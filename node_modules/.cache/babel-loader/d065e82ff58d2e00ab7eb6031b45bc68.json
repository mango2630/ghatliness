{"remainingRequest":"F:\\Web_design\\item\\node_modules\\babel-loader\\lib\\index.js!F:\\Web_design\\item\\src\\assets\\promanage\\js\\vue.js","dependencies":[{"path":"F:\\Web_design\\item\\src\\assets\\promanage\\js\\vue.js","mtime":1613734262281},{"path":"F:\\Web_design\\item\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\Web_design\\item\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF90eXBlb2YgPSByZXF1aXJlKCJGOi9XZWJfZGVzaWduL2l0ZW0vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mIikuZGVmYXVsdDsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3Rvci5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5mcmVlemUuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuY29uc3RydWN0b3IuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZS5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LW5hbWVzLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmlzLWV4dGVuc2libGUuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmFuY2hvci5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJlZHVjZS5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci50by1maXhlZC5qcyIpOwoKLyohCiAqIFZ1ZS5qcyB2MS4wLjI2CiAqIChjKSAyMDE2IEV2YW4gWW91CiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4KICovCihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7CiAgKHR5cGVvZiBleHBvcnRzID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihleHBvcnRzKSkgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOiB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZmFjdG9yeSkgOiBnbG9iYWwuVnVlID0gZmFjdG9yeSgpOwp9KSh0aGlzLCBmdW5jdGlvbiAoKSB7CiAgJ3VzZSBzdHJpY3QnOwoKICBmdW5jdGlvbiBzZXQob2JqLCBrZXksIHZhbCkgewogICAgaWYgKGhhc093bihvYmosIGtleSkpIHsKICAgICAgb2JqW2tleV0gPSB2YWw7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAob2JqLl9pc1Z1ZSkgewogICAgICBzZXQob2JqLl9kYXRhLCBrZXksIHZhbCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgb2IgPSBvYmouX19vYl9fOwoKICAgIGlmICghb2IpIHsKICAgICAgb2JqW2tleV0gPSB2YWw7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBvYi5jb252ZXJ0KGtleSwgdmFsKTsKICAgIG9iLmRlcC5ub3RpZnkoKTsKCiAgICBpZiAob2Iudm1zKSB7CiAgICAgIHZhciBpID0gb2Iudm1zLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB2YXIgdm0gPSBvYi52bXNbaV07CgogICAgICAgIHZtLl9wcm94eShrZXkpOwoKICAgICAgICB2bS5fZGlnZXN0KCk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdmFsOwogIH0KICAvKioKICAgKiBEZWxldGUgYSBwcm9wZXJ0eSBhbmQgdHJpZ2dlciBjaGFuZ2UgaWYgbmVjZXNzYXJ5LgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IG9iagogICAqIEBwYXJhbSB7U3RyaW5nfSBrZXkKICAgKi8KCgogIGZ1bmN0aW9uIGRlbChvYmosIGtleSkgewogICAgaWYgKCFoYXNPd24ob2JqLCBrZXkpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBkZWxldGUgb2JqW2tleV07CiAgICB2YXIgb2IgPSBvYmouX19vYl9fOwoKICAgIGlmICghb2IpIHsKICAgICAgaWYgKG9iai5faXNWdWUpIHsKICAgICAgICBkZWxldGUgb2JqLl9kYXRhW2tleV07CgogICAgICAgIG9iai5fZGlnZXN0KCk7CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0KCiAgICBvYi5kZXAubm90aWZ5KCk7CgogICAgaWYgKG9iLnZtcykgewogICAgICB2YXIgaSA9IG9iLnZtcy5sZW5ndGg7CgogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgdmFyIHZtID0gb2Iudm1zW2ldOwoKICAgICAgICB2bS5fdW5wcm94eShrZXkpOwoKICAgICAgICB2bS5fZGlnZXN0KCk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CiAgLyoqCiAgICogQ2hlY2sgd2hldGhlciB0aGUgb2JqZWN0IGhhcyB0aGUgcHJvcGVydHkuCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqCiAgICogQHBhcmFtIHtTdHJpbmd9IGtleQogICAqIEByZXR1cm4ge0Jvb2xlYW59CiAgICovCgogIGZ1bmN0aW9uIGhhc093bihvYmosIGtleSkgewogICAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpOwogIH0KICAvKioKICAgKiBDaGVjayBpZiBhbiBleHByZXNzaW9uIGlzIGEgbGl0ZXJhbCB2YWx1ZS4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBleHAKICAgKiBAcmV0dXJuIHtCb29sZWFufQogICAqLwoKCiAgdmFyIGxpdGVyYWxWYWx1ZVJFID0gL15ccz8odHJ1ZXxmYWxzZXwtP1tcZFwuXSt8J1teJ10qJ3wiW14iXSoiKVxzPyQvOwoKICBmdW5jdGlvbiBpc0xpdGVyYWwoZXhwKSB7CiAgICByZXR1cm4gbGl0ZXJhbFZhbHVlUkUudGVzdChleHApOwogIH0KICAvKioKICAgKiBDaGVjayBpZiBhIHN0cmluZyBzdGFydHMgd2l0aCAkIG9yIF8KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBzdHIKICAgKiBAcmV0dXJuIHtCb29sZWFufQogICAqLwoKCiAgZnVuY3Rpb24gaXNSZXNlcnZlZChzdHIpIHsKICAgIHZhciBjID0gKHN0ciArICcnKS5jaGFyQ29kZUF0KDApOwogICAgcmV0dXJuIGMgPT09IDB4MjQgfHwgYyA9PT0gMHg1RjsKICB9CiAgLyoqCiAgICogR3VhcmQgdGV4dCBvdXRwdXQsIG1ha2Ugc3VyZSB1bmRlZmluZWQgb3V0cHV0cwogICAqIGVtcHR5IHN0cmluZwogICAqCiAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAqIEByZXR1cm4ge1N0cmluZ30KICAgKi8KCgogIGZ1bmN0aW9uIF90b1N0cmluZyh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyAnJyA6IHZhbHVlLnRvU3RyaW5nKCk7CiAgfQogIC8qKgogICAqIENoZWNrIGFuZCBjb252ZXJ0IHBvc3NpYmxlIG51bWVyaWMgc3RyaW5ncyB0byBudW1iZXJzCiAgICogYmVmb3JlIHNldHRpbmcgYmFjayB0byBkYXRhCiAgICoKICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICogQHJldHVybiB7KnxOdW1iZXJ9CiAgICovCgoKICBmdW5jdGlvbiB0b051bWJlcih2YWx1ZSkgewogICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHBhcnNlZCA9IE51bWJlcih2YWx1ZSk7CiAgICAgIHJldHVybiBpc05hTihwYXJzZWQpID8gdmFsdWUgOiBwYXJzZWQ7CiAgICB9CiAgfQogIC8qKgogICAqIENvbnZlcnQgc3RyaW5nIGJvb2xlYW4gbGl0ZXJhbHMgaW50byByZWFsIGJvb2xlYW5zLgogICAqCiAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAqIEByZXR1cm4geyp8Qm9vbGVhbn0KICAgKi8KCgogIGZ1bmN0aW9uIHRvQm9vbGVhbih2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlID09PSAndHJ1ZScgPyB0cnVlIDogdmFsdWUgPT09ICdmYWxzZScgPyBmYWxzZSA6IHZhbHVlOwogIH0KICAvKioKICAgKiBTdHJpcCBxdW90ZXMgZnJvbSBhIHN0cmluZwogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cgogICAqIEByZXR1cm4ge1N0cmluZyB8IGZhbHNlfQogICAqLwoKCiAgZnVuY3Rpb24gc3RyaXBRdW90ZXMoc3RyKSB7CiAgICB2YXIgYSA9IHN0ci5jaGFyQ29kZUF0KDApOwogICAgdmFyIGIgPSBzdHIuY2hhckNvZGVBdChzdHIubGVuZ3RoIC0gMSk7CiAgICByZXR1cm4gYSA9PT0gYiAmJiAoYSA9PT0gMHgyMiB8fCBhID09PSAweDI3KSA/IHN0ci5zbGljZSgxLCAtMSkgOiBzdHI7CiAgfQogIC8qKgogICAqIENhbWVsaXplIGEgaHlwaGVuLWRlbG1pdGVkIHN0cmluZy4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBzdHIKICAgKiBAcmV0dXJuIHtTdHJpbmd9CiAgICovCgoKICB2YXIgY2FtZWxpemVSRSA9IC8tKFx3KS9nOwoKICBmdW5jdGlvbiBjYW1lbGl6ZShzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZShjYW1lbGl6ZVJFLCB0b1VwcGVyKTsKICB9CgogIGZ1bmN0aW9uIHRvVXBwZXIoXywgYykgewogICAgcmV0dXJuIGMgPyBjLnRvVXBwZXJDYXNlKCkgOiAnJzsKICB9CiAgLyoqCiAgICogSHlwaGVuYXRlIGEgY2FtZWxDYXNlIHN0cmluZy4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBzdHIKICAgKiBAcmV0dXJuIHtTdHJpbmd9CiAgICovCgoKICB2YXIgaHlwaGVuYXRlUkUgPSAvKFthLXpcZF0pKFtBLVpdKS9nOwoKICBmdW5jdGlvbiBoeXBoZW5hdGUoc3RyKSB7CiAgICByZXR1cm4gc3RyLnJlcGxhY2UoaHlwaGVuYXRlUkUsICckMS0kMicpLnRvTG93ZXJDYXNlKCk7CiAgfQogIC8qKgogICAqIENvbnZlcnRzIGh5cGhlbi91bmRlcnNjb3JlL3NsYXNoIGRlbGltaXRlcmVkIG5hbWVzIGludG8KICAgKiBjYW1lbGl6ZWQgY2xhc3NOYW1lcy4KICAgKgogICAqIGUuZy4gbXktY29tcG9uZW50ID0+IE15Q29tcG9uZW50CiAgICogICAgICBzb21lX2Vsc2UgICAgPT4gU29tZUVsc2UKICAgKiAgICAgIHNvbWUvY29tcCAgICA9PiBTb21lQ29tcAogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cgogICAqIEByZXR1cm4ge1N0cmluZ30KICAgKi8KCgogIHZhciBjbGFzc2lmeVJFID0gLyg/Ol58Wy1fXC9dKShcdykvZzsKCiAgZnVuY3Rpb24gY2xhc3NpZnkoc3RyKSB7CiAgICByZXR1cm4gc3RyLnJlcGxhY2UoY2xhc3NpZnlSRSwgdG9VcHBlcik7CiAgfQogIC8qKgogICAqIFNpbXBsZSBiaW5kLCBmYXN0ZXIgdGhhbiBuYXRpdmUKICAgKgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAgICogQHBhcmFtIHtPYmplY3R9IGN0eAogICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAqLwoKCiAgZnVuY3Rpb24gYmluZChmbiwgY3R4KSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKGEpIHsKICAgICAgdmFyIGwgPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICByZXR1cm4gbCA/IGwgPiAxID8gZm4uYXBwbHkoY3R4LCBhcmd1bWVudHMpIDogZm4uY2FsbChjdHgsIGEpIDogZm4uY2FsbChjdHgpOwogICAgfTsKICB9CiAgLyoqCiAgICogQ29udmVydCBhbiBBcnJheS1saWtlIG9iamVjdCB0byBhIHJlYWwgQXJyYXkuCiAgICoKICAgKiBAcGFyYW0ge0FycmF5LWxpa2V9IGxpc3QKICAgKiBAcGFyYW0ge051bWJlcn0gW3N0YXJ0XSAtIHN0YXJ0IGluZGV4CiAgICogQHJldHVybiB7QXJyYXl9CiAgICovCgoKICBmdW5jdGlvbiB0b0FycmF5KGxpc3QsIHN0YXJ0KSB7CiAgICBzdGFydCA9IHN0YXJ0IHx8IDA7CiAgICB2YXIgaSA9IGxpc3QubGVuZ3RoIC0gc3RhcnQ7CiAgICB2YXIgcmV0ID0gbmV3IEFycmF5KGkpOwoKICAgIHdoaWxlIChpLS0pIHsKICAgICAgcmV0W2ldID0gbGlzdFtpICsgc3RhcnRdOwogICAgfQoKICAgIHJldHVybiByZXQ7CiAgfQogIC8qKgogICAqIE1peCBwcm9wZXJ0aWVzIGludG8gdGFyZ2V0IG9iamVjdC4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSB0bwogICAqIEBwYXJhbSB7T2JqZWN0fSBmcm9tCiAgICovCgoKICBmdW5jdGlvbiBleHRlbmQodG8sIGZyb20pIHsKICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoZnJvbSk7CiAgICB2YXIgaSA9IGtleXMubGVuZ3RoOwoKICAgIHdoaWxlIChpLS0pIHsKICAgICAgdG9ba2V5c1tpXV0gPSBmcm9tW2tleXNbaV1dOwogICAgfQoKICAgIHJldHVybiB0bzsKICB9CiAgLyoqCiAgICogUXVpY2sgb2JqZWN0IGNoZWNrIC0gdGhpcyBpcyBwcmltYXJpbHkgdXNlZCB0byB0ZWxsCiAgICogT2JqZWN0cyBmcm9tIHByaW1pdGl2ZSB2YWx1ZXMgd2hlbiB3ZSBrbm93IHRoZSB2YWx1ZQogICAqIGlzIGEgSlNPTi1jb21wbGlhbnQgdHlwZS4KICAgKgogICAqIEBwYXJhbSB7Kn0gb2JqCiAgICogQHJldHVybiB7Qm9vbGVhbn0KICAgKi8KCgogIGZ1bmN0aW9uIGlzT2JqZWN0KG9iaikgewogICAgcmV0dXJuIG9iaiAhPT0gbnVsbCAmJiBfdHlwZW9mKG9iaikgPT09ICdvYmplY3QnOwogIH0KICAvKioKICAgKiBTdHJpY3Qgb2JqZWN0IHR5cGUgY2hlY2suIE9ubHkgcmV0dXJucyB0cnVlCiAgICogZm9yIHBsYWluIEphdmFTY3JpcHQgb2JqZWN0cy4KICAgKgogICAqIEBwYXJhbSB7Kn0gb2JqCiAgICogQHJldHVybiB7Qm9vbGVhbn0KICAgKi8KCgogIHZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CiAgdmFyIE9CSkVDVF9TVFJJTkcgPSAnW29iamVjdCBPYmplY3RdJzsKCiAgZnVuY3Rpb24gaXNQbGFpbk9iamVjdChvYmopIHsKICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT09IE9CSkVDVF9TVFJJTkc7CiAgfQogIC8qKgogICAqIEFycmF5IHR5cGUgY2hlY2suCiAgICoKICAgKiBAcGFyYW0geyp9IG9iagogICAqIEByZXR1cm4ge0Jvb2xlYW59CiAgICovCgoKICB2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CiAgLyoqCiAgICogRGVmaW5lIGEgcHJvcGVydHkuCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqCiAgICogQHBhcmFtIHtTdHJpbmd9IGtleQogICAqIEBwYXJhbSB7Kn0gdmFsCiAgICogQHBhcmFtIHtCb29sZWFufSBbZW51bWVyYWJsZV0KICAgKi8KCiAgZnVuY3Rpb24gZGVmKG9iaiwga2V5LCB2YWwsIGVudW1lcmFibGUpIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsLAogICAgICBlbnVtZXJhYmxlOiAhIWVudW1lcmFibGUsCiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0pOwogIH0KICAvKioKICAgKiBEZWJvdW5jZSBhIGZ1bmN0aW9uIHNvIGl0IG9ubHkgZ2V0cyBjYWxsZWQgYWZ0ZXIgdGhlCiAgICogaW5wdXQgc3RvcHMgYXJyaXZpbmcgYWZ0ZXIgdGhlIGdpdmVuIHdhaXQgcGVyaW9kLgogICAqCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYwogICAqIEBwYXJhbSB7TnVtYmVyfSB3YWl0CiAgICogQHJldHVybiB7RnVuY3Rpb259IC0gdGhlIGRlYm91bmNlZCBmdW5jdGlvbgogICAqLwoKCiAgZnVuY3Rpb24gX2RlYm91bmNlKGZ1bmMsIHdhaXQpIHsKICAgIHZhciB0aW1lb3V0LCBhcmdzLCBjb250ZXh0LCB0aW1lc3RhbXAsIHJlc3VsdDsKCiAgICB2YXIgbGF0ZXIgPSBmdW5jdGlvbiBsYXRlcigpIHsKICAgICAgdmFyIGxhc3QgPSBEYXRlLm5vdygpIC0gdGltZXN0YW1wOwoKICAgICAgaWYgKGxhc3QgPCB3YWl0ICYmIGxhc3QgPj0gMCkgewogICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0IC0gbGFzdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICBpZiAoIXRpbWVvdXQpIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICBjb250ZXh0ID0gdGhpczsKICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgICAgdGltZXN0YW1wID0gRGF0ZS5ub3coKTsKCiAgICAgIGlmICghdGltZW91dCkgewogICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfQogIC8qKgogICAqIE1hbnVhbCBpbmRleE9mIGJlY2F1c2UgaXQncyBzbGlnaHRseSBmYXN0ZXIgdGhhbgogICAqIG5hdGl2ZS4KICAgKgogICAqIEBwYXJhbSB7QXJyYXl9IGFycgogICAqIEBwYXJhbSB7Kn0gb2JqCiAgICovCgoKICBmdW5jdGlvbiBpbmRleE9mKGFyciwgb2JqKSB7CiAgICB2YXIgaSA9IGFyci5sZW5ndGg7CgogICAgd2hpbGUgKGktLSkgewogICAgICBpZiAoYXJyW2ldID09PSBvYmopIHJldHVybiBpOwogICAgfQoKICAgIHJldHVybiAtMTsKICB9CiAgLyoqCiAgICogTWFrZSBhIGNhbmNlbGxhYmxlIHZlcnNpb24gb2YgYW4gYXN5bmMgY2FsbGJhY2suCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAqLwoKCiAgZnVuY3Rpb24gY2FuY2VsbGFibGUoZm4pIHsKICAgIHZhciBjYiA9IGZ1bmN0aW9uIGNiKCkgewogICAgICBpZiAoIWNiLmNhbmNlbGxlZCkgewogICAgICAgIHJldHVybiBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwoKICAgIGNiLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgY2IuY2FuY2VsbGVkID0gdHJ1ZTsKICAgIH07CgogICAgcmV0dXJuIGNiOwogIH0KICAvKioKICAgKiBDaGVjayBpZiB0d28gdmFsdWVzIGFyZSBsb29zZWx5IGVxdWFsIC0gdGhhdCBpcywKICAgKiBpZiB0aGV5IGFyZSBwbGFpbiBvYmplY3RzLCBkbyB0aGV5IGhhdmUgdGhlIHNhbWUgc2hhcGU/CiAgICoKICAgKiBAcGFyYW0geyp9IGEKICAgKiBAcGFyYW0geyp9IGIKICAgKiBAcmV0dXJuIHtCb29sZWFufQogICAqLwoKCiAgZnVuY3Rpb24gbG9vc2VFcXVhbChhLCBiKSB7CiAgICAvKiBlc2xpbnQtZGlzYWJsZSBlcWVxZXEgKi8KICAgIHJldHVybiBhID09IGIgfHwgKGlzT2JqZWN0KGEpICYmIGlzT2JqZWN0KGIpID8gSlNPTi5zdHJpbmdpZnkoYSkgPT09IEpTT04uc3RyaW5naWZ5KGIpIDogZmFsc2UpOwogICAgLyogZXNsaW50LWVuYWJsZSBlcWVxZXEgKi8KICB9CgogIHZhciBoYXNQcm90byA9ICgnX19wcm90b19fJyBpbiB7fSk7IC8vIEJyb3dzZXIgZW52aXJvbm1lbnQgc25pZmZpbmcKCiAgdmFyIGluQnJvd3NlciA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh3aW5kb3cpICE9PSAnW29iamVjdCBPYmplY3RdJzsgLy8gZGV0ZWN0IGRldnRvb2xzCgogIHZhciBkZXZ0b29scyA9IGluQnJvd3NlciAmJiB3aW5kb3cuX19WVUVfREVWVE9PTFNfR0xPQkFMX0hPT0tfXzsgLy8gVUEgc25pZmZpbmcgZm9yIHdvcmtpbmcgYXJvdW5kIGJyb3dzZXItc3BlY2lmaWMgcXVpcmtzCgogIHZhciBVQSA9IGluQnJvd3NlciAmJiB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpOwogIHZhciBpc0lFID0gVUEgJiYgVUEuaW5kZXhPZigndHJpZGVudCcpID4gMDsKICB2YXIgaXNJRTkgPSBVQSAmJiBVQS5pbmRleE9mKCdtc2llIDkuMCcpID4gMDsKICB2YXIgaXNBbmRyb2lkID0gVUEgJiYgVUEuaW5kZXhPZignYW5kcm9pZCcpID4gMDsKICB2YXIgaXNJb3MgPSBVQSAmJiAvKGlwaG9uZXxpcGFkfGlwb2R8aW9zKS9pLnRlc3QoVUEpOwogIHZhciBpb3NWZXJzaW9uTWF0Y2ggPSBpc0lvcyAmJiBVQS5tYXRjaCgvb3MgKFtcZF9dKykvKTsKICB2YXIgaW9zVmVyc2lvbiA9IGlvc1ZlcnNpb25NYXRjaCAmJiBpb3NWZXJzaW9uTWF0Y2hbMV0uc3BsaXQoJ18nKTsgLy8gZGV0ZWN0aW5nIGlPUyBVSVdlYlZpZXcgYnkgaW5kZXhlZERCCgogIHZhciBoYXNNdXRhdGlvbk9ic2VydmVyQnVnID0gaW9zVmVyc2lvbiAmJiBOdW1iZXIoaW9zVmVyc2lvblswXSkgPj0gOSAmJiBOdW1iZXIoaW9zVmVyc2lvblsxXSkgPj0gMyAmJiAhd2luZG93LmluZGV4ZWREQjsKICB2YXIgdHJhbnNpdGlvblByb3AgPSB1bmRlZmluZWQ7CiAgdmFyIHRyYW5zaXRpb25FbmRFdmVudCA9IHVuZGVmaW5lZDsKICB2YXIgYW5pbWF0aW9uUHJvcCA9IHVuZGVmaW5lZDsKICB2YXIgYW5pbWF0aW9uRW5kRXZlbnQgPSB1bmRlZmluZWQ7IC8vIFRyYW5zaXRpb24gcHJvcGVydHkvZXZlbnQgc25pZmZpbmcKCiAgaWYgKGluQnJvd3NlciAmJiAhaXNJRTkpIHsKICAgIHZhciBpc1dlYmtpdFRyYW5zID0gd2luZG93Lm9udHJhbnNpdGlvbmVuZCA9PT0gdW5kZWZpbmVkICYmIHdpbmRvdy5vbndlYmtpdHRyYW5zaXRpb25lbmQgIT09IHVuZGVmaW5lZDsKICAgIHZhciBpc1dlYmtpdEFuaW0gPSB3aW5kb3cub25hbmltYXRpb25lbmQgPT09IHVuZGVmaW5lZCAmJiB3aW5kb3cub253ZWJraXRhbmltYXRpb25lbmQgIT09IHVuZGVmaW5lZDsKICAgIHRyYW5zaXRpb25Qcm9wID0gaXNXZWJraXRUcmFucyA/ICdXZWJraXRUcmFuc2l0aW9uJyA6ICd0cmFuc2l0aW9uJzsKICAgIHRyYW5zaXRpb25FbmRFdmVudCA9IGlzV2Via2l0VHJhbnMgPyAnd2Via2l0VHJhbnNpdGlvbkVuZCcgOiAndHJhbnNpdGlvbmVuZCc7CiAgICBhbmltYXRpb25Qcm9wID0gaXNXZWJraXRBbmltID8gJ1dlYmtpdEFuaW1hdGlvbicgOiAnYW5pbWF0aW9uJzsKICAgIGFuaW1hdGlvbkVuZEV2ZW50ID0gaXNXZWJraXRBbmltID8gJ3dlYmtpdEFuaW1hdGlvbkVuZCcgOiAnYW5pbWF0aW9uZW5kJzsKICB9CiAgLyoqCiAgICogRGVmZXIgYSB0YXNrIHRvIGV4ZWN1dGUgaXQgYXN5bmNocm9ub3VzbHkuIElkZWFsbHkgdGhpcwogICAqIHNob3VsZCBiZSBleGVjdXRlZCBhcyBhIG1pY3JvdGFzaywgc28gd2UgbGV2ZXJhZ2UKICAgKiBNdXRhdGlvbk9ic2VydmVyIGlmIGl0J3MgYXZhaWxhYmxlLCBhbmQgZmFsbGJhY2sgdG8KICAgKiBzZXRUaW1lb3V0KDApLgogICAqCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2IKICAgKiBAcGFyYW0ge09iamVjdH0gY3R4CiAgICovCgoKICB2YXIgbmV4dFRpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY2FsbGJhY2tzID0gW107CiAgICB2YXIgcGVuZGluZyA9IGZhbHNlOwogICAgdmFyIHRpbWVyRnVuYzsKCiAgICBmdW5jdGlvbiBuZXh0VGlja0hhbmRsZXIoKSB7CiAgICAgIHBlbmRpbmcgPSBmYWxzZTsKICAgICAgdmFyIGNvcGllcyA9IGNhbGxiYWNrcy5zbGljZSgwKTsKICAgICAgY2FsbGJhY2tzID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvcGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvcGllc1tpXSgpOwogICAgICB9CiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCgogICAgaWYgKHR5cGVvZiBNdXRhdGlvbk9ic2VydmVyICE9PSAndW5kZWZpbmVkJyAmJiAhaGFzTXV0YXRpb25PYnNlcnZlckJ1ZykgewogICAgICB2YXIgY291bnRlciA9IDE7CiAgICAgIHZhciBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKG5leHRUaWNrSGFuZGxlcik7CiAgICAgIHZhciB0ZXh0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNvdW50ZXIpOwogICAgICBvYnNlcnZlci5vYnNlcnZlKHRleHROb2RlLCB7CiAgICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZQogICAgICB9KTsKCiAgICAgIHRpbWVyRnVuYyA9IGZ1bmN0aW9uIHRpbWVyRnVuYygpIHsKICAgICAgICBjb3VudGVyID0gKGNvdW50ZXIgKyAxKSAlIDI7CiAgICAgICAgdGV4dE5vZGUuZGF0YSA9IGNvdW50ZXI7CiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICAvLyB3ZWJwYWNrIGF0dGVtcHRzIHRvIGluamVjdCBhIHNoaW0gZm9yIHNldEltbWVkaWF0ZQogICAgICAvLyBpZiBpdCBpcyB1c2VkIGFzIGEgZ2xvYmFsLCBzbyB3ZSBoYXZlIHRvIHdvcmsgYXJvdW5kIHRoYXQgdG8KICAgICAgLy8gYXZvaWQgYnVuZGxpbmcgdW5uZWNlc3NhcnkgY29kZS4KICAgICAgdmFyIGNvbnRleHQgPSBpbkJyb3dzZXIgPyB3aW5kb3cgOiB0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbCA6IHt9OwogICAgICB0aW1lckZ1bmMgPSBjb250ZXh0LnNldEltbWVkaWF0ZSB8fCBzZXRUaW1lb3V0OwogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbiAoY2IsIGN0eCkgewogICAgICB2YXIgZnVuYyA9IGN0eCA/IGZ1bmN0aW9uICgpIHsKICAgICAgICBjYi5jYWxsKGN0eCk7CiAgICAgIH0gOiBjYjsKICAgICAgY2FsbGJhY2tzLnB1c2goZnVuYyk7CiAgICAgIGlmIChwZW5kaW5nKSByZXR1cm47CiAgICAgIHBlbmRpbmcgPSB0cnVlOwogICAgICB0aW1lckZ1bmMobmV4dFRpY2tIYW5kbGVyLCAwKTsKICAgIH07CiAgfSgpOwoKICB2YXIgX1NldCA9IHVuZGVmaW5lZDsKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgaWYgKHR5cGVvZiBTZXQgIT09ICd1bmRlZmluZWQnICYmIFNldC50b1N0cmluZygpLm1hdGNoKC9uYXRpdmUgY29kZS8pKSB7CiAgICAvLyB1c2UgbmF0aXZlIFNldCB3aGVuIGF2YWlsYWJsZS4KICAgIF9TZXQgPSBTZXQ7CiAgfSBlbHNlIHsKICAgIC8vIGEgbm9uLXN0YW5kYXJkIFNldCBwb2x5ZmlsbCB0aGF0IG9ubHkgd29ya3Mgd2l0aCBwcmltaXRpdmUga2V5cy4KICAgIF9TZXQgPSBmdW5jdGlvbiBfU2V0KCkgewogICAgICB0aGlzLnNldCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB9OwoKICAgIF9TZXQucHJvdG90eXBlLmhhcyA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0W2tleV0gIT09IHVuZGVmaW5lZDsKICAgIH07CgogICAgX1NldC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKGtleSkgewogICAgICB0aGlzLnNldFtrZXldID0gMTsKICAgIH07CgogICAgX1NldC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuc2V0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBDYWNoZShsaW1pdCkgewogICAgdGhpcy5zaXplID0gMDsKICAgIHRoaXMubGltaXQgPSBsaW1pdDsKICAgIHRoaXMuaGVhZCA9IHRoaXMudGFpbCA9IHVuZGVmaW5lZDsKICAgIHRoaXMuX2tleW1hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgfQoKICB2YXIgcCA9IENhY2hlLnByb3RvdHlwZTsKICAvKioKICAgKiBQdXQgPHZhbHVlPiBpbnRvIHRoZSBjYWNoZSBhc3NvY2lhdGVkIHdpdGggPGtleT4uCiAgICogUmV0dXJucyB0aGUgZW50cnkgd2hpY2ggd2FzIHJlbW92ZWQgdG8gbWFrZSByb29tIGZvcgogICAqIHRoZSBuZXcgZW50cnkuIE90aGVyd2lzZSB1bmRlZmluZWQgaXMgcmV0dXJuZWQuCiAgICogKGkuZS4gaWYgdGhlcmUgd2FzIGVub3VnaCByb29tIGFscmVhZHkpLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGtleQogICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgKiBAcmV0dXJuIHtFbnRyeXx1bmRlZmluZWR9CiAgICovCgogIHAucHV0ID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgIHZhciByZW1vdmVkOwogICAgdmFyIGVudHJ5ID0gdGhpcy5nZXQoa2V5LCB0cnVlKTsKCiAgICBpZiAoIWVudHJ5KSB7CiAgICAgIGlmICh0aGlzLnNpemUgPT09IHRoaXMubGltaXQpIHsKICAgICAgICByZW1vdmVkID0gdGhpcy5zaGlmdCgpOwogICAgICB9CgogICAgICBlbnRyeSA9IHsKICAgICAgICBrZXk6IGtleQogICAgICB9OwogICAgICB0aGlzLl9rZXltYXBba2V5XSA9IGVudHJ5OwoKICAgICAgaWYgKHRoaXMudGFpbCkgewogICAgICAgIHRoaXMudGFpbC5uZXdlciA9IGVudHJ5OwogICAgICAgIGVudHJ5Lm9sZGVyID0gdGhpcy50YWlsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaGVhZCA9IGVudHJ5OwogICAgICB9CgogICAgICB0aGlzLnRhaWwgPSBlbnRyeTsKICAgICAgdGhpcy5zaXplKys7CiAgICB9CgogICAgZW50cnkudmFsdWUgPSB2YWx1ZTsKICAgIHJldHVybiByZW1vdmVkOwogIH07CiAgLyoqCiAgICogUHVyZ2UgdGhlIGxlYXN0IHJlY2VudGx5IHVzZWQgKG9sZGVzdCkgZW50cnkgZnJvbSB0aGUKICAgKiBjYWNoZS4gUmV0dXJucyB0aGUgcmVtb3ZlZCBlbnRyeSBvciB1bmRlZmluZWQgaWYgdGhlCiAgICogY2FjaGUgd2FzIGVtcHR5LgogICAqLwoKCiAgcC5zaGlmdCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbnRyeSA9IHRoaXMuaGVhZDsKCiAgICBpZiAoZW50cnkpIHsKICAgICAgdGhpcy5oZWFkID0gdGhpcy5oZWFkLm5ld2VyOwogICAgICB0aGlzLmhlYWQub2xkZXIgPSB1bmRlZmluZWQ7CiAgICAgIGVudHJ5Lm5ld2VyID0gZW50cnkub2xkZXIgPSB1bmRlZmluZWQ7CiAgICAgIHRoaXMuX2tleW1hcFtlbnRyeS5rZXldID0gdW5kZWZpbmVkOwogICAgICB0aGlzLnNpemUtLTsKICAgIH0KCiAgICByZXR1cm4gZW50cnk7CiAgfTsKICAvKioKICAgKiBHZXQgYW5kIHJlZ2lzdGVyIHJlY2VudCB1c2Ugb2YgPGtleT4uIFJldHVybnMgdGhlIHZhbHVlCiAgICogYXNzb2NpYXRlZCB3aXRoIDxrZXk+IG9yIHVuZGVmaW5lZCBpZiBub3QgaW4gY2FjaGUuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5CiAgICogQHBhcmFtIHtCb29sZWFufSByZXR1cm5FbnRyeQogICAqIEByZXR1cm4ge0VudHJ5fCp9CiAgICovCgoKICBwLmdldCA9IGZ1bmN0aW9uIChrZXksIHJldHVybkVudHJ5KSB7CiAgICB2YXIgZW50cnkgPSB0aGlzLl9rZXltYXBba2V5XTsKICAgIGlmIChlbnRyeSA9PT0gdW5kZWZpbmVkKSByZXR1cm47CgogICAgaWYgKGVudHJ5ID09PSB0aGlzLnRhaWwpIHsKICAgICAgcmV0dXJuIHJldHVybkVudHJ5ID8gZW50cnkgOiBlbnRyeS52YWx1ZTsKICAgIH0gLy8gSEVBRC0tLS0tLS0tLS0tLS0tVEFJTAogICAgLy8gICA8Lm9sZGVyICAgLm5ld2VyPgogICAgLy8gIDwtLS0gYWRkIGRpcmVjdGlvbiAtLQogICAgLy8gICBBICBCICBDICA8RD4gIEUKCgogICAgaWYgKGVudHJ5Lm5ld2VyKSB7CiAgICAgIGlmIChlbnRyeSA9PT0gdGhpcy5oZWFkKSB7CiAgICAgICAgdGhpcy5oZWFkID0gZW50cnkubmV3ZXI7CiAgICAgIH0KCiAgICAgIGVudHJ5Lm5ld2VyLm9sZGVyID0gZW50cnkub2xkZXI7IC8vIEMgPC0tIEUuCiAgICB9CgogICAgaWYgKGVudHJ5Lm9sZGVyKSB7CiAgICAgIGVudHJ5Lm9sZGVyLm5ld2VyID0gZW50cnkubmV3ZXI7IC8vIEMuIC0tPiBFCiAgICB9CgogICAgZW50cnkubmV3ZXIgPSB1bmRlZmluZWQ7IC8vIEQgLS14CgogICAgZW50cnkub2xkZXIgPSB0aGlzLnRhaWw7IC8vIEQuIC0tPiBFCgogICAgaWYgKHRoaXMudGFpbCkgewogICAgICB0aGlzLnRhaWwubmV3ZXIgPSBlbnRyeTsgLy8gRS4gPC0tIEQKICAgIH0KCiAgICB0aGlzLnRhaWwgPSBlbnRyeTsKICAgIHJldHVybiByZXR1cm5FbnRyeSA/IGVudHJ5IDogZW50cnkudmFsdWU7CiAgfTsKCiAgdmFyIGNhY2hlJDEgPSBuZXcgQ2FjaGUoMTAwMCk7CiAgdmFyIGZpbHRlclRva2VuUkUgPSAvW15ccyciXSt8J1teJ10qJ3wiW14iXSoiL2c7CiAgdmFyIHJlc2VydmVkQXJnUkUgPSAvXmluJHxeLT9cZCsvOwogIC8qKgogICAqIFBhcnNlciBzdGF0ZQogICAqLwoKICB2YXIgc3RyOwogIHZhciBkaXI7CiAgdmFyIGM7CiAgdmFyIHByZXY7CiAgdmFyIGk7CiAgdmFyIGw7CiAgdmFyIGxhc3RGaWx0ZXJJbmRleDsKICB2YXIgaW5TaW5nbGU7CiAgdmFyIGluRG91YmxlOwogIHZhciBjdXJseTsKICB2YXIgc3F1YXJlOwogIHZhciBwYXJlbjsKICAvKioKICAgKiBQdXNoIGEgZmlsdGVyIHRvIHRoZSBjdXJyZW50IGRpcmVjdGl2ZSBvYmplY3QKICAgKi8KCiAgZnVuY3Rpb24gcHVzaEZpbHRlcigpIHsKICAgIHZhciBleHAgPSBzdHIuc2xpY2UobGFzdEZpbHRlckluZGV4LCBpKS50cmltKCk7CiAgICB2YXIgZmlsdGVyOwoKICAgIGlmIChleHApIHsKICAgICAgZmlsdGVyID0ge307CiAgICAgIHZhciB0b2tlbnMgPSBleHAubWF0Y2goZmlsdGVyVG9rZW5SRSk7CiAgICAgIGZpbHRlci5uYW1lID0gdG9rZW5zWzBdOwoKICAgICAgaWYgKHRva2Vucy5sZW5ndGggPiAxKSB7CiAgICAgICAgZmlsdGVyLmFyZ3MgPSB0b2tlbnMuc2xpY2UoMSkubWFwKHByb2Nlc3NGaWx0ZXJBcmcpOwogICAgICB9CiAgICB9CgogICAgaWYgKGZpbHRlcikgewogICAgICAoZGlyLmZpbHRlcnMgPSBkaXIuZmlsdGVycyB8fCBbXSkucHVzaChmaWx0ZXIpOwogICAgfQoKICAgIGxhc3RGaWx0ZXJJbmRleCA9IGkgKyAxOwogIH0KICAvKioKICAgKiBDaGVjayBpZiBhbiBhcmd1bWVudCBpcyBkeW5hbWljIGFuZCBzdHJpcCBxdW90ZXMuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gYXJnCiAgICogQHJldHVybiB7T2JqZWN0fQogICAqLwoKCiAgZnVuY3Rpb24gcHJvY2Vzc0ZpbHRlckFyZyhhcmcpIHsKICAgIGlmIChyZXNlcnZlZEFyZ1JFLnRlc3QoYXJnKSkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB0b051bWJlcihhcmcpLAogICAgICAgIGR5bmFtaWM6IGZhbHNlCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICB2YXIgc3RyaXBwZWQgPSBzdHJpcFF1b3RlcyhhcmcpOwogICAgICB2YXIgZHluYW1pYyA9IHN0cmlwcGVkID09PSBhcmc7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IGR5bmFtaWMgPyBhcmcgOiBzdHJpcHBlZCwKICAgICAgICBkeW5hbWljOiBkeW5hbWljCiAgICAgIH07CiAgICB9CiAgfQogIC8qKgogICAqIFBhcnNlIGEgZGlyZWN0aXZlIHZhbHVlIGFuZCBleHRyYWN0IHRoZSBleHByZXNzaW9uCiAgICogYW5kIGl0cyBmaWx0ZXJzIGludG8gYSBkZXNjcmlwdG9yLgogICAqCiAgICogRXhhbXBsZToKICAgKgogICAqICJhICsgMSB8IHVwcGVyY2FzZSIgd2lsbCB5aWVsZDoKICAgKiB7CiAgICogICBleHByZXNzaW9uOiAnYSArIDEnLAogICAqICAgZmlsdGVyczogWwogICAqICAgICB7IG5hbWU6ICd1cHBlcmNhc2UnLCBhcmdzOiBudWxsIH0KICAgKiAgIF0KICAgKiB9CiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gcwogICAqIEByZXR1cm4ge09iamVjdH0KICAgKi8KCgogIGZ1bmN0aW9uIHBhcnNlRGlyZWN0aXZlKHMpIHsKICAgIHZhciBoaXQgPSBjYWNoZSQxLmdldChzKTsKCiAgICBpZiAoaGl0KSB7CiAgICAgIHJldHVybiBoaXQ7CiAgICB9IC8vIHJlc2V0IHBhcnNlciBzdGF0ZQoKCiAgICBzdHIgPSBzOwogICAgaW5TaW5nbGUgPSBpbkRvdWJsZSA9IGZhbHNlOwogICAgY3VybHkgPSBzcXVhcmUgPSBwYXJlbiA9IDA7CiAgICBsYXN0RmlsdGVySW5kZXggPSAwOwogICAgZGlyID0ge307CgogICAgZm9yIChpID0gMCwgbCA9IHN0ci5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgcHJldiA9IGM7CiAgICAgIGMgPSBzdHIuY2hhckNvZGVBdChpKTsKCiAgICAgIGlmIChpblNpbmdsZSkgewogICAgICAgIC8vIGNoZWNrIHNpbmdsZSBxdW90ZQogICAgICAgIGlmIChjID09PSAweDI3ICYmIHByZXYgIT09IDB4NUMpIGluU2luZ2xlID0gIWluU2luZ2xlOwogICAgICB9IGVsc2UgaWYgKGluRG91YmxlKSB7CiAgICAgICAgLy8gY2hlY2sgZG91YmxlIHF1b3RlCiAgICAgICAgaWYgKGMgPT09IDB4MjIgJiYgcHJldiAhPT0gMHg1QykgaW5Eb3VibGUgPSAhaW5Eb3VibGU7CiAgICAgIH0gZWxzZSBpZiAoYyA9PT0gMHg3QyAmJiAvLyBwaXBlCiAgICAgIHN0ci5jaGFyQ29kZUF0KGkgKyAxKSAhPT0gMHg3QyAmJiBzdHIuY2hhckNvZGVBdChpIC0gMSkgIT09IDB4N0MpIHsKICAgICAgICBpZiAoZGlyLmV4cHJlc3Npb24gPT0gbnVsbCkgewogICAgICAgICAgLy8gZmlyc3QgZmlsdGVyLCBlbmQgb2YgZXhwcmVzc2lvbgogICAgICAgICAgbGFzdEZpbHRlckluZGV4ID0gaSArIDE7CiAgICAgICAgICBkaXIuZXhwcmVzc2lvbiA9IHN0ci5zbGljZSgwLCBpKS50cmltKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGFscmVhZHkgaGFzIGZpbHRlcgogICAgICAgICAgcHVzaEZpbHRlcigpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgIGNhc2UgMHgyMjoKICAgICAgICAgICAgaW5Eb3VibGUgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIC8vICIKCiAgICAgICAgICBjYXNlIDB4Mjc6CiAgICAgICAgICAgIGluU2luZ2xlID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyAnCgogICAgICAgICAgY2FzZSAweDI4OgogICAgICAgICAgICBwYXJlbisrOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIC8vICgKCiAgICAgICAgICBjYXNlIDB4Mjk6CiAgICAgICAgICAgIHBhcmVuLS07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gKQoKICAgICAgICAgIGNhc2UgMHg1QjoKICAgICAgICAgICAgc3F1YXJlKys7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gWwoKICAgICAgICAgIGNhc2UgMHg1RDoKICAgICAgICAgICAgc3F1YXJlLS07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gXQoKICAgICAgICAgIGNhc2UgMHg3QjoKICAgICAgICAgICAgY3VybHkrKzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyB7CgogICAgICAgICAgY2FzZSAweDdEOgogICAgICAgICAgICBjdXJseS0tOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIC8vIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZGlyLmV4cHJlc3Npb24gPT0gbnVsbCkgewogICAgICBkaXIuZXhwcmVzc2lvbiA9IHN0ci5zbGljZSgwLCBpKS50cmltKCk7CiAgICB9IGVsc2UgaWYgKGxhc3RGaWx0ZXJJbmRleCAhPT0gMCkgewogICAgICBwdXNoRmlsdGVyKCk7CiAgICB9CgogICAgY2FjaGUkMS5wdXQocywgZGlyKTsKICAgIHJldHVybiBkaXI7CiAgfQoKICB2YXIgZGlyZWN0aXZlID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBwYXJzZURpcmVjdGl2ZTogcGFyc2VEaXJlY3RpdmUKICB9KTsKICB2YXIgcmVnZXhFc2NhcGVSRSA9IC9bLS4qKz9eJHt9KCl8W1xdXC9cXF0vZzsKICB2YXIgY2FjaGUgPSB1bmRlZmluZWQ7CiAgdmFyIHRhZ1JFID0gdW5kZWZpbmVkOwogIHZhciBodG1sUkUgPSB1bmRlZmluZWQ7CiAgLyoqCiAgICogRXNjYXBlIGEgc3RyaW5nIHNvIGl0IGNhbiBiZSB1c2VkIGluIGEgUmVnRXhwCiAgICogY29uc3RydWN0b3IuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyCiAgICovCgogIGZ1bmN0aW9uIGVzY2FwZVJlZ2V4KHN0cikgewogICAgcmV0dXJuIHN0ci5yZXBsYWNlKHJlZ2V4RXNjYXBlUkUsICdcXCQmJyk7CiAgfQoKICBmdW5jdGlvbiBjb21waWxlUmVnZXgoKSB7CiAgICB2YXIgb3BlbiA9IGVzY2FwZVJlZ2V4KGNvbmZpZy5kZWxpbWl0ZXJzWzBdKTsKICAgIHZhciBjbG9zZSA9IGVzY2FwZVJlZ2V4KGNvbmZpZy5kZWxpbWl0ZXJzWzFdKTsKICAgIHZhciB1bnNhZmVPcGVuID0gZXNjYXBlUmVnZXgoY29uZmlnLnVuc2FmZURlbGltaXRlcnNbMF0pOwogICAgdmFyIHVuc2FmZUNsb3NlID0gZXNjYXBlUmVnZXgoY29uZmlnLnVuc2FmZURlbGltaXRlcnNbMV0pOwogICAgdGFnUkUgPSBuZXcgUmVnRXhwKHVuc2FmZU9wZW4gKyAnKCg/Oi58XFxuKSs/KScgKyB1bnNhZmVDbG9zZSArICd8JyArIG9wZW4gKyAnKCg/Oi58XFxuKSs/KScgKyBjbG9zZSwgJ2cnKTsKICAgIGh0bWxSRSA9IG5ldyBSZWdFeHAoJ14nICsgdW5zYWZlT3BlbiArICcoKD86LnxcXG4pKz8pJyArIHVuc2FmZUNsb3NlICsgJyQnKTsgLy8gcmVzZXQgY2FjaGUKCiAgICBjYWNoZSA9IG5ldyBDYWNoZSgxMDAwKTsKICB9CiAgLyoqCiAgICogUGFyc2UgYSB0ZW1wbGF0ZSB0ZXh0IHN0cmluZyBpbnRvIGFuIGFycmF5IG9mIHRva2Vucy4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0CiAgICogQHJldHVybiB7QXJyYXk8T2JqZWN0PiB8IG51bGx9CiAgICogICAgICAgICAgICAgICAtIHtTdHJpbmd9IHR5cGUKICAgKiAgICAgICAgICAgICAgIC0ge1N0cmluZ30gdmFsdWUKICAgKiAgICAgICAgICAgICAgIC0ge0Jvb2xlYW59IFtodG1sXQogICAqICAgICAgICAgICAgICAgLSB7Qm9vbGVhbn0gW29uZVRpbWVdCiAgICovCgoKICBmdW5jdGlvbiBwYXJzZVRleHQodGV4dCkgewogICAgaWYgKCFjYWNoZSkgewogICAgICBjb21waWxlUmVnZXgoKTsKICAgIH0KCiAgICB2YXIgaGl0ID0gY2FjaGUuZ2V0KHRleHQpOwoKICAgIGlmIChoaXQpIHsKICAgICAgcmV0dXJuIGhpdDsKICAgIH0KCiAgICBpZiAoIXRhZ1JFLnRlc3QodGV4dCkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgdmFyIHRva2VucyA9IFtdOwogICAgdmFyIGxhc3RJbmRleCA9IHRhZ1JFLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbWF0Y2gsIGluZGV4LCBodG1sLCB2YWx1ZSwgZmlyc3QsIG9uZVRpbWU7CiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25kLWFzc2lnbiAqLwoKICAgIHdoaWxlIChtYXRjaCA9IHRhZ1JFLmV4ZWModGV4dCkpIHsKICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1jb25kLWFzc2lnbiAqLwogICAgICBpbmRleCA9IG1hdGNoLmluZGV4OyAvLyBwdXNoIHRleHQgdG9rZW4KCiAgICAgIGlmIChpbmRleCA+IGxhc3RJbmRleCkgewogICAgICAgIHRva2Vucy5wdXNoKHsKICAgICAgICAgIHZhbHVlOiB0ZXh0LnNsaWNlKGxhc3RJbmRleCwgaW5kZXgpCiAgICAgICAgfSk7CiAgICAgIH0gLy8gdGFnIHRva2VuCgoKICAgICAgaHRtbCA9IGh0bWxSRS50ZXN0KG1hdGNoWzBdKTsKICAgICAgdmFsdWUgPSBodG1sID8gbWF0Y2hbMV0gOiBtYXRjaFsyXTsKICAgICAgZmlyc3QgPSB2YWx1ZS5jaGFyQ29kZUF0KDApOwogICAgICBvbmVUaW1lID0gZmlyc3QgPT09IDQyOyAvLyAqCgogICAgICB2YWx1ZSA9IG9uZVRpbWUgPyB2YWx1ZS5zbGljZSgxKSA6IHZhbHVlOwogICAgICB0b2tlbnMucHVzaCh7CiAgICAgICAgdGFnOiB0cnVlLAogICAgICAgIHZhbHVlOiB2YWx1ZS50cmltKCksCiAgICAgICAgaHRtbDogaHRtbCwKICAgICAgICBvbmVUaW1lOiBvbmVUaW1lCiAgICAgIH0pOwogICAgICBsYXN0SW5kZXggPSBpbmRleCArIG1hdGNoWzBdLmxlbmd0aDsKICAgIH0KCiAgICBpZiAobGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHsKICAgICAgdG9rZW5zLnB1c2goewogICAgICAgIHZhbHVlOiB0ZXh0LnNsaWNlKGxhc3RJbmRleCkKICAgICAgfSk7CiAgICB9CgogICAgY2FjaGUucHV0KHRleHQsIHRva2Vucyk7CiAgICByZXR1cm4gdG9rZW5zOwogIH0KICAvKioKICAgKiBGb3JtYXQgYSBsaXN0IG9mIHRva2VucyBpbnRvIGFuIGV4cHJlc3Npb24uCiAgICogZS5nLiB0b2tlbnMgcGFyc2VkIGZyb20gJ2Ege3tifX0gYycgY2FuIGJlIHNlcmlhbGl6ZWQKICAgKiBpbnRvIG9uZSBzaW5nbGUgZXhwcmVzc2lvbiBhcyAnImEgIiArIGIgKyAiIGMiJy4KICAgKgogICAqIEBwYXJhbSB7QXJyYXl9IHRva2VucwogICAqIEBwYXJhbSB7VnVlfSBbdm1dCiAgICogQHJldHVybiB7U3RyaW5nfQogICAqLwoKCiAgZnVuY3Rpb24gdG9rZW5zVG9FeHAodG9rZW5zLCB2bSkgewogICAgaWYgKHRva2Vucy5sZW5ndGggPiAxKSB7CiAgICAgIHJldHVybiB0b2tlbnMubWFwKGZ1bmN0aW9uICh0b2tlbikgewogICAgICAgIHJldHVybiBmb3JtYXRUb2tlbih0b2tlbiwgdm0pOwogICAgICB9KS5qb2luKCcrJyk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZm9ybWF0VG9rZW4odG9rZW5zWzBdLCB2bSwgdHJ1ZSk7CiAgICB9CiAgfQogIC8qKgogICAqIEZvcm1hdCBhIHNpbmdsZSB0b2tlbi4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSB0b2tlbgogICAqIEBwYXJhbSB7VnVlfSBbdm1dCiAgICogQHBhcmFtIHtCb29sZWFufSBbc2luZ2xlXQogICAqIEByZXR1cm4ge1N0cmluZ30KICAgKi8KCgogIGZ1bmN0aW9uIGZvcm1hdFRva2VuKHRva2VuLCB2bSwgc2luZ2xlKSB7CiAgICByZXR1cm4gdG9rZW4udGFnID8gdG9rZW4ub25lVGltZSAmJiB2bSA/ICciJyArIHZtLiRldmFsKHRva2VuLnZhbHVlKSArICciJyA6IGlubGluZUZpbHRlcnModG9rZW4udmFsdWUsIHNpbmdsZSkgOiAnIicgKyB0b2tlbi52YWx1ZSArICciJzsKICB9CiAgLyoqCiAgICogRm9yIGFuIGF0dHJpYnV0ZSB3aXRoIG11bHRpcGxlIGludGVycG9sYXRpb24gdGFncywKICAgKiBlLmcuIGF0dHI9InNvbWUte3t0aGluZyB8IGZpbHRlcn19IiwgaW4gb3JkZXIgdG8gY29tYmluZQogICAqIHRoZSB3aG9sZSB0aGluZyBpbnRvIGEgc2luZ2xlIHdhdGNoYWJsZSBleHByZXNzaW9uLCB3ZQogICAqIGhhdmUgdG8gaW5saW5lIHRob3NlIGZpbHRlcnMuIFRoaXMgZnVuY3Rpb24gZG9lcyBleGFjdGx5CiAgICogdGhhdC4gVGhpcyBpcyBhIGJpdCBoYWNreSBidXQgaXQgYXZvaWRzIGhlYXZ5IGNoYW5nZXMKICAgKiB0byBkaXJlY3RpdmUgcGFyc2VyIGFuZCB3YXRjaGVyIG1lY2hhbmlzbS4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBleHAKICAgKiBAcGFyYW0ge0Jvb2xlYW59IHNpbmdsZQogICAqIEByZXR1cm4ge1N0cmluZ30KICAgKi8KCgogIHZhciBmaWx0ZXJSRSA9IC9bXnxdXHxbXnxdLzsKCiAgZnVuY3Rpb24gaW5saW5lRmlsdGVycyhleHAsIHNpbmdsZSkgewogICAgaWYgKCFmaWx0ZXJSRS50ZXN0KGV4cCkpIHsKICAgICAgcmV0dXJuIHNpbmdsZSA/IGV4cCA6ICcoJyArIGV4cCArICcpJzsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBkaXIgPSBwYXJzZURpcmVjdGl2ZShleHApOwoKICAgICAgaWYgKCFkaXIuZmlsdGVycykgewogICAgICAgIHJldHVybiAnKCcgKyBleHAgKyAnKSc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICd0aGlzLl9hcHBseUZpbHRlcnMoJyArIGRpci5leHByZXNzaW9uICsgLy8gdmFsdWUKICAgICAgICAnLG51bGwsJyArIC8vIG9sZFZhbHVlIChudWxsIGZvciByZWFkKQogICAgICAgIEpTT04uc3RyaW5naWZ5KGRpci5maWx0ZXJzKSArIC8vIGZpbHRlciBkZXNjcmlwdG9ycwogICAgICAgICcsZmFsc2UpJzsgLy8gd3JpdGU/CiAgICAgIH0KICAgIH0KICB9CgogIHZhciB0ZXh0ID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBjb21waWxlUmVnZXg6IGNvbXBpbGVSZWdleCwKICAgIHBhcnNlVGV4dDogcGFyc2VUZXh0LAogICAgdG9rZW5zVG9FeHA6IHRva2Vuc1RvRXhwCiAgfSk7CiAgdmFyIGRlbGltaXRlcnMgPSBbJ3t7JywgJ319J107CiAgdmFyIHVuc2FmZURlbGltaXRlcnMgPSBbJ3t7eycsICd9fX0nXTsKICB2YXIgY29uZmlnID0gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoewogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHByaW50IGRlYnVnIG1lc3NhZ2VzLgogICAgICogQWxzbyBlbmFibGVzIHN0YWNrIHRyYWNlIGZvciB3YXJuaW5ncy4KICAgICAqCiAgICAgKiBAdHlwZSB7Qm9vbGVhbn0KICAgICAqLwogICAgZGVidWc6IGZhbHNlLAoKICAgIC8qKgogICAgICogV2hldGhlciB0byBzdXBwcmVzcyB3YXJuaW5ncy4KICAgICAqCiAgICAgKiBAdHlwZSB7Qm9vbGVhbn0KICAgICAqLwogICAgc2lsZW50OiBmYWxzZSwKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdXNlIGFzeW5jIHJlbmRlcmluZy4KICAgICAqLwogICAgYXN5bmM6IHRydWUsCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHdhcm4gYWdhaW5zdCBlcnJvcnMgY2F1Z2h0IHdoZW4gZXZhbHVhdGluZwogICAgICogZXhwcmVzc2lvbnMuCiAgICAgKi8KICAgIHdhcm5FeHByZXNzaW9uRXJyb3JzOiB0cnVlLAoKICAgIC8qKgogICAgICogV2hldGhlciB0byBhbGxvdyBkZXZ0b29scyBpbnNwZWN0aW9uLgogICAgICogRGlzYWJsZWQgYnkgZGVmYXVsdCBpbiBwcm9kdWN0aW9uIGJ1aWxkcy4KICAgICAqLwogICAgZGV2dG9vbHM6ICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJywKCiAgICAvKioKICAgICAqIEludGVybmFsIGZsYWcgdG8gaW5kaWNhdGUgdGhlIGRlbGltaXRlcnMgaGF2ZSBiZWVuCiAgICAgKiBjaGFuZ2VkLgogICAgICoKICAgICAqIEB0eXBlIHtCb29sZWFufQogICAgICovCiAgICBfZGVsaW1pdGVyc0NoYW5nZWQ6IHRydWUsCgogICAgLyoqCiAgICAgKiBMaXN0IG9mIGFzc2V0IHR5cGVzIHRoYXQgYSBjb21wb25lbnQgY2FuIG93bi4KICAgICAqCiAgICAgKiBAdHlwZSB7QXJyYXl9CiAgICAgKi8KICAgIF9hc3NldFR5cGVzOiBbJ2NvbXBvbmVudCcsICdkaXJlY3RpdmUnLCAnZWxlbWVudERpcmVjdGl2ZScsICdmaWx0ZXInLCAndHJhbnNpdGlvbicsICdwYXJ0aWFsJ10sCgogICAgLyoqCiAgICAgKiBwcm9wIGJpbmRpbmcgbW9kZXMKICAgICAqLwogICAgX3Byb3BCaW5kaW5nTW9kZXM6IHsKICAgICAgT05FX1dBWTogMCwKICAgICAgVFdPX1dBWTogMSwKICAgICAgT05FX1RJTUU6IDIKICAgIH0sCgogICAgLyoqCiAgICAgKiBNYXggY2lyY3VsYXIgdXBkYXRlcyBhbGxvd2VkIGluIGEgYmF0Y2hlciBmbHVzaCBjeWNsZS4KICAgICAqLwogICAgX21heFVwZGF0ZUNvdW50OiAxMDAKICB9LCB7CiAgICBkZWxpbWl0ZXJzOiB7CiAgICAgIC8qKgogICAgICAgKiBJbnRlcnBvbGF0aW9uIGRlbGltaXRlcnMuIENoYW5naW5nIHRoZXNlIHdvdWxkIHRyaWdnZXIKICAgICAgICogdGhlIHRleHQgcGFyc2VyIHRvIHJlLWNvbXBpbGUgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbnMuCiAgICAgICAqCiAgICAgICAqIEB0eXBlIHtBcnJheTxTdHJpbmc+fQogICAgICAgKi8KICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIGRlbGltaXRlcnM7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbCkgewogICAgICAgIGRlbGltaXRlcnMgPSB2YWw7CiAgICAgICAgY29tcGlsZVJlZ2V4KCk7CiAgICAgIH0sCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZQogICAgfSwKICAgIHVuc2FmZURlbGltaXRlcnM6IHsKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHVuc2FmZURlbGltaXRlcnM7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbCkgewogICAgICAgIHVuc2FmZURlbGltaXRlcnMgPSB2YWw7CiAgICAgICAgY29tcGlsZVJlZ2V4KCk7CiAgICAgIH0sCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIHZhciB3YXJuID0gdW5kZWZpbmVkOwogIHZhciBmb3JtYXRDb21wb25lbnROYW1lID0gdW5kZWZpbmVkOwoKICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAoZnVuY3Rpb24gKCkgewogICAgICB2YXIgaGFzQ29uc29sZSA9IHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJzsKCiAgICAgIHdhcm4gPSBmdW5jdGlvbiB3YXJuKG1zZywgdm0pIHsKICAgICAgICBpZiAoaGFzQ29uc29sZSAmJiAhY29uZmlnLnNpbGVudCkgewogICAgICAgICAgY29uc29sZS5lcnJvcignW1Z1ZSB3YXJuXTogJyArIG1zZyArICh2bSA/IGZvcm1hdENvbXBvbmVudE5hbWUodm0pIDogJycpKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBmb3JtYXRDb21wb25lbnROYW1lID0gZnVuY3Rpb24gZm9ybWF0Q29tcG9uZW50TmFtZSh2bSkgewogICAgICAgIHZhciBuYW1lID0gdm0uX2lzVnVlID8gdm0uJG9wdGlvbnMubmFtZSA6IHZtLm5hbWU7CiAgICAgICAgcmV0dXJuIG5hbWUgPyAnIChmb3VuZCBpbiBjb21wb25lbnQ6IDwnICsgaHlwaGVuYXRlKG5hbWUpICsgJz4pJyA6ICcnOwogICAgICB9OwogICAgfSkoKTsKICB9CiAgLyoqCiAgICogQXBwZW5kIHdpdGggdHJhbnNpdGlvbi4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge0VsZW1lbnR9IHRhcmdldAogICAqIEBwYXJhbSB7VnVlfSB2bQogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYl0KICAgKi8KCgogIGZ1bmN0aW9uIGFwcGVuZFdpdGhUcmFuc2l0aW9uKGVsLCB0YXJnZXQsIHZtLCBjYikgewogICAgYXBwbHlUcmFuc2l0aW9uKGVsLCAxLCBmdW5jdGlvbiAoKSB7CiAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChlbCk7CiAgICB9LCB2bSwgY2IpOwogIH0KICAvKioKICAgKiBJbnNlcnRCZWZvcmUgd2l0aCB0cmFuc2l0aW9uLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7RWxlbWVudH0gdGFyZ2V0CiAgICogQHBhcmFtIHtWdWV9IHZtCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NiXQogICAqLwoKCiAgZnVuY3Rpb24gYmVmb3JlV2l0aFRyYW5zaXRpb24oZWwsIHRhcmdldCwgdm0sIGNiKSB7CiAgICBhcHBseVRyYW5zaXRpb24oZWwsIDEsIGZ1bmN0aW9uICgpIHsKICAgICAgYmVmb3JlKGVsLCB0YXJnZXQpOwogICAgfSwgdm0sIGNiKTsKICB9CiAgLyoqCiAgICogUmVtb3ZlIHdpdGggdHJhbnNpdGlvbi4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge1Z1ZX0gdm0KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2JdCiAgICovCgoKICBmdW5jdGlvbiByZW1vdmVXaXRoVHJhbnNpdGlvbihlbCwgdm0sIGNiKSB7CiAgICBhcHBseVRyYW5zaXRpb24oZWwsIC0xLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJlbW92ZShlbCk7CiAgICB9LCB2bSwgY2IpOwogIH0KICAvKioKICAgKiBBcHBseSB0cmFuc2l0aW9ucyB3aXRoIGFuIG9wZXJhdGlvbiBjYWxsYmFjay4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge051bWJlcn0gZGlyZWN0aW9uCiAgICogICAgICAgICAgICAgICAgICAxOiBlbnRlcgogICAqICAgICAgICAgICAgICAgICAtMTogbGVhdmUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcCAtIHRoZSBhY3R1YWwgRE9NIG9wZXJhdGlvbgogICAqIEBwYXJhbSB7VnVlfSB2bQogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYl0KICAgKi8KCgogIGZ1bmN0aW9uIGFwcGx5VHJhbnNpdGlvbihlbCwgZGlyZWN0aW9uLCBvcCwgdm0sIGNiKSB7CiAgICB2YXIgdHJhbnNpdGlvbiA9IGVsLl9fdl90cmFuczsKCiAgICBpZiAoIXRyYW5zaXRpb24gfHwgLy8gc2tpcCBpZiB0aGVyZSBhcmUgbm8ganMgaG9va3MgYW5kIENTUyB0cmFuc2l0aW9uIGlzCiAgICAvLyBub3Qgc3VwcG9ydGVkCiAgICAhdHJhbnNpdGlvbi5ob29rcyAmJiAhdHJhbnNpdGlvbkVuZEV2ZW50IHx8IC8vIHNraXAgdHJhbnNpdGlvbnMgZm9yIGluaXRpYWwgY29tcGlsZQogICAgIXZtLl9pc0NvbXBpbGVkIHx8IC8vIGlmIHRoZSB2bSBpcyBiZWluZyBtYW5pcHVsYXRlZCBieSBhIHBhcmVudCBkaXJlY3RpdmUKICAgIC8vIGR1cmluZyB0aGUgcGFyZW50J3MgY29tcGlsYXRpb24gcGhhc2UsIHNraXAgdGhlCiAgICAvLyBhbmltYXRpb24uCiAgICB2bS4kcGFyZW50ICYmICF2bS4kcGFyZW50Ll9pc0NvbXBpbGVkKSB7CiAgICAgIG9wKCk7CiAgICAgIGlmIChjYikgY2IoKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBhY3Rpb24gPSBkaXJlY3Rpb24gPiAwID8gJ2VudGVyJyA6ICdsZWF2ZSc7CiAgICB0cmFuc2l0aW9uW2FjdGlvbl0ob3AsIGNiKTsKICB9CgogIHZhciB0cmFuc2l0aW9uID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBhcHBlbmRXaXRoVHJhbnNpdGlvbjogYXBwZW5kV2l0aFRyYW5zaXRpb24sCiAgICBiZWZvcmVXaXRoVHJhbnNpdGlvbjogYmVmb3JlV2l0aFRyYW5zaXRpb24sCiAgICByZW1vdmVXaXRoVHJhbnNpdGlvbjogcmVtb3ZlV2l0aFRyYW5zaXRpb24sCiAgICBhcHBseVRyYW5zaXRpb246IGFwcGx5VHJhbnNpdGlvbgogIH0pOwogIC8qKgogICAqIFF1ZXJ5IGFuIGVsZW1lbnQgc2VsZWN0b3IgaWYgaXQncyBub3QgYW4gZWxlbWVudCBhbHJlYWR5LgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd8RWxlbWVudH0gZWwKICAgKiBAcmV0dXJuIHtFbGVtZW50fQogICAqLwoKICBmdW5jdGlvbiBxdWVyeShlbCkgewogICAgaWYgKHR5cGVvZiBlbCA9PT0gJ3N0cmluZycpIHsKICAgICAgdmFyIHNlbGVjdG9yID0gZWw7CiAgICAgIGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbCk7CgogICAgICBpZiAoIWVsKSB7CiAgICAgICAgJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oJ0Nhbm5vdCBmaW5kIGVsZW1lbnQ6ICcgKyBzZWxlY3Rvcik7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZWw7CiAgfQogIC8qKgogICAqIENoZWNrIGlmIGEgbm9kZSBpcyBpbiB0aGUgZG9jdW1lbnQuCiAgICogTm90ZTogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNvbnRhaW5zIHNob3VsZCB3b3JrIGhlcmUKICAgKiBidXQgYWx3YXlzIHJldHVybnMgZmFsc2UgZm9yIGNvbW1lbnQgbm9kZXMgaW4gcGhhbnRvbWpzLAogICAqIG1ha2luZyB1bml0IHRlc3RzIGRpZmZpY3VsdC4gVGhpcyBpcyBmaXhlZCBieSBkb2luZyB0aGUKICAgKiBjb250YWlucygpIGNoZWNrIG9uIHRoZSBub2RlJ3MgcGFyZW50Tm9kZSBpbnN0ZWFkIG9mCiAgICogdGhlIG5vZGUgaXRzZWxmLgogICAqCiAgICogQHBhcmFtIHtOb2RlfSBub2RlCiAgICogQHJldHVybiB7Qm9vbGVhbn0KICAgKi8KCgogIGZ1bmN0aW9uIGluRG9jKG5vZGUpIHsKICAgIGlmICghbm9kZSkgcmV0dXJuIGZhbHNlOwogICAgdmFyIGRvYyA9IG5vZGUub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlOwogICAgcmV0dXJuIGRvYyA9PT0gbm9kZSB8fCBkb2MgPT09IHBhcmVudCB8fCAhIShwYXJlbnQgJiYgcGFyZW50Lm5vZGVUeXBlID09PSAxICYmIGRvYy5jb250YWlucyhwYXJlbnQpKTsKICB9CiAgLyoqCiAgICogR2V0IGFuZCByZW1vdmUgYW4gYXR0cmlidXRlIGZyb20gYSBub2RlLgogICAqCiAgICogQHBhcmFtIHtOb2RlfSBub2RlCiAgICogQHBhcmFtIHtTdHJpbmd9IF9hdHRyCiAgICovCgoKICBmdW5jdGlvbiBnZXRBdHRyKG5vZGUsIF9hdHRyKSB7CiAgICB2YXIgdmFsID0gbm9kZS5nZXRBdHRyaWJ1dGUoX2F0dHIpOwoKICAgIGlmICh2YWwgIT09IG51bGwpIHsKICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoX2F0dHIpOwogICAgfQoKICAgIHJldHVybiB2YWw7CiAgfQogIC8qKgogICAqIEdldCBhbiBhdHRyaWJ1dGUgd2l0aCBjb2xvbiBvciB2LWJpbmQ6IHByZWZpeC4KICAgKgogICAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAgICogQHJldHVybiB7U3RyaW5nfG51bGx9CiAgICovCgoKICBmdW5jdGlvbiBnZXRCaW5kQXR0cihub2RlLCBuYW1lKSB7CiAgICB2YXIgdmFsID0gZ2V0QXR0cihub2RlLCAnOicgKyBuYW1lKTsKCiAgICBpZiAodmFsID09PSBudWxsKSB7CiAgICAgIHZhbCA9IGdldEF0dHIobm9kZSwgJ3YtYmluZDonICsgbmFtZSk7CiAgICB9CgogICAgcmV0dXJuIHZhbDsKICB9CiAgLyoqCiAgICogQ2hlY2sgdGhlIHByZXNlbmNlIG9mIGEgYmluZCBhdHRyaWJ1dGUuCiAgICoKICAgKiBAcGFyYW0ge05vZGV9IG5vZGUKICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogICAqIEByZXR1cm4ge0Jvb2xlYW59CiAgICovCgoKICBmdW5jdGlvbiBoYXNCaW5kQXR0cihub2RlLCBuYW1lKSB7CiAgICByZXR1cm4gbm9kZS5oYXNBdHRyaWJ1dGUobmFtZSkgfHwgbm9kZS5oYXNBdHRyaWJ1dGUoJzonICsgbmFtZSkgfHwgbm9kZS5oYXNBdHRyaWJ1dGUoJ3YtYmluZDonICsgbmFtZSk7CiAgfQogIC8qKgogICAqIEluc2VydCBlbCBiZWZvcmUgdGFyZ2V0CiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHBhcmFtIHtFbGVtZW50fSB0YXJnZXQKICAgKi8KCgogIGZ1bmN0aW9uIGJlZm9yZShlbCwgdGFyZ2V0KSB7CiAgICB0YXJnZXQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZWwsIHRhcmdldCk7CiAgfQogIC8qKgogICAqIEluc2VydCBlbCBhZnRlciB0YXJnZXQKICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge0VsZW1lbnR9IHRhcmdldAogICAqLwoKCiAgZnVuY3Rpb24gYWZ0ZXIoZWwsIHRhcmdldCkgewogICAgaWYgKHRhcmdldC5uZXh0U2libGluZykgewogICAgICBiZWZvcmUoZWwsIHRhcmdldC5uZXh0U2libGluZyk7CiAgICB9IGVsc2UgewogICAgICB0YXJnZXQucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChlbCk7CiAgICB9CiAgfQogIC8qKgogICAqIFJlbW92ZSBlbCBmcm9tIERPTQogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqLwoKCiAgZnVuY3Rpb24gcmVtb3ZlKGVsKSB7CiAgICBlbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKTsKICB9CiAgLyoqCiAgICogUHJlcGVuZCBlbCB0byB0YXJnZXQKICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge0VsZW1lbnR9IHRhcmdldAogICAqLwoKCiAgZnVuY3Rpb24gcHJlcGVuZChlbCwgdGFyZ2V0KSB7CiAgICBpZiAodGFyZ2V0LmZpcnN0Q2hpbGQpIHsKICAgICAgYmVmb3JlKGVsLCB0YXJnZXQuZmlyc3RDaGlsZCk7CiAgICB9IGVsc2UgewogICAgICB0YXJnZXQuYXBwZW5kQ2hpbGQoZWwpOwogICAgfQogIH0KICAvKioKICAgKiBSZXBsYWNlIHRhcmdldCB3aXRoIGVsCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IHRhcmdldAogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKi8KCgogIGZ1bmN0aW9uIHJlcGxhY2UodGFyZ2V0LCBlbCkgewogICAgdmFyIHBhcmVudCA9IHRhcmdldC5wYXJlbnROb2RlOwoKICAgIGlmIChwYXJlbnQpIHsKICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZChlbCwgdGFyZ2V0KTsKICAgIH0KICB9CiAgLyoqCiAgICogQWRkIGV2ZW50IGxpc3RlbmVyIHNob3J0aGFuZC4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnQKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3VzZUNhcHR1cmVdCiAgICovCgoKICBmdW5jdGlvbiBvbihlbCwgZXZlbnQsIGNiLCB1c2VDYXB0dXJlKSB7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBjYiwgdXNlQ2FwdHVyZSk7CiAgfQogIC8qKgogICAqIFJlbW92ZSBldmVudCBsaXN0ZW5lciBzaG9ydGhhbmQuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2IKICAgKi8KCgogIGZ1bmN0aW9uIG9mZihlbCwgZXZlbnQsIGNiKSB7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBjYik7CiAgfQogIC8qKgogICAqIEZvciBJRTkgY29tcGF0OiB3aGVuIGJvdGggY2xhc3MgYW5kIDpjbGFzcyBhcmUgcHJlc2VudAogICAqIGdldEF0dHJpYnV0ZSgnY2xhc3MnKSByZXR1cm5zIHdyb25nIHZhbHVlLi4uCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHJldHVybiB7U3RyaW5nfQogICAqLwoKCiAgZnVuY3Rpb24gZ2V0Q2xhc3MoZWwpIHsKICAgIHZhciBjbGFzc25hbWUgPSBlbC5jbGFzc05hbWU7CgogICAgaWYgKF90eXBlb2YoY2xhc3NuYW1lKSA9PT0gJ29iamVjdCcpIHsKICAgICAgY2xhc3NuYW1lID0gY2xhc3NuYW1lLmJhc2VWYWwgfHwgJyc7CiAgICB9CgogICAgcmV0dXJuIGNsYXNzbmFtZTsKICB9CiAgLyoqCiAgICogSW4gSUU5LCBzZXRBdHRyaWJ1dGUoJ2NsYXNzJykgd2lsbCByZXN1bHQgaW4gZW1wdHkgY2xhc3MKICAgKiBpZiB0aGUgZWxlbWVudCBhbHNvIGhhcyB0aGUgOmNsYXNzIGF0dHJpYnV0ZTsgSG93ZXZlciBpbgogICAqIFBoYW50b21KUywgc2V0dGluZyBgY2xhc3NOYW1lYCBkb2VzIG5vdCB3b3JrIG9uIFNWRyBlbGVtZW50cy4uLgogICAqIFNvIHdlIGhhdmUgdG8gZG8gYSBjb25kaXRpb25hbCBjaGVjayBoZXJlLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7U3RyaW5nfSBjbHMKICAgKi8KCgogIGZ1bmN0aW9uIHNldENsYXNzKGVsLCBjbHMpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGlzSUU5ICYmICEvc3ZnJC8udGVzdChlbC5uYW1lc3BhY2VVUkkpKSB7CiAgICAgIGVsLmNsYXNzTmFtZSA9IGNsczsKICAgIH0gZWxzZSB7CiAgICAgIGVsLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCBjbHMpOwogICAgfQogIH0KICAvKioKICAgKiBBZGQgY2xhc3Mgd2l0aCBjb21wYXRpYmlsaXR5IGZvciBJRSAmIFNWRwogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7U3RyaW5nfSBjbHMKICAgKi8KCgogIGZ1bmN0aW9uIGFkZENsYXNzKGVsLCBjbHMpIHsKICAgIGlmIChlbC5jbGFzc0xpc3QpIHsKICAgICAgZWwuY2xhc3NMaXN0LmFkZChjbHMpOwogICAgfSBlbHNlIHsKICAgICAgdmFyIGN1ciA9ICcgJyArIGdldENsYXNzKGVsKSArICcgJzsKCiAgICAgIGlmIChjdXIuaW5kZXhPZignICcgKyBjbHMgKyAnICcpIDwgMCkgewogICAgICAgIHNldENsYXNzKGVsLCAoY3VyICsgY2xzKS50cmltKCkpOwogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIFJlbW92ZSBjbGFzcyB3aXRoIGNvbXBhdGliaWxpdHkgZm9yIElFICYgU1ZHCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHBhcmFtIHtTdHJpbmd9IGNscwogICAqLwoKCiAgZnVuY3Rpb24gcmVtb3ZlQ2xhc3MoZWwsIGNscykgewogICAgaWYgKGVsLmNsYXNzTGlzdCkgewogICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKGNscyk7CiAgICB9IGVsc2UgewogICAgICB2YXIgY3VyID0gJyAnICsgZ2V0Q2xhc3MoZWwpICsgJyAnOwogICAgICB2YXIgdGFyID0gJyAnICsgY2xzICsgJyAnOwoKICAgICAgd2hpbGUgKGN1ci5pbmRleE9mKHRhcikgPj0gMCkgewogICAgICAgIGN1ciA9IGN1ci5yZXBsYWNlKHRhciwgJyAnKTsKICAgICAgfQoKICAgICAgc2V0Q2xhc3MoZWwsIGN1ci50cmltKCkpOwogICAgfQoKICAgIGlmICghZWwuY2xhc3NOYW1lKSB7CiAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgnY2xhc3MnKTsKICAgIH0KICB9CiAgLyoqCiAgICogRXh0cmFjdCByYXcgY29udGVudCBpbnNpZGUgYW4gZWxlbWVudCBpbnRvIGEgdGVtcG9yYXJ5CiAgICogY29udGFpbmVyIGRpdgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7Qm9vbGVhbn0gYXNGcmFnbWVudAogICAqIEByZXR1cm4ge0VsZW1lbnR8RG9jdW1lbnRGcmFnbWVudH0KICAgKi8KCgogIGZ1bmN0aW9uIGV4dHJhY3RDb250ZW50KGVsLCBhc0ZyYWdtZW50KSB7CiAgICB2YXIgY2hpbGQ7CiAgICB2YXIgcmF3Q29udGVudDsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKICAgIGlmIChpc1RlbXBsYXRlKGVsKSAmJiBpc0ZyYWdtZW50KGVsLmNvbnRlbnQpKSB7CiAgICAgIGVsID0gZWwuY29udGVudDsKICAgIH0KCiAgICBpZiAoZWwuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgIHRyaW1Ob2RlKGVsKTsKICAgICAgcmF3Q29udGVudCA9IGFzRnJhZ21lbnQgPyBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkgOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tY29uZC1hc3NpZ24gKi8KCiAgICAgIHdoaWxlIChjaGlsZCA9IGVsLmZpcnN0Q2hpbGQpIHsKICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLWNvbmQtYXNzaWduICovCiAgICAgICAgcmF3Q29udGVudC5hcHBlbmRDaGlsZChjaGlsZCk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmF3Q29udGVudDsKICB9CiAgLyoqCiAgICogVHJpbSBwb3NzaWJsZSBlbXB0eSBoZWFkL3RhaWwgdGV4dCBhbmQgY29tbWVudAogICAqIG5vZGVzIGluc2lkZSBhIHBhcmVudC4KICAgKgogICAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogICAqLwoKCiAgZnVuY3Rpb24gdHJpbU5vZGUobm9kZSkgewogICAgdmFyIGNoaWxkOwogICAgLyogZXNsaW50LWRpc2FibGUgbm8tc2VxdWVuY2VzICovCgogICAgd2hpbGUgKGNoaWxkID0gbm9kZS5maXJzdENoaWxkLCBpc1RyaW1tYWJsZShjaGlsZCkpIHsKICAgICAgbm9kZS5yZW1vdmVDaGlsZChjaGlsZCk7CiAgICB9CgogICAgd2hpbGUgKGNoaWxkID0gbm9kZS5sYXN0Q2hpbGQsIGlzVHJpbW1hYmxlKGNoaWxkKSkgewogICAgICBub2RlLnJlbW92ZUNoaWxkKGNoaWxkKTsKICAgIH0KICAgIC8qIGVzbGludC1lbmFibGUgbm8tc2VxdWVuY2VzICovCgogIH0KCiAgZnVuY3Rpb24gaXNUcmltbWFibGUobm9kZSkgewogICAgcmV0dXJuIG5vZGUgJiYgKG5vZGUubm9kZVR5cGUgPT09IDMgJiYgIW5vZGUuZGF0YS50cmltKCkgfHwgbm9kZS5ub2RlVHlwZSA9PT0gOCk7CiAgfQogIC8qKgogICAqIENoZWNrIGlmIGFuIGVsZW1lbnQgaXMgYSB0ZW1wbGF0ZSB0YWcuCiAgICogTm90ZSBpZiB0aGUgdGVtcGxhdGUgYXBwZWFycyBpbnNpZGUgYW4gU1ZHIGl0cyB0YWdOYW1lCiAgICogd2lsbCBiZSBpbiBsb3dlcmNhc2UuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICovCgoKICBmdW5jdGlvbiBpc1RlbXBsYXRlKGVsKSB7CiAgICByZXR1cm4gZWwudGFnTmFtZSAmJiBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICd0ZW1wbGF0ZSc7CiAgfQogIC8qKgogICAqIENyZWF0ZSBhbiAiYW5jaG9yIiBmb3IgcGVyZm9ybWluZyBkb20gaW5zZXJ0aW9uL3JlbW92YWxzLgogICAqIFRoaXMgaXMgdXNlZCBpbiBhIG51bWJlciBvZiBzY2VuYXJpb3M6CiAgICogLSBmcmFnbWVudCBpbnN0YW5jZQogICAqIC0gdi1odG1sCiAgICogLSB2LWlmCiAgICogLSB2LWZvcgogICAqIC0gY29tcG9uZW50CiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gY29udGVudAogICAqIEBwYXJhbSB7Qm9vbGVhbn0gcGVyc2lzdCAtIElFIHRyYXNoZXMgZW1wdHkgdGV4dE5vZGVzIG9uCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvbmVOb2RlKHRydWUpLCBzbyBpbiBjZXJ0YWluCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZXMgdGhlIGFuY2hvciBuZWVkcyB0byBiZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vbi1lbXB0eSB0byBiZSBwZXJzaXN0ZWQgaW4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZXMuCiAgICogQHJldHVybiB7Q29tbWVudHxUZXh0fQogICAqLwoKCiAgZnVuY3Rpb24gY3JlYXRlQW5jaG9yKGNvbnRlbnQsIHBlcnNpc3QpIHsKICAgIHZhciBhbmNob3IgPSBjb25maWcuZGVidWcgPyBkb2N1bWVudC5jcmVhdGVDb21tZW50KGNvbnRlbnQpIDogZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocGVyc2lzdCA/ICcgJyA6ICcnKTsKICAgIGFuY2hvci5fX3ZfYW5jaG9yID0gdHJ1ZTsKICAgIHJldHVybiBhbmNob3I7CiAgfQogIC8qKgogICAqIEZpbmQgYSBjb21wb25lbnQgcmVmIGF0dHJpYnV0ZSB0aGF0IHN0YXJ0cyB3aXRoICQuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IG5vZGUKICAgKiBAcmV0dXJuIHtTdHJpbmd8dW5kZWZpbmVkfQogICAqLwoKCiAgdmFyIHJlZlJFID0gL152LXJlZjovOwoKICBmdW5jdGlvbiBmaW5kUmVmKG5vZGUpIHsKICAgIGlmIChub2RlLmhhc0F0dHJpYnV0ZXMoKSkgewogICAgICB2YXIgYXR0cnMgPSBub2RlLmF0dHJpYnV0ZXM7CgogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGF0dHJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHZhciBuYW1lID0gYXR0cnNbaV0ubmFtZTsKCiAgICAgICAgaWYgKHJlZlJFLnRlc3QobmFtZSkpIHsKICAgICAgICAgIHJldHVybiBjYW1lbGl6ZShuYW1lLnJlcGxhY2UocmVmUkUsICcnKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIE1hcCBhIGZ1bmN0aW9uIHRvIGEgcmFuZ2Ugb2Ygbm9kZXMgLgogICAqCiAgICogQHBhcmFtIHtOb2RlfSBub2RlCiAgICogQHBhcmFtIHtOb2RlfSBlbmQKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcAogICAqLwoKCiAgZnVuY3Rpb24gbWFwTm9kZVJhbmdlKG5vZGUsIGVuZCwgb3ApIHsKICAgIHZhciBuZXh0OwoKICAgIHdoaWxlIChub2RlICE9PSBlbmQpIHsKICAgICAgbmV4dCA9IG5vZGUubmV4dFNpYmxpbmc7CiAgICAgIG9wKG5vZGUpOwogICAgICBub2RlID0gbmV4dDsKICAgIH0KCiAgICBvcChlbmQpOwogIH0KICAvKioKICAgKiBSZW1vdmUgYSByYW5nZSBvZiBub2RlcyB3aXRoIHRyYW5zaXRpb24sIHN0b3JlCiAgICogdGhlIG5vZGVzIGluIGEgZnJhZ21lbnQgd2l0aCBjb3JyZWN0IG9yZGVyaW5nLAogICAqIGFuZCBjYWxsIGNhbGxiYWNrIHdoZW4gZG9uZS4KICAgKgogICAqIEBwYXJhbSB7Tm9kZX0gc3RhcnQKICAgKiBAcGFyYW0ge05vZGV9IGVuZAogICAqIEBwYXJhbSB7VnVlfSB2bQogICAqIEBwYXJhbSB7RG9jdW1lbnRGcmFnbWVudH0gZnJhZwogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNiCiAgICovCgoKICBmdW5jdGlvbiByZW1vdmVOb2RlUmFuZ2Uoc3RhcnQsIGVuZCwgdm0sIGZyYWcsIGNiKSB7CiAgICB2YXIgZG9uZSA9IGZhbHNlOwogICAgdmFyIHJlbW92ZWQgPSAwOwogICAgdmFyIG5vZGVzID0gW107CiAgICBtYXBOb2RlUmFuZ2Uoc3RhcnQsIGVuZCwgZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgaWYgKG5vZGUgPT09IGVuZCkgZG9uZSA9IHRydWU7CiAgICAgIG5vZGVzLnB1c2gobm9kZSk7CiAgICAgIHJlbW92ZVdpdGhUcmFuc2l0aW9uKG5vZGUsIHZtLCBvblJlbW92ZWQpOwogICAgfSk7CgogICAgZnVuY3Rpb24gb25SZW1vdmVkKCkgewogICAgICByZW1vdmVkKys7CgogICAgICBpZiAoZG9uZSAmJiByZW1vdmVkID49IG5vZGVzLmxlbmd0aCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGZyYWcuYXBwZW5kQ2hpbGQobm9kZXNbaV0pOwogICAgICAgIH0KCiAgICAgICAgY2IgJiYgY2IoKTsKICAgICAgfQogICAgfQogIH0KICAvKioKICAgKiBDaGVjayBpZiBhIG5vZGUgaXMgYSBEb2N1bWVudEZyYWdtZW50LgogICAqCiAgICogQHBhcmFtIHtOb2RlfSBub2RlCiAgICogQHJldHVybiB7Qm9vbGVhbn0KICAgKi8KCgogIGZ1bmN0aW9uIGlzRnJhZ21lbnQobm9kZSkgewogICAgcmV0dXJuIG5vZGUgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMTE7CiAgfQogIC8qKgogICAqIEdldCBvdXRlckhUTUwgb2YgZWxlbWVudHMsIHRha2luZyBjYXJlCiAgICogb2YgU1ZHIGVsZW1lbnRzIGluIElFIGFzIHdlbGwuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHJldHVybiB7U3RyaW5nfQogICAqLwoKCiAgZnVuY3Rpb24gZ2V0T3V0ZXJIVE1MKGVsKSB7CiAgICBpZiAoZWwub3V0ZXJIVE1MKSB7CiAgICAgIHJldHVybiBlbC5vdXRlckhUTUw7CiAgICB9IGVsc2UgewogICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlbC5jbG9uZU5vZGUodHJ1ZSkpOwogICAgICByZXR1cm4gY29udGFpbmVyLmlubmVySFRNTDsKICAgIH0KICB9CgogIHZhciBjb21tb25UYWdSRSA9IC9eKGRpdnxwfHNwYW58aW1nfGF8YnxpfGJyfHVsfG9sfGxpfGgxfGgyfGgzfGg0fGg1fGg2fGNvZGV8cHJlfHRhYmxlfHRofHRkfHRyfGZvcm18bGFiZWx8aW5wdXR8c2VsZWN0fG9wdGlvbnxuYXZ8YXJ0aWNsZXxzZWN0aW9ufGhlYWRlcnxmb290ZXIpJC9pOwogIHZhciByZXNlcnZlZFRhZ1JFID0gL14oc2xvdHxwYXJ0aWFsfGNvbXBvbmVudCkkL2k7CiAgdmFyIGlzVW5rbm93bkVsZW1lbnQgPSB1bmRlZmluZWQ7CgogIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicpIHsKICAgIGlzVW5rbm93bkVsZW1lbnQgPSBmdW5jdGlvbiBpc1Vua25vd25FbGVtZW50KGVsLCB0YWcpIHsKICAgICAgaWYgKHRhZy5pbmRleE9mKCctJykgPiAtMSkgewogICAgICAgIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzI4MjEwMzY0LzEwNzAyNDQKICAgICAgICByZXR1cm4gZWwuY29uc3RydWN0b3IgPT09IHdpbmRvdy5IVE1MVW5rbm93bkVsZW1lbnQgfHwgZWwuY29uc3RydWN0b3IgPT09IHdpbmRvdy5IVE1MRWxlbWVudDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gL0hUTUxVbmtub3duRWxlbWVudC8udGVzdChlbC50b1N0cmluZygpKSAmJiAvLyBDaHJvbWUgcmV0dXJucyB1bmtub3duIGZvciBzZXZlcmFsIEhUTUw1IGVsZW1lbnRzLgogICAgICAgIC8vIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD01NDA1MjYKICAgICAgICAvLyBGaXJlZm94IHJldHVybnMgdW5rbm93biBmb3Igc29tZSAiSW50ZXJhY3RpdmUgZWxlbWVudHMuIgogICAgICAgICEvXihkYXRhfHRpbWV8cnRjfHJifGRldGFpbHN8ZGlhbG9nfHN1bW1hcnkpJC8udGVzdCh0YWcpOwogICAgICB9CiAgICB9OwogIH0KICAvKioKICAgKiBDaGVjayBpZiBhbiBlbGVtZW50IGlzIGEgY29tcG9uZW50LCBpZiB5ZXMgcmV0dXJuIGl0cwogICAqIGNvbXBvbmVudCBpZC4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEByZXR1cm4ge09iamVjdHx1bmRlZmluZWR9CiAgICovCgoKICBmdW5jdGlvbiBjaGVja0NvbXBvbmVudEF0dHIoZWwsIG9wdGlvbnMpIHsKICAgIHZhciB0YWcgPSBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICB2YXIgaGFzQXR0cnMgPSBlbC5oYXNBdHRyaWJ1dGVzKCk7CgogICAgaWYgKCFjb21tb25UYWdSRS50ZXN0KHRhZykgJiYgIXJlc2VydmVkVGFnUkUudGVzdCh0YWcpKSB7CiAgICAgIGlmIChyZXNvbHZlQXNzZXQob3B0aW9ucywgJ2NvbXBvbmVudHMnLCB0YWcpKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGlkOiB0YWcKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBpcyA9IGhhc0F0dHJzICYmIGdldElzQmluZGluZyhlbCwgb3B0aW9ucyk7CgogICAgICAgIGlmIChpcykgewogICAgICAgICAgcmV0dXJuIGlzOwogICAgICAgIH0gZWxzZSBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB2YXIgZXhwZWN0ZWRUYWcgPSBvcHRpb25zLl9jb21wb25lbnROYW1lTWFwICYmIG9wdGlvbnMuX2NvbXBvbmVudE5hbWVNYXBbdGFnXTsKCiAgICAgICAgICBpZiAoZXhwZWN0ZWRUYWcpIHsKICAgICAgICAgICAgd2FybignVW5rbm93biBjdXN0b20gZWxlbWVudDogPCcgKyB0YWcgKyAnPiAtICcgKyAnZGlkIHlvdSBtZWFuIDwnICsgZXhwZWN0ZWRUYWcgKyAnPj8gJyArICdIVE1MIGlzIGNhc2UtaW5zZW5zaXRpdmUsIHJlbWVtYmVyIHRvIHVzZSBrZWJhYi1jYXNlIGluIHRlbXBsYXRlcy4nKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaXNVbmtub3duRWxlbWVudChlbCwgdGFnKSkgewogICAgICAgICAgICB3YXJuKCdVbmtub3duIGN1c3RvbSBlbGVtZW50OiA8JyArIHRhZyArICc+IC0gZGlkIHlvdSAnICsgJ3JlZ2lzdGVyIHRoZSBjb21wb25lbnQgY29ycmVjdGx5PyBGb3IgcmVjdXJzaXZlIGNvbXBvbmVudHMsICcgKyAnbWFrZSBzdXJlIHRvIHByb3ZpZGUgdGhlICJuYW1lIiBvcHRpb24uJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKGhhc0F0dHJzKSB7CiAgICAgIHJldHVybiBnZXRJc0JpbmRpbmcoZWwsIG9wdGlvbnMpOwogICAgfQogIH0KICAvKioKICAgKiBHZXQgImlzIiBiaW5kaW5nIGZyb20gYW4gZWxlbWVudC4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEByZXR1cm4ge09iamVjdHx1bmRlZmluZWR9CiAgICovCgoKICBmdW5jdGlvbiBnZXRJc0JpbmRpbmcoZWwsIG9wdGlvbnMpIHsKICAgIC8vIGR5bmFtaWMgc3ludGF4CiAgICB2YXIgZXhwID0gZWwuZ2V0QXR0cmlidXRlKCdpcycpOwoKICAgIGlmIChleHAgIT0gbnVsbCkgewogICAgICBpZiAocmVzb2x2ZUFzc2V0KG9wdGlvbnMsICdjb21wb25lbnRzJywgZXhwKSkgewogICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgnaXMnKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaWQ6IGV4cAogICAgICAgIH07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGV4cCA9IGdldEJpbmRBdHRyKGVsLCAnaXMnKTsKCiAgICAgIGlmIChleHAgIT0gbnVsbCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpZDogZXhwLAogICAgICAgICAgZHluYW1pYzogdHJ1ZQogICAgICAgIH07CiAgICAgIH0KICAgIH0KICB9CiAgLyoqCiAgICogT3B0aW9uIG92ZXJ3cml0aW5nIHN0cmF0ZWdpZXMgYXJlIGZ1bmN0aW9ucyB0aGF0IGhhbmRsZQogICAqIGhvdyB0byBtZXJnZSBhIHBhcmVudCBvcHRpb24gdmFsdWUgYW5kIGEgY2hpbGQgb3B0aW9uCiAgICogdmFsdWUgaW50byB0aGUgZmluYWwgdmFsdWUuCiAgICoKICAgKiBBbGwgc3RyYXRlZ3kgZnVuY3Rpb25zIGZvbGxvdyB0aGUgc2FtZSBzaWduYXR1cmU6CiAgICoKICAgKiBAcGFyYW0geyp9IHBhcmVudFZhbAogICAqIEBwYXJhbSB7Kn0gY2hpbGRWYWwKICAgKiBAcGFyYW0ge1Z1ZX0gW3ZtXQogICAqLwoKCiAgdmFyIHN0cmF0cyA9IGNvbmZpZy5vcHRpb25NZXJnZVN0cmF0ZWdpZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIC8qKgogICAqIEhlbHBlciB0aGF0IHJlY3Vyc2l2ZWx5IG1lcmdlcyB0d28gZGF0YSBvYmplY3RzIHRvZ2V0aGVyLgogICAqLwoKICBmdW5jdGlvbiBtZXJnZURhdGEodG8sIGZyb20pIHsKICAgIHZhciBrZXksIHRvVmFsLCBmcm9tVmFsOwoKICAgIGZvciAoa2V5IGluIGZyb20pIHsKICAgICAgdG9WYWwgPSB0b1trZXldOwogICAgICBmcm9tVmFsID0gZnJvbVtrZXldOwoKICAgICAgaWYgKCFoYXNPd24odG8sIGtleSkpIHsKICAgICAgICBzZXQodG8sIGtleSwgZnJvbVZhbCk7CiAgICAgIH0gZWxzZSBpZiAoaXNPYmplY3QodG9WYWwpICYmIGlzT2JqZWN0KGZyb21WYWwpKSB7CiAgICAgICAgbWVyZ2VEYXRhKHRvVmFsLCBmcm9tVmFsKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0bzsKICB9CiAgLyoqCiAgICogRGF0YQogICAqLwoKCiAgc3RyYXRzLmRhdGEgPSBmdW5jdGlvbiAocGFyZW50VmFsLCBjaGlsZFZhbCwgdm0pIHsKICAgIGlmICghdm0pIHsKICAgICAgLy8gaW4gYSBWdWUuZXh0ZW5kIG1lcmdlLCBib3RoIHNob3VsZCBiZSBmdW5jdGlvbnMKICAgICAgaWYgKCFjaGlsZFZhbCkgewogICAgICAgIHJldHVybiBwYXJlbnRWYWw7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlb2YgY2hpbGRWYWwgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgd2FybignVGhlICJkYXRhIiBvcHRpb24gc2hvdWxkIGJlIGEgZnVuY3Rpb24gJyArICd0aGF0IHJldHVybnMgYSBwZXItaW5zdGFuY2UgdmFsdWUgaW4gY29tcG9uZW50ICcgKyAnZGVmaW5pdGlvbnMuJywgdm0pOwogICAgICAgIHJldHVybiBwYXJlbnRWYWw7CiAgICAgIH0KCiAgICAgIGlmICghcGFyZW50VmFsKSB7CiAgICAgICAgcmV0dXJuIGNoaWxkVmFsOwogICAgICB9IC8vIHdoZW4gcGFyZW50VmFsICYgY2hpbGRWYWwgYXJlIGJvdGggcHJlc2VudCwKICAgICAgLy8gd2UgbmVlZCB0byByZXR1cm4gYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlCiAgICAgIC8vIG1lcmdlZCByZXN1bHQgb2YgYm90aCBmdW5jdGlvbnMuLi4gbm8gbmVlZCB0bwogICAgICAvLyBjaGVjayBpZiBwYXJlbnRWYWwgaXMgYSBmdW5jdGlvbiBoZXJlIGJlY2F1c2UKICAgICAgLy8gaXQgaGFzIHRvIGJlIGEgZnVuY3Rpb24gdG8gcGFzcyBwcmV2aW91cyBtZXJnZXMuCgoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIG1lcmdlZERhdGFGbigpIHsKICAgICAgICByZXR1cm4gbWVyZ2VEYXRhKGNoaWxkVmFsLmNhbGwodGhpcyksIHBhcmVudFZhbC5jYWxsKHRoaXMpKTsKICAgICAgfTsKICAgIH0gZWxzZSBpZiAocGFyZW50VmFsIHx8IGNoaWxkVmFsKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiBtZXJnZWRJbnN0YW5jZURhdGFGbigpIHsKICAgICAgICAvLyBpbnN0YW5jZSBtZXJnZQogICAgICAgIHZhciBpbnN0YW5jZURhdGEgPSB0eXBlb2YgY2hpbGRWYWwgPT09ICdmdW5jdGlvbicgPyBjaGlsZFZhbC5jYWxsKHZtKSA6IGNoaWxkVmFsOwogICAgICAgIHZhciBkZWZhdWx0RGF0YSA9IHR5cGVvZiBwYXJlbnRWYWwgPT09ICdmdW5jdGlvbicgPyBwYXJlbnRWYWwuY2FsbCh2bSkgOiB1bmRlZmluZWQ7CgogICAgICAgIGlmIChpbnN0YW5jZURhdGEpIHsKICAgICAgICAgIHJldHVybiBtZXJnZURhdGEoaW5zdGFuY2VEYXRhLCBkZWZhdWx0RGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBkZWZhdWx0RGF0YTsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfTsKICAvKioKICAgKiBFbAogICAqLwoKCiAgc3RyYXRzLmVsID0gZnVuY3Rpb24gKHBhcmVudFZhbCwgY2hpbGRWYWwsIHZtKSB7CiAgICBpZiAoIXZtICYmIGNoaWxkVmFsICYmIHR5cGVvZiBjaGlsZFZhbCAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgd2FybignVGhlICJlbCIgb3B0aW9uIHNob3VsZCBiZSBhIGZ1bmN0aW9uICcgKyAndGhhdCByZXR1cm5zIGEgcGVyLWluc3RhbmNlIHZhbHVlIGluIGNvbXBvbmVudCAnICsgJ2RlZmluaXRpb25zLicsIHZtKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciByZXQgPSBjaGlsZFZhbCB8fCBwYXJlbnRWYWw7IC8vIGludm9rZSB0aGUgZWxlbWVudCBmYWN0b3J5IGlmIHRoaXMgaXMgaW5zdGFuY2UgbWVyZ2UKCiAgICByZXR1cm4gdm0gJiYgdHlwZW9mIHJldCA9PT0gJ2Z1bmN0aW9uJyA/IHJldC5jYWxsKHZtKSA6IHJldDsKICB9OwogIC8qKgogICAqIEhvb2tzIGFuZCBwYXJhbSBhdHRyaWJ1dGVzIGFyZSBtZXJnZWQgYXMgYXJyYXlzLgogICAqLwoKCiAgc3RyYXRzLmluaXQgPSBzdHJhdHMuY3JlYXRlZCA9IHN0cmF0cy5yZWFkeSA9IHN0cmF0cy5hdHRhY2hlZCA9IHN0cmF0cy5kZXRhY2hlZCA9IHN0cmF0cy5iZWZvcmVDb21waWxlID0gc3RyYXRzLmNvbXBpbGVkID0gc3RyYXRzLmJlZm9yZURlc3Ryb3kgPSBzdHJhdHMuZGVzdHJveWVkID0gc3RyYXRzLmFjdGl2YXRlID0gZnVuY3Rpb24gKHBhcmVudFZhbCwgY2hpbGRWYWwpIHsKICAgIHJldHVybiBjaGlsZFZhbCA/IHBhcmVudFZhbCA/IHBhcmVudFZhbC5jb25jYXQoY2hpbGRWYWwpIDogaXNBcnJheShjaGlsZFZhbCkgPyBjaGlsZFZhbCA6IFtjaGlsZFZhbF0gOiBwYXJlbnRWYWw7CiAgfTsKICAvKioKICAgKiBBc3NldHMKICAgKgogICAqIFdoZW4gYSB2bSBpcyBwcmVzZW50IChpbnN0YW5jZSBjcmVhdGlvbiksIHdlIG5lZWQgdG8gZG8KICAgKiBhIHRocmVlLXdheSBtZXJnZSBiZXR3ZWVuIGNvbnN0cnVjdG9yIG9wdGlvbnMsIGluc3RhbmNlCiAgICogb3B0aW9ucyBhbmQgcGFyZW50IG9wdGlvbnMuCiAgICovCgoKICBmdW5jdGlvbiBtZXJnZUFzc2V0cyhwYXJlbnRWYWwsIGNoaWxkVmFsKSB7CiAgICB2YXIgcmVzID0gT2JqZWN0LmNyZWF0ZShwYXJlbnRWYWwgfHwgbnVsbCk7CiAgICByZXR1cm4gY2hpbGRWYWwgPyBleHRlbmQocmVzLCBndWFyZEFycmF5QXNzZXRzKGNoaWxkVmFsKSkgOiByZXM7CiAgfQoKICBjb25maWcuX2Fzc2V0VHlwZXMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkgewogICAgc3RyYXRzW3R5cGUgKyAncyddID0gbWVyZ2VBc3NldHM7CiAgfSk7CiAgLyoqCiAgICogRXZlbnRzICYgV2F0Y2hlcnMuCiAgICoKICAgKiBFdmVudHMgJiB3YXRjaGVycyBoYXNoZXMgc2hvdWxkIG5vdCBvdmVyd3JpdGUgb25lCiAgICogYW5vdGhlciwgc28gd2UgbWVyZ2UgdGhlbSBhcyBhcnJheXMuCiAgICovCgoKICBzdHJhdHMud2F0Y2ggPSBzdHJhdHMuZXZlbnRzID0gZnVuY3Rpb24gKHBhcmVudFZhbCwgY2hpbGRWYWwpIHsKICAgIGlmICghY2hpbGRWYWwpIHJldHVybiBwYXJlbnRWYWw7CiAgICBpZiAoIXBhcmVudFZhbCkgcmV0dXJuIGNoaWxkVmFsOwogICAgdmFyIHJldCA9IHt9OwogICAgZXh0ZW5kKHJldCwgcGFyZW50VmFsKTsKCiAgICBmb3IgKHZhciBrZXkgaW4gY2hpbGRWYWwpIHsKICAgICAgdmFyIHBhcmVudCA9IHJldFtrZXldOwogICAgICB2YXIgY2hpbGQgPSBjaGlsZFZhbFtrZXldOwoKICAgICAgaWYgKHBhcmVudCAmJiAhaXNBcnJheShwYXJlbnQpKSB7CiAgICAgICAgcGFyZW50ID0gW3BhcmVudF07CiAgICAgIH0KCiAgICAgIHJldFtrZXldID0gcGFyZW50ID8gcGFyZW50LmNvbmNhdChjaGlsZCkgOiBbY2hpbGRdOwogICAgfQoKICAgIHJldHVybiByZXQ7CiAgfTsKICAvKioKICAgKiBPdGhlciBvYmplY3QgaGFzaGVzLgogICAqLwoKCiAgc3RyYXRzLnByb3BzID0gc3RyYXRzLm1ldGhvZHMgPSBzdHJhdHMuY29tcHV0ZWQgPSBmdW5jdGlvbiAocGFyZW50VmFsLCBjaGlsZFZhbCkgewogICAgaWYgKCFjaGlsZFZhbCkgcmV0dXJuIHBhcmVudFZhbDsKICAgIGlmICghcGFyZW50VmFsKSByZXR1cm4gY2hpbGRWYWw7CiAgICB2YXIgcmV0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGV4dGVuZChyZXQsIHBhcmVudFZhbCk7CiAgICBleHRlbmQocmV0LCBjaGlsZFZhbCk7CiAgICByZXR1cm4gcmV0OwogIH07CiAgLyoqCiAgICogRGVmYXVsdCBzdHJhdGVneS4KICAgKi8KCgogIHZhciBkZWZhdWx0U3RyYXQgPSBmdW5jdGlvbiBkZWZhdWx0U3RyYXQocGFyZW50VmFsLCBjaGlsZFZhbCkgewogICAgcmV0dXJuIGNoaWxkVmFsID09PSB1bmRlZmluZWQgPyBwYXJlbnRWYWwgOiBjaGlsZFZhbDsKICB9OwogIC8qKgogICAqIE1ha2Ugc3VyZSBjb21wb25lbnQgb3B0aW9ucyBnZXQgY29udmVydGVkIHRvIGFjdHVhbAogICAqIGNvbnN0cnVjdG9ycy4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICovCgoKICBmdW5jdGlvbiBndWFyZENvbXBvbmVudHMob3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMuY29tcG9uZW50cykgewogICAgICB2YXIgY29tcG9uZW50cyA9IG9wdGlvbnMuY29tcG9uZW50cyA9IGd1YXJkQXJyYXlBc3NldHMob3B0aW9ucy5jb21wb25lbnRzKTsKICAgICAgdmFyIGlkcyA9IE9iamVjdC5rZXlzKGNvbXBvbmVudHMpOwogICAgICB2YXIgZGVmOwoKICAgICAgaWYgKCdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgIHZhciBtYXAgPSBvcHRpb25zLl9jb21wb25lbnROYW1lTWFwID0ge307CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gaWRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHZhciBrZXkgPSBpZHNbaV07CgogICAgICAgIGlmIChjb21tb25UYWdSRS50ZXN0KGtleSkgfHwgcmVzZXJ2ZWRUYWdSRS50ZXN0KGtleSkpIHsKICAgICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdEbyBub3QgdXNlIGJ1aWx0LWluIG9yIHJlc2VydmVkIEhUTUwgZWxlbWVudHMgYXMgY29tcG9uZW50ICcgKyAnaWQ6ICcgKyBrZXkpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyByZWNvcmQgYSBhbGwgbG93ZXJjYXNlIDwtPiBrZWJhYi1jYXNlIG1hcHBpbmcgZm9yCiAgICAgICAgLy8gcG9zc2libGUgY3VzdG9tIGVsZW1lbnQgY2FzZSBlcnJvciB3YXJuaW5nCgoKICAgICAgICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICBtYXBba2V5LnJlcGxhY2UoLy0vZywgJycpLnRvTG93ZXJDYXNlKCldID0gaHlwaGVuYXRlKGtleSk7CiAgICAgICAgfQoKICAgICAgICBkZWYgPSBjb21wb25lbnRzW2tleV07CgogICAgICAgIGlmIChpc1BsYWluT2JqZWN0KGRlZikpIHsKICAgICAgICAgIGNvbXBvbmVudHNba2V5XSA9IFZ1ZS5leHRlbmQoZGVmKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgLyoqCiAgICogRW5zdXJlIGFsbCBwcm9wcyBvcHRpb24gc3ludGF4IGFyZSBub3JtYWxpemVkIGludG8gdGhlCiAgICogT2JqZWN0LWJhc2VkIGZvcm1hdC4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICovCgoKICBmdW5jdGlvbiBndWFyZFByb3BzKG9wdGlvbnMpIHsKICAgIHZhciBwcm9wcyA9IG9wdGlvbnMucHJvcHM7CiAgICB2YXIgaSwgdmFsOwoKICAgIGlmIChpc0FycmF5KHByb3BzKSkgewogICAgICBvcHRpb25zLnByb3BzID0ge307CiAgICAgIGkgPSBwcm9wcy5sZW5ndGg7CgogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgdmFsID0gcHJvcHNbaV07CgogICAgICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykgewogICAgICAgICAgb3B0aW9ucy5wcm9wc1t2YWxdID0gbnVsbDsKICAgICAgICB9IGVsc2UgaWYgKHZhbC5uYW1lKSB7CiAgICAgICAgICBvcHRpb25zLnByb3BzW3ZhbC5uYW1lXSA9IHZhbDsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChwcm9wcykpIHsKICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhwcm9wcyk7CiAgICAgIGkgPSBrZXlzLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB2YWwgPSBwcm9wc1trZXlzW2ldXTsKCiAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHByb3BzW2tleXNbaV1dID0gewogICAgICAgICAgICB0eXBlOiB2YWwKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIEd1YXJkIGFuIEFycmF5LWZvcm1hdCBhc3NldHMgb3B0aW9uIGFuZCBjb252ZXJ0ZWQgaXQKICAgKiBpbnRvIHRoZSBrZXktdmFsdWUgT2JqZWN0IGZvcm1hdC4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fEFycmF5fSBhc3NldHMKICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICovCgoKICBmdW5jdGlvbiBndWFyZEFycmF5QXNzZXRzKGFzc2V0cykgewogICAgaWYgKGlzQXJyYXkoYXNzZXRzKSkgewogICAgICB2YXIgcmVzID0ge307CiAgICAgIHZhciBpID0gYXNzZXRzLmxlbmd0aDsKICAgICAgdmFyIGFzc2V0OwoKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIGFzc2V0ID0gYXNzZXRzW2ldOwogICAgICAgIHZhciBpZCA9IHR5cGVvZiBhc3NldCA9PT0gJ2Z1bmN0aW9uJyA/IGFzc2V0Lm9wdGlvbnMgJiYgYXNzZXQub3B0aW9ucy5uYW1lIHx8IGFzc2V0LmlkIDogYXNzZXQubmFtZSB8fCBhc3NldC5pZDsKCiAgICAgICAgaWYgKCFpZCkgewogICAgICAgICAgJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oJ0FycmF5LXN5bnRheCBhc3NldHMgbXVzdCBwcm92aWRlIGEgIm5hbWUiIG9yICJpZCIgZmllbGQuJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc1tpZF0gPSBhc3NldDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXM7CiAgICB9CgogICAgcmV0dXJuIGFzc2V0czsKICB9CiAgLyoqCiAgICogTWVyZ2UgdHdvIG9wdGlvbiBvYmplY3RzIGludG8gYSBuZXcgb25lLgogICAqIENvcmUgdXRpbGl0eSB1c2VkIGluIGJvdGggaW5zdGFudGlhdGlvbiBhbmQgaW5oZXJpdGFuY2UuCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gcGFyZW50CiAgICogQHBhcmFtIHtPYmplY3R9IGNoaWxkCiAgICogQHBhcmFtIHtWdWV9IFt2bV0gLSBpZiB2bSBpcyBwcmVzZW50LCBpbmRpY2F0ZXMgdGhpcyBpcwogICAqICAgICAgICAgICAgICAgICAgICAgYW4gaW5zdGFudGlhdGlvbiBtZXJnZS4KICAgKi8KCgogIGZ1bmN0aW9uIG1lcmdlT3B0aW9ucyhwYXJlbnQsIGNoaWxkLCB2bSkgewogICAgZ3VhcmRDb21wb25lbnRzKGNoaWxkKTsKICAgIGd1YXJkUHJvcHMoY2hpbGQpOwoKICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgaWYgKGNoaWxkLnByb3BzRGF0YSAmJiAhdm0pIHsKICAgICAgICB3YXJuKCdwcm9wc0RhdGEgY2FuIG9ubHkgYmUgdXNlZCBhcyBhbiBpbnN0YW50aWF0aW9uIG9wdGlvbi4nKTsKICAgICAgfQogICAgfQoKICAgIHZhciBvcHRpb25zID0ge307CiAgICB2YXIga2V5OwoKICAgIGlmIChjaGlsZFsnZXh0ZW5kcyddKSB7CiAgICAgIHBhcmVudCA9IHR5cGVvZiBjaGlsZFsnZXh0ZW5kcyddID09PSAnZnVuY3Rpb24nID8gbWVyZ2VPcHRpb25zKHBhcmVudCwgY2hpbGRbJ2V4dGVuZHMnXS5vcHRpb25zLCB2bSkgOiBtZXJnZU9wdGlvbnMocGFyZW50LCBjaGlsZFsnZXh0ZW5kcyddLCB2bSk7CiAgICB9CgogICAgaWYgKGNoaWxkLm1peGlucykgewogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGNoaWxkLm1peGlucy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB2YXIgbWl4aW4gPSBjaGlsZC5taXhpbnNbaV07CiAgICAgICAgdmFyIG1peGluT3B0aW9ucyA9IG1peGluLnByb3RvdHlwZSBpbnN0YW5jZW9mIFZ1ZSA/IG1peGluLm9wdGlvbnMgOiBtaXhpbjsKICAgICAgICBwYXJlbnQgPSBtZXJnZU9wdGlvbnMocGFyZW50LCBtaXhpbk9wdGlvbnMsIHZtKTsKICAgICAgfQogICAgfQoKICAgIGZvciAoa2V5IGluIHBhcmVudCkgewogICAgICBtZXJnZUZpZWxkKGtleSk7CiAgICB9CgogICAgZm9yIChrZXkgaW4gY2hpbGQpIHsKICAgICAgaWYgKCFoYXNPd24ocGFyZW50LCBrZXkpKSB7CiAgICAgICAgbWVyZ2VGaWVsZChrZXkpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbWVyZ2VGaWVsZChrZXkpIHsKICAgICAgdmFyIHN0cmF0ID0gc3RyYXRzW2tleV0gfHwgZGVmYXVsdFN0cmF0OwogICAgICBvcHRpb25zW2tleV0gPSBzdHJhdChwYXJlbnRba2V5XSwgY2hpbGRba2V5XSwgdm0sIGtleSk7CiAgICB9CgogICAgcmV0dXJuIG9wdGlvbnM7CiAgfQogIC8qKgogICAqIFJlc29sdmUgYW4gYXNzZXQuCiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIGJlY2F1c2UgY2hpbGQgaW5zdGFuY2VzIG5lZWQgYWNjZXNzCiAgICogdG8gYXNzZXRzIGRlZmluZWQgaW4gaXRzIGFuY2VzdG9yIGNoYWluLgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAqIEBwYXJhbSB7U3RyaW5nfSBpZAogICAqIEBwYXJhbSB7Qm9vbGVhbn0gd2Fybk1pc3NpbmcKICAgKiBAcmV0dXJuIHtPYmplY3R8RnVuY3Rpb259CiAgICovCgoKICBmdW5jdGlvbiByZXNvbHZlQXNzZXQob3B0aW9ucywgdHlwZSwgaWQsIHdhcm5NaXNzaW5nKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICh0eXBlb2YgaWQgIT09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgYXNzZXRzID0gb3B0aW9uc1t0eXBlXTsKICAgIHZhciBjYW1lbGl6ZWRJZDsKICAgIHZhciByZXMgPSBhc3NldHNbaWRdIHx8IC8vIGNhbWVsQ2FzZSBJRAogICAgYXNzZXRzW2NhbWVsaXplZElkID0gY2FtZWxpemUoaWQpXSB8fCAvLyBQYXNjYWwgQ2FzZSBJRAogICAgYXNzZXRzW2NhbWVsaXplZElkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgY2FtZWxpemVkSWQuc2xpY2UoMSldOwoKICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgd2Fybk1pc3NpbmcgJiYgIXJlcykgewogICAgICB3YXJuKCdGYWlsZWQgdG8gcmVzb2x2ZSAnICsgdHlwZS5zbGljZSgwLCAtMSkgKyAnOiAnICsgaWQsIG9wdGlvbnMpOwogICAgfQoKICAgIHJldHVybiByZXM7CiAgfQoKICB2YXIgdWlkJDEgPSAwOwogIC8qKgogICAqIEEgZGVwIGlzIGFuIG9ic2VydmFibGUgdGhhdCBjYW4gaGF2ZSBtdWx0aXBsZQogICAqIGRpcmVjdGl2ZXMgc3Vic2NyaWJpbmcgdG8gaXQuCiAgICoKICAgKiBAY29uc3RydWN0b3IKICAgKi8KCiAgZnVuY3Rpb24gRGVwKCkgewogICAgdGhpcy5pZCA9IHVpZCQxKys7CiAgICB0aGlzLnN1YnMgPSBbXTsKICB9IC8vIHRoZSBjdXJyZW50IHRhcmdldCB3YXRjaGVyIGJlaW5nIGV2YWx1YXRlZC4KICAvLyB0aGlzIGlzIGdsb2JhbGx5IHVuaXF1ZSBiZWNhdXNlIHRoZXJlIGNvdWxkIGJlIG9ubHkgb25lCiAgLy8gd2F0Y2hlciBiZWluZyBldmFsdWF0ZWQgYXQgYW55IHRpbWUuCgoKICBEZXAudGFyZ2V0ID0gbnVsbDsKICAvKioKICAgKiBBZGQgYSBkaXJlY3RpdmUgc3Vic2NyaWJlci4KICAgKgogICAqIEBwYXJhbSB7RGlyZWN0aXZlfSBzdWIKICAgKi8KCiAgRGVwLnByb3RvdHlwZS5hZGRTdWIgPSBmdW5jdGlvbiAoc3ViKSB7CiAgICB0aGlzLnN1YnMucHVzaChzdWIpOwogIH07CiAgLyoqCiAgICogUmVtb3ZlIGEgZGlyZWN0aXZlIHN1YnNjcmliZXIuCiAgICoKICAgKiBAcGFyYW0ge0RpcmVjdGl2ZX0gc3ViCiAgICovCgoKICBEZXAucHJvdG90eXBlLnJlbW92ZVN1YiA9IGZ1bmN0aW9uIChzdWIpIHsKICAgIHRoaXMuc3Vicy4kcmVtb3ZlKHN1Yik7CiAgfTsKICAvKioKICAgKiBBZGQgc2VsZiBhcyBhIGRlcGVuZGVuY3kgdG8gdGhlIHRhcmdldCB3YXRjaGVyLgogICAqLwoKCiAgRGVwLnByb3RvdHlwZS5kZXBlbmQgPSBmdW5jdGlvbiAoKSB7CiAgICBEZXAudGFyZ2V0LmFkZERlcCh0aGlzKTsKICB9OwogIC8qKgogICAqIE5vdGlmeSBhbGwgc3Vic2NyaWJlcnMgb2YgYSBuZXcgdmFsdWUuCiAgICovCgoKICBEZXAucHJvdG90eXBlLm5vdGlmeSA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIHN0YWJsaXplIHRoZSBzdWJzY3JpYmVyIGxpc3QgZmlyc3QKICAgIHZhciBzdWJzID0gdG9BcnJheSh0aGlzLnN1YnMpOwoKICAgIGZvciAodmFyIGkgPSAwLCBsID0gc3Vicy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgc3Vic1tpXS51cGRhdGUoKTsKICAgIH0KICB9OwoKICB2YXIgYXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTsKICB2YXIgYXJyYXlNZXRob2RzID0gT2JqZWN0LmNyZWF0ZShhcnJheVByb3RvKQogIC8qKgogICAqIEludGVyY2VwdCBtdXRhdGluZyBtZXRob2RzIGFuZCBlbWl0IGV2ZW50cwogICAqLwogIDsKICBbJ3B1c2gnLCAncG9wJywgJ3NoaWZ0JywgJ3Vuc2hpZnQnLCAnc3BsaWNlJywgJ3NvcnQnLCAncmV2ZXJzZSddLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZCkgewogICAgLy8gY2FjaGUgb3JpZ2luYWwgbWV0aG9kCiAgICB2YXIgb3JpZ2luYWwgPSBhcnJheVByb3RvW21ldGhvZF07CiAgICBkZWYoYXJyYXlNZXRob2RzLCBtZXRob2QsIGZ1bmN0aW9uIG11dGF0b3IoKSB7CiAgICAgIC8vIGF2b2lkIGxlYWtpbmcgYXJndW1lbnRzOgogICAgICAvLyBodHRwOi8vanNwZXJmLmNvbS9jbG9zdXJlLXdpdGgtYXJndW1lbnRzCiAgICAgIHZhciBpID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoaSk7CgogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsKICAgICAgfQoKICAgICAgdmFyIHJlc3VsdCA9IG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICB2YXIgb2IgPSB0aGlzLl9fb2JfXzsKICAgICAgdmFyIGluc2VydGVkOwoKICAgICAgc3dpdGNoIChtZXRob2QpIHsKICAgICAgICBjYXNlICdwdXNoJzoKICAgICAgICAgIGluc2VydGVkID0gYXJnczsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICd1bnNoaWZ0JzoKICAgICAgICAgIGluc2VydGVkID0gYXJnczsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdzcGxpY2UnOgogICAgICAgICAgaW5zZXJ0ZWQgPSBhcmdzLnNsaWNlKDIpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIGlmIChpbnNlcnRlZCkgb2Iub2JzZXJ2ZUFycmF5KGluc2VydGVkKTsgLy8gbm90aWZ5IGNoYW5nZQoKICAgICAgb2IuZGVwLm5vdGlmeSgpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSk7CiAgfSk7CiAgLyoqCiAgICogU3dhcCB0aGUgZWxlbWVudCBhdCB0aGUgZ2l2ZW4gaW5kZXggd2l0aCBhIG5ldyB2YWx1ZQogICAqIGFuZCBlbWl0cyBjb3JyZXNwb25kaW5nIGV2ZW50LgogICAqCiAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4CiAgICogQHBhcmFtIHsqfSB2YWwKICAgKiBAcmV0dXJuIHsqfSAtIHJlcGxhY2VkIGVsZW1lbnQKICAgKi8KCiAgZGVmKGFycmF5UHJvdG8sICckc2V0JywgZnVuY3Rpb24gJHNldChpbmRleCwgdmFsKSB7CiAgICBpZiAoaW5kZXggPj0gdGhpcy5sZW5ndGgpIHsKICAgICAgdGhpcy5sZW5ndGggPSBOdW1iZXIoaW5kZXgpICsgMTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5zcGxpY2UoaW5kZXgsIDEsIHZhbClbMF07CiAgfSk7CiAgLyoqCiAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHJlbW92ZSB0aGUgZWxlbWVudCBhdCBnaXZlbiBpbmRleCBvciB0YXJnZXQgZWxlbWVudCByZWZlcmVuY2UuCiAgICoKICAgKiBAcGFyYW0geyp9IGl0ZW0KICAgKi8KCiAgZGVmKGFycmF5UHJvdG8sICckcmVtb3ZlJywgZnVuY3Rpb24gJHJlbW92ZShpdGVtKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICghdGhpcy5sZW5ndGgpIHJldHVybjsKICAgIHZhciBpbmRleCA9IGluZGV4T2YodGhpcywgaXRlbSk7CgogICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BsaWNlKGluZGV4LCAxKTsKICAgIH0KICB9KTsKICB2YXIgYXJyYXlLZXlzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoYXJyYXlNZXRob2RzKTsKICAvKioKICAgKiBCeSBkZWZhdWx0LCB3aGVuIGEgcmVhY3RpdmUgcHJvcGVydHkgaXMgc2V0LCB0aGUgbmV3IHZhbHVlIGlzCiAgICogYWxzbyBjb252ZXJ0ZWQgdG8gYmVjb21lIHJlYWN0aXZlLiBIb3dldmVyIGluIGNlcnRhaW4gY2FzZXMsIGUuZy4KICAgKiB2LWZvciBzY29wZSBhbGlhcyBhbmQgcHJvcHMsIHdlIGRvbid0IHdhbnQgdG8gZm9yY2UgY29udmVyc2lvbgogICAqIGJlY2F1c2UgdGhlIHZhbHVlIG1heSBiZSBhIG5lc3RlZCB2YWx1ZSB1bmRlciBhIGZyb3plbiBkYXRhIHN0cnVjdHVyZS4KICAgKgogICAqIFNvIHdoZW5ldmVyIHdlIHdhbnQgdG8gc2V0IGEgcmVhY3RpdmUgcHJvcGVydHkgd2l0aG91dCBmb3JjaW5nCiAgICogY29udmVyc2lvbiBvbiB0aGUgbmV3IHZhbHVlLCB3ZSB3cmFwIHRoYXQgY2FsbCBpbnNpZGUgdGhpcyBmdW5jdGlvbi4KICAgKi8KCiAgdmFyIHNob3VsZENvbnZlcnQgPSB0cnVlOwoKICBmdW5jdGlvbiB3aXRob3V0Q29udmVyc2lvbihmbikgewogICAgc2hvdWxkQ29udmVydCA9IGZhbHNlOwogICAgZm4oKTsKICAgIHNob3VsZENvbnZlcnQgPSB0cnVlOwogIH0KICAvKioKICAgKiBPYnNlcnZlciBjbGFzcyB0aGF0IGFyZSBhdHRhY2hlZCB0byBlYWNoIG9ic2VydmVkCiAgICogb2JqZWN0LiBPbmNlIGF0dGFjaGVkLCB0aGUgb2JzZXJ2ZXIgY29udmVydHMgdGFyZ2V0CiAgICogb2JqZWN0J3MgcHJvcGVydHkga2V5cyBpbnRvIGdldHRlci9zZXR0ZXJzIHRoYXQKICAgKiBjb2xsZWN0IGRlcGVuZGVuY2llcyBhbmQgZGlzcGF0Y2hlcyB1cGRhdGVzLgogICAqCiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IHZhbHVlCiAgICogQGNvbnN0cnVjdG9yCiAgICovCgoKICBmdW5jdGlvbiBPYnNlcnZlcih2YWx1ZSkgewogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgdGhpcy5kZXAgPSBuZXcgRGVwKCk7CiAgICBkZWYodmFsdWUsICdfX29iX18nLCB0aGlzKTsKCiAgICBpZiAoaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgdmFyIGF1Z21lbnQgPSBoYXNQcm90byA/IHByb3RvQXVnbWVudCA6IGNvcHlBdWdtZW50OwogICAgICBhdWdtZW50KHZhbHVlLCBhcnJheU1ldGhvZHMsIGFycmF5S2V5cyk7CiAgICAgIHRoaXMub2JzZXJ2ZUFycmF5KHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMud2Fsayh2YWx1ZSk7CiAgICB9CiAgfSAvLyBJbnN0YW5jZSBtZXRob2RzCgogIC8qKgogICAqIFdhbGsgdGhyb3VnaCBlYWNoIHByb3BlcnR5IGFuZCBjb252ZXJ0IHRoZW0gaW50bwogICAqIGdldHRlci9zZXR0ZXJzLiBUaGlzIG1ldGhvZCBzaG91bGQgb25seSBiZSBjYWxsZWQgd2hlbgogICAqIHZhbHVlIHR5cGUgaXMgT2JqZWN0LgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IG9iagogICAqLwoKCiAgT2JzZXJ2ZXIucHJvdG90eXBlLndhbGsgPSBmdW5jdGlvbiAob2JqKSB7CiAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iaik7CgogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBrZXlzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB0aGlzLmNvbnZlcnQoa2V5c1tpXSwgb2JqW2tleXNbaV1dKTsKICAgIH0KICB9OwogIC8qKgogICAqIE9ic2VydmUgYSBsaXN0IG9mIEFycmF5IGl0ZW1zLgogICAqCiAgICogQHBhcmFtIHtBcnJheX0gaXRlbXMKICAgKi8KCgogIE9ic2VydmVyLnByb3RvdHlwZS5vYnNlcnZlQXJyYXkgPSBmdW5jdGlvbiAoaXRlbXMpIHsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gaXRlbXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIG9ic2VydmUoaXRlbXNbaV0pOwogICAgfQogIH07CiAgLyoqCiAgICogQ29udmVydCBhIHByb3BlcnR5IGludG8gZ2V0dGVyL3NldHRlciBzbyB3ZSBjYW4gZW1pdAogICAqIHRoZSBldmVudHMgd2hlbiB0aGUgcHJvcGVydHkgaXMgYWNjZXNzZWQvY2hhbmdlZC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBrZXkKICAgKiBAcGFyYW0geyp9IHZhbAogICAqLwoKCiAgT2JzZXJ2ZXIucHJvdG90eXBlLmNvbnZlcnQgPSBmdW5jdGlvbiAoa2V5LCB2YWwpIHsKICAgIGRlZmluZVJlYWN0aXZlKHRoaXMudmFsdWUsIGtleSwgdmFsKTsKICB9OwogIC8qKgogICAqIEFkZCBhbiBvd25lciB2bSwgc28gdGhhdCB3aGVuICRzZXQvJGRlbGV0ZSBtdXRhdGlvbnMKICAgKiBoYXBwZW4gd2UgY2FuIG5vdGlmeSBvd25lciB2bXMgdG8gcHJveHkgdGhlIGtleXMgYW5kCiAgICogZGlnZXN0IHRoZSB3YXRjaGVycy4gVGhpcyBpcyBvbmx5IGNhbGxlZCB3aGVuIHRoZSBvYmplY3QKICAgKiBpcyBvYnNlcnZlZCBhcyBhbiBpbnN0YW5jZSdzIHJvb3QgJGRhdGEuCiAgICoKICAgKiBAcGFyYW0ge1Z1ZX0gdm0KICAgKi8KCgogIE9ic2VydmVyLnByb3RvdHlwZS5hZGRWbSA9IGZ1bmN0aW9uICh2bSkgewogICAgKHRoaXMudm1zIHx8ICh0aGlzLnZtcyA9IFtdKSkucHVzaCh2bSk7CiAgfTsKICAvKioKICAgKiBSZW1vdmUgYW4gb3duZXIgdm0uIFRoaXMgaXMgY2FsbGVkIHdoZW4gdGhlIG9iamVjdCBpcwogICAqIHN3YXBwZWQgb3V0IGFzIGFuIGluc3RhbmNlJ3MgJGRhdGEgb2JqZWN0LgogICAqCiAgICogQHBhcmFtIHtWdWV9IHZtCiAgICovCgoKICBPYnNlcnZlci5wcm90b3R5cGUucmVtb3ZlVm0gPSBmdW5jdGlvbiAodm0pIHsKICAgIHRoaXMudm1zLiRyZW1vdmUodm0pOwogIH07IC8vIGhlbHBlcnMKCiAgLyoqCiAgICogQXVnbWVudCBhbiB0YXJnZXQgT2JqZWN0IG9yIEFycmF5IGJ5IGludGVyY2VwdGluZwogICAqIHRoZSBwcm90b3R5cGUgY2hhaW4gdXNpbmcgX19wcm90b19fCiAgICoKICAgKiBAcGFyYW0ge09iamVjdHxBcnJheX0gdGFyZ2V0CiAgICogQHBhcmFtIHtPYmplY3R9IHNyYwogICAqLwoKCiAgZnVuY3Rpb24gcHJvdG9BdWdtZW50KHRhcmdldCwgc3JjKSB7CiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1wcm90byAqLwogICAgdGFyZ2V0Ll9fcHJvdG9fXyA9IHNyYzsKICAgIC8qIGVzbGludC1lbmFibGUgbm8tcHJvdG8gKi8KICB9CiAgLyoqCiAgICogQXVnbWVudCBhbiB0YXJnZXQgT2JqZWN0IG9yIEFycmF5IGJ5IGRlZmluaW5nCiAgICogaGlkZGVuIHByb3BlcnRpZXMuCiAgICoKICAgKiBAcGFyYW0ge09iamVjdHxBcnJheX0gdGFyZ2V0CiAgICogQHBhcmFtIHtPYmplY3R9IHByb3RvCiAgICovCgoKICBmdW5jdGlvbiBjb3B5QXVnbWVudCh0YXJnZXQsIHNyYywga2V5cykgewogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBrZXlzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB2YXIga2V5ID0ga2V5c1tpXTsKICAgICAgZGVmKHRhcmdldCwga2V5LCBzcmNba2V5XSk7CiAgICB9CiAgfQogIC8qKgogICAqIEF0dGVtcHQgdG8gY3JlYXRlIGFuIG9ic2VydmVyIGluc3RhbmNlIGZvciBhIHZhbHVlLAogICAqIHJldHVybnMgdGhlIG5ldyBvYnNlcnZlciBpZiBzdWNjZXNzZnVsbHkgb2JzZXJ2ZWQsCiAgICogb3IgdGhlIGV4aXN0aW5nIG9ic2VydmVyIGlmIHRoZSB2YWx1ZSBhbHJlYWR5IGhhcyBvbmUuCiAgICoKICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICogQHBhcmFtIHtWdWV9IFt2bV0KICAgKiBAcmV0dXJuIHtPYnNlcnZlcnx1bmRlZmluZWR9CiAgICogQHN0YXRpYwogICAqLwoKCiAgZnVuY3Rpb24gb2JzZXJ2ZSh2YWx1ZSwgdm0pIHsKICAgIGlmICghdmFsdWUgfHwgX3R5cGVvZih2YWx1ZSkgIT09ICdvYmplY3QnKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgb2I7CgogICAgaWYgKGhhc093bih2YWx1ZSwgJ19fb2JfXycpICYmIHZhbHVlLl9fb2JfXyBpbnN0YW5jZW9mIE9ic2VydmVyKSB7CiAgICAgIG9iID0gdmFsdWUuX19vYl9fOwogICAgfSBlbHNlIGlmIChzaG91bGRDb252ZXJ0ICYmIChpc0FycmF5KHZhbHVlKSB8fCBpc1BsYWluT2JqZWN0KHZhbHVlKSkgJiYgT2JqZWN0LmlzRXh0ZW5zaWJsZSh2YWx1ZSkgJiYgIXZhbHVlLl9pc1Z1ZSkgewogICAgICBvYiA9IG5ldyBPYnNlcnZlcih2YWx1ZSk7CiAgICB9CgogICAgaWYgKG9iICYmIHZtKSB7CiAgICAgIG9iLmFkZFZtKHZtKTsKICAgIH0KCiAgICByZXR1cm4gb2I7CiAgfQogIC8qKgogICAqIERlZmluZSBhIHJlYWN0aXZlIHByb3BlcnR5IG9uIGFuIE9iamVjdC4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmoKICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5CiAgICogQHBhcmFtIHsqfSB2YWwKICAgKi8KCgogIGZ1bmN0aW9uIGRlZmluZVJlYWN0aXZlKG9iaiwga2V5LCB2YWwpIHsKICAgIHZhciBkZXAgPSBuZXcgRGVwKCk7CiAgICB2YXIgcHJvcGVydHkgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KTsKCiAgICBpZiAocHJvcGVydHkgJiYgcHJvcGVydHkuY29uZmlndXJhYmxlID09PSBmYWxzZSkgewogICAgICByZXR1cm47CiAgICB9IC8vIGNhdGVyIGZvciBwcmUtZGVmaW5lZCBnZXR0ZXIvc2V0dGVycwoKCiAgICB2YXIgZ2V0dGVyID0gcHJvcGVydHkgJiYgcHJvcGVydHkuZ2V0OwogICAgdmFyIHNldHRlciA9IHByb3BlcnR5ICYmIHByb3BlcnR5LnNldDsKICAgIHZhciBjaGlsZE9iID0gb2JzZXJ2ZSh2YWwpOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZ2V0OiBmdW5jdGlvbiByZWFjdGl2ZUdldHRlcigpIHsKICAgICAgICB2YXIgdmFsdWUgPSBnZXR0ZXIgPyBnZXR0ZXIuY2FsbChvYmopIDogdmFsOwoKICAgICAgICBpZiAoRGVwLnRhcmdldCkgewogICAgICAgICAgZGVwLmRlcGVuZCgpOwoKICAgICAgICAgIGlmIChjaGlsZE9iKSB7CiAgICAgICAgICAgIGNoaWxkT2IuZGVwLmRlcGVuZCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICAgICAgICBmb3IgKHZhciBlLCBpID0gMCwgbCA9IHZhbHVlLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgIGUgPSB2YWx1ZVtpXTsKICAgICAgICAgICAgICBlICYmIGUuX19vYl9fICYmIGUuX19vYl9fLmRlcC5kZXBlbmQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uIHJlYWN0aXZlU2V0dGVyKG5ld1ZhbCkgewogICAgICAgIHZhciB2YWx1ZSA9IGdldHRlciA/IGdldHRlci5jYWxsKG9iaikgOiB2YWw7CgogICAgICAgIGlmIChuZXdWYWwgPT09IHZhbHVlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoc2V0dGVyKSB7CiAgICAgICAgICBzZXR0ZXIuY2FsbChvYmosIG5ld1ZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbCA9IG5ld1ZhbDsKICAgICAgICB9CgogICAgICAgIGNoaWxkT2IgPSBvYnNlcnZlKG5ld1ZhbCk7CiAgICAgICAgZGVwLm5vdGlmeSgpOwogICAgICB9CiAgICB9KTsKICB9CgogIHZhciB1dGlsID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBkZWZpbmVSZWFjdGl2ZTogZGVmaW5lUmVhY3RpdmUsCiAgICBzZXQ6IHNldCwKICAgIGRlbDogZGVsLAogICAgaGFzT3duOiBoYXNPd24sCiAgICBpc0xpdGVyYWw6IGlzTGl0ZXJhbCwKICAgIGlzUmVzZXJ2ZWQ6IGlzUmVzZXJ2ZWQsCiAgICBfdG9TdHJpbmc6IF90b1N0cmluZywKICAgIHRvTnVtYmVyOiB0b051bWJlciwKICAgIHRvQm9vbGVhbjogdG9Cb29sZWFuLAogICAgc3RyaXBRdW90ZXM6IHN0cmlwUXVvdGVzLAogICAgY2FtZWxpemU6IGNhbWVsaXplLAogICAgaHlwaGVuYXRlOiBoeXBoZW5hdGUsCiAgICBjbGFzc2lmeTogY2xhc3NpZnksCiAgICBiaW5kOiBiaW5kLAogICAgdG9BcnJheTogdG9BcnJheSwKICAgIGV4dGVuZDogZXh0ZW5kLAogICAgaXNPYmplY3Q6IGlzT2JqZWN0LAogICAgaXNQbGFpbk9iamVjdDogaXNQbGFpbk9iamVjdCwKICAgIGRlZjogZGVmLAogICAgZGVib3VuY2U6IF9kZWJvdW5jZSwKICAgIGluZGV4T2Y6IGluZGV4T2YsCiAgICBjYW5jZWxsYWJsZTogY2FuY2VsbGFibGUsCiAgICBsb29zZUVxdWFsOiBsb29zZUVxdWFsLAogICAgaXNBcnJheTogaXNBcnJheSwKICAgIGhhc1Byb3RvOiBoYXNQcm90bywKICAgIGluQnJvd3NlcjogaW5Ccm93c2VyLAogICAgZGV2dG9vbHM6IGRldnRvb2xzLAogICAgaXNJRTogaXNJRSwKICAgIGlzSUU5OiBpc0lFOSwKICAgIGlzQW5kcm9pZDogaXNBbmRyb2lkLAogICAgaXNJb3M6IGlzSW9zLAogICAgaW9zVmVyc2lvbk1hdGNoOiBpb3NWZXJzaW9uTWF0Y2gsCiAgICBpb3NWZXJzaW9uOiBpb3NWZXJzaW9uLAogICAgaGFzTXV0YXRpb25PYnNlcnZlckJ1ZzogaGFzTXV0YXRpb25PYnNlcnZlckJ1ZywKCiAgICBnZXQgdHJhbnNpdGlvblByb3AoKSB7CiAgICAgIHJldHVybiB0cmFuc2l0aW9uUHJvcDsKICAgIH0sCgogICAgZ2V0IHRyYW5zaXRpb25FbmRFdmVudCgpIHsKICAgICAgcmV0dXJuIHRyYW5zaXRpb25FbmRFdmVudDsKICAgIH0sCgogICAgZ2V0IGFuaW1hdGlvblByb3AoKSB7CiAgICAgIHJldHVybiBhbmltYXRpb25Qcm9wOwogICAgfSwKCiAgICBnZXQgYW5pbWF0aW9uRW5kRXZlbnQoKSB7CiAgICAgIHJldHVybiBhbmltYXRpb25FbmRFdmVudDsKICAgIH0sCgogICAgbmV4dFRpY2s6IG5leHRUaWNrLAoKICAgIGdldCBfU2V0KCkgewogICAgICByZXR1cm4gX1NldDsKICAgIH0sCgogICAgcXVlcnk6IHF1ZXJ5LAogICAgaW5Eb2M6IGluRG9jLAogICAgZ2V0QXR0cjogZ2V0QXR0ciwKICAgIGdldEJpbmRBdHRyOiBnZXRCaW5kQXR0ciwKICAgIGhhc0JpbmRBdHRyOiBoYXNCaW5kQXR0ciwKICAgIGJlZm9yZTogYmVmb3JlLAogICAgYWZ0ZXI6IGFmdGVyLAogICAgcmVtb3ZlOiByZW1vdmUsCiAgICBwcmVwZW5kOiBwcmVwZW5kLAogICAgcmVwbGFjZTogcmVwbGFjZSwKICAgIG9uOiBvbiwKICAgIG9mZjogb2ZmLAogICAgc2V0Q2xhc3M6IHNldENsYXNzLAogICAgYWRkQ2xhc3M6IGFkZENsYXNzLAogICAgcmVtb3ZlQ2xhc3M6IHJlbW92ZUNsYXNzLAogICAgZXh0cmFjdENvbnRlbnQ6IGV4dHJhY3RDb250ZW50LAogICAgdHJpbU5vZGU6IHRyaW1Ob2RlLAogICAgaXNUZW1wbGF0ZTogaXNUZW1wbGF0ZSwKICAgIGNyZWF0ZUFuY2hvcjogY3JlYXRlQW5jaG9yLAogICAgZmluZFJlZjogZmluZFJlZiwKICAgIG1hcE5vZGVSYW5nZTogbWFwTm9kZVJhbmdlLAogICAgcmVtb3ZlTm9kZVJhbmdlOiByZW1vdmVOb2RlUmFuZ2UsCiAgICBpc0ZyYWdtZW50OiBpc0ZyYWdtZW50LAogICAgZ2V0T3V0ZXJIVE1MOiBnZXRPdXRlckhUTUwsCiAgICBtZXJnZU9wdGlvbnM6IG1lcmdlT3B0aW9ucywKICAgIHJlc29sdmVBc3NldDogcmVzb2x2ZUFzc2V0LAogICAgY2hlY2tDb21wb25lbnRBdHRyOiBjaGVja0NvbXBvbmVudEF0dHIsCiAgICBjb21tb25UYWdSRTogY29tbW9uVGFnUkUsCiAgICByZXNlcnZlZFRhZ1JFOiByZXNlcnZlZFRhZ1JFLAoKICAgIGdldCB3YXJuKCkgewogICAgICByZXR1cm4gd2FybjsKICAgIH0KCiAgfSk7CiAgdmFyIHVpZCA9IDA7CgogIGZ1bmN0aW9uIGluaXRNaXhpbihWdWUpIHsKICAgIC8qKgogICAgICogVGhlIG1haW4gaW5pdCBzZXF1ZW5jZS4gVGhpcyBpcyBjYWxsZWQgZm9yIGV2ZXJ5CiAgICAgKiBpbnN0YW5jZSwgaW5jbHVkaW5nIG9uZXMgdGhhdCBhcmUgY3JlYXRlZCBmcm9tIGV4dGVuZGVkCiAgICAgKiBjb25zdHJ1Y3RvcnMuCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSB0aGlzIG9wdGlvbnMgb2JqZWN0IHNob3VsZCBiZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgcmVzdWx0IG9mIG1lcmdpbmcgY2xhc3MKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyBhbmQgdGhlIG9wdGlvbnMgcGFzc2VkCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIHRvIHRoZSBjb25zdHJ1Y3Rvci4KICAgICAqLwogICAgVnVlLnByb3RvdHlwZS5faW5pdCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICB0aGlzLiRlbCA9IG51bGw7CiAgICAgIHRoaXMuJHBhcmVudCA9IG9wdGlvbnMucGFyZW50OwogICAgICB0aGlzLiRyb290ID0gdGhpcy4kcGFyZW50ID8gdGhpcy4kcGFyZW50LiRyb290IDogdGhpczsKICAgICAgdGhpcy4kY2hpbGRyZW4gPSBbXTsKICAgICAgdGhpcy4kcmVmcyA9IHt9OyAvLyBjaGlsZCB2bSByZWZlcmVuY2VzCgogICAgICB0aGlzLiRlbHMgPSB7fTsgLy8gZWxlbWVudCByZWZlcmVuY2VzCgogICAgICB0aGlzLl93YXRjaGVycyA9IFtdOyAvLyBhbGwgd2F0Y2hlcnMgYXMgYW4gYXJyYXkKCiAgICAgIHRoaXMuX2RpcmVjdGl2ZXMgPSBbXTsgLy8gYWxsIGRpcmVjdGl2ZXMKICAgICAgLy8gYSB1aWQKCiAgICAgIHRoaXMuX3VpZCA9IHVpZCsrOyAvLyBhIGZsYWcgdG8gYXZvaWQgdGhpcyBiZWluZyBvYnNlcnZlZAoKICAgICAgdGhpcy5faXNWdWUgPSB0cnVlOyAvLyBldmVudHMgYm9va2tlZXBpbmcKCiAgICAgIHRoaXMuX2V2ZW50cyA9IHt9OyAvLyByZWdpc3RlcmVkIGNhbGxiYWNrcwoKICAgICAgdGhpcy5fZXZlbnRzQ291bnQgPSB7fTsgLy8gZm9yICRicm9hZGNhc3Qgb3B0aW1pemF0aW9uCiAgICAgIC8vIGZyYWdtZW50IGluc3RhbmNlIHByb3BlcnRpZXMKCiAgICAgIHRoaXMuX2lzRnJhZ21lbnQgPSBmYWxzZTsKICAgICAgdGhpcy5fZnJhZ21lbnQgPSAvLyBAdHlwZSB7RG9jdW1lbnRGcmFnbWVudH0KICAgICAgdGhpcy5fZnJhZ21lbnRTdGFydCA9IC8vIEB0eXBlIHtUZXh0fENvbW1lbnR9CiAgICAgIHRoaXMuX2ZyYWdtZW50RW5kID0gbnVsbDsgLy8gQHR5cGUge1RleHR8Q29tbWVudH0KICAgICAgLy8gbGlmZWN5Y2xlIHN0YXRlCgogICAgICB0aGlzLl9pc0NvbXBpbGVkID0gdGhpcy5faXNEZXN0cm95ZWQgPSB0aGlzLl9pc1JlYWR5ID0gdGhpcy5faXNBdHRhY2hlZCA9IHRoaXMuX2lzQmVpbmdEZXN0cm95ZWQgPSB0aGlzLl92Rm9yUmVtb3ZpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5fdW5saW5rRm4gPSBudWxsOyAvLyBjb250ZXh0OgogICAgICAvLyBpZiB0aGlzIGlzIGEgdHJhbnNjbHVkZWQgY29tcG9uZW50LCBjb250ZXh0CiAgICAgIC8vIHdpbGwgYmUgdGhlIGNvbW1vbiBwYXJlbnQgdm0gb2YgdGhpcyBpbnN0YW5jZQogICAgICAvLyBhbmQgaXRzIGhvc3QuCgogICAgICB0aGlzLl9jb250ZXh0ID0gb3B0aW9ucy5fY29udGV4dCB8fCB0aGlzLiRwYXJlbnQ7IC8vIHNjb3BlOgogICAgICAvLyBpZiB0aGlzIGlzIGluc2lkZSBhbiBpbmxpbmUgdi1mb3IsIHRoZSBzY29wZQogICAgICAvLyB3aWxsIGJlIHRoZSBpbnRlcm1lZGlhdGUgc2NvcGUgY3JlYXRlZCBmb3IgdGhpcwogICAgICAvLyByZXBlYXQgZnJhZ21lbnQuIHRoaXMgaXMgdXNlZCBmb3IgbGlua2luZyBwcm9wcwogICAgICAvLyBhbmQgY29udGFpbmVyIGRpcmVjdGl2ZXMuCgogICAgICB0aGlzLl9zY29wZSA9IG9wdGlvbnMuX3Njb3BlOyAvLyBmcmFnbWVudDoKICAgICAgLy8gaWYgdGhpcyBpbnN0YW5jZSBpcyBjb21waWxlZCBpbnNpZGUgYSBGcmFnbWVudCwgaXQKICAgICAgLy8gbmVlZHMgdG8gcmVpZ3N0ZXIgaXRzZWxmIGFzIGEgY2hpbGQgb2YgdGhhdCBmcmFnbWVudAogICAgICAvLyBmb3IgYXR0YWNoL2RldGFjaCB0byB3b3JrIHByb3Blcmx5LgoKICAgICAgdGhpcy5fZnJhZyA9IG9wdGlvbnMuX2ZyYWc7CgogICAgICBpZiAodGhpcy5fZnJhZykgewogICAgICAgIHRoaXMuX2ZyYWcuY2hpbGRyZW4ucHVzaCh0aGlzKTsKICAgICAgfSAvLyBwdXNoIHNlbGYgaW50byBwYXJlbnQgLyB0cmFuc2NsdXNpb24gaG9zdAoKCiAgICAgIGlmICh0aGlzLiRwYXJlbnQpIHsKICAgICAgICB0aGlzLiRwYXJlbnQuJGNoaWxkcmVuLnB1c2godGhpcyk7CiAgICAgIH0gLy8gbWVyZ2Ugb3B0aW9ucy4KCgogICAgICBvcHRpb25zID0gdGhpcy4kb3B0aW9ucyA9IG1lcmdlT3B0aW9ucyh0aGlzLmNvbnN0cnVjdG9yLm9wdGlvbnMsIG9wdGlvbnMsIHRoaXMpOyAvLyBzZXQgcmVmCgogICAgICB0aGlzLl91cGRhdGVSZWYoKTsgLy8gaW5pdGlhbGl6ZSBkYXRhIGFzIGVtcHR5IG9iamVjdC4KICAgICAgLy8gaXQgd2lsbCBiZSBmaWxsZWQgdXAgaW4gX2luaXREYXRhKCkuCgoKICAgICAgdGhpcy5fZGF0YSA9IHt9OyAvLyBjYWxsIGluaXQgaG9vawoKICAgICAgdGhpcy5fY2FsbEhvb2soJ2luaXQnKTsgLy8gaW5pdGlhbGl6ZSBkYXRhIG9ic2VydmF0aW9uIGFuZCBzY29wZSBpbmhlcml0YW5jZS4KCgogICAgICB0aGlzLl9pbml0U3RhdGUoKTsgLy8gc2V0dXAgZXZlbnQgc3lzdGVtIGFuZCBvcHRpb24gZXZlbnRzLgoKCiAgICAgIHRoaXMuX2luaXRFdmVudHMoKTsgLy8gY2FsbCBjcmVhdGVkIGhvb2sKCgogICAgICB0aGlzLl9jYWxsSG9vaygnY3JlYXRlZCcpOyAvLyBpZiBgZWxgIG9wdGlvbiBpcyBwYXNzZWQsIHN0YXJ0IGNvbXBpbGF0aW9uLgoKCiAgICAgIGlmIChvcHRpb25zLmVsKSB7CiAgICAgICAgdGhpcy4kbW91bnQob3B0aW9ucy5lbCk7CiAgICAgIH0KICAgIH07CiAgfQoKICB2YXIgcGF0aENhY2hlID0gbmV3IENhY2hlKDEwMDApOyAvLyBhY3Rpb25zCgogIHZhciBBUFBFTkQgPSAwOwogIHZhciBQVVNIID0gMTsKICB2YXIgSU5DX1NVQl9QQVRIX0RFUFRIID0gMjsKICB2YXIgUFVTSF9TVUJfUEFUSCA9IDM7IC8vIHN0YXRlcwoKICB2YXIgQkVGT1JFX1BBVEggPSAwOwogIHZhciBJTl9QQVRIID0gMTsKICB2YXIgQkVGT1JFX0lERU5UID0gMjsKICB2YXIgSU5fSURFTlQgPSAzOwogIHZhciBJTl9TVUJfUEFUSCA9IDQ7CiAgdmFyIElOX1NJTkdMRV9RVU9URSA9IDU7CiAgdmFyIElOX0RPVUJMRV9RVU9URSA9IDY7CiAgdmFyIEFGVEVSX1BBVEggPSA3OwogIHZhciBFUlJPUiA9IDg7CiAgdmFyIHBhdGhTdGF0ZU1hY2hpbmUgPSBbXTsKICBwYXRoU3RhdGVNYWNoaW5lW0JFRk9SRV9QQVRIXSA9IHsKICAgICd3cyc6IFtCRUZPUkVfUEFUSF0sCiAgICAnaWRlbnQnOiBbSU5fSURFTlQsIEFQUEVORF0sCiAgICAnWyc6IFtJTl9TVUJfUEFUSF0sCiAgICAnZW9mJzogW0FGVEVSX1BBVEhdCiAgfTsKICBwYXRoU3RhdGVNYWNoaW5lW0lOX1BBVEhdID0gewogICAgJ3dzJzogW0lOX1BBVEhdLAogICAgJy4nOiBbQkVGT1JFX0lERU5UXSwKICAgICdbJzogW0lOX1NVQl9QQVRIXSwKICAgICdlb2YnOiBbQUZURVJfUEFUSF0KICB9OwogIHBhdGhTdGF0ZU1hY2hpbmVbQkVGT1JFX0lERU5UXSA9IHsKICAgICd3cyc6IFtCRUZPUkVfSURFTlRdLAogICAgJ2lkZW50JzogW0lOX0lERU5ULCBBUFBFTkRdCiAgfTsKICBwYXRoU3RhdGVNYWNoaW5lW0lOX0lERU5UXSA9IHsKICAgICdpZGVudCc6IFtJTl9JREVOVCwgQVBQRU5EXSwKICAgICcwJzogW0lOX0lERU5ULCBBUFBFTkRdLAogICAgJ251bWJlcic6IFtJTl9JREVOVCwgQVBQRU5EXSwKICAgICd3cyc6IFtJTl9QQVRILCBQVVNIXSwKICAgICcuJzogW0JFRk9SRV9JREVOVCwgUFVTSF0sCiAgICAnWyc6IFtJTl9TVUJfUEFUSCwgUFVTSF0sCiAgICAnZW9mJzogW0FGVEVSX1BBVEgsIFBVU0hdCiAgfTsKICBwYXRoU3RhdGVNYWNoaW5lW0lOX1NVQl9QQVRIXSA9IHsKICAgICInIjogW0lOX1NJTkdMRV9RVU9URSwgQVBQRU5EXSwKICAgICciJzogW0lOX0RPVUJMRV9RVU9URSwgQVBQRU5EXSwKICAgICdbJzogW0lOX1NVQl9QQVRILCBJTkNfU1VCX1BBVEhfREVQVEhdLAogICAgJ10nOiBbSU5fUEFUSCwgUFVTSF9TVUJfUEFUSF0sCiAgICAnZW9mJzogRVJST1IsCiAgICAnZWxzZSc6IFtJTl9TVUJfUEFUSCwgQVBQRU5EXQogIH07CiAgcGF0aFN0YXRlTWFjaGluZVtJTl9TSU5HTEVfUVVPVEVdID0gewogICAgIiciOiBbSU5fU1VCX1BBVEgsIEFQUEVORF0sCiAgICAnZW9mJzogRVJST1IsCiAgICAnZWxzZSc6IFtJTl9TSU5HTEVfUVVPVEUsIEFQUEVORF0KICB9OwogIHBhdGhTdGF0ZU1hY2hpbmVbSU5fRE9VQkxFX1FVT1RFXSA9IHsKICAgICciJzogW0lOX1NVQl9QQVRILCBBUFBFTkRdLAogICAgJ2VvZic6IEVSUk9SLAogICAgJ2Vsc2UnOiBbSU5fRE9VQkxFX1FVT1RFLCBBUFBFTkRdCiAgfTsKICAvKioKICAgKiBEZXRlcm1pbmUgdGhlIHR5cGUgb2YgYSBjaGFyYWN0ZXIgaW4gYSBrZXlwYXRoLgogICAqCiAgICogQHBhcmFtIHtDaGFyfSBjaAogICAqIEByZXR1cm4ge1N0cmluZ30gdHlwZQogICAqLwoKICBmdW5jdGlvbiBnZXRQYXRoQ2hhclR5cGUoY2gpIHsKICAgIGlmIChjaCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiAnZW9mJzsKICAgIH0KCiAgICB2YXIgY29kZSA9IGNoLmNoYXJDb2RlQXQoMCk7CgogICAgc3dpdGNoIChjb2RlKSB7CiAgICAgIGNhc2UgMHg1QjogLy8gWwoKICAgICAgY2FzZSAweDVEOiAvLyBdCgogICAgICBjYXNlIDB4MkU6IC8vIC4KCiAgICAgIGNhc2UgMHgyMjogLy8gIgoKICAgICAgY2FzZSAweDI3OiAvLyAnCgogICAgICBjYXNlIDB4MzA6CiAgICAgICAgLy8gMAogICAgICAgIHJldHVybiBjaDsKCiAgICAgIGNhc2UgMHg1RjogLy8gXwoKICAgICAgY2FzZSAweDI0OgogICAgICAgIC8vICQKICAgICAgICByZXR1cm4gJ2lkZW50JzsKCiAgICAgIGNhc2UgMHgyMDogLy8gU3BhY2UKCiAgICAgIGNhc2UgMHgwOTogLy8gVGFiCgogICAgICBjYXNlIDB4MEE6IC8vIE5ld2xpbmUKCiAgICAgIGNhc2UgMHgwRDogLy8gUmV0dXJuCgogICAgICBjYXNlIDB4QTA6IC8vIE5vLWJyZWFrIHNwYWNlCgogICAgICBjYXNlIDB4RkVGRjogLy8gQnl0ZSBPcmRlciBNYXJrCgogICAgICBjYXNlIDB4MjAyODogLy8gTGluZSBTZXBhcmF0b3IKCiAgICAgIGNhc2UgMHgyMDI5OgogICAgICAgIC8vIFBhcmFncmFwaCBTZXBhcmF0b3IKICAgICAgICByZXR1cm4gJ3dzJzsKICAgIH0gLy8gYS16LCBBLVoKCgogICAgaWYgKGNvZGUgPj0gMHg2MSAmJiBjb2RlIDw9IDB4N0EgfHwgY29kZSA+PSAweDQxICYmIGNvZGUgPD0gMHg1QSkgewogICAgICByZXR1cm4gJ2lkZW50JzsKICAgIH0gLy8gMS05CgoKICAgIGlmIChjb2RlID49IDB4MzEgJiYgY29kZSA8PSAweDM5KSB7CiAgICAgIHJldHVybiAnbnVtYmVyJzsKICAgIH0KCiAgICByZXR1cm4gJ2Vsc2UnOwogIH0KICAvKioKICAgKiBGb3JtYXQgYSBzdWJQYXRoLCByZXR1cm4gaXRzIHBsYWluIGZvcm0gaWYgaXQgaXMKICAgKiBhIGxpdGVyYWwgc3RyaW5nIG9yIG51bWJlci4gT3RoZXJ3aXNlIHByZXBlbmQgdGhlCiAgICogZHluYW1pYyBpbmRpY2F0b3IgKCopLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGgKICAgKiBAcmV0dXJuIHtTdHJpbmd9CiAgICovCgoKICBmdW5jdGlvbiBmb3JtYXRTdWJQYXRoKHBhdGgpIHsKICAgIHZhciB0cmltbWVkID0gcGF0aC50cmltKCk7IC8vIGludmFsaWQgbGVhZGluZyAwCgogICAgaWYgKHBhdGguY2hhckF0KDApID09PSAnMCcgJiYgaXNOYU4ocGF0aCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJldHVybiBpc0xpdGVyYWwodHJpbW1lZCkgPyBzdHJpcFF1b3Rlcyh0cmltbWVkKSA6ICcqJyArIHRyaW1tZWQ7CiAgfQogIC8qKgogICAqIFBhcnNlIGEgc3RyaW5nIHBhdGggaW50byBhbiBhcnJheSBvZiBzZWdtZW50cwogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGgKICAgKiBAcmV0dXJuIHtBcnJheXx1bmRlZmluZWR9CiAgICovCgoKICBmdW5jdGlvbiBwYXJzZShwYXRoKSB7CiAgICB2YXIga2V5cyA9IFtdOwogICAgdmFyIGluZGV4ID0gLTE7CiAgICB2YXIgbW9kZSA9IEJFRk9SRV9QQVRIOwogICAgdmFyIHN1YlBhdGhEZXB0aCA9IDA7CiAgICB2YXIgYywgbmV3Q2hhciwga2V5LCB0eXBlLCB0cmFuc2l0aW9uLCBhY3Rpb24sIHR5cGVNYXA7CiAgICB2YXIgYWN0aW9ucyA9IFtdOwoKICAgIGFjdGlvbnNbUFVTSF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChrZXkgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGtleXMucHVzaChrZXkpOwogICAgICAgIGtleSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgfTsKCiAgICBhY3Rpb25zW0FQUEVORF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGtleSA9IG5ld0NoYXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAga2V5ICs9IG5ld0NoYXI7CiAgICAgIH0KICAgIH07CgogICAgYWN0aW9uc1tJTkNfU1VCX1BBVEhfREVQVEhdID0gZnVuY3Rpb24gKCkgewogICAgICBhY3Rpb25zW0FQUEVORF0oKTsKICAgICAgc3ViUGF0aERlcHRoKys7CiAgICB9OwoKICAgIGFjdGlvbnNbUFVTSF9TVUJfUEFUSF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChzdWJQYXRoRGVwdGggPiAwKSB7CiAgICAgICAgc3ViUGF0aERlcHRoLS07CiAgICAgICAgbW9kZSA9IElOX1NVQl9QQVRIOwogICAgICAgIGFjdGlvbnNbQVBQRU5EXSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHN1YlBhdGhEZXB0aCA9IDA7CiAgICAgICAga2V5ID0gZm9ybWF0U3ViUGF0aChrZXkpOwoKICAgICAgICBpZiAoa2V5ID09PSBmYWxzZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhY3Rpb25zW1BVU0hdKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIG1heWJlVW5lc2NhcGVRdW90ZSgpIHsKICAgICAgdmFyIG5leHRDaGFyID0gcGF0aFtpbmRleCArIDFdOwoKICAgICAgaWYgKG1vZGUgPT09IElOX1NJTkdMRV9RVU9URSAmJiBuZXh0Q2hhciA9PT0gIiciIHx8IG1vZGUgPT09IElOX0RPVUJMRV9RVU9URSAmJiBuZXh0Q2hhciA9PT0gJyInKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgICBuZXdDaGFyID0gJ1xcJyArIG5leHRDaGFyOwogICAgICAgIGFjdGlvbnNbQVBQRU5EXSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CgogICAgd2hpbGUgKG1vZGUgIT0gbnVsbCkgewogICAgICBpbmRleCsrOwogICAgICBjID0gcGF0aFtpbmRleF07CgogICAgICBpZiAoYyA9PT0gJ1xcJyAmJiBtYXliZVVuZXNjYXBlUXVvdGUoKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICB0eXBlID0gZ2V0UGF0aENoYXJUeXBlKGMpOwogICAgICB0eXBlTWFwID0gcGF0aFN0YXRlTWFjaGluZVttb2RlXTsKICAgICAgdHJhbnNpdGlvbiA9IHR5cGVNYXBbdHlwZV0gfHwgdHlwZU1hcFsnZWxzZSddIHx8IEVSUk9SOwoKICAgICAgaWYgKHRyYW5zaXRpb24gPT09IEVSUk9SKSB7CiAgICAgICAgcmV0dXJuOyAvLyBwYXJzZSBlcnJvcgogICAgICB9CgogICAgICBtb2RlID0gdHJhbnNpdGlvblswXTsKICAgICAgYWN0aW9uID0gYWN0aW9uc1t0cmFuc2l0aW9uWzFdXTsKCiAgICAgIGlmIChhY3Rpb24pIHsKICAgICAgICBuZXdDaGFyID0gdHJhbnNpdGlvblsyXTsKICAgICAgICBuZXdDaGFyID0gbmV3Q2hhciA9PT0gdW5kZWZpbmVkID8gYyA6IG5ld0NoYXI7CgogICAgICAgIGlmIChhY3Rpb24oKSA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChtb2RlID09PSBBRlRFUl9QQVRIKSB7CiAgICAgICAga2V5cy5yYXcgPSBwYXRoOwogICAgICAgIHJldHVybiBrZXlzOwogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIEV4dGVybmFsIHBhcnNlIHRoYXQgY2hlY2sgZm9yIGEgY2FjaGUgaGl0IGZpcnN0CiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gcGF0aAogICAqIEByZXR1cm4ge0FycmF5fHVuZGVmaW5lZH0KICAgKi8KCgogIGZ1bmN0aW9uIHBhcnNlUGF0aChwYXRoKSB7CiAgICB2YXIgaGl0ID0gcGF0aENhY2hlLmdldChwYXRoKTsKCiAgICBpZiAoIWhpdCkgewogICAgICBoaXQgPSBwYXJzZShwYXRoKTsKCiAgICAgIGlmIChoaXQpIHsKICAgICAgICBwYXRoQ2FjaGUucHV0KHBhdGgsIGhpdCk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gaGl0OwogIH0KICAvKioKICAgKiBHZXQgZnJvbSBhbiBvYmplY3QgZnJvbSBhIHBhdGggc3RyaW5nCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqCiAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGgKICAgKi8KCgogIGZ1bmN0aW9uIGdldFBhdGgob2JqLCBwYXRoKSB7CiAgICByZXR1cm4gcGFyc2VFeHByZXNzaW9uKHBhdGgpLmdldChvYmopOwogIH0KICAvKioKICAgKiBXYXJuIGFnYWluc3Qgc2V0dGluZyBub24tZXhpc3RlbnQgcm9vdCBwYXRoIG9uIGEgdm0uCiAgICovCgoKICB2YXIgd2Fybk5vbkV4aXN0ZW50OwoKICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICB3YXJuTm9uRXhpc3RlbnQgPSBmdW5jdGlvbiB3YXJuTm9uRXhpc3RlbnQocGF0aCwgdm0pIHsKICAgICAgd2FybignWW91IGFyZSBzZXR0aW5nIGEgbm9uLWV4aXN0ZW50IHBhdGggIicgKyBwYXRoLnJhdyArICciICcgKyAnb24gYSB2bSBpbnN0YW5jZS4gQ29uc2lkZXIgcHJlLWluaXRpYWxpemluZyB0aGUgcHJvcGVydHkgJyArICd3aXRoIHRoZSAiZGF0YSIgb3B0aW9uIGZvciBtb3JlIHJlbGlhYmxlIHJlYWN0aXZpdHkgJyArICdhbmQgYmV0dGVyIHBlcmZvcm1hbmNlLicsIHZtKTsKICAgIH07CiAgfQogIC8qKgogICAqIFNldCBvbiBhbiBvYmplY3QgZnJvbSBhIHBhdGgKICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmoKICAgKiBAcGFyYW0ge1N0cmluZyB8IEFycmF5fSBwYXRoCiAgICogQHBhcmFtIHsqfSB2YWwKICAgKi8KCgogIGZ1bmN0aW9uIHNldFBhdGgob2JqLCBwYXRoLCB2YWwpIHsKICAgIHZhciBvcmlnaW5hbCA9IG9iajsKCiAgICBpZiAodHlwZW9mIHBhdGggPT09ICdzdHJpbmcnKSB7CiAgICAgIHBhdGggPSBwYXJzZShwYXRoKTsKICAgIH0KCiAgICBpZiAoIXBhdGggfHwgIWlzT2JqZWN0KG9iaikpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHZhciBsYXN0LCBrZXk7CgogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBwYXRoLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBsYXN0ID0gb2JqOwogICAgICBrZXkgPSBwYXRoW2ldOwoKICAgICAgaWYgKGtleS5jaGFyQXQoMCkgPT09ICcqJykgewogICAgICAgIGtleSA9IHBhcnNlRXhwcmVzc2lvbihrZXkuc2xpY2UoMSkpLmdldC5jYWxsKG9yaWdpbmFsLCBvcmlnaW5hbCk7CiAgICAgIH0KCiAgICAgIGlmIChpIDwgbCAtIDEpIHsKICAgICAgICBvYmogPSBvYmpba2V5XTsKCiAgICAgICAgaWYgKCFpc09iamVjdChvYmopKSB7CiAgICAgICAgICBvYmogPSB7fTsKCiAgICAgICAgICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIGxhc3QuX2lzVnVlKSB7CiAgICAgICAgICAgIHdhcm5Ob25FeGlzdGVudChwYXRoLCBsYXN0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBzZXQobGFzdCwga2V5LCBvYmopOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoaXNBcnJheShvYmopKSB7CiAgICAgICAgICBvYmouJHNldChrZXksIHZhbCk7CiAgICAgICAgfSBlbHNlIGlmIChrZXkgaW4gb2JqKSB7CiAgICAgICAgICBvYmpba2V5XSA9IHZhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKCdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiBvYmouX2lzVnVlKSB7CiAgICAgICAgICAgIHdhcm5Ob25FeGlzdGVudChwYXRoLCBvYmopOwogICAgICAgICAgfQoKICAgICAgICAgIHNldChvYmosIGtleSwgdmFsKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIHZhciBwYXRoID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBwYXJzZVBhdGg6IHBhcnNlUGF0aCwKICAgIGdldFBhdGg6IGdldFBhdGgsCiAgICBzZXRQYXRoOiBzZXRQYXRoCiAgfSk7CiAgdmFyIGV4cHJlc3Npb25DYWNoZSA9IG5ldyBDYWNoZSgxMDAwKTsKICB2YXIgYWxsb3dlZEtleXdvcmRzID0gJ01hdGgsRGF0ZSx0aGlzLHRydWUsZmFsc2UsbnVsbCx1bmRlZmluZWQsSW5maW5pdHksTmFOLCcgKyAnaXNOYU4saXNGaW5pdGUsZGVjb2RlVVJJLGRlY29kZVVSSUNvbXBvbmVudCxlbmNvZGVVUkksJyArICdlbmNvZGVVUklDb21wb25lbnQscGFyc2VJbnQscGFyc2VGbG9hdCc7CiAgdmFyIGFsbG93ZWRLZXl3b3Jkc1JFID0gbmV3IFJlZ0V4cCgnXignICsgYWxsb3dlZEtleXdvcmRzLnJlcGxhY2UoLywvZywgJ1xcYnwnKSArICdcXGIpJyk7IC8vIGtleXdvcmRzIHRoYXQgZG9uJ3QgbWFrZSBzZW5zZSBpbnNpZGUgZXhwcmVzc2lvbnMKCiAgdmFyIGltcHJvcGVyS2V5d29yZHMgPSAnYnJlYWssY2FzZSxjbGFzcyxjYXRjaCxjb25zdCxjb250aW51ZSxkZWJ1Z2dlcixkZWZhdWx0LCcgKyAnZGVsZXRlLGRvLGVsc2UsZXhwb3J0LGV4dGVuZHMsZmluYWxseSxmb3IsZnVuY3Rpb24saWYsJyArICdpbXBvcnQsaW4saW5zdGFuY2VvZixsZXQscmV0dXJuLHN1cGVyLHN3aXRjaCx0aHJvdyx0cnksJyArICd2YXIsd2hpbGUsd2l0aCx5aWVsZCxlbnVtLGF3YWl0LGltcGxlbWVudHMscGFja2FnZSwnICsgJ3Byb3RlY3RlZCxzdGF0aWMsaW50ZXJmYWNlLHByaXZhdGUscHVibGljJzsKICB2YXIgaW1wcm9wZXJLZXl3b3Jkc1JFID0gbmV3IFJlZ0V4cCgnXignICsgaW1wcm9wZXJLZXl3b3Jkcy5yZXBsYWNlKC8sL2csICdcXGJ8JykgKyAnXFxiKScpOwogIHZhciB3c1JFID0gL1xzL2c7CiAgdmFyIG5ld2xpbmVSRSA9IC9cbi9nOwogIHZhciBzYXZlUkUgPSAvW1x7LF1ccypbXHdcJF9dK1xzKjp8KCcoPzpbXidcXF18XFwuKSonfCIoPzpbXiJcXF18XFwuKSoifGAoPzpbXmBcXF18XFwuKSpcJFx7fFx9KD86W15gXFxdfFxcLikqYHxgKD86W15gXFxdfFxcLikqYCl8bmV3IHx0eXBlb2YgfHZvaWQgL2c7CiAgdmFyIHJlc3RvcmVSRSA9IC8iKFxkKykiL2c7CiAgdmFyIHBhdGhUZXN0UkUgPSAvXltBLVphLXpfJF1bXHckXSooPzpcLltBLVphLXpfJF1bXHckXSp8XFsnLio/J1xdfFxbIi4qPyJcXXxcW1xkK1xdfFxbW0EtWmEtel8kXVtcdyRdKlxdKSokLzsKICB2YXIgaWRlbnRSRSA9IC9bXlx3JFwuXSg/OltBLVphLXpfJF1bXHckXSopL2c7CiAgdmFyIGxpdGVyYWxWYWx1ZVJFJDEgPSAvXig/OnRydWV8ZmFsc2V8bnVsbHx1bmRlZmluZWR8SW5maW5pdHl8TmFOKSQvOwoKICBmdW5jdGlvbiBub29wKCkge30KICAvKioKICAgKiBTYXZlIC8gUmV3cml0ZSAvIFJlc3RvcmUKICAgKgogICAqIFdoZW4gcmV3cml0aW5nIHBhdGhzIGZvdW5kIGluIGFuIGV4cHJlc3Npb24sIGl0IGlzCiAgICogcG9zc2libGUgZm9yIHRoZSBzYW1lIGxldHRlciBzZXF1ZW5jZXMgdG8gYmUgZm91bmQgaW4KICAgKiBzdHJpbmdzIGFuZCBPYmplY3QgbGl0ZXJhbCBwcm9wZXJ0eSBrZXlzLiBUaGVyZWZvcmUgd2UKICAgKiByZW1vdmUgYW5kIHN0b3JlIHRoZXNlIHBhcnRzIGluIGEgdGVtcG9yYXJ5IGFycmF5LCBhbmQKICAgKiByZXN0b3JlIHRoZW0gYWZ0ZXIgdGhlIHBhdGggcmV3cml0ZS4KICAgKi8KCgogIHZhciBzYXZlZCA9IFtdOwogIC8qKgogICAqIFNhdmUgcmVwbGFjZXIKICAgKgogICAqIFRoZSBzYXZlIHJlZ2V4IGNhbiBtYXRjaCB0d28gcG9zc2libGUgY2FzZXM6CiAgICogMS4gQW4gb3BlbmluZyBvYmplY3QgbGl0ZXJhbAogICAqIDIuIEEgc3RyaW5nCiAgICogSWYgbWF0Y2hlZCBhcyBhIHBsYWluIHN0cmluZywgd2UgbmVlZCB0byBlc2NhcGUgaXRzCiAgICogbmV3bGluZXMsIHNpbmNlIHRoZSBzdHJpbmcgbmVlZHMgdG8gYmUgcHJlc2VydmVkIHdoZW4KICAgKiBnZW5lcmF0aW5nIHRoZSBmdW5jdGlvbiBib2R5LgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cgogICAqIEBwYXJhbSB7U3RyaW5nfSBpc1N0cmluZyAtIHN0ciBpZiBtYXRjaGVkIGFzIGEgc3RyaW5nCiAgICogQHJldHVybiB7U3RyaW5nfSAtIHBsYWNlaG9sZGVyIHdpdGggaW5kZXgKICAgKi8KCiAgZnVuY3Rpb24gc2F2ZShzdHIsIGlzU3RyaW5nKSB7CiAgICB2YXIgaSA9IHNhdmVkLmxlbmd0aDsKICAgIHNhdmVkW2ldID0gaXNTdHJpbmcgPyBzdHIucmVwbGFjZShuZXdsaW5lUkUsICdcXG4nKSA6IHN0cjsKICAgIHJldHVybiAnIicgKyBpICsgJyInOwogIH0KICAvKioKICAgKiBQYXRoIHJld3JpdGUgcmVwbGFjZXIKICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSByYXcKICAgKiBAcmV0dXJuIHtTdHJpbmd9CiAgICovCgoKICBmdW5jdGlvbiByZXdyaXRlKHJhdykgewogICAgdmFyIGMgPSByYXcuY2hhckF0KDApOwogICAgdmFyIHBhdGggPSByYXcuc2xpY2UoMSk7CgogICAgaWYgKGFsbG93ZWRLZXl3b3Jkc1JFLnRlc3QocGF0aCkpIHsKICAgICAgcmV0dXJuIHJhdzsKICAgIH0gZWxzZSB7CiAgICAgIHBhdGggPSBwYXRoLmluZGV4T2YoJyInKSA+IC0xID8gcGF0aC5yZXBsYWNlKHJlc3RvcmVSRSwgcmVzdG9yZSkgOiBwYXRoOwogICAgICByZXR1cm4gYyArICdzY29wZS4nICsgcGF0aDsKICAgIH0KICB9CiAgLyoqCiAgICogUmVzdG9yZSByZXBsYWNlcgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cgogICAqIEBwYXJhbSB7U3RyaW5nfSBpIC0gbWF0Y2hlZCBzYXZlIGluZGV4CiAgICogQHJldHVybiB7U3RyaW5nfQogICAqLwoKCiAgZnVuY3Rpb24gcmVzdG9yZShzdHIsIGkpIHsKICAgIHJldHVybiBzYXZlZFtpXTsKICB9CiAgLyoqCiAgICogUmV3cml0ZSBhbiBleHByZXNzaW9uLCBwcmVmaXhpbmcgYWxsIHBhdGggYWNjZXNzb3JzIHdpdGgKICAgKiBgc2NvcGUuYCBhbmQgZ2VuZXJhdGUgZ2V0dGVyL3NldHRlciBmdW5jdGlvbnMuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gZXhwCiAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICovCgoKICBmdW5jdGlvbiBjb21waWxlR2V0dGVyKGV4cCkgewogICAgaWYgKGltcHJvcGVyS2V5d29yZHNSRS50ZXN0KGV4cCkpIHsKICAgICAgJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oJ0F2b2lkIHVzaW5nIHJlc2VydmVkIGtleXdvcmRzIGluIGV4cHJlc3Npb246ICcgKyBleHApOwogICAgfSAvLyByZXNldCBzdGF0ZQoKCiAgICBzYXZlZC5sZW5ndGggPSAwOyAvLyBzYXZlIHN0cmluZ3MgYW5kIG9iamVjdCBsaXRlcmFsIGtleXMKCiAgICB2YXIgYm9keSA9IGV4cC5yZXBsYWNlKHNhdmVSRSwgc2F2ZSkucmVwbGFjZSh3c1JFLCAnJyk7IC8vIHJld3JpdGUgYWxsIHBhdGhzCiAgICAvLyBwYWQgMSBzcGFjZSBoZXJlIGJlY2F1c2UgdGhlIHJlZ2V4IG1hdGNoZXMgMSBleHRyYSBjaGFyCgogICAgYm9keSA9ICgnICcgKyBib2R5KS5yZXBsYWNlKGlkZW50UkUsIHJld3JpdGUpLnJlcGxhY2UocmVzdG9yZVJFLCByZXN0b3JlKTsKICAgIHJldHVybiBtYWtlR2V0dGVyRm4oYm9keSk7CiAgfQogIC8qKgogICAqIEJ1aWxkIGEgZ2V0dGVyIGZ1bmN0aW9uLiBSZXF1aXJlcyBldmFsLgogICAqCiAgICogV2UgaXNvbGF0ZSB0aGUgdHJ5L2NhdGNoIHNvIGl0IGRvZXNuJ3QgYWZmZWN0IHRoZQogICAqIG9wdGltaXphdGlvbiBvZiB0aGUgcGFyc2UgZnVuY3Rpb24gd2hlbiBpdCBpcyBub3QgY2FsbGVkLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGJvZHkKICAgKiBAcmV0dXJuIHtGdW5jdGlvbnx1bmRlZmluZWR9CiAgICovCgoKICBmdW5jdGlvbiBtYWtlR2V0dGVyRm4oYm9keSkgewogICAgdHJ5IHsKICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tbmV3LWZ1bmMgKi8KICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbignc2NvcGUnLCAncmV0dXJuICcgKyBib2R5ICsgJzsnKTsKICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1uZXctZnVuYyAqLwogICAgfSBjYXRjaCAoZSkgewogICAgICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgaWYgKGUudG9TdHJpbmcoKS5tYXRjaCgvdW5zYWZlLWV2YWx8Q1NQLykpIHsKICAgICAgICAgIHdhcm4oJ0l0IHNlZW1zIHlvdSBhcmUgdXNpbmcgdGhlIGRlZmF1bHQgYnVpbGQgb2YgVnVlLmpzIGluIGFuIGVudmlyb25tZW50ICcgKyAnd2l0aCBDb250ZW50IFNlY3VyaXR5IFBvbGljeSB0aGF0IHByb2hpYml0cyB1bnNhZmUtZXZhbC4gJyArICdVc2UgdGhlIENTUC1jb21wbGlhbnQgYnVpbGQgaW5zdGVhZDogJyArICdodHRwOi8vdnVlanMub3JnL2d1aWRlL2luc3RhbGxhdGlvbi5odG1sI0NTUC1jb21wbGlhbnQtYnVpbGQnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2FybignSW52YWxpZCBleHByZXNzaW9uLiAnICsgJ0dlbmVyYXRlZCBmdW5jdGlvbiBib2R5OiAnICsgYm9keSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbm9vcDsKICAgIH0KICB9CiAgLyoqCiAgICogQ29tcGlsZSBhIHNldHRlciBmdW5jdGlvbiBmb3IgdGhlIGV4cHJlc3Npb24uCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gZXhwCiAgICogQHJldHVybiB7RnVuY3Rpb258dW5kZWZpbmVkfQogICAqLwoKCiAgZnVuY3Rpb24gY29tcGlsZVNldHRlcihleHApIHsKICAgIHZhciBwYXRoID0gcGFyc2VQYXRoKGV4cCk7CgogICAgaWYgKHBhdGgpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzY29wZSwgdmFsKSB7CiAgICAgICAgc2V0UGF0aChzY29wZSwgcGF0aCwgdmFsKTsKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdJbnZhbGlkIHNldHRlciBleHByZXNzaW9uOiAnICsgZXhwKTsKICAgIH0KICB9CiAgLyoqCiAgICogUGFyc2UgYW4gZXhwcmVzc2lvbiBpbnRvIHJlLXdyaXR0ZW4gZ2V0dGVyL3NldHRlcnMuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gZXhwCiAgICogQHBhcmFtIHtCb29sZWFufSBuZWVkU2V0CiAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICovCgoKICBmdW5jdGlvbiBwYXJzZUV4cHJlc3Npb24oZXhwLCBuZWVkU2V0KSB7CiAgICBleHAgPSBleHAudHJpbSgpOyAvLyB0cnkgY2FjaGUKCiAgICB2YXIgaGl0ID0gZXhwcmVzc2lvbkNhY2hlLmdldChleHApOwoKICAgIGlmIChoaXQpIHsKICAgICAgaWYgKG5lZWRTZXQgJiYgIWhpdC5zZXQpIHsKICAgICAgICBoaXQuc2V0ID0gY29tcGlsZVNldHRlcihoaXQuZXhwKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGhpdDsKICAgIH0KCiAgICB2YXIgcmVzID0gewogICAgICBleHA6IGV4cAogICAgfTsKICAgIHJlcy5nZXQgPSBpc1NpbXBsZVBhdGgoZXhwKSAmJiBleHAuaW5kZXhPZignWycpIDwgMCAvLyBvcHRpbWl6ZWQgc3VwZXIgc2ltcGxlIGdldHRlcgogICAgPyBtYWtlR2V0dGVyRm4oJ3Njb3BlLicgKyBleHApIC8vIGR5bmFtaWMgZ2V0dGVyCiAgICA6IGNvbXBpbGVHZXR0ZXIoZXhwKTsKCiAgICBpZiAobmVlZFNldCkgewogICAgICByZXMuc2V0ID0gY29tcGlsZVNldHRlcihleHApOwogICAgfQoKICAgIGV4cHJlc3Npb25DYWNoZS5wdXQoZXhwLCByZXMpOwogICAgcmV0dXJuIHJlczsKICB9CiAgLyoqCiAgICogQ2hlY2sgaWYgYW4gZXhwcmVzc2lvbiBpcyBhIHNpbXBsZSBwYXRoLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGV4cAogICAqIEByZXR1cm4ge0Jvb2xlYW59CiAgICovCgoKICBmdW5jdGlvbiBpc1NpbXBsZVBhdGgoZXhwKSB7CiAgICByZXR1cm4gcGF0aFRlc3RSRS50ZXN0KGV4cCkgJiYgLy8gZG9uJ3QgdHJlYXQgbGl0ZXJhbCB2YWx1ZXMgYXMgcGF0aHMKICAgICFsaXRlcmFsVmFsdWVSRSQxLnRlc3QoZXhwKSAmJiAvLyBNYXRoIGNvbnN0YW50cyBlLmcuIE1hdGguUEksIE1hdGguRSBldGMuCiAgICBleHAuc2xpY2UoMCwgNSkgIT09ICdNYXRoLic7CiAgfQoKICB2YXIgZXhwcmVzc2lvbiA9IE9iamVjdC5mcmVlemUoewogICAgcGFyc2VFeHByZXNzaW9uOiBwYXJzZUV4cHJlc3Npb24sCiAgICBpc1NpbXBsZVBhdGg6IGlzU2ltcGxlUGF0aAogIH0pOyAvLyB3ZSBoYXZlIHR3byBzZXBhcmF0ZSBxdWV1ZXM6IG9uZSBmb3IgZGlyZWN0aXZlIHVwZGF0ZXMKICAvLyBhbmQgb25lIGZvciB1c2VyIHdhdGNoZXIgcmVnaXN0ZXJlZCB2aWEgJHdhdGNoKCkuCiAgLy8gd2Ugd2FudCB0byBndWFyYW50ZWUgZGlyZWN0aXZlIHVwZGF0ZXMgdG8gYmUgY2FsbGVkCiAgLy8gYmVmb3JlIHVzZXIgd2F0Y2hlcnMgc28gdGhhdCB3aGVuIHVzZXIgd2F0Y2hlcnMgYXJlCiAgLy8gdHJpZ2dlcmVkLCB0aGUgRE9NIHdvdWxkIGhhdmUgYWxyZWFkeSBiZWVuIGluIHVwZGF0ZWQKICAvLyBzdGF0ZS4KCiAgdmFyIHF1ZXVlID0gW107CiAgdmFyIHVzZXJRdWV1ZSA9IFtdOwogIHZhciBoYXMgPSB7fTsKICB2YXIgY2lyY3VsYXIgPSB7fTsKICB2YXIgd2FpdGluZyA9IGZhbHNlOwogIC8qKgogICAqIFJlc2V0IHRoZSBiYXRjaGVyJ3Mgc3RhdGUuCiAgICovCgogIGZ1bmN0aW9uIHJlc2V0QmF0Y2hlclN0YXRlKCkgewogICAgcXVldWUubGVuZ3RoID0gMDsKICAgIHVzZXJRdWV1ZS5sZW5ndGggPSAwOwogICAgaGFzID0ge307CiAgICBjaXJjdWxhciA9IHt9OwogICAgd2FpdGluZyA9IGZhbHNlOwogIH0KICAvKioKICAgKiBGbHVzaCBib3RoIHF1ZXVlcyBhbmQgcnVuIHRoZSB3YXRjaGVycy4KICAgKi8KCgogIGZ1bmN0aW9uIGZsdXNoQmF0Y2hlclF1ZXVlKCkgewogICAgdmFyIF9hZ2FpbiA9IHRydWU7CgogICAgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7CiAgICAgIF9hZ2FpbiA9IGZhbHNlOwogICAgICBydW5CYXRjaGVyUXVldWUocXVldWUpOwogICAgICBydW5CYXRjaGVyUXVldWUodXNlclF1ZXVlKTsgLy8gdXNlciB3YXRjaGVycyB0cmlnZ2VyZWQgbW9yZSB3YXRjaGVycywKICAgICAgLy8ga2VlcCBmbHVzaGluZyB1bnRpbCBpdCBkZXBsZXRlcwoKICAgICAgaWYgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgIF9hZ2FpbiA9IHRydWU7CiAgICAgICAgY29udGludWUgX2Z1bmN0aW9uOwogICAgICB9IC8vIGRldiB0b29sIGhvb2sKCiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICAgIGlmIChkZXZ0b29scyAmJiBjb25maWcuZGV2dG9vbHMpIHsKICAgICAgICBkZXZ0b29scy5lbWl0KCdmbHVzaCcpOwogICAgICB9CgogICAgICByZXNldEJhdGNoZXJTdGF0ZSgpOwogICAgfQogIH0KICAvKioKICAgKiBSdW4gdGhlIHdhdGNoZXJzIGluIGEgc2luZ2xlIHF1ZXVlLgogICAqCiAgICogQHBhcmFtIHtBcnJheX0gcXVldWUKICAgKi8KCgogIGZ1bmN0aW9uIHJ1bkJhdGNoZXJRdWV1ZShxdWV1ZSkgewogICAgLy8gZG8gbm90IGNhY2hlIGxlbmd0aCBiZWNhdXNlIG1vcmUgd2F0Y2hlcnMgbWlnaHQgYmUgcHVzaGVkCiAgICAvLyBhcyB3ZSBydW4gZXhpc3Rpbmcgd2F0Y2hlcnMKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHdhdGNoZXIgPSBxdWV1ZVtpXTsKICAgICAgdmFyIGlkID0gd2F0Y2hlci5pZDsKICAgICAgaGFzW2lkXSA9IG51bGw7CiAgICAgIHdhdGNoZXIucnVuKCk7IC8vIGluIGRldiBidWlsZCwgY2hlY2sgYW5kIHN0b3AgY2lyY3VsYXIgdXBkYXRlcy4KCiAgICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgaGFzW2lkXSAhPSBudWxsKSB7CiAgICAgICAgY2lyY3VsYXJbaWRdID0gKGNpcmN1bGFyW2lkXSB8fCAwKSArIDE7CgogICAgICAgIGlmIChjaXJjdWxhcltpZF0gPiBjb25maWcuX21heFVwZGF0ZUNvdW50KSB7CiAgICAgICAgICB3YXJuKCdZb3UgbWF5IGhhdmUgYW4gaW5maW5pdGUgdXBkYXRlIGxvb3AgZm9yIHdhdGNoZXIgJyArICd3aXRoIGV4cHJlc3Npb24gIicgKyB3YXRjaGVyLmV4cHJlc3Npb24gKyAnIicsIHdhdGNoZXIudm0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcXVldWUubGVuZ3RoID0gMDsKICB9CiAgLyoqCiAgICogUHVzaCBhIHdhdGNoZXIgaW50byB0aGUgd2F0Y2hlciBxdWV1ZS4KICAgKiBKb2JzIHdpdGggZHVwbGljYXRlIElEcyB3aWxsIGJlIHNraXBwZWQgdW5sZXNzIGl0J3MKICAgKiBwdXNoZWQgd2hlbiB0aGUgcXVldWUgaXMgYmVpbmcgZmx1c2hlZC4KICAgKgogICAqIEBwYXJhbSB7V2F0Y2hlcn0gd2F0Y2hlcgogICAqICAgcHJvcGVydGllczoKICAgKiAgIC0ge051bWJlcn0gaWQKICAgKiAgIC0ge0Z1bmN0aW9ufSBydW4KICAgKi8KCgogIGZ1bmN0aW9uIHB1c2hXYXRjaGVyKHdhdGNoZXIpIHsKICAgIHZhciBpZCA9IHdhdGNoZXIuaWQ7CgogICAgaWYgKGhhc1tpZF0gPT0gbnVsbCkgewogICAgICAvLyBwdXNoIHdhdGNoZXIgaW50byBhcHByb3ByaWF0ZSBxdWV1ZQogICAgICB2YXIgcSA9IHdhdGNoZXIudXNlciA/IHVzZXJRdWV1ZSA6IHF1ZXVlOwogICAgICBoYXNbaWRdID0gcS5sZW5ndGg7CiAgICAgIHEucHVzaCh3YXRjaGVyKTsgLy8gcXVldWUgdGhlIGZsdXNoCgogICAgICBpZiAoIXdhaXRpbmcpIHsKICAgICAgICB3YWl0aW5nID0gdHJ1ZTsKICAgICAgICBuZXh0VGljayhmbHVzaEJhdGNoZXJRdWV1ZSk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciB1aWQkMiA9IDA7CiAgLyoqCiAgICogQSB3YXRjaGVyIHBhcnNlcyBhbiBleHByZXNzaW9uLCBjb2xsZWN0cyBkZXBlbmRlbmNpZXMsCiAgICogYW5kIGZpcmVzIGNhbGxiYWNrIHdoZW4gdGhlIGV4cHJlc3Npb24gdmFsdWUgY2hhbmdlcy4KICAgKiBUaGlzIGlzIHVzZWQgZm9yIGJvdGggdGhlICR3YXRjaCgpIGFwaSBhbmQgZGlyZWN0aXZlcy4KICAgKgogICAqIEBwYXJhbSB7VnVlfSB2bQogICAqIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBleHBPckZuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2IKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqICAgICAgICAgICAgICAgICAtIHtBcnJheX0gZmlsdGVycwogICAqICAgICAgICAgICAgICAgICAtIHtCb29sZWFufSB0d29XYXkKICAgKiAgICAgICAgICAgICAgICAgLSB7Qm9vbGVhbn0gZGVlcAogICAqICAgICAgICAgICAgICAgICAtIHtCb29sZWFufSB1c2VyCiAgICogICAgICAgICAgICAgICAgIC0ge0Jvb2xlYW59IHN5bmMKICAgKiAgICAgICAgICAgICAgICAgLSB7Qm9vbGVhbn0gbGF6eQogICAqICAgICAgICAgICAgICAgICAtIHtGdW5jdGlvbn0gW3ByZVByb2Nlc3NdCiAgICogICAgICAgICAgICAgICAgIC0ge0Z1bmN0aW9ufSBbcG9zdFByb2Nlc3NdCiAgICogQGNvbnN0cnVjdG9yCiAgICovCgogIGZ1bmN0aW9uIFdhdGNoZXIodm0sIGV4cE9yRm4sIGNiLCBvcHRpb25zKSB7CiAgICAvLyBtaXggaW4gb3B0aW9ucwogICAgaWYgKG9wdGlvbnMpIHsKICAgICAgZXh0ZW5kKHRoaXMsIG9wdGlvbnMpOwogICAgfQoKICAgIHZhciBpc0ZuID0gdHlwZW9mIGV4cE9yRm4gPT09ICdmdW5jdGlvbic7CiAgICB0aGlzLnZtID0gdm07CgogICAgdm0uX3dhdGNoZXJzLnB1c2godGhpcyk7CgogICAgdGhpcy5leHByZXNzaW9uID0gZXhwT3JGbjsKICAgIHRoaXMuY2IgPSBjYjsKICAgIHRoaXMuaWQgPSArK3VpZCQyOyAvLyB1aWQgZm9yIGJhdGNoaW5nCgogICAgdGhpcy5hY3RpdmUgPSB0cnVlOwogICAgdGhpcy5kaXJ0eSA9IHRoaXMubGF6eTsgLy8gZm9yIGxhenkgd2F0Y2hlcnMKCiAgICB0aGlzLmRlcHMgPSBbXTsKICAgIHRoaXMubmV3RGVwcyA9IFtdOwogICAgdGhpcy5kZXBJZHMgPSBuZXcgX1NldCgpOwogICAgdGhpcy5uZXdEZXBJZHMgPSBuZXcgX1NldCgpOwogICAgdGhpcy5wcmV2RXJyb3IgPSBudWxsOyAvLyBmb3IgYXN5bmMgZXJyb3Igc3RhY2tzCiAgICAvLyBwYXJzZSBleHByZXNzaW9uIGZvciBnZXR0ZXIvc2V0dGVyCgogICAgaWYgKGlzRm4pIHsKICAgICAgdGhpcy5nZXR0ZXIgPSBleHBPckZuOwogICAgICB0aGlzLnNldHRlciA9IHVuZGVmaW5lZDsKICAgIH0gZWxzZSB7CiAgICAgIHZhciByZXMgPSBwYXJzZUV4cHJlc3Npb24oZXhwT3JGbiwgdGhpcy50d29XYXkpOwogICAgICB0aGlzLmdldHRlciA9IHJlcy5nZXQ7CiAgICAgIHRoaXMuc2V0dGVyID0gcmVzLnNldDsKICAgIH0KCiAgICB0aGlzLnZhbHVlID0gdGhpcy5sYXp5ID8gdW5kZWZpbmVkIDogdGhpcy5nZXQoKTsgLy8gc3RhdGUgZm9yIGF2b2lkaW5nIGZhbHNlIHRyaWdnZXJzIGZvciBkZWVwIGFuZCBBcnJheQogICAgLy8gd2F0Y2hlcnMgZHVyaW5nIHZtLl9kaWdlc3QoKQoKICAgIHRoaXMucXVldWVkID0gdGhpcy5zaGFsbG93ID0gZmFsc2U7CiAgfQogIC8qKgogICAqIEV2YWx1YXRlIHRoZSBnZXR0ZXIsIGFuZCByZS1jb2xsZWN0IGRlcGVuZGVuY2llcy4KICAgKi8KCgogIFdhdGNoZXIucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuYmVmb3JlR2V0KCk7CiAgICB2YXIgc2NvcGUgPSB0aGlzLnNjb3BlIHx8IHRoaXMudm07CiAgICB2YXIgdmFsdWU7CgogICAgdHJ5IHsKICAgICAgdmFsdWUgPSB0aGlzLmdldHRlci5jYWxsKHNjb3BlLCBzY29wZSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgY29uZmlnLndhcm5FeHByZXNzaW9uRXJyb3JzKSB7CiAgICAgICAgd2FybignRXJyb3Igd2hlbiBldmFsdWF0aW5nIGV4cHJlc3Npb24gJyArICciJyArIHRoaXMuZXhwcmVzc2lvbiArICciOiAnICsgZS50b1N0cmluZygpLCB0aGlzLnZtKTsKICAgICAgfQogICAgfSAvLyAidG91Y2giIGV2ZXJ5IHByb3BlcnR5IHNvIHRoZXkgYXJlIGFsbCB0cmFja2VkIGFzCiAgICAvLyBkZXBlbmRlbmNpZXMgZm9yIGRlZXAgd2F0Y2hpbmcKCgogICAgaWYgKHRoaXMuZGVlcCkgewogICAgICB0cmF2ZXJzZSh2YWx1ZSk7CiAgICB9CgogICAgaWYgKHRoaXMucHJlUHJvY2VzcykgewogICAgICB2YWx1ZSA9IHRoaXMucHJlUHJvY2Vzcyh2YWx1ZSk7CiAgICB9CgogICAgaWYgKHRoaXMuZmlsdGVycykgewogICAgICB2YWx1ZSA9IHNjb3BlLl9hcHBseUZpbHRlcnModmFsdWUsIG51bGwsIHRoaXMuZmlsdGVycywgZmFsc2UpOwogICAgfQoKICAgIGlmICh0aGlzLnBvc3RQcm9jZXNzKSB7CiAgICAgIHZhbHVlID0gdGhpcy5wb3N0UHJvY2Vzcyh2YWx1ZSk7CiAgICB9CgogICAgdGhpcy5hZnRlckdldCgpOwogICAgcmV0dXJuIHZhbHVlOwogIH07CiAgLyoqCiAgICogU2V0IHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlIHdpdGggdGhlIHNldHRlci4KICAgKgogICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgKi8KCgogIFdhdGNoZXIucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgdmFyIHNjb3BlID0gdGhpcy5zY29wZSB8fCB0aGlzLnZtOwoKICAgIGlmICh0aGlzLmZpbHRlcnMpIHsKICAgICAgdmFsdWUgPSBzY29wZS5fYXBwbHlGaWx0ZXJzKHZhbHVlLCB0aGlzLnZhbHVlLCB0aGlzLmZpbHRlcnMsIHRydWUpOwogICAgfQoKICAgIHRyeSB7CiAgICAgIHRoaXMuc2V0dGVyLmNhbGwoc2NvcGUsIHNjb3BlLCB2YWx1ZSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgY29uZmlnLndhcm5FeHByZXNzaW9uRXJyb3JzKSB7CiAgICAgICAgd2FybignRXJyb3Igd2hlbiBldmFsdWF0aW5nIHNldHRlciAnICsgJyInICsgdGhpcy5leHByZXNzaW9uICsgJyI6ICcgKyBlLnRvU3RyaW5nKCksIHRoaXMudm0pOwogICAgICB9CiAgICB9IC8vIHR3by13YXkgc3luYyBmb3Igdi1mb3IgYWxpYXMKCgogICAgdmFyIGZvckNvbnRleHQgPSBzY29wZS4kZm9yQ29udGV4dDsKCiAgICBpZiAoZm9yQ29udGV4dCAmJiBmb3JDb250ZXh0LmFsaWFzID09PSB0aGlzLmV4cHJlc3Npb24pIHsKICAgICAgaWYgKGZvckNvbnRleHQuZmlsdGVycykgewogICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdJdCBzZWVtcyB5b3UgYXJlIHVzaW5nIHR3by13YXkgYmluZGluZyBvbiAnICsgJ2Egdi1mb3IgYWxpYXMgKCcgKyB0aGlzLmV4cHJlc3Npb24gKyAnKSwgYW5kIHRoZSAnICsgJ3YtZm9yIGhhcyBmaWx0ZXJzLiBUaGlzIHdpbGwgbm90IHdvcmsgcHJvcGVybHkuICcgKyAnRWl0aGVyIHJlbW92ZSB0aGUgZmlsdGVycyBvciB1c2UgYW4gYXJyYXkgb2YgJyArICdvYmplY3RzIGFuZCBiaW5kIHRvIG9iamVjdCBwcm9wZXJ0aWVzIGluc3RlYWQuJywgdGhpcy52bSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3JDb250ZXh0Ll93aXRoTG9jayhmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHNjb3BlLiRrZXkpIHsKICAgICAgICAgIC8vIG9yaWdpbmFsIGlzIGFuIG9iamVjdAogICAgICAgICAgZm9yQ29udGV4dC5yYXdWYWx1ZVtzY29wZS4ka2V5XSA9IHZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3JDb250ZXh0LnJhd1ZhbHVlLiRzZXQoc2NvcGUuJGluZGV4LCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9OwogIC8qKgogICAqIFByZXBhcmUgZm9yIGRlcGVuZGVuY3kgY29sbGVjdGlvbi4KICAgKi8KCgogIFdhdGNoZXIucHJvdG90eXBlLmJlZm9yZUdldCA9IGZ1bmN0aW9uICgpIHsKICAgIERlcC50YXJnZXQgPSB0aGlzOwogIH07CiAgLyoqCiAgICogQWRkIGEgZGVwZW5kZW5jeSB0byB0aGlzIGRpcmVjdGl2ZS4KICAgKgogICAqIEBwYXJhbSB7RGVwfSBkZXAKICAgKi8KCgogIFdhdGNoZXIucHJvdG90eXBlLmFkZERlcCA9IGZ1bmN0aW9uIChkZXApIHsKICAgIHZhciBpZCA9IGRlcC5pZDsKCiAgICBpZiAoIXRoaXMubmV3RGVwSWRzLmhhcyhpZCkpIHsKICAgICAgdGhpcy5uZXdEZXBJZHMuYWRkKGlkKTsKICAgICAgdGhpcy5uZXdEZXBzLnB1c2goZGVwKTsKCiAgICAgIGlmICghdGhpcy5kZXBJZHMuaGFzKGlkKSkgewogICAgICAgIGRlcC5hZGRTdWIodGhpcyk7CiAgICAgIH0KICAgIH0KICB9OwogIC8qKgogICAqIENsZWFuIHVwIGZvciBkZXBlbmRlbmN5IGNvbGxlY3Rpb24uCiAgICovCgoKICBXYXRjaGVyLnByb3RvdHlwZS5hZnRlckdldCA9IGZ1bmN0aW9uICgpIHsKICAgIERlcC50YXJnZXQgPSBudWxsOwogICAgdmFyIGkgPSB0aGlzLmRlcHMubGVuZ3RoOwoKICAgIHdoaWxlIChpLS0pIHsKICAgICAgdmFyIGRlcCA9IHRoaXMuZGVwc1tpXTsKCiAgICAgIGlmICghdGhpcy5uZXdEZXBJZHMuaGFzKGRlcC5pZCkpIHsKICAgICAgICBkZXAucmVtb3ZlU3ViKHRoaXMpOwogICAgICB9CiAgICB9CgogICAgdmFyIHRtcCA9IHRoaXMuZGVwSWRzOwogICAgdGhpcy5kZXBJZHMgPSB0aGlzLm5ld0RlcElkczsKICAgIHRoaXMubmV3RGVwSWRzID0gdG1wOwogICAgdGhpcy5uZXdEZXBJZHMuY2xlYXIoKTsKICAgIHRtcCA9IHRoaXMuZGVwczsKICAgIHRoaXMuZGVwcyA9IHRoaXMubmV3RGVwczsKICAgIHRoaXMubmV3RGVwcyA9IHRtcDsKICAgIHRoaXMubmV3RGVwcy5sZW5ndGggPSAwOwogIH07CiAgLyoqCiAgICogU3Vic2NyaWJlciBpbnRlcmZhY2UuCiAgICogV2lsbCBiZSBjYWxsZWQgd2hlbiBhIGRlcGVuZGVuY3kgY2hhbmdlcy4KICAgKgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gc2hhbGxvdwogICAqLwoKCiAgV2F0Y2hlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKHNoYWxsb3cpIHsKICAgIGlmICh0aGlzLmxhenkpIHsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9IGVsc2UgaWYgKHRoaXMuc3luYyB8fCAhY29uZmlnLmFzeW5jKSB7CiAgICAgIHRoaXMucnVuKCk7CiAgICB9IGVsc2UgewogICAgICAvLyBpZiBxdWV1ZWQsIG9ubHkgb3ZlcndyaXRlIHNoYWxsb3cgd2l0aCBub24tc2hhbGxvdywKICAgICAgLy8gYnV0IG5vdCB0aGUgb3RoZXIgd2F5IGFyb3VuZC4KICAgICAgdGhpcy5zaGFsbG93ID0gdGhpcy5xdWV1ZWQgPyBzaGFsbG93ID8gdGhpcy5zaGFsbG93IDogZmFsc2UgOiAhIXNoYWxsb3c7CiAgICAgIHRoaXMucXVldWVkID0gdHJ1ZTsgLy8gcmVjb3JkIGJlZm9yZS1wdXNoIGVycm9yIHN0YWNrIGluIGRlYnVnIG1vZGUKCiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKICAgICAgaWYgKCdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiBjb25maWcuZGVidWcpIHsKICAgICAgICB0aGlzLnByZXZFcnJvciA9IG5ldyBFcnJvcignW3Z1ZV0gYXN5bmMgc3RhY2sgdHJhY2UnKTsKICAgICAgfQoKICAgICAgcHVzaFdhdGNoZXIodGhpcyk7CiAgICB9CiAgfTsKICAvKioKICAgKiBCYXRjaGVyIGpvYiBpbnRlcmZhY2UuCiAgICogV2lsbCBiZSBjYWxsZWQgYnkgdGhlIGJhdGNoZXIuCiAgICovCgoKICBXYXRjaGVyLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5hY3RpdmUpIHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5nZXQoKTsKCiAgICAgIGlmICh2YWx1ZSAhPT0gdGhpcy52YWx1ZSB8fCAvLyBEZWVwIHdhdGNoZXJzIGFuZCB3YXRjaGVycyBvbiBPYmplY3QvQXJyYXlzIHNob3VsZCBmaXJlIGV2ZW4KICAgICAgLy8gd2hlbiB0aGUgdmFsdWUgaXMgdGhlIHNhbWUsIGJlY2F1c2UgdGhlIHZhbHVlIG1heQogICAgICAvLyBoYXZlIG11dGF0ZWQ7IGJ1dCBvbmx5IGRvIHNvIGlmIHRoaXMgaXMgYQogICAgICAvLyBub24tc2hhbGxvdyB1cGRhdGUgKGNhdXNlZCBieSBhIHZtIGRpZ2VzdCkuCiAgICAgIChpc09iamVjdCh2YWx1ZSkgfHwgdGhpcy5kZWVwKSAmJiAhdGhpcy5zaGFsbG93KSB7CiAgICAgICAgLy8gc2V0IG5ldyB2YWx1ZQogICAgICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMudmFsdWU7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOyAvLyBpbiBkZWJ1ZyArIGFzeW5jIG1vZGUsIHdoZW4gYSB3YXRjaGVyIGNhbGxiYWNrcwogICAgICAgIC8vIHRocm93cywgd2UgYWxzbyB0aHJvdyB0aGUgc2F2ZWQgYmVmb3JlLXB1c2ggZXJyb3IKICAgICAgICAvLyBzbyB0aGUgZnVsbCBjcm9zcy10aWNrIHN0YWNrIHRyYWNlIGlzIGF2YWlsYWJsZS4KCiAgICAgICAgdmFyIHByZXZFcnJvciA9IHRoaXMucHJldkVycm9yOwogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKICAgICAgICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIGNvbmZpZy5kZWJ1ZyAmJiBwcmV2RXJyb3IpIHsKICAgICAgICAgIHRoaXMucHJldkVycm9yID0gbnVsbDsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzLmNiLmNhbGwodGhpcy52bSwgdmFsdWUsIG9sZFZhbHVlKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHRocm93IHByZXZFcnJvcjsKICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuY2IuY2FsbCh0aGlzLnZtLCB2YWx1ZSwgb2xkVmFsdWUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5xdWV1ZWQgPSB0aGlzLnNoYWxsb3cgPSBmYWxzZTsKICAgIH0KICB9OwogIC8qKgogICAqIEV2YWx1YXRlIHRoZSB2YWx1ZSBvZiB0aGUgd2F0Y2hlci4KICAgKiBUaGlzIG9ubHkgZ2V0cyBjYWxsZWQgZm9yIGxhenkgd2F0Y2hlcnMuCiAgICovCgoKICBXYXRjaGVyLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIGF2b2lkIG92ZXJ3cml0aW5nIGFub3RoZXIgd2F0Y2hlciB0aGF0IGlzIGJlaW5nCiAgICAvLyBjb2xsZWN0ZWQuCiAgICB2YXIgY3VycmVudCA9IERlcC50YXJnZXQ7CiAgICB0aGlzLnZhbHVlID0gdGhpcy5nZXQoKTsKICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgIERlcC50YXJnZXQgPSBjdXJyZW50OwogIH07CiAgLyoqCiAgICogRGVwZW5kIG9uIGFsbCBkZXBzIGNvbGxlY3RlZCBieSB0aGlzIHdhdGNoZXIuCiAgICovCgoKICBXYXRjaGVyLnByb3RvdHlwZS5kZXBlbmQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaSA9IHRoaXMuZGVwcy5sZW5ndGg7CgogICAgd2hpbGUgKGktLSkgewogICAgICB0aGlzLmRlcHNbaV0uZGVwZW5kKCk7CiAgICB9CiAgfTsKICAvKioKICAgKiBSZW1vdmUgc2VsZiBmcm9tIGFsbCBkZXBlbmRlbmNpZXMnIHN1YmNyaWJlciBsaXN0LgogICAqLwoKCiAgV2F0Y2hlci5wcm90b3R5cGUudGVhcmRvd24gPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5hY3RpdmUpIHsKICAgICAgLy8gcmVtb3ZlIHNlbGYgZnJvbSB2bSdzIHdhdGNoZXIgbGlzdAogICAgICAvLyB0aGlzIGlzIGEgc29tZXdoYXQgZXhwZW5zaXZlIG9wZXJhdGlvbiBzbyB3ZSBza2lwIGl0CiAgICAgIC8vIGlmIHRoZSB2bSBpcyBiZWluZyBkZXN0cm95ZWQgb3IgaXMgcGVyZm9ybWluZyBhIHYtZm9yCiAgICAgIC8vIHJlLXJlbmRlciAodGhlIHdhdGNoZXIgbGlzdCBpcyB0aGVuIGZpbHRlcmVkIGJ5IHYtZm9yKS4KICAgICAgaWYgKCF0aGlzLnZtLl9pc0JlaW5nRGVzdHJveWVkICYmICF0aGlzLnZtLl92Rm9yUmVtb3ZpbmcpIHsKICAgICAgICB0aGlzLnZtLl93YXRjaGVycy4kcmVtb3ZlKHRoaXMpOwogICAgICB9CgogICAgICB2YXIgaSA9IHRoaXMuZGVwcy5sZW5ndGg7CgogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgdGhpcy5kZXBzW2ldLnJlbW92ZVN1Yih0aGlzKTsKICAgICAgfQoKICAgICAgdGhpcy5hY3RpdmUgPSBmYWxzZTsKICAgICAgdGhpcy52bSA9IHRoaXMuY2IgPSB0aGlzLnZhbHVlID0gbnVsbDsKICAgIH0KICB9OwogIC8qKgogICAqIFJlY3J1c2l2ZWx5IHRyYXZlcnNlIGFuIG9iamVjdCB0byBldm9rZSBhbGwgY29udmVydGVkCiAgICogZ2V0dGVycywgc28gdGhhdCBldmVyeSBuZXN0ZWQgcHJvcGVydHkgaW5zaWRlIHRoZSBvYmplY3QKICAgKiBpcyBjb2xsZWN0ZWQgYXMgYSAiZGVlcCIgZGVwZW5kZW5jeS4KICAgKgogICAqIEBwYXJhbSB7Kn0gdmFsCiAgICovCgoKICB2YXIgc2Vlbk9iamVjdHMgPSBuZXcgX1NldCgpOwoKICBmdW5jdGlvbiB0cmF2ZXJzZSh2YWwsIHNlZW4pIHsKICAgIHZhciBpID0gdW5kZWZpbmVkLAogICAgICAgIGtleXMgPSB1bmRlZmluZWQ7CgogICAgaWYgKCFzZWVuKSB7CiAgICAgIHNlZW4gPSBzZWVuT2JqZWN0czsKICAgICAgc2Vlbi5jbGVhcigpOwogICAgfQoKICAgIHZhciBpc0EgPSBpc0FycmF5KHZhbCk7CiAgICB2YXIgaXNPID0gaXNPYmplY3QodmFsKTsKCiAgICBpZiAoKGlzQSB8fCBpc08pICYmIE9iamVjdC5pc0V4dGVuc2libGUodmFsKSkgewogICAgICBpZiAodmFsLl9fb2JfXykgewogICAgICAgIHZhciBkZXBJZCA9IHZhbC5fX29iX18uZGVwLmlkOwoKICAgICAgICBpZiAoc2Vlbi5oYXMoZGVwSWQpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlZW4uYWRkKGRlcElkKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChpc0EpIHsKICAgICAgICBpID0gdmFsLmxlbmd0aDsKCiAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgdHJhdmVyc2UodmFsW2ldLCBzZWVuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoaXNPKSB7CiAgICAgICAga2V5cyA9IE9iamVjdC5rZXlzKHZhbCk7CiAgICAgICAgaSA9IGtleXMubGVuZ3RoOwoKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICB0cmF2ZXJzZSh2YWxba2V5c1tpXV0sIHNlZW4pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgdmFyIHRleHQkMSA9IHsKICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQoKSB7CiAgICAgIHRoaXMuYXR0ciA9IHRoaXMuZWwubm9kZVR5cGUgPT09IDMgPyAnZGF0YScgOiAndGV4dENvbnRlbnQnOwogICAgfSwKICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHZhbHVlKSB7CiAgICAgIHRoaXMuZWxbdGhpcy5hdHRyXSA9IF90b1N0cmluZyh2YWx1ZSk7CiAgICB9CiAgfTsKICB2YXIgdGVtcGxhdGVDYWNoZSA9IG5ldyBDYWNoZSgxMDAwKTsKICB2YXIgaWRTZWxlY3RvckNhY2hlID0gbmV3IENhY2hlKDEwMDApOwogIHZhciBtYXAgPSB7CiAgICBlZmF1bHQ6IFswLCAnJywgJyddLAogICAgbGVnZW5kOiBbMSwgJzxmaWVsZHNldD4nLCAnPC9maWVsZHNldD4nXSwKICAgIHRyOiBbMiwgJzx0YWJsZT48dGJvZHk+JywgJzwvdGJvZHk+PC90YWJsZT4nXSwKICAgIGNvbDogWzIsICc8dGFibGU+PHRib2R5PjwvdGJvZHk+PGNvbGdyb3VwPicsICc8L2NvbGdyb3VwPjwvdGFibGU+J10KICB9OwogIG1hcC50ZCA9IG1hcC50aCA9IFszLCAnPHRhYmxlPjx0Ym9keT48dHI+JywgJzwvdHI+PC90Ym9keT48L3RhYmxlPiddOwogIG1hcC5vcHRpb24gPSBtYXAub3B0Z3JvdXAgPSBbMSwgJzxzZWxlY3QgbXVsdGlwbGU9Im11bHRpcGxlIj4nLCAnPC9zZWxlY3Q+J107CiAgbWFwLnRoZWFkID0gbWFwLnRib2R5ID0gbWFwLmNvbGdyb3VwID0gbWFwLmNhcHRpb24gPSBtYXAudGZvb3QgPSBbMSwgJzx0YWJsZT4nLCAnPC90YWJsZT4nXTsKICBtYXAuZyA9IG1hcC5kZWZzID0gbWFwLnN5bWJvbCA9IG1hcC51c2UgPSBtYXAuaW1hZ2UgPSBtYXAudGV4dCA9IG1hcC5jaXJjbGUgPSBtYXAuZWxsaXBzZSA9IG1hcC5saW5lID0gbWFwLnBhdGggPSBtYXAucG9seWdvbiA9IG1hcC5wb2x5bGluZSA9IG1hcC5yZWN0ID0gWzEsICc8c3ZnICcgKyAneG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAnICsgJ3htbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiAnICsgJ3htbG5zOmV2PSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL3htbC1ldmVudHMiJyArICd2ZXJzaW9uPSIxLjEiPicsICc8L3N2Zz4nXTsKICAvKioKICAgKiBDaGVjayBpZiBhIG5vZGUgaXMgYSBzdXBwb3J0ZWQgdGVtcGxhdGUgbm9kZSB3aXRoIGEKICAgKiBEb2N1bWVudEZyYWdtZW50IGNvbnRlbnQuCiAgICoKICAgKiBAcGFyYW0ge05vZGV9IG5vZGUKICAgKiBAcmV0dXJuIHtCb29sZWFufQogICAqLwoKICBmdW5jdGlvbiBpc1JlYWxUZW1wbGF0ZShub2RlKSB7CiAgICByZXR1cm4gaXNUZW1wbGF0ZShub2RlKSAmJiBpc0ZyYWdtZW50KG5vZGUuY29udGVudCk7CiAgfQoKICB2YXIgdGFnUkUkMSA9IC88KFtcdzotXSspLzsKICB2YXIgZW50aXR5UkUgPSAvJiM/XHcrPzsvOwogIHZhciBjb21tZW50UkUgPSAvPCEtLS87CiAgLyoqCiAgICogQ29udmVydCBhIHN0cmluZyB0ZW1wbGF0ZSB0byBhIERvY3VtZW50RnJhZ21lbnQuCiAgICogRGV0ZXJtaW5lcyBjb3JyZWN0IHdyYXBwaW5nIGJ5IHRhZyB0eXBlcy4gV3JhcHBpbmcKICAgKiBzdHJhdGVneSBmb3VuZCBpbiBqUXVlcnkgJiBjb21wb25lbnQvZG9taWZ5LgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHRlbXBsYXRlU3RyaW5nCiAgICogQHBhcmFtIHtCb29sZWFufSByYXcKICAgKiBAcmV0dXJuIHtEb2N1bWVudEZyYWdtZW50fQogICAqLwoKICBmdW5jdGlvbiBzdHJpbmdUb0ZyYWdtZW50KHRlbXBsYXRlU3RyaW5nLCByYXcpIHsKICAgIC8vIHRyeSBhIGNhY2hlIGhpdCBmaXJzdAogICAgdmFyIGNhY2hlS2V5ID0gcmF3ID8gdGVtcGxhdGVTdHJpbmcgOiB0ZW1wbGF0ZVN0cmluZy50cmltKCk7CiAgICB2YXIgaGl0ID0gdGVtcGxhdGVDYWNoZS5nZXQoY2FjaGVLZXkpOwoKICAgIGlmIChoaXQpIHsKICAgICAgcmV0dXJuIGhpdDsKICAgIH0KCiAgICB2YXIgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgIHZhciB0YWdNYXRjaCA9IHRlbXBsYXRlU3RyaW5nLm1hdGNoKHRhZ1JFJDEpOwogICAgdmFyIGVudGl0eU1hdGNoID0gZW50aXR5UkUudGVzdCh0ZW1wbGF0ZVN0cmluZyk7CiAgICB2YXIgY29tbWVudE1hdGNoID0gY29tbWVudFJFLnRlc3QodGVtcGxhdGVTdHJpbmcpOwoKICAgIGlmICghdGFnTWF0Y2ggJiYgIWVudGl0eU1hdGNoICYmICFjb21tZW50TWF0Y2gpIHsKICAgICAgLy8gdGV4dCBvbmx5LCByZXR1cm4gYSBzaW5nbGUgdGV4dCBub2RlLgogICAgICBmcmFnLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRlbXBsYXRlU3RyaW5nKSk7CiAgICB9IGVsc2UgewogICAgICB2YXIgdGFnID0gdGFnTWF0Y2ggJiYgdGFnTWF0Y2hbMV07CiAgICAgIHZhciB3cmFwID0gbWFwW3RhZ10gfHwgbWFwLmVmYXVsdDsKICAgICAgdmFyIGRlcHRoID0gd3JhcFswXTsKICAgICAgdmFyIHByZWZpeCA9IHdyYXBbMV07CiAgICAgIHZhciBzdWZmaXggPSB3cmFwWzJdOwogICAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBub2RlLmlubmVySFRNTCA9IHByZWZpeCArIHRlbXBsYXRlU3RyaW5nICsgc3VmZml4OwoKICAgICAgd2hpbGUgKGRlcHRoLS0pIHsKICAgICAgICBub2RlID0gbm9kZS5sYXN0Q2hpbGQ7CiAgICAgIH0KCiAgICAgIHZhciBjaGlsZDsKICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tY29uZC1hc3NpZ24gKi8KCiAgICAgIHdoaWxlIChjaGlsZCA9IG5vZGUuZmlyc3RDaGlsZCkgewogICAgICAgIC8qIGVzbGludC1lbmFibGUgbm8tY29uZC1hc3NpZ24gKi8KICAgICAgICBmcmFnLmFwcGVuZENoaWxkKGNoaWxkKTsKICAgICAgfQogICAgfQoKICAgIGlmICghcmF3KSB7CiAgICAgIHRyaW1Ob2RlKGZyYWcpOwogICAgfQoKICAgIHRlbXBsYXRlQ2FjaGUucHV0KGNhY2hlS2V5LCBmcmFnKTsKICAgIHJldHVybiBmcmFnOwogIH0KICAvKioKICAgKiBDb252ZXJ0IGEgdGVtcGxhdGUgbm9kZSB0byBhIERvY3VtZW50RnJhZ21lbnQuCiAgICoKICAgKiBAcGFyYW0ge05vZGV9IG5vZGUKICAgKiBAcmV0dXJuIHtEb2N1bWVudEZyYWdtZW50fQogICAqLwoKCiAgZnVuY3Rpb24gbm9kZVRvRnJhZ21lbnQobm9kZSkgewogICAgLy8gaWYgaXRzIGEgdGVtcGxhdGUgdGFnIGFuZCB0aGUgYnJvd3NlciBzdXBwb3J0cyBpdCwKICAgIC8vIGl0cyBjb250ZW50IGlzIGFscmVhZHkgYSBkb2N1bWVudCBmcmFnbWVudC4gSG93ZXZlciwgaU9TIFNhZmFyaSBoYXMKICAgIC8vIGJ1ZyB3aGVuIHVzaW5nIGRpcmVjdGx5IGNsb25lZCB0ZW1wbGF0ZSBjb250ZW50IHdpdGggdG91Y2gKICAgIC8vIGV2ZW50cyBhbmQgY2FuIGNhdXNlIGNyYXNoZXMgd2hlbiB0aGUgbm9kZXMgYXJlIHJlbW92ZWQgZnJvbSBET00sIHNvIHdlCiAgICAvLyBoYXZlIHRvIHRyZWF0IHRlbXBsYXRlIGVsZW1lbnRzIGFzIHN0cmluZyB0ZW1wbGF0ZXMuICgjMjgwNSkKCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmIChpc1JlYWxUZW1wbGF0ZShub2RlKSkgewogICAgICByZXR1cm4gc3RyaW5nVG9GcmFnbWVudChub2RlLmlubmVySFRNTCk7CiAgICB9IC8vIHNjcmlwdCB0ZW1wbGF0ZQoKCiAgICBpZiAobm9kZS50YWdOYW1lID09PSAnU0NSSVBUJykgewogICAgICByZXR1cm4gc3RyaW5nVG9GcmFnbWVudChub2RlLnRleHRDb250ZW50KTsKICAgIH0gLy8gbm9ybWFsIG5vZGUsIGNsb25lIGl0IHRvIGF2b2lkIG11dGF0aW5nIHRoZSBvcmlnaW5hbAoKCiAgICB2YXIgY2xvbmVkTm9kZSA9IGNsb25lTm9kZShub2RlKTsKICAgIHZhciBmcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgdmFyIGNoaWxkOwogICAgLyogZXNsaW50LWRpc2FibGUgbm8tY29uZC1hc3NpZ24gKi8KCiAgICB3aGlsZSAoY2hpbGQgPSBjbG9uZWROb2RlLmZpcnN0Q2hpbGQpIHsKICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1jb25kLWFzc2lnbiAqLwogICAgICBmcmFnLmFwcGVuZENoaWxkKGNoaWxkKTsKICAgIH0KCiAgICB0cmltTm9kZShmcmFnKTsKICAgIHJldHVybiBmcmFnOwogIH0gLy8gVGVzdCBmb3IgdGhlIHByZXNlbmNlIG9mIHRoZSBTYWZhcmkgdGVtcGxhdGUgY2xvbmluZyBidWcKICAvLyBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93dWcuY2dpP2lkPTEzNzc1NQoKCiAgdmFyIGhhc0Jyb2tlblRlbXBsYXRlID0gZnVuY3Rpb24gKCkgewogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgIGlmIChpbkJyb3dzZXIpIHsKICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgYS5pbm5lckhUTUwgPSAnPHRlbXBsYXRlPjE8L3RlbXBsYXRlPic7CiAgICAgIHJldHVybiAhYS5jbG9uZU5vZGUodHJ1ZSkuZmlyc3RDaGlsZC5pbm5lckhUTUw7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSgpOyAvLyBUZXN0IGZvciBJRTEwLzExIHRleHRhcmVhIHBsYWNlaG9sZGVyIGNsb25lIGJ1ZwoKCiAgdmFyIGhhc1RleHRhcmVhQ2xvbmVCdWcgPSBmdW5jdGlvbiAoKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgaWYgKGluQnJvd3NlcikgewogICAgICB2YXIgdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7CiAgICAgIHQucGxhY2Vob2xkZXIgPSAndCc7CiAgICAgIHJldHVybiB0LmNsb25lTm9kZSh0cnVlKS52YWx1ZSA9PT0gJ3QnOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0oKTsKICAvKioKICAgKiAxLiBEZWFsIHdpdGggU2FmYXJpIGNsb25pbmcgbmVzdGVkIDx0ZW1wbGF0ZT4gYnVnIGJ5CiAgICogICAgbWFudWFsbHkgY2xvbmluZyBhbGwgdGVtcGxhdGUgaW5zdGFuY2VzLgogICAqIDIuIERlYWwgd2l0aCBJRTEwLzExIHRleHRhcmVhIHBsYWNlaG9sZGVyIGJ1ZyBieSBzZXR0aW5nCiAgICogICAgdGhlIGNvcnJlY3QgdmFsdWUgYWZ0ZXIgY2xvbmluZy4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudHxEb2N1bWVudEZyYWdtZW50fSBub2RlCiAgICogQHJldHVybiB7RWxlbWVudHxEb2N1bWVudEZyYWdtZW50fQogICAqLwoKCiAgZnVuY3Rpb24gY2xvbmVOb2RlKG5vZGUpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKCFub2RlLnF1ZXJ5U2VsZWN0b3JBbGwpIHsKICAgICAgcmV0dXJuIG5vZGUuY2xvbmVOb2RlKCk7CiAgICB9CgogICAgdmFyIHJlcyA9IG5vZGUuY2xvbmVOb2RlKHRydWUpOwogICAgdmFyIGksIG9yaWdpbmFsLCBjbG9uZWQ7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgICBpZiAoaGFzQnJva2VuVGVtcGxhdGUpIHsKICAgICAgdmFyIHRlbXBDbG9uZSA9IHJlczsKCiAgICAgIGlmIChpc1JlYWxUZW1wbGF0ZShub2RlKSkgewogICAgICAgIG5vZGUgPSBub2RlLmNvbnRlbnQ7CiAgICAgICAgdGVtcENsb25lID0gcmVzLmNvbnRlbnQ7CiAgICAgIH0KCiAgICAgIG9yaWdpbmFsID0gbm9kZS5xdWVyeVNlbGVjdG9yQWxsKCd0ZW1wbGF0ZScpOwoKICAgICAgaWYgKG9yaWdpbmFsLmxlbmd0aCkgewogICAgICAgIGNsb25lZCA9IHRlbXBDbG9uZS5xdWVyeVNlbGVjdG9yQWxsKCd0ZW1wbGF0ZScpOwogICAgICAgIGkgPSBjbG9uZWQubGVuZ3RoOwoKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICBjbG9uZWRbaV0ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoY2xvbmVOb2RlKG9yaWdpbmFsW2ldKSwgY2xvbmVkW2ldKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoaGFzVGV4dGFyZWFDbG9uZUJ1ZykgewogICAgICBpZiAobm9kZS50YWdOYW1lID09PSAnVEVYVEFSRUEnKSB7CiAgICAgICAgcmVzLnZhbHVlID0gbm9kZS52YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcmlnaW5hbCA9IG5vZGUucXVlcnlTZWxlY3RvckFsbCgndGV4dGFyZWEnKTsKCiAgICAgICAgaWYgKG9yaWdpbmFsLmxlbmd0aCkgewogICAgICAgICAgY2xvbmVkID0gcmVzLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RleHRhcmVhJyk7CiAgICAgICAgICBpID0gY2xvbmVkLmxlbmd0aDsKCiAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgIGNsb25lZFtpXS52YWx1ZSA9IG9yaWdpbmFsW2ldLnZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXM7CiAgfQogIC8qKgogICAqIFByb2Nlc3MgdGhlIHRlbXBsYXRlIG9wdGlvbiBhbmQgbm9ybWFsaXplcyBpdCBpbnRvIGEKICAgKiBhIERvY3VtZW50RnJhZ21lbnQgdGhhdCBjYW4gYmUgdXNlZCBhcyBhIHBhcnRpYWwgb3IgYQogICAqIGluc3RhbmNlIHRlbXBsYXRlLgogICAqCiAgICogQHBhcmFtIHsqfSB0ZW1wbGF0ZQogICAqICAgICAgICBQb3NzaWJsZSB2YWx1ZXMgaW5jbHVkZToKICAgKiAgICAgICAgLSBEb2N1bWVudEZyYWdtZW50IG9iamVjdAogICAqICAgICAgICAtIE5vZGUgb2JqZWN0IG9mIHR5cGUgVGVtcGxhdGUKICAgKiAgICAgICAgLSBpZCBzZWxlY3RvcjogJyNzb21lLXRlbXBsYXRlLWlkJwogICAqICAgICAgICAtIHRlbXBsYXRlIHN0cmluZzogJzxkaXY+PHNwYW4+e3ttc2d9fTwvc3Bhbj48L2Rpdj4nCiAgICogQHBhcmFtIHtCb29sZWFufSBzaG91bGRDbG9uZQogICAqIEBwYXJhbSB7Qm9vbGVhbn0gcmF3CiAgICogICAgICAgIGlubGluZSBIVE1MIGludGVycG9sYXRpb24uIERvIG5vdCBjaGVjayBmb3IgaWQKICAgKiAgICAgICAgc2VsZWN0b3IgYW5kIGtlZXAgd2hpdGVzcGFjZSBpbiB0aGUgc3RyaW5nLgogICAqIEByZXR1cm4ge0RvY3VtZW50RnJhZ21lbnR8dW5kZWZpbmVkfQogICAqLwoKCiAgZnVuY3Rpb24gcGFyc2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgc2hvdWxkQ2xvbmUsIHJhdykgewogICAgdmFyIG5vZGUsIGZyYWc7IC8vIGlmIHRoZSB0ZW1wbGF0ZSBpcyBhbHJlYWR5IGEgZG9jdW1lbnQgZnJhZ21lbnQsCiAgICAvLyBkbyBub3RoaW5nCgogICAgaWYgKGlzRnJhZ21lbnQodGVtcGxhdGUpKSB7CiAgICAgIHRyaW1Ob2RlKHRlbXBsYXRlKTsKICAgICAgcmV0dXJuIHNob3VsZENsb25lID8gY2xvbmVOb2RlKHRlbXBsYXRlKSA6IHRlbXBsYXRlOwogICAgfQoKICAgIGlmICh0eXBlb2YgdGVtcGxhdGUgPT09ICdzdHJpbmcnKSB7CiAgICAgIC8vIGlkIHNlbGVjdG9yCiAgICAgIGlmICghcmF3ICYmIHRlbXBsYXRlLmNoYXJBdCgwKSA9PT0gJyMnKSB7CiAgICAgICAgLy8gaWQgc2VsZWN0b3IgY2FuIGJlIGNhY2hlZCB0b28KICAgICAgICBmcmFnID0gaWRTZWxlY3RvckNhY2hlLmdldCh0ZW1wbGF0ZSk7CgogICAgICAgIGlmICghZnJhZykgewogICAgICAgICAgbm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRlbXBsYXRlLnNsaWNlKDEpKTsKCiAgICAgICAgICBpZiAobm9kZSkgewogICAgICAgICAgICBmcmFnID0gbm9kZVRvRnJhZ21lbnQobm9kZSk7IC8vIHNhdmUgc2VsZWN0b3IgdG8gY2FjaGUKCiAgICAgICAgICAgIGlkU2VsZWN0b3JDYWNoZS5wdXQodGVtcGxhdGUsIGZyYWcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBub3JtYWwgc3RyaW5nIHRlbXBsYXRlCiAgICAgICAgZnJhZyA9IHN0cmluZ1RvRnJhZ21lbnQodGVtcGxhdGUsIHJhdyk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodGVtcGxhdGUubm9kZVR5cGUpIHsKICAgICAgLy8gYSBkaXJlY3Qgbm9kZQogICAgICBmcmFnID0gbm9kZVRvRnJhZ21lbnQodGVtcGxhdGUpOwogICAgfQoKICAgIHJldHVybiBmcmFnICYmIHNob3VsZENsb25lID8gY2xvbmVOb2RlKGZyYWcpIDogZnJhZzsKICB9CgogIHZhciB0ZW1wbGF0ZSA9IE9iamVjdC5mcmVlemUoewogICAgY2xvbmVOb2RlOiBjbG9uZU5vZGUsCiAgICBwYXJzZVRlbXBsYXRlOiBwYXJzZVRlbXBsYXRlCiAgfSk7CiAgdmFyIGh0bWwgPSB7CiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKCkgewogICAgICAvLyBhIGNvbW1lbnQgbm9kZSBtZWFucyB0aGlzIGlzIGEgYmluZGluZyBmb3IKICAgICAgLy8ge3t7IGlubGluZSB1bmVzY2FwZWQgaHRtbCB9fX0KICAgICAgaWYgKHRoaXMuZWwubm9kZVR5cGUgPT09IDgpIHsKICAgICAgICAvLyBob2xkIG5vZGVzCiAgICAgICAgdGhpcy5ub2RlcyA9IFtdOyAvLyByZXBsYWNlIHRoZSBwbGFjZWhvbGRlciB3aXRoIHByb3BlciBhbmNob3IKCiAgICAgICAgdGhpcy5hbmNob3IgPSBjcmVhdGVBbmNob3IoJ3YtaHRtbCcpOwogICAgICAgIHJlcGxhY2UodGhpcy5lbCwgdGhpcy5hbmNob3IpOwogICAgICB9CiAgICB9LAogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUodmFsdWUpIHsKICAgICAgdmFsdWUgPSBfdG9TdHJpbmcodmFsdWUpOwoKICAgICAgaWYgKHRoaXMubm9kZXMpIHsKICAgICAgICB0aGlzLnN3YXAodmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBzd2FwOiBmdW5jdGlvbiBzd2FwKHZhbHVlKSB7CiAgICAgIC8vIHJlbW92ZSBvbGQgbm9kZXMKICAgICAgdmFyIGkgPSB0aGlzLm5vZGVzLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICByZW1vdmUodGhpcy5ub2Rlc1tpXSk7CiAgICAgIH0gLy8gY29udmVydCBuZXcgdmFsdWUgdG8gYSBmcmFnbWVudAogICAgICAvLyBkbyBub3QgYXR0ZW1wdCB0byByZXRyaWV2ZSBmcm9tIGlkIHNlbGVjdG9yCgoKICAgICAgdmFyIGZyYWcgPSBwYXJzZVRlbXBsYXRlKHZhbHVlLCB0cnVlLCB0cnVlKTsgLy8gc2F2ZSBhIHJlZmVyZW5jZSB0byB0aGVzZSBub2RlcyBzbyB3ZSBjYW4gcmVtb3ZlIGxhdGVyCgogICAgICB0aGlzLm5vZGVzID0gdG9BcnJheShmcmFnLmNoaWxkTm9kZXMpOwogICAgICBiZWZvcmUoZnJhZywgdGhpcy5hbmNob3IpOwogICAgfQogIH07CiAgLyoqCiAgICogQWJzdHJhY3Rpb24gZm9yIGEgcGFydGlhbGx5LWNvbXBpbGVkIGZyYWdtZW50LgogICAqIENhbiBvcHRpb25hbGx5IGNvbXBpbGUgY29udGVudCB3aXRoIGEgY2hpbGQgc2NvcGUuCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaW5rZXIKICAgKiBAcGFyYW0ge1Z1ZX0gdm0KICAgKiBAcGFyYW0ge0RvY3VtZW50RnJhZ21lbnR9IGZyYWcKICAgKiBAcGFyYW0ge1Z1ZX0gW2hvc3RdCiAgICogQHBhcmFtIHtPYmplY3R9IFtzY29wZV0KICAgKiBAcGFyYW0ge0ZyYWdtZW50fSBbcGFyZW50RnJhZ10KICAgKi8KCiAgZnVuY3Rpb24gRnJhZ21lbnQobGlua2VyLCB2bSwgZnJhZywgaG9zdCwgc2NvcGUsIHBhcmVudEZyYWcpIHsKICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgIHRoaXMuY2hpbGRGcmFncyA9IFtdOwogICAgdGhpcy52bSA9IHZtOwogICAgdGhpcy5zY29wZSA9IHNjb3BlOwogICAgdGhpcy5pbnNlcnRlZCA9IGZhbHNlOwogICAgdGhpcy5wYXJlbnRGcmFnID0gcGFyZW50RnJhZzsKCiAgICBpZiAocGFyZW50RnJhZykgewogICAgICBwYXJlbnRGcmFnLmNoaWxkRnJhZ3MucHVzaCh0aGlzKTsKICAgIH0KCiAgICB0aGlzLnVubGluayA9IGxpbmtlcih2bSwgZnJhZywgaG9zdCwgc2NvcGUsIHRoaXMpOwogICAgdmFyIHNpbmdsZSA9IHRoaXMuc2luZ2xlID0gZnJhZy5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMSAmJiAvLyBkbyBub3QgZ28gc2luZ2xlIG1vZGUgaWYgdGhlIG9ubHkgbm9kZSBpcyBhbiBhbmNob3IKICAgICFmcmFnLmNoaWxkTm9kZXNbMF0uX192X2FuY2hvcjsKCiAgICBpZiAoc2luZ2xlKSB7CiAgICAgIHRoaXMubm9kZSA9IGZyYWcuY2hpbGROb2Rlc1swXTsKICAgICAgdGhpcy5iZWZvcmUgPSBzaW5nbGVCZWZvcmU7CiAgICAgIHRoaXMucmVtb3ZlID0gc2luZ2xlUmVtb3ZlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5ub2RlID0gY3JlYXRlQW5jaG9yKCdmcmFnbWVudC1zdGFydCcpOwogICAgICB0aGlzLmVuZCA9IGNyZWF0ZUFuY2hvcignZnJhZ21lbnQtZW5kJyk7CiAgICAgIHRoaXMuZnJhZyA9IGZyYWc7CiAgICAgIHByZXBlbmQodGhpcy5ub2RlLCBmcmFnKTsKICAgICAgZnJhZy5hcHBlbmRDaGlsZCh0aGlzLmVuZCk7CiAgICAgIHRoaXMuYmVmb3JlID0gbXVsdGlCZWZvcmU7CiAgICAgIHRoaXMucmVtb3ZlID0gbXVsdGlSZW1vdmU7CiAgICB9CgogICAgdGhpcy5ub2RlLl9fdl9mcmFnID0gdGhpczsKICB9CiAgLyoqCiAgICogQ2FsbCBhdHRhY2gvZGV0YWNoIGZvciBhbGwgY29tcG9uZW50cyBjb250YWluZWQgd2l0aGluCiAgICogdGhpcyBmcmFnbWVudC4gQWxzbyBkbyBzbyByZWN1cnNpdmVseSBmb3IgYWxsIGNoaWxkCiAgICogZnJhZ21lbnRzLgogICAqCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaG9vawogICAqLwoKCiAgRnJhZ21lbnQucHJvdG90eXBlLmNhbGxIb29rID0gZnVuY3Rpb24gKGhvb2spIHsKICAgIHZhciBpLCBsOwoKICAgIGZvciAoaSA9IDAsIGwgPSB0aGlzLmNoaWxkRnJhZ3MubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHRoaXMuY2hpbGRGcmFnc1tpXS5jYWxsSG9vayhob29rKTsKICAgIH0KCiAgICBmb3IgKGkgPSAwLCBsID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgaG9vayh0aGlzLmNoaWxkcmVuW2ldKTsKICAgIH0KICB9OwogIC8qKgogICAqIEluc2VydCBmcmFnbWVudCBiZWZvcmUgdGFyZ2V0LCBzaW5nbGUgbm9kZSB2ZXJzaW9uCiAgICoKICAgKiBAcGFyYW0ge05vZGV9IHRhcmdldAogICAqIEBwYXJhbSB7Qm9vbGVhbn0gd2l0aFRyYW5zaXRpb24KICAgKi8KCgogIGZ1bmN0aW9uIHNpbmdsZUJlZm9yZSh0YXJnZXQsIHdpdGhUcmFuc2l0aW9uKSB7CiAgICB0aGlzLmluc2VydGVkID0gdHJ1ZTsKICAgIHZhciBtZXRob2QgPSB3aXRoVHJhbnNpdGlvbiAhPT0gZmFsc2UgPyBiZWZvcmVXaXRoVHJhbnNpdGlvbiA6IGJlZm9yZTsKICAgIG1ldGhvZCh0aGlzLm5vZGUsIHRhcmdldCwgdGhpcy52bSk7CgogICAgaWYgKGluRG9jKHRoaXMubm9kZSkpIHsKICAgICAgdGhpcy5jYWxsSG9vayhhdHRhY2gpOwogICAgfQogIH0KICAvKioKICAgKiBSZW1vdmUgZnJhZ21lbnQsIHNpbmdsZSBub2RlIHZlcnNpb24KICAgKi8KCgogIGZ1bmN0aW9uIHNpbmdsZVJlbW92ZSgpIHsKICAgIHRoaXMuaW5zZXJ0ZWQgPSBmYWxzZTsKICAgIHZhciBzaG91bGRDYWxsUmVtb3ZlID0gaW5Eb2ModGhpcy5ub2RlKTsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHRoaXMuYmVmb3JlUmVtb3ZlKCk7CiAgICByZW1vdmVXaXRoVHJhbnNpdGlvbih0aGlzLm5vZGUsIHRoaXMudm0sIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHNob3VsZENhbGxSZW1vdmUpIHsKICAgICAgICBzZWxmLmNhbGxIb29rKGRldGFjaCk7CiAgICAgIH0KCiAgICAgIHNlbGYuZGVzdHJveSgpOwogICAgfSk7CiAgfQogIC8qKgogICAqIEluc2VydCBmcmFnbWVudCBiZWZvcmUgdGFyZ2V0LCBtdWx0aS1ub2RlcyB2ZXJzaW9uCiAgICoKICAgKiBAcGFyYW0ge05vZGV9IHRhcmdldAogICAqIEBwYXJhbSB7Qm9vbGVhbn0gd2l0aFRyYW5zaXRpb24KICAgKi8KCgogIGZ1bmN0aW9uIG11bHRpQmVmb3JlKHRhcmdldCwgd2l0aFRyYW5zaXRpb24pIHsKICAgIHRoaXMuaW5zZXJ0ZWQgPSB0cnVlOwogICAgdmFyIHZtID0gdGhpcy52bTsKICAgIHZhciBtZXRob2QgPSB3aXRoVHJhbnNpdGlvbiAhPT0gZmFsc2UgPyBiZWZvcmVXaXRoVHJhbnNpdGlvbiA6IGJlZm9yZTsKICAgIG1hcE5vZGVSYW5nZSh0aGlzLm5vZGUsIHRoaXMuZW5kLCBmdW5jdGlvbiAobm9kZSkgewogICAgICBtZXRob2Qobm9kZSwgdGFyZ2V0LCB2bSk7CiAgICB9KTsKCiAgICBpZiAoaW5Eb2ModGhpcy5ub2RlKSkgewogICAgICB0aGlzLmNhbGxIb29rKGF0dGFjaCk7CiAgICB9CiAgfQogIC8qKgogICAqIFJlbW92ZSBmcmFnbWVudCwgbXVsdGktbm9kZXMgdmVyc2lvbgogICAqLwoKCiAgZnVuY3Rpb24gbXVsdGlSZW1vdmUoKSB7CiAgICB0aGlzLmluc2VydGVkID0gZmFsc2U7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgc2hvdWxkQ2FsbFJlbW92ZSA9IGluRG9jKHRoaXMubm9kZSk7CiAgICB0aGlzLmJlZm9yZVJlbW92ZSgpOwogICAgcmVtb3ZlTm9kZVJhbmdlKHRoaXMubm9kZSwgdGhpcy5lbmQsIHRoaXMudm0sIHRoaXMuZnJhZywgZnVuY3Rpb24gKCkgewogICAgICBpZiAoc2hvdWxkQ2FsbFJlbW92ZSkgewogICAgICAgIHNlbGYuY2FsbEhvb2soZGV0YWNoKTsKICAgICAgfQoKICAgICAgc2VsZi5kZXN0cm95KCk7CiAgICB9KTsKICB9CiAgLyoqCiAgICogUHJlcGFyZSB0aGUgZnJhZ21lbnQgZm9yIHJlbW92YWwuCiAgICovCgoKICBGcmFnbWVudC5wcm90b3R5cGUuYmVmb3JlUmVtb3ZlID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGksIGw7CgogICAgZm9yIChpID0gMCwgbCA9IHRoaXMuY2hpbGRGcmFncy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgLy8gY2FsbCB0aGUgc2FtZSBtZXRob2QgcmVjdXJzaXZlbHkgb24gY2hpbGQKICAgICAgLy8gZnJhZ21lbnRzLCBkZXB0aC1maXJzdAogICAgICB0aGlzLmNoaWxkRnJhZ3NbaV0uYmVmb3JlUmVtb3ZlKGZhbHNlKTsKICAgIH0KCiAgICBmb3IgKGkgPSAwLCBsID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgLy8gQ2FsbCBkZXN0cm95IGZvciBhbGwgY29udGFpbmVkIGluc3RhbmNlcywKICAgICAgLy8gd2l0aCByZW1vdmU6ZmFsc2UgYW5kIGRlZmVyOnRydWUuCiAgICAgIC8vIERlZmVyIGlzIG5lY2Vzc2FyeSBiZWNhdXNlIHdlIG5lZWQgdG8KICAgICAgLy8ga2VlcCB0aGUgY2hpbGRyZW4gdG8gY2FsbCBkZXRhY2ggaG9va3MKICAgICAgLy8gb24gdGhlbS4KICAgICAgdGhpcy5jaGlsZHJlbltpXS4kZGVzdHJveShmYWxzZSwgdHJ1ZSk7CiAgICB9CgogICAgdmFyIGRpcnMgPSB0aGlzLnVubGluay5kaXJzOwoKICAgIGZvciAoaSA9IDAsIGwgPSBkaXJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAvLyBkaXNhYmxlIHRoZSB3YXRjaGVycyBvbiBhbGwgdGhlIGRpcmVjdGl2ZXMKICAgICAgLy8gc28gdGhhdCB0aGUgcmVuZGVyZWQgY29udGVudCBzdGF5cyB0aGUgc2FtZQogICAgICAvLyBkdXJpbmcgcmVtb3ZhbC4KICAgICAgZGlyc1tpXS5fd2F0Y2hlciAmJiBkaXJzW2ldLl93YXRjaGVyLnRlYXJkb3duKCk7CiAgICB9CiAgfTsKICAvKioKICAgKiBEZXN0cm95IHRoZSBmcmFnbWVudC4KICAgKi8KCgogIEZyYWdtZW50LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMucGFyZW50RnJhZykgewogICAgICB0aGlzLnBhcmVudEZyYWcuY2hpbGRGcmFncy4kcmVtb3ZlKHRoaXMpOwogICAgfQoKICAgIHRoaXMubm9kZS5fX3ZfZnJhZyA9IG51bGw7CiAgICB0aGlzLnVubGluaygpOwogIH07CiAgLyoqCiAgICogQ2FsbCBhdHRhY2ggaG9vayBmb3IgYSBWdWUgaW5zdGFuY2UuCiAgICoKICAgKiBAcGFyYW0ge1Z1ZX0gY2hpbGQKICAgKi8KCgogIGZ1bmN0aW9uIGF0dGFjaChjaGlsZCkgewogICAgaWYgKCFjaGlsZC5faXNBdHRhY2hlZCAmJiBpbkRvYyhjaGlsZC4kZWwpKSB7CiAgICAgIGNoaWxkLl9jYWxsSG9vaygnYXR0YWNoZWQnKTsKICAgIH0KICB9CiAgLyoqCiAgICogQ2FsbCBkZXRhY2ggaG9vayBmb3IgYSBWdWUgaW5zdGFuY2UuCiAgICoKICAgKiBAcGFyYW0ge1Z1ZX0gY2hpbGQKICAgKi8KCgogIGZ1bmN0aW9uIGRldGFjaChjaGlsZCkgewogICAgaWYgKGNoaWxkLl9pc0F0dGFjaGVkICYmICFpbkRvYyhjaGlsZC4kZWwpKSB7CiAgICAgIGNoaWxkLl9jYWxsSG9vaygnZGV0YWNoZWQnKTsKICAgIH0KICB9CgogIHZhciBsaW5rZXJDYWNoZSA9IG5ldyBDYWNoZSg1MDAwKTsKICAvKioKICAgKiBBIGZhY3RvcnkgdGhhdCBjYW4gYmUgdXNlZCB0byBjcmVhdGUgaW5zdGFuY2VzIG9mIGEKICAgKiBmcmFnbWVudC4gQ2FjaGVzIHRoZSBjb21waWxlZCBsaW5rZXIgaWYgcG9zc2libGUuCiAgICoKICAgKiBAcGFyYW0ge1Z1ZX0gdm0KICAgKiBAcGFyYW0ge0VsZW1lbnR8U3RyaW5nfSBlbAogICAqLwoKICBmdW5jdGlvbiBGcmFnbWVudEZhY3Rvcnkodm0sIGVsKSB7CiAgICB0aGlzLnZtID0gdm07CiAgICB2YXIgdGVtcGxhdGU7CiAgICB2YXIgaXNTdHJpbmcgPSB0eXBlb2YgZWwgPT09ICdzdHJpbmcnOwoKICAgIGlmIChpc1N0cmluZyB8fCBpc1RlbXBsYXRlKGVsKSAmJiAhZWwuaGFzQXR0cmlidXRlKCd2LWlmJykpIHsKICAgICAgdGVtcGxhdGUgPSBwYXJzZVRlbXBsYXRlKGVsLCB0cnVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHRlbXBsYXRlID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICB0ZW1wbGF0ZS5hcHBlbmRDaGlsZChlbCk7CiAgICB9CgogICAgdGhpcy50ZW1wbGF0ZSA9IHRlbXBsYXRlOyAvLyBsaW5rZXIgY2FuIGJlIGNhY2hlZCwgYnV0IG9ubHkgZm9yIGNvbXBvbmVudHMKCiAgICB2YXIgbGlua2VyOwogICAgdmFyIGNpZCA9IHZtLmNvbnN0cnVjdG9yLmNpZDsKCiAgICBpZiAoY2lkID4gMCkgewogICAgICB2YXIgY2FjaGVJZCA9IGNpZCArIChpc1N0cmluZyA/IGVsIDogZ2V0T3V0ZXJIVE1MKGVsKSk7CiAgICAgIGxpbmtlciA9IGxpbmtlckNhY2hlLmdldChjYWNoZUlkKTsKCiAgICAgIGlmICghbGlua2VyKSB7CiAgICAgICAgbGlua2VyID0gY29tcGlsZSh0ZW1wbGF0ZSwgdm0uJG9wdGlvbnMsIHRydWUpOwogICAgICAgIGxpbmtlckNhY2hlLnB1dChjYWNoZUlkLCBsaW5rZXIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsaW5rZXIgPSBjb21waWxlKHRlbXBsYXRlLCB2bS4kb3B0aW9ucywgdHJ1ZSk7CiAgICB9CgogICAgdGhpcy5saW5rZXIgPSBsaW5rZXI7CiAgfQogIC8qKgogICAqIENyZWF0ZSBhIGZyYWdtZW50IGluc3RhbmNlIHdpdGggZ2l2ZW4gaG9zdCBhbmQgc2NvcGUuCiAgICoKICAgKiBAcGFyYW0ge1Z1ZX0gaG9zdAogICAqIEBwYXJhbSB7T2JqZWN0fSBzY29wZQogICAqIEBwYXJhbSB7RnJhZ21lbnR9IHBhcmVudEZyYWcKICAgKi8KCgogIEZyYWdtZW50RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKGhvc3QsIHNjb3BlLCBwYXJlbnRGcmFnKSB7CiAgICB2YXIgZnJhZyA9IGNsb25lTm9kZSh0aGlzLnRlbXBsYXRlKTsKICAgIHJldHVybiBuZXcgRnJhZ21lbnQodGhpcy5saW5rZXIsIHRoaXMudm0sIGZyYWcsIGhvc3QsIHNjb3BlLCBwYXJlbnRGcmFnKTsKICB9OwoKICB2YXIgT04gPSA3MDA7CiAgdmFyIE1PREVMID0gODAwOwogIHZhciBCSU5EID0gODUwOwogIHZhciBUUkFOU0lUSU9OID0gMTEwMDsKICB2YXIgRUwgPSAxNTAwOwogIHZhciBDT01QT05FTlQgPSAxNTAwOwogIHZhciBQQVJUSUFMID0gMTc1MDsKICB2YXIgSUYgPSAyMTAwOwogIHZhciBGT1IgPSAyMjAwOwogIHZhciBTTE9UID0gMjMwMDsKICB2YXIgdWlkJDMgPSAwOwogIHZhciB2Rm9yID0gewogICAgcHJpb3JpdHk6IEZPUiwKICAgIHRlcm1pbmFsOiB0cnVlLAogICAgcGFyYW1zOiBbJ3RyYWNrLWJ5JywgJ3N0YWdnZXInLCAnZW50ZXItc3RhZ2dlcicsICdsZWF2ZS1zdGFnZ2VyJ10sCiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKCkgewogICAgICAvLyBzdXBwb3J0ICJpdGVtIGluL29mIGl0ZW1zIiBzeW50YXgKICAgICAgdmFyIGluTWF0Y2ggPSB0aGlzLmV4cHJlc3Npb24ubWF0Y2goLyguKikgKD86aW58b2YpICguKikvKTsKCiAgICAgIGlmIChpbk1hdGNoKSB7CiAgICAgICAgdmFyIGl0TWF0Y2ggPSBpbk1hdGNoWzFdLm1hdGNoKC9cKCguKiksKC4qKVwpLyk7CgogICAgICAgIGlmIChpdE1hdGNoKSB7CiAgICAgICAgICB0aGlzLml0ZXJhdG9yID0gaXRNYXRjaFsxXS50cmltKCk7CiAgICAgICAgICB0aGlzLmFsaWFzID0gaXRNYXRjaFsyXS50cmltKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYWxpYXMgPSBpbk1hdGNoWzFdLnRyaW0oKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuZXhwcmVzc2lvbiA9IGluTWF0Y2hbMl07CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5hbGlhcykgewogICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdJbnZhbGlkIHYtZm9yIGV4cHJlc3Npb24gIicgKyB0aGlzLmRlc2NyaXB0b3IucmF3ICsgJyI6ICcgKyAnYWxpYXMgaXMgcmVxdWlyZWQuJywgdGhpcy52bSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIHVpZCBhcyBhIGNhY2hlIGlkZW50aWZpZXIKCgogICAgICB0aGlzLmlkID0gJ19fdi1mb3JfXycgKyArK3VpZCQzOyAvLyBjaGVjayBpZiB0aGlzIGlzIGFuIG9wdGlvbiBsaXN0LAogICAgICAvLyBzbyB0aGF0IHdlIGtub3cgaWYgd2UgbmVlZCB0byB1cGRhdGUgdGhlIDxzZWxlY3Q+J3MKICAgICAgLy8gdi1tb2RlbCB3aGVuIHRoZSBvcHRpb24gbGlzdCBoYXMgY2hhbmdlZC4KICAgICAgLy8gYmVjYXVzZSB2LW1vZGVsIGhhcyBhIGxvd2VyIHByaW9yaXR5IHRoYW4gdi1mb3IsCiAgICAgIC8vIHRoZSB2LW1vZGVsIGlzIG5vdCBib3VuZCBoZXJlIHlldCwgc28gd2UgaGF2ZSB0bwogICAgICAvLyByZXRyaXZlIGl0IGluIHRoZSBhY3R1YWwgdXBkYXRlTW9kZWwoKSBmdW5jdGlvbi4KCiAgICAgIHZhciB0YWcgPSB0aGlzLmVsLnRhZ05hbWU7CiAgICAgIHRoaXMuaXNPcHRpb24gPSAodGFnID09PSAnT1BUSU9OJyB8fCB0YWcgPT09ICdPUFRHUk9VUCcpICYmIHRoaXMuZWwucGFyZW50Tm9kZS50YWdOYW1lID09PSAnU0VMRUNUJzsgLy8gc2V0dXAgYW5jaG9yIG5vZGVzCgogICAgICB0aGlzLnN0YXJ0ID0gY3JlYXRlQW5jaG9yKCd2LWZvci1zdGFydCcpOwogICAgICB0aGlzLmVuZCA9IGNyZWF0ZUFuY2hvcigndi1mb3ItZW5kJyk7CiAgICAgIHJlcGxhY2UodGhpcy5lbCwgdGhpcy5lbmQpOwogICAgICBiZWZvcmUodGhpcy5zdGFydCwgdGhpcy5lbmQpOyAvLyBjYWNoZQoKICAgICAgdGhpcy5jYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7IC8vIGZyYWdtZW50IGZhY3RvcnkKCiAgICAgIHRoaXMuZmFjdG9yeSA9IG5ldyBGcmFnbWVudEZhY3RvcnkodGhpcy52bSwgdGhpcy5lbCk7CiAgICB9LAogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUoZGF0YSkgewogICAgICB0aGlzLmRpZmYoZGF0YSk7CiAgICAgIHRoaXMudXBkYXRlUmVmKCk7CiAgICAgIHRoaXMudXBkYXRlTW9kZWwoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBEaWZmLCBiYXNlZCBvbiBuZXcgZGF0YSBhbmQgb2xkIGRhdGEsIGRldGVybWluZSB0aGUKICAgICAqIG1pbmltdW0gYW1vdW50IG9mIERPTSBtYW5pcHVsYXRpb25zIG5lZWRlZCB0byBtYWtlIHRoZQogICAgICogRE9NIHJlZmxlY3QgdGhlIG5ldyBkYXRhIEFycmF5LgogICAgICoKICAgICAqIFRoZSBhbGdvcml0aG0gZGlmZnMgdGhlIG5ldyBkYXRhIEFycmF5IGJ5IHN0b3JpbmcgYQogICAgICogaGlkZGVuIHJlZmVyZW5jZSB0byBhbiBvd25lciB2bSBpbnN0YW5jZSBvbiBwcmV2aW91c2x5CiAgICAgKiBzZWVuIGRhdGEuIFRoaXMgYWxsb3dzIHVzIHRvIGFjaGlldmUgTyhuKSB3aGljaCBpcwogICAgICogYmV0dGVyIHRoYW4gYSBsZXZlbnNodGVpbiBkaXN0YW5jZSBiYXNlZCBhbGdvcml0aG0sCiAgICAgKiB3aGljaCBpcyBPKG0gKiBuKS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0FycmF5fSBkYXRhCiAgICAgKi8KICAgIGRpZmY6IGZ1bmN0aW9uIGRpZmYoZGF0YSkgewogICAgICAvLyBjaGVjayBpZiB0aGUgQXJyYXkgd2FzIGNvbnZlcnRlZCBmcm9tIGFuIE9iamVjdAogICAgICB2YXIgaXRlbSA9IGRhdGFbMF07CiAgICAgIHZhciBjb252ZXJ0ZWRGcm9tT2JqZWN0ID0gdGhpcy5mcm9tT2JqZWN0ID0gaXNPYmplY3QoaXRlbSkgJiYgaGFzT3duKGl0ZW0sICcka2V5JykgJiYgaGFzT3duKGl0ZW0sICckdmFsdWUnKTsKICAgICAgdmFyIHRyYWNrQnlLZXkgPSB0aGlzLnBhcmFtcy50cmFja0J5OwogICAgICB2YXIgb2xkRnJhZ3MgPSB0aGlzLmZyYWdzOwogICAgICB2YXIgZnJhZ3MgPSB0aGlzLmZyYWdzID0gbmV3IEFycmF5KGRhdGEubGVuZ3RoKTsKICAgICAgdmFyIGFsaWFzID0gdGhpcy5hbGlhczsKICAgICAgdmFyIGl0ZXJhdG9yID0gdGhpcy5pdGVyYXRvcjsKICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zdGFydDsKICAgICAgdmFyIGVuZCA9IHRoaXMuZW5kOwogICAgICB2YXIgaW5Eb2N1bWVudCA9IGluRG9jKHN0YXJ0KTsKICAgICAgdmFyIGluaXQgPSAhb2xkRnJhZ3M7CiAgICAgIHZhciBpLCBsLCBmcmFnLCBrZXksIHZhbHVlLCBwcmltaXRpdmU7IC8vIEZpcnN0IHBhc3MsIGdvIHRocm91Z2ggdGhlIG5ldyBBcnJheSBhbmQgZmlsbCB1cAogICAgICAvLyB0aGUgbmV3IGZyYWdzIGFycmF5LiBJZiBhIHBpZWNlIG9mIGRhdGEgaGFzIGEgY2FjaGVkCiAgICAgIC8vIGluc3RhbmNlIGZvciBpdCwgd2UgcmV1c2UgaXQuIE90aGVyd2lzZSBidWlsZCBhIG5ldwogICAgICAvLyBpbnN0YW5jZS4KCiAgICAgIGZvciAoaSA9IDAsIGwgPSBkYXRhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGl0ZW0gPSBkYXRhW2ldOwogICAgICAgIGtleSA9IGNvbnZlcnRlZEZyb21PYmplY3QgPyBpdGVtLiRrZXkgOiBudWxsOwogICAgICAgIHZhbHVlID0gY29udmVydGVkRnJvbU9iamVjdCA/IGl0ZW0uJHZhbHVlIDogaXRlbTsKICAgICAgICBwcmltaXRpdmUgPSAhaXNPYmplY3QodmFsdWUpOwogICAgICAgIGZyYWcgPSAhaW5pdCAmJiB0aGlzLmdldENhY2hlZEZyYWcodmFsdWUsIGksIGtleSk7CgogICAgICAgIGlmIChmcmFnKSB7CiAgICAgICAgICAvLyByZXVzYWJsZSBmcmFnbWVudAogICAgICAgICAgZnJhZy5yZXVzZWQgPSB0cnVlOyAvLyB1cGRhdGUgJGluZGV4CgogICAgICAgICAgZnJhZy5zY29wZS4kaW5kZXggPSBpOyAvLyB1cGRhdGUgJGtleQoKICAgICAgICAgIGlmIChrZXkpIHsKICAgICAgICAgICAgZnJhZy5zY29wZS4ka2V5ID0ga2V5OwogICAgICAgICAgfSAvLyB1cGRhdGUgaXRlcmF0b3IKCgogICAgICAgICAgaWYgKGl0ZXJhdG9yKSB7CiAgICAgICAgICAgIGZyYWcuc2NvcGVbaXRlcmF0b3JdID0ga2V5ICE9PSBudWxsID8ga2V5IDogaTsKICAgICAgICAgIH0gLy8gdXBkYXRlIGRhdGEgZm9yIHRyYWNrLWJ5LCBvYmplY3QgcmVwZWF0ICYKICAgICAgICAgIC8vIHByaW1pdGl2ZSB2YWx1ZXMuCgoKICAgICAgICAgIGlmICh0cmFja0J5S2V5IHx8IGNvbnZlcnRlZEZyb21PYmplY3QgfHwgcHJpbWl0aXZlKSB7CiAgICAgICAgICAgIHdpdGhvdXRDb252ZXJzaW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBmcmFnLnNjb3BlW2FsaWFzXSA9IHZhbHVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gbmV3IGlzbnRhbmNlCiAgICAgICAgICBmcmFnID0gdGhpcy5jcmVhdGUodmFsdWUsIGFsaWFzLCBpLCBrZXkpOwogICAgICAgICAgZnJhZy5mcmVzaCA9ICFpbml0OwogICAgICAgIH0KCiAgICAgICAgZnJhZ3NbaV0gPSBmcmFnOwoKICAgICAgICBpZiAoaW5pdCkgewogICAgICAgICAgZnJhZy5iZWZvcmUoZW5kKTsKICAgICAgICB9CiAgICAgIH0gLy8gd2UncmUgZG9uZSBmb3IgdGhlIGluaXRpYWwgcmVuZGVyLgoKCiAgICAgIGlmIChpbml0KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIFNlY29uZCBwYXNzLCBnbyB0aHJvdWdoIHRoZSBvbGQgZnJhZ21lbnRzIGFuZAogICAgICAvLyBkZXN0cm95IHRob3NlIHdobyBhcmUgbm90IHJldXNlZCAoYW5kIHJlbW92ZSB0aGVtCiAgICAgIC8vIGZyb20gY2FjaGUpCgoKICAgICAgdmFyIHJlbW92YWxJbmRleCA9IDA7CiAgICAgIHZhciB0b3RhbFJlbW92ZWQgPSBvbGRGcmFncy5sZW5ndGggLSBmcmFncy5sZW5ndGg7IC8vIHdoZW4gcmVtb3ZpbmcgYSBsYXJnZSBudW1iZXIgb2YgZnJhZ21lbnRzLCB3YXRjaGVyIHJlbW92YWwKICAgICAgLy8gdHVybnMgb3V0IHRvIGJlIGEgcGVyZiBib3R0bGVuZWNrLCBzbyB3ZSBiYXRjaCB0aGUgd2F0Y2hlcgogICAgICAvLyByZW1vdmFscyBpbnRvIGEgc2luZ2xlIGZpbHRlciBjYWxsIQoKICAgICAgdGhpcy52bS5fdkZvclJlbW92aW5nID0gdHJ1ZTsKCiAgICAgIGZvciAoaSA9IDAsIGwgPSBvbGRGcmFncy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBmcmFnID0gb2xkRnJhZ3NbaV07CgogICAgICAgIGlmICghZnJhZy5yZXVzZWQpIHsKICAgICAgICAgIHRoaXMuZGVsZXRlQ2FjaGVkRnJhZyhmcmFnKTsKICAgICAgICAgIHRoaXMucmVtb3ZlKGZyYWcsIHJlbW92YWxJbmRleCsrLCB0b3RhbFJlbW92ZWQsIGluRG9jdW1lbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy52bS5fdkZvclJlbW92aW5nID0gZmFsc2U7CgogICAgICBpZiAocmVtb3ZhbEluZGV4KSB7CiAgICAgICAgdGhpcy52bS5fd2F0Y2hlcnMgPSB0aGlzLnZtLl93YXRjaGVycy5maWx0ZXIoZnVuY3Rpb24gKHcpIHsKICAgICAgICAgIHJldHVybiB3LmFjdGl2ZTsKICAgICAgICB9KTsKICAgICAgfSAvLyBGaW5hbCBwYXNzLCBtb3ZlL2luc2VydCBuZXcgZnJhZ21lbnRzIGludG8gdGhlCiAgICAgIC8vIHJpZ2h0IHBsYWNlLgoKCiAgICAgIHZhciB0YXJnZXRQcmV2LCBwcmV2RWwsIGN1cnJlbnRQcmV2OwogICAgICB2YXIgaW5zZXJ0aW9uSW5kZXggPSAwOwoKICAgICAgZm9yIChpID0gMCwgbCA9IGZyYWdzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGZyYWcgPSBmcmFnc1tpXTsgLy8gdGhpcyBpcyB0aGUgZnJhZyB0aGF0IHdlIHNob3VsZCBiZSBhZnRlcgoKICAgICAgICB0YXJnZXRQcmV2ID0gZnJhZ3NbaSAtIDFdOwogICAgICAgIHByZXZFbCA9IHRhcmdldFByZXYgPyB0YXJnZXRQcmV2LnN0YWdnZXJDYiA/IHRhcmdldFByZXYuc3RhZ2dlckFuY2hvciA6IHRhcmdldFByZXYuZW5kIHx8IHRhcmdldFByZXYubm9kZSA6IHN0YXJ0OwoKICAgICAgICBpZiAoZnJhZy5yZXVzZWQgJiYgIWZyYWcuc3RhZ2dlckNiKSB7CiAgICAgICAgICBjdXJyZW50UHJldiA9IGZpbmRQcmV2RnJhZyhmcmFnLCBzdGFydCwgdGhpcy5pZCk7CgogICAgICAgICAgaWYgKGN1cnJlbnRQcmV2ICE9PSB0YXJnZXRQcmV2ICYmICghY3VycmVudFByZXYgfHwgLy8gb3B0aW1pemF0aW9uIGZvciBtb3ZpbmcgYSBzaW5nbGUgaXRlbS4KICAgICAgICAgIC8vIHRoYW5rcyB0byBzdWdnZXN0aW9ucyBieSBAbGl2b3JhcyBpbiAjMTgwNwogICAgICAgICAgZmluZFByZXZGcmFnKGN1cnJlbnRQcmV2LCBzdGFydCwgdGhpcy5pZCkgIT09IHRhcmdldFByZXYpKSB7CiAgICAgICAgICAgIHRoaXMubW92ZShmcmFnLCBwcmV2RWwpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBuZXcgaW5zdGFuY2UsIG9yIHN0aWxsIGluIHN0YWdnZXIuCiAgICAgICAgICAvLyBpbnNlcnQgd2l0aCB1cGRhdGVkIHN0YWdnZXIgaW5kZXguCiAgICAgICAgICB0aGlzLmluc2VydChmcmFnLCBpbnNlcnRpb25JbmRleCsrLCBwcmV2RWwsIGluRG9jdW1lbnQpOwogICAgICAgIH0KCiAgICAgICAgZnJhZy5yZXVzZWQgPSBmcmFnLmZyZXNoID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgZnJhZ21lbnQgaW5zdGFuY2UuCiAgICAgKgogICAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAgICogQHBhcmFtIHtTdHJpbmd9IGFsaWFzCiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXgKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBba2V5XQogICAgICogQHJldHVybiB7RnJhZ21lbnR9CiAgICAgKi8KICAgIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKHZhbHVlLCBhbGlhcywgaW5kZXgsIGtleSkgewogICAgICB2YXIgaG9zdCA9IHRoaXMuX2hvc3Q7IC8vIGNyZWF0ZSBpdGVyYXRpb24gc2NvcGUKCiAgICAgIHZhciBwYXJlbnRTY29wZSA9IHRoaXMuX3Njb3BlIHx8IHRoaXMudm07CiAgICAgIHZhciBzY29wZSA9IE9iamVjdC5jcmVhdGUocGFyZW50U2NvcGUpOyAvLyByZWYgaG9sZGVyIGZvciB0aGUgc2NvcGUKCiAgICAgIHNjb3BlLiRyZWZzID0gT2JqZWN0LmNyZWF0ZShwYXJlbnRTY29wZS4kcmVmcyk7CiAgICAgIHNjb3BlLiRlbHMgPSBPYmplY3QuY3JlYXRlKHBhcmVudFNjb3BlLiRlbHMpOyAvLyBtYWtlIHN1cmUgcG9pbnQgJHBhcmVudCB0byBwYXJlbnQgc2NvcGUKCiAgICAgIHNjb3BlLiRwYXJlbnQgPSBwYXJlbnRTY29wZTsgLy8gZm9yIHR3by13YXkgYmluZGluZyBvbiBhbGlhcwoKICAgICAgc2NvcGUuJGZvckNvbnRleHQgPSB0aGlzOyAvLyBkZWZpbmUgc2NvcGUgcHJvcGVydGllcwogICAgICAvLyBpbXBvcnRhbnQ6IGRlZmluZSB0aGUgc2NvcGUgYWxpYXMgd2l0aG91dCBmb3JjZWQgY29udmVyc2lvbgogICAgICAvLyBzbyB0aGF0IGZyb3plbiBkYXRhIHN0cnVjdHVyZXMgcmVtYWluIG5vbi1yZWFjdGl2ZS4KCiAgICAgIHdpdGhvdXRDb252ZXJzaW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICBkZWZpbmVSZWFjdGl2ZShzY29wZSwgYWxpYXMsIHZhbHVlKTsKICAgICAgfSk7CiAgICAgIGRlZmluZVJlYWN0aXZlKHNjb3BlLCAnJGluZGV4JywgaW5kZXgpOwoKICAgICAgaWYgKGtleSkgewogICAgICAgIGRlZmluZVJlYWN0aXZlKHNjb3BlLCAnJGtleScsIGtleSk7CiAgICAgIH0gZWxzZSBpZiAoc2NvcGUuJGtleSkgewogICAgICAgIC8vIGF2b2lkIGFjY2lkZW50YWwgZmFsbGJhY2sKICAgICAgICBkZWYoc2NvcGUsICcka2V5JywgbnVsbCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLml0ZXJhdG9yKSB7CiAgICAgICAgZGVmaW5lUmVhY3RpdmUoc2NvcGUsIHRoaXMuaXRlcmF0b3IsIGtleSAhPT0gbnVsbCA/IGtleSA6IGluZGV4KTsKICAgICAgfQoKICAgICAgdmFyIGZyYWcgPSB0aGlzLmZhY3RvcnkuY3JlYXRlKGhvc3QsIHNjb3BlLCB0aGlzLl9mcmFnKTsKICAgICAgZnJhZy5mb3JJZCA9IHRoaXMuaWQ7CiAgICAgIHRoaXMuY2FjaGVGcmFnKHZhbHVlLCBmcmFnLCBpbmRleCwga2V5KTsKICAgICAgcmV0dXJuIGZyYWc7CiAgICB9LAoKICAgIC8qKgogICAgICogVXBkYXRlIHRoZSB2LXJlZiBvbiBvd25lciB2bS4KICAgICAqLwogICAgdXBkYXRlUmVmOiBmdW5jdGlvbiB1cGRhdGVSZWYoKSB7CiAgICAgIHZhciByZWYgPSB0aGlzLmRlc2NyaXB0b3IucmVmOwogICAgICBpZiAoIXJlZikgcmV0dXJuOwogICAgICB2YXIgaGFzaCA9ICh0aGlzLl9zY29wZSB8fCB0aGlzLnZtKS4kcmVmczsKICAgICAgdmFyIHJlZnM7CgogICAgICBpZiAoIXRoaXMuZnJvbU9iamVjdCkgewogICAgICAgIHJlZnMgPSB0aGlzLmZyYWdzLm1hcChmaW5kVm1Gcm9tRnJhZyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVmcyA9IHt9OwogICAgICAgIHRoaXMuZnJhZ3MuZm9yRWFjaChmdW5jdGlvbiAoZnJhZykgewogICAgICAgICAgcmVmc1tmcmFnLnNjb3BlLiRrZXldID0gZmluZFZtRnJvbUZyYWcoZnJhZyk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGhhc2hbcmVmXSA9IHJlZnM7CiAgICB9LAoKICAgIC8qKgogICAgICogRm9yIG9wdGlvbiBsaXN0cywgdXBkYXRlIHRoZSBjb250YWluaW5nIHYtbW9kZWwgb24KICAgICAqIHBhcmVudCA8c2VsZWN0Pi4KICAgICAqLwogICAgdXBkYXRlTW9kZWw6IGZ1bmN0aW9uIHVwZGF0ZU1vZGVsKCkgewogICAgICBpZiAodGhpcy5pc09wdGlvbikgewogICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLnN0YXJ0LnBhcmVudE5vZGU7CiAgICAgICAgdmFyIG1vZGVsID0gcGFyZW50ICYmIHBhcmVudC5fX3ZfbW9kZWw7CgogICAgICAgIGlmIChtb2RlbCkgewogICAgICAgICAgbW9kZWwuZm9yY2VVcGRhdGUoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnNlcnQgYSBmcmFnbWVudC4gSGFuZGxlcyBzdGFnZ2VyaW5nLgogICAgICoKICAgICAqIEBwYXJhbSB7RnJhZ21lbnR9IGZyYWcKICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleAogICAgICogQHBhcmFtIHtOb2RlfSBwcmV2RWwKICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaW5Eb2N1bWVudAogICAgICovCiAgICBpbnNlcnQ6IGZ1bmN0aW9uIGluc2VydChmcmFnLCBpbmRleCwgcHJldkVsLCBpbkRvY3VtZW50KSB7CiAgICAgIGlmIChmcmFnLnN0YWdnZXJDYikgewogICAgICAgIGZyYWcuc3RhZ2dlckNiLmNhbmNlbCgpOwogICAgICAgIGZyYWcuc3RhZ2dlckNiID0gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIHN0YWdnZXJBbW91bnQgPSB0aGlzLmdldFN0YWdnZXIoZnJhZywgaW5kZXgsIG51bGwsICdlbnRlcicpOwoKICAgICAgaWYgKGluRG9jdW1lbnQgJiYgc3RhZ2dlckFtb3VudCkgewogICAgICAgIC8vIGNyZWF0ZSBhbiBhbmNob3IgYW5kIGluc2VydCBpdCBzeW5jaHJvbm91c2x5LAogICAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIHJlc29sdmUgdGhlIGNvcnJlY3Qgb3JkZXIgd2l0aG91dAogICAgICAgIC8vIHdvcnJ5aW5nIGFib3V0IHNvbWUgZWxlbWVudHMgbm90IGluc2VydGVkIHlldAogICAgICAgIHZhciBhbmNob3IgPSBmcmFnLnN0YWdnZXJBbmNob3I7CgogICAgICAgIGlmICghYW5jaG9yKSB7CiAgICAgICAgICBhbmNob3IgPSBmcmFnLnN0YWdnZXJBbmNob3IgPSBjcmVhdGVBbmNob3IoJ3N0YWdnZXItYW5jaG9yJyk7CiAgICAgICAgICBhbmNob3IuX192X2ZyYWcgPSBmcmFnOwogICAgICAgIH0KCiAgICAgICAgYWZ0ZXIoYW5jaG9yLCBwcmV2RWwpOwogICAgICAgIHZhciBvcCA9IGZyYWcuc3RhZ2dlckNiID0gY2FuY2VsbGFibGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgZnJhZy5zdGFnZ2VyQ2IgPSBudWxsOwogICAgICAgICAgZnJhZy5iZWZvcmUoYW5jaG9yKTsKICAgICAgICAgIHJlbW92ZShhbmNob3IpOwogICAgICAgIH0pOwogICAgICAgIHNldFRpbWVvdXQob3AsIHN0YWdnZXJBbW91bnQpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciB0YXJnZXQgPSBwcmV2RWwubmV4dFNpYmxpbmc7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgogICAgICAgIGlmICghdGFyZ2V0KSB7CiAgICAgICAgICAvLyByZXNldCBlbmQgYW5jaG9yIHBvc2l0aW9uIGluIGNhc2UgdGhlIHBvc2l0aW9uIHdhcyBtZXNzZWQgdXAKICAgICAgICAgIC8vIGJ5IGFuIGV4dGVybmFsIGRyYWctbi1kcm9wIGxpYnJhcnkuCiAgICAgICAgICBhZnRlcih0aGlzLmVuZCwgcHJldkVsKTsKICAgICAgICAgIHRhcmdldCA9IHRoaXMuZW5kOwogICAgICAgIH0KCiAgICAgICAgZnJhZy5iZWZvcmUodGFyZ2V0KTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFJlbW92ZSBhIGZyYWdtZW50LiBIYW5kbGVzIHN0YWdnZXJpbmcuCiAgICAgKgogICAgICogQHBhcmFtIHtGcmFnbWVudH0gZnJhZwogICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4CiAgICAgKiBAcGFyYW0ge051bWJlcn0gdG90YWwKICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaW5Eb2N1bWVudAogICAgICovCiAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZShmcmFnLCBpbmRleCwgdG90YWwsIGluRG9jdW1lbnQpIHsKICAgICAgaWYgKGZyYWcuc3RhZ2dlckNiKSB7CiAgICAgICAgZnJhZy5zdGFnZ2VyQ2IuY2FuY2VsKCk7CiAgICAgICAgZnJhZy5zdGFnZ2VyQ2IgPSBudWxsOyAvLyBpdCdzIG5vdCBwb3NzaWJsZSBmb3IgdGhlIHNhbWUgZnJhZyB0byBiZSByZW1vdmVkCiAgICAgICAgLy8gdHdpY2UsIHNvIGlmIHdlIGhhdmUgYSBwZW5kaW5nIHN0YWdnZXIgY2FsbGJhY2ssCiAgICAgICAgLy8gaXQgbWVhbnMgdGhpcyBmcmFnIGlzIHF1ZXVlZCBmb3IgZW50ZXIgYnV0IHJlbW92ZWQKICAgICAgICAvLyBiZWZvcmUgaXRzIHRyYW5zaXRpb24gc3RhcnRlZC4gU2luY2UgaXQgaXMgYWxyZWFkeQogICAgICAgIC8vIGRlc3Ryb3llZCwgd2UgY2FuIGp1c3QgbGVhdmUgaXQgaW4gZGV0YWNoZWQgc3RhdGUuCgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHN0YWdnZXJBbW91bnQgPSB0aGlzLmdldFN0YWdnZXIoZnJhZywgaW5kZXgsIHRvdGFsLCAnbGVhdmUnKTsKCiAgICAgIGlmIChpbkRvY3VtZW50ICYmIHN0YWdnZXJBbW91bnQpIHsKICAgICAgICB2YXIgb3AgPSBmcmFnLnN0YWdnZXJDYiA9IGNhbmNlbGxhYmxlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGZyYWcuc3RhZ2dlckNiID0gbnVsbDsKICAgICAgICAgIGZyYWcucmVtb3ZlKCk7CiAgICAgICAgfSk7CiAgICAgICAgc2V0VGltZW91dChvcCwgc3RhZ2dlckFtb3VudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZnJhZy5yZW1vdmUoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIE1vdmUgYSBmcmFnbWVudCB0byBhIG5ldyBwb3NpdGlvbi4KICAgICAqIEZvcmNlIG5vIHRyYW5zaXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIHtGcmFnbWVudH0gZnJhZwogICAgICogQHBhcmFtIHtOb2RlfSBwcmV2RWwKICAgICAqLwogICAgbW92ZTogZnVuY3Rpb24gbW92ZShmcmFnLCBwcmV2RWwpIHsKICAgICAgLy8gZml4IGEgY29tbW9uIGlzc3VlIHdpdGggU29ydGFibGU6CiAgICAgIC8vIGlmIHByZXZFbCBkb2Vzbid0IGhhdmUgbmV4dFNpYmxpbmcsIHRoaXMgbWVhbnMgaXQncwogICAgICAvLyBiZWVuIGRyYWdnZWQgYWZ0ZXIgdGhlIGVuZCBhbmNob3IuIEp1c3QgcmUtcG9zaXRpb24KICAgICAgLy8gdGhlIGVuZCBhbmNob3IgdG8gdGhlIGVuZCBvZiB0aGUgY29udGFpbmVyLgoKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmICghcHJldkVsLm5leHRTaWJsaW5nKSB7CiAgICAgICAgdGhpcy5lbmQucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmVuZCk7CiAgICAgIH0KCiAgICAgIGZyYWcuYmVmb3JlKHByZXZFbC5uZXh0U2libGluZywgZmFsc2UpOwogICAgfSwKCiAgICAvKioKICAgICAqIENhY2hlIGEgZnJhZ21lbnQgdXNpbmcgdHJhY2stYnkgb3IgdGhlIG9iamVjdCBrZXkuCiAgICAgKgogICAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAgICogQHBhcmFtIHtGcmFnbWVudH0gZnJhZwogICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4CiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2tleV0KICAgICAqLwogICAgY2FjaGVGcmFnOiBmdW5jdGlvbiBjYWNoZUZyYWcodmFsdWUsIGZyYWcsIGluZGV4LCBrZXkpIHsKICAgICAgdmFyIHRyYWNrQnlLZXkgPSB0aGlzLnBhcmFtcy50cmFja0J5OwogICAgICB2YXIgY2FjaGUgPSB0aGlzLmNhY2hlOwogICAgICB2YXIgcHJpbWl0aXZlID0gIWlzT2JqZWN0KHZhbHVlKTsKICAgICAgdmFyIGlkOwoKICAgICAgaWYgKGtleSB8fCB0cmFja0J5S2V5IHx8IHByaW1pdGl2ZSkgewogICAgICAgIGlkID0gZ2V0VHJhY2tCeUtleShpbmRleCwga2V5LCB2YWx1ZSwgdHJhY2tCeUtleSk7CgogICAgICAgIGlmICghY2FjaGVbaWRdKSB7CiAgICAgICAgICBjYWNoZVtpZF0gPSBmcmFnOwogICAgICAgIH0gZWxzZSBpZiAodHJhY2tCeUtleSAhPT0gJyRpbmRleCcpIHsKICAgICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB0aGlzLndhcm5EdXBsaWNhdGUodmFsdWUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZCA9IHRoaXMuaWQ7CgogICAgICAgIGlmIChoYXNPd24odmFsdWUsIGlkKSkgewogICAgICAgICAgaWYgKHZhbHVlW2lkXSA9PT0gbnVsbCkgewogICAgICAgICAgICB2YWx1ZVtpZF0gPSBmcmFnOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIHRoaXMud2FybkR1cGxpY2F0ZSh2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuaXNFeHRlbnNpYmxlKHZhbHVlKSkgewogICAgICAgICAgZGVmKHZhbHVlLCBpZCwgZnJhZyk7CiAgICAgICAgfSBlbHNlIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgIHdhcm4oJ0Zyb3plbiB2LWZvciBvYmplY3RzIGNhbm5vdCBiZSBhdXRvbWF0aWNhbGx5IHRyYWNrZWQsIG1ha2Ugc3VyZSB0byAnICsgJ3Byb3ZpZGUgYSB0cmFjay1ieSBrZXkuJyk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmcmFnLnJhdyA9IHZhbHVlOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCBhIGNhY2hlZCBmcmFnbWVudCBmcm9tIHRoZSB2YWx1ZS9pbmRleC9rZXkKICAgICAqCiAgICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXgKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBrZXkKICAgICAqIEByZXR1cm4ge0ZyYWdtZW50fQogICAgICovCiAgICBnZXRDYWNoZWRGcmFnOiBmdW5jdGlvbiBnZXRDYWNoZWRGcmFnKHZhbHVlLCBpbmRleCwga2V5KSB7CiAgICAgIHZhciB0cmFja0J5S2V5ID0gdGhpcy5wYXJhbXMudHJhY2tCeTsKICAgICAgdmFyIHByaW1pdGl2ZSA9ICFpc09iamVjdCh2YWx1ZSk7CiAgICAgIHZhciBmcmFnOwoKICAgICAgaWYgKGtleSB8fCB0cmFja0J5S2V5IHx8IHByaW1pdGl2ZSkgewogICAgICAgIHZhciBpZCA9IGdldFRyYWNrQnlLZXkoaW5kZXgsIGtleSwgdmFsdWUsIHRyYWNrQnlLZXkpOwogICAgICAgIGZyYWcgPSB0aGlzLmNhY2hlW2lkXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmcmFnID0gdmFsdWVbdGhpcy5pZF07CiAgICAgIH0KCiAgICAgIGlmIChmcmFnICYmIChmcmFnLnJldXNlZCB8fCBmcmFnLmZyZXNoKSkgewogICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB0aGlzLndhcm5EdXBsaWNhdGUodmFsdWUpOwogICAgICB9CgogICAgICByZXR1cm4gZnJhZzsKICAgIH0sCgogICAgLyoqCiAgICAgKiBEZWxldGUgYSBmcmFnbWVudCBmcm9tIGNhY2hlLgogICAgICoKICAgICAqIEBwYXJhbSB7RnJhZ21lbnR9IGZyYWcKICAgICAqLwogICAgZGVsZXRlQ2FjaGVkRnJhZzogZnVuY3Rpb24gZGVsZXRlQ2FjaGVkRnJhZyhmcmFnKSB7CiAgICAgIHZhciB2YWx1ZSA9IGZyYWcucmF3OwogICAgICB2YXIgdHJhY2tCeUtleSA9IHRoaXMucGFyYW1zLnRyYWNrQnk7CiAgICAgIHZhciBzY29wZSA9IGZyYWcuc2NvcGU7CiAgICAgIHZhciBpbmRleCA9IHNjb3BlLiRpbmRleDsgLy8gZml4ICM5NDg6IGF2b2lkIGFjY2lkZW50YWxseSBmYWxsIHRocm91Z2ggdG8KICAgICAgLy8gYSBwYXJlbnQgcmVwZWF0ZXIgd2hpY2ggaGFwcGVucyB0byBoYXZlICRrZXkuCgogICAgICB2YXIga2V5ID0gaGFzT3duKHNjb3BlLCAnJGtleScpICYmIHNjb3BlLiRrZXk7CiAgICAgIHZhciBwcmltaXRpdmUgPSAhaXNPYmplY3QodmFsdWUpOwoKICAgICAgaWYgKHRyYWNrQnlLZXkgfHwga2V5IHx8IHByaW1pdGl2ZSkgewogICAgICAgIHZhciBpZCA9IGdldFRyYWNrQnlLZXkoaW5kZXgsIGtleSwgdmFsdWUsIHRyYWNrQnlLZXkpOwogICAgICAgIHRoaXMuY2FjaGVbaWRdID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YWx1ZVt0aGlzLmlkXSA9IG51bGw7CiAgICAgICAgZnJhZy5yYXcgPSBudWxsOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBzdGFnZ2VyIGFtb3VudCBmb3IgYW4gaW5zZXJ0aW9uL3JlbW92YWwuCiAgICAgKgogICAgICogQHBhcmFtIHtGcmFnbWVudH0gZnJhZwogICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4CiAgICAgKiBAcGFyYW0ge051bWJlcn0gdG90YWwKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICAgKi8KICAgIGdldFN0YWdnZXI6IGZ1bmN0aW9uIGdldFN0YWdnZXIoZnJhZywgaW5kZXgsIHRvdGFsLCB0eXBlKSB7CiAgICAgIHR5cGUgPSB0eXBlICsgJ1N0YWdnZXInOwogICAgICB2YXIgdHJhbnMgPSBmcmFnLm5vZGUuX192X3RyYW5zOwogICAgICB2YXIgaG9va3MgPSB0cmFucyAmJiB0cmFucy5ob29rczsKICAgICAgdmFyIGhvb2sgPSBob29rcyAmJiAoaG9va3NbdHlwZV0gfHwgaG9va3Muc3RhZ2dlcik7CiAgICAgIHJldHVybiBob29rID8gaG9vay5jYWxsKGZyYWcsIGluZGV4LCB0b3RhbCkgOiBpbmRleCAqIHBhcnNlSW50KHRoaXMucGFyYW1zW3R5cGVdIHx8IHRoaXMucGFyYW1zLnN0YWdnZXIsIDEwKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBQcmUtcHJvY2VzcyB0aGUgdmFsdWUgYmVmb3JlIHBpcGluZyBpdCB0aHJvdWdoIHRoZQogICAgICogZmlsdGVycy4gVGhpcyBpcyBwYXNzZWQgdG8gYW5kIGNhbGxlZCBieSB0aGUgd2F0Y2hlci4KICAgICAqLwogICAgX3ByZVByb2Nlc3M6IGZ1bmN0aW9uIF9wcmVQcm9jZXNzKHZhbHVlKSB7CiAgICAgIC8vIHJlZ2FyZGxlc3Mgb2YgdHlwZSwgc3RvcmUgdGhlIHVuLWZpbHRlcmVkIHJhdyB2YWx1ZS4KICAgICAgdGhpcy5yYXdWYWx1ZSA9IHZhbHVlOwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9LAoKICAgIC8qKgogICAgICogUG9zdC1wcm9jZXNzIHRoZSB2YWx1ZSBhZnRlciBpdCBoYXMgYmVlbiBwaXBlZCB0aHJvdWdoCiAgICAgKiB0aGUgZmlsdGVycy4gVGhpcyBpcyBwYXNzZWQgdG8gYW5kIGNhbGxlZCBieSB0aGUgd2F0Y2hlci4KICAgICAqCiAgICAgKiBJdCBpcyBuZWNlc3NhcnkgZm9yIHRoaXMgdG8gYmUgY2FsbGVkIGR1cmluZyB0aGUKICAgICAqIHdhdGNoZXIncyBkZXBlbmRlbmN5IGNvbGxlY3Rpb24gcGhhc2UgYmVjYXVzZSB3ZSB3YW50CiAgICAgKiB0aGUgdi1mb3IgdG8gdXBkYXRlIHdoZW4gdGhlIHNvdXJjZSBPYmplY3QgaXMgbXV0YXRlZC4KICAgICAqLwogICAgX3Bvc3RQcm9jZXNzOiBmdW5jdGlvbiBfcG9zdFByb2Nlc3ModmFsdWUpIHsKICAgICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9IGVsc2UgaWYgKGlzUGxhaW5PYmplY3QodmFsdWUpKSB7CiAgICAgICAgLy8gY29udmVydCBwbGFpbiBvYmplY3QgdG8gYXJyYXkuCiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSk7CiAgICAgICAgdmFyIGkgPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgcmVzID0gbmV3IEFycmF5KGkpOwogICAgICAgIHZhciBrZXk7CgogICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgIGtleSA9IGtleXNbaV07CiAgICAgICAgICByZXNbaV0gPSB7CiAgICAgICAgICAgICRrZXk6IGtleSwKICAgICAgICAgICAgJHZhbHVlOiB2YWx1ZVtrZXldCiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiAhaXNOYU4odmFsdWUpKSB7CiAgICAgICAgICB2YWx1ZSA9IHJhbmdlKHZhbHVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB2YWx1ZSB8fCBbXTsKICAgICAgfQogICAgfSwKICAgIHVuYmluZDogZnVuY3Rpb24gdW5iaW5kKCkgewogICAgICBpZiAodGhpcy5kZXNjcmlwdG9yLnJlZikgewogICAgICAgICh0aGlzLl9zY29wZSB8fCB0aGlzLnZtKS4kcmVmc1t0aGlzLmRlc2NyaXB0b3IucmVmXSA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZyYWdzKSB7CiAgICAgICAgdmFyIGkgPSB0aGlzLmZyYWdzLmxlbmd0aDsKICAgICAgICB2YXIgZnJhZzsKCiAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgZnJhZyA9IHRoaXMuZnJhZ3NbaV07CiAgICAgICAgICB0aGlzLmRlbGV0ZUNhY2hlZEZyYWcoZnJhZyk7CiAgICAgICAgICBmcmFnLmRlc3Ryb3koKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwogIC8qKgogICAqIEhlbHBlciB0byBmaW5kIHRoZSBwcmV2aW91cyBlbGVtZW50IHRoYXQgaXMgYSBmcmFnbWVudAogICAqIGFuY2hvci4gVGhpcyBpcyBuZWNlc3NhcnkgYmVjYXVzZSBhIGRlc3Ryb3llZCBmcmFnJ3MKICAgKiBlbGVtZW50IGNvdWxkIHN0aWxsIGJlIGxpbmdlcmluZyBpbiB0aGUgRE9NIGJlZm9yZSBpdHMKICAgKiBsZWF2aW5nIHRyYW5zaXRpb24gZmluaXNoZXMsIGJ1dCBpdHMgaW5zZXJ0ZWQgZmxhZwogICAqIHNob3VsZCBoYXZlIGJlZW4gc2V0IHRvIGZhbHNlIHNvIHdlIGNhbiBza2lwIHRoZW0uCiAgICoKICAgKiBJZiB0aGlzIGlzIGEgYmxvY2sgcmVwZWF0LCB3ZSB3YW50IHRvIG1ha2Ugc3VyZSB3ZSBvbmx5CiAgICogcmV0dXJuIGZyYWcgdGhhdCBpcyBib3VuZCB0byB0aGlzIHYtZm9yLiAoc2VlICM5MjkpCiAgICoKICAgKiBAcGFyYW0ge0ZyYWdtZW50fSBmcmFnCiAgICogQHBhcmFtIHtDb21tZW50fFRleHR9IGFuY2hvcgogICAqIEBwYXJhbSB7U3RyaW5nfSBpZAogICAqIEByZXR1cm4ge0ZyYWdtZW50fQogICAqLwoKICBmdW5jdGlvbiBmaW5kUHJldkZyYWcoZnJhZywgYW5jaG9yLCBpZCkgewogICAgdmFyIGVsID0gZnJhZy5ub2RlLnByZXZpb3VzU2libGluZzsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKICAgIGlmICghZWwpIHJldHVybjsKICAgIGZyYWcgPSBlbC5fX3ZfZnJhZzsKCiAgICB3aGlsZSAoKCFmcmFnIHx8IGZyYWcuZm9ySWQgIT09IGlkIHx8ICFmcmFnLmluc2VydGVkKSAmJiBlbCAhPT0gYW5jaG9yKSB7CiAgICAgIGVsID0gZWwucHJldmlvdXNTaWJsaW5nOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgICAgIGlmICghZWwpIHJldHVybjsKICAgICAgZnJhZyA9IGVsLl9fdl9mcmFnOwogICAgfQoKICAgIHJldHVybiBmcmFnOwogIH0KICAvKioKICAgKiBGaW5kIGEgdm0gZnJvbSBhIGZyYWdtZW50LgogICAqCiAgICogQHBhcmFtIHtGcmFnbWVudH0gZnJhZwogICAqIEByZXR1cm4ge1Z1ZXx1bmRlZmluZWR9CiAgICovCgoKICBmdW5jdGlvbiBmaW5kVm1Gcm9tRnJhZyhmcmFnKSB7CiAgICB2YXIgbm9kZSA9IGZyYWcubm9kZTsgLy8gaGFuZGxlIG11bHRpLW5vZGUgZnJhZwoKICAgIGlmIChmcmFnLmVuZCkgewogICAgICB3aGlsZSAoIW5vZGUuX192dWVfXyAmJiBub2RlICE9PSBmcmFnLmVuZCAmJiBub2RlLm5leHRTaWJsaW5nKSB7CiAgICAgICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmc7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gbm9kZS5fX3Z1ZV9fOwogIH0KICAvKioKICAgKiBDcmVhdGUgYSByYW5nZSBhcnJheSBmcm9tIGdpdmVuIG51bWJlci4KICAgKgogICAqIEBwYXJhbSB7TnVtYmVyfSBuCiAgICogQHJldHVybiB7QXJyYXl9CiAgICovCgoKICBmdW5jdGlvbiByYW5nZShuKSB7CiAgICB2YXIgaSA9IC0xOwogICAgdmFyIHJldCA9IG5ldyBBcnJheShNYXRoLmZsb29yKG4pKTsKCiAgICB3aGlsZSAoKytpIDwgbikgewogICAgICByZXRbaV0gPSBpOwogICAgfQoKICAgIHJldHVybiByZXQ7CiAgfQogIC8qKgogICAqIEdldCB0aGUgdHJhY2sgYnkga2V5IGZvciBhbiBpdGVtLgogICAqCiAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4CiAgICogQHBhcmFtIHtTdHJpbmd9IGtleQogICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgKiBAcGFyYW0ge1N0cmluZ30gW3RyYWNrQnlLZXldCiAgICovCgoKICBmdW5jdGlvbiBnZXRUcmFja0J5S2V5KGluZGV4LCBrZXksIHZhbHVlLCB0cmFja0J5S2V5KSB7CiAgICByZXR1cm4gdHJhY2tCeUtleSA/IHRyYWNrQnlLZXkgPT09ICckaW5kZXgnID8gaW5kZXggOiB0cmFja0J5S2V5LmNoYXJBdCgwKS5tYXRjaCgvXHcvKSA/IGdldFBhdGgodmFsdWUsIHRyYWNrQnlLZXkpIDogdmFsdWVbdHJhY2tCeUtleV0gOiBrZXkgfHwgdmFsdWU7CiAgfQoKICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICB2Rm9yLndhcm5EdXBsaWNhdGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgd2FybignRHVwbGljYXRlIHZhbHVlIGZvdW5kIGluIHYtZm9yPSInICsgdGhpcy5kZXNjcmlwdG9yLnJhdyArICciOiAnICsgSlNPTi5zdHJpbmdpZnkodmFsdWUpICsgJy4gVXNlIHRyYWNrLWJ5PSIkaW5kZXgiIGlmICcgKyAneW91IGFyZSBleHBlY3RpbmcgZHVwbGljYXRlIHZhbHVlcy4nLCB0aGlzLnZtKTsKICAgIH07CiAgfQoKICB2YXIgdklmID0gewogICAgcHJpb3JpdHk6IElGLAogICAgdGVybWluYWw6IHRydWUsCiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKCkgewogICAgICB2YXIgZWwgPSB0aGlzLmVsOwoKICAgICAgaWYgKCFlbC5fX3Z1ZV9fKSB7CiAgICAgICAgLy8gY2hlY2sgZWxzZSBibG9jawogICAgICAgIHZhciBuZXh0ID0gZWwubmV4dEVsZW1lbnRTaWJsaW5nOwoKICAgICAgICBpZiAobmV4dCAmJiBnZXRBdHRyKG5leHQsICd2LWVsc2UnKSAhPT0gbnVsbCkgewogICAgICAgICAgcmVtb3ZlKG5leHQpOwogICAgICAgICAgdGhpcy5lbHNlRWwgPSBuZXh0OwogICAgICAgIH0gLy8gY2hlY2sgbWFpbiBibG9jawoKCiAgICAgICAgdGhpcy5hbmNob3IgPSBjcmVhdGVBbmNob3IoJ3YtaWYnKTsKICAgICAgICByZXBsYWNlKGVsLCB0aGlzLmFuY2hvcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oJ3YtaWY9IicgKyB0aGlzLmV4cHJlc3Npb24gKyAnIiBjYW5ub3QgYmUgJyArICd1c2VkIG9uIGFuIGluc3RhbmNlIHJvb3QgZWxlbWVudC4nLCB0aGlzLnZtKTsKICAgICAgICB0aGlzLmludmFsaWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUodmFsdWUpIHsKICAgICAgaWYgKHRoaXMuaW52YWxpZCkgcmV0dXJuOwoKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgaWYgKCF0aGlzLmZyYWcpIHsKICAgICAgICAgIHRoaXMuaW5zZXJ0KCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0sCiAgICBpbnNlcnQ6IGZ1bmN0aW9uIGluc2VydCgpIHsKICAgICAgaWYgKHRoaXMuZWxzZUZyYWcpIHsKICAgICAgICB0aGlzLmVsc2VGcmFnLnJlbW92ZSgpOwogICAgICAgIHRoaXMuZWxzZUZyYWcgPSBudWxsOwogICAgICB9IC8vIGxhenkgaW5pdCBmYWN0b3J5CgoKICAgICAgaWYgKCF0aGlzLmZhY3RvcnkpIHsKICAgICAgICB0aGlzLmZhY3RvcnkgPSBuZXcgRnJhZ21lbnRGYWN0b3J5KHRoaXMudm0sIHRoaXMuZWwpOwogICAgICB9CgogICAgICB0aGlzLmZyYWcgPSB0aGlzLmZhY3RvcnkuY3JlYXRlKHRoaXMuX2hvc3QsIHRoaXMuX3Njb3BlLCB0aGlzLl9mcmFnKTsKICAgICAgdGhpcy5mcmFnLmJlZm9yZSh0aGlzLmFuY2hvcik7CiAgICB9LAogICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoKSB7CiAgICAgIGlmICh0aGlzLmZyYWcpIHsKICAgICAgICB0aGlzLmZyYWcucmVtb3ZlKCk7CiAgICAgICAgdGhpcy5mcmFnID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZWxzZUVsICYmICF0aGlzLmVsc2VGcmFnKSB7CiAgICAgICAgaWYgKCF0aGlzLmVsc2VGYWN0b3J5KSB7CiAgICAgICAgICB0aGlzLmVsc2VGYWN0b3J5ID0gbmV3IEZyYWdtZW50RmFjdG9yeSh0aGlzLmVsc2VFbC5fY29udGV4dCB8fCB0aGlzLnZtLCB0aGlzLmVsc2VFbCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmVsc2VGcmFnID0gdGhpcy5lbHNlRmFjdG9yeS5jcmVhdGUodGhpcy5faG9zdCwgdGhpcy5fc2NvcGUsIHRoaXMuX2ZyYWcpOwogICAgICAgIHRoaXMuZWxzZUZyYWcuYmVmb3JlKHRoaXMuYW5jaG9yKTsKICAgICAgfQogICAgfSwKICAgIHVuYmluZDogZnVuY3Rpb24gdW5iaW5kKCkgewogICAgICBpZiAodGhpcy5mcmFnKSB7CiAgICAgICAgdGhpcy5mcmFnLmRlc3Ryb3koKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZWxzZUZyYWcpIHsKICAgICAgICB0aGlzLmVsc2VGcmFnLmRlc3Ryb3koKTsKICAgICAgfQogICAgfQogIH07CiAgdmFyIHNob3cgPSB7CiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKCkgewogICAgICAvLyBjaGVjayBlbHNlIGJsb2NrCiAgICAgIHZhciBuZXh0ID0gdGhpcy5lbC5uZXh0RWxlbWVudFNpYmxpbmc7CgogICAgICBpZiAobmV4dCAmJiBnZXRBdHRyKG5leHQsICd2LWVsc2UnKSAhPT0gbnVsbCkgewogICAgICAgIHRoaXMuZWxzZUVsID0gbmV4dDsKICAgICAgfQogICAgfSwKICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHZhbHVlKSB7CiAgICAgIHRoaXMuYXBwbHkodGhpcy5lbCwgdmFsdWUpOwoKICAgICAgaWYgKHRoaXMuZWxzZUVsKSB7CiAgICAgICAgdGhpcy5hcHBseSh0aGlzLmVsc2VFbCwgIXZhbHVlKTsKICAgICAgfQogICAgfSwKICAgIGFwcGx5OiBmdW5jdGlvbiBhcHBseShlbCwgdmFsdWUpIHsKICAgICAgaWYgKGluRG9jKGVsKSkgewogICAgICAgIGFwcGx5VHJhbnNpdGlvbihlbCwgdmFsdWUgPyAxIDogLTEsIHRvZ2dsZSwgdGhpcy52bSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9nZ2xlKCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHRvZ2dsZSgpIHsKICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gdmFsdWUgPyAnJyA6ICdub25lJzsKICAgICAgfQogICAgfQogIH07CiAgdmFyIHRleHQkMiA9IHsKICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQoKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGVsID0gdGhpcy5lbDsKICAgICAgdmFyIGlzUmFuZ2UgPSBlbC50eXBlID09PSAncmFuZ2UnOwogICAgICB2YXIgbGF6eSA9IHRoaXMucGFyYW1zLmxhenk7CiAgICAgIHZhciBudW1iZXIgPSB0aGlzLnBhcmFtcy5udW1iZXI7CiAgICAgIHZhciBkZWJvdW5jZSA9IHRoaXMucGFyYW1zLmRlYm91bmNlOyAvLyBoYW5kbGUgY29tcG9zaXRpb24gZXZlbnRzLgogICAgICAvLyAgIGh0dHA6Ly9ibG9nLmV2YW55b3UubWUvMjAxNC8wMS8wMy9jb21wb3NpdGlvbi1ldmVudC8KICAgICAgLy8gc2tpcCB0aGlzIGZvciBBbmRyb2lkIGJlY2F1c2UgaXQgaGFuZGxlcyBjb21wb3NpdGlvbgogICAgICAvLyBldmVudHMgcXVpdGUgZGlmZmVyZW50bHkuIEFuZHJvaWQgZG9lc24ndCB0cmlnZ2VyCiAgICAgIC8vIGNvbXBvc2l0aW9uIGV2ZW50cyBmb3IgbGFuZ3VhZ2UgaW5wdXQgbWV0aG9kcyBlLmcuCiAgICAgIC8vIENoaW5lc2UsIGJ1dCBpbnN0ZWFkIHRyaWdnZXJzIHRoZW0gZm9yIHNwZWxsaW5nCiAgICAgIC8vIHN1Z2dlc3Rpb25zLi4uIChzZWUgRGlzY3Vzc2lvbi8jMTYyKQoKICAgICAgdmFyIGNvbXBvc2luZyA9IGZhbHNlOwoKICAgICAgaWYgKCFpc0FuZHJvaWQgJiYgIWlzUmFuZ2UpIHsKICAgICAgICB0aGlzLm9uKCdjb21wb3NpdGlvbnN0YXJ0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tcG9zaW5nID0gdHJ1ZTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLm9uKCdjb21wb3NpdGlvbmVuZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbXBvc2luZyA9IGZhbHNlOyAvLyBpbiBJRTExIHRoZSAiY29tcG9zaXRpb25lbmQiIGV2ZW50IGZpcmVzIEFGVEVSCiAgICAgICAgICAvLyB0aGUgImlucHV0IiBldmVudCwgc28gdGhlIGlucHV0IGhhbmRsZXIgaXMgYmxvY2tlZAogICAgICAgICAgLy8gYXQgdGhlIGVuZC4uLiBoYXZlIHRvIGNhbGwgaXQgaGVyZS4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyAjMTMyNzogaW4gbGF6eSBtb2RlIHRoaXMgaXMgdW5lY2Vzc2FyeS4KCiAgICAgICAgICBpZiAoIWxhenkpIHsKICAgICAgICAgICAgc2VsZi5saXN0ZW5lcigpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IC8vIHByZXZlbnQgbWVzc2luZyB3aXRoIHRoZSBpbnB1dCB3aGVuIHVzZXIgaXMgdHlwaW5nLAogICAgICAvLyBhbmQgZm9yY2UgdXBkYXRlIG9uIGJsdXIuCgoKICAgICAgdGhpcy5mb2N1c2VkID0gZmFsc2U7CgogICAgICBpZiAoIWlzUmFuZ2UgJiYgIWxhenkpIHsKICAgICAgICB0aGlzLm9uKCdmb2N1cycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHNlbGYuZm9jdXNlZCA9IHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5vbignYmx1cicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHNlbGYuZm9jdXNlZCA9IGZhbHNlOyAvLyBkbyBub3Qgc3luYyB2YWx1ZSBhZnRlciBmcmFnbWVudCByZW1vdmFsICgjMjAxNykKCiAgICAgICAgICBpZiAoIXNlbGYuX2ZyYWcgfHwgc2VsZi5fZnJhZy5pbnNlcnRlZCkgewogICAgICAgICAgICBzZWxmLnJhd0xpc3RlbmVyKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gLy8gTm93IGF0dGFjaCB0aGUgbWFpbiBsaXN0ZW5lcgoKCiAgICAgIHRoaXMubGlzdGVuZXIgPSB0aGlzLnJhd0xpc3RlbmVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChjb21wb3NpbmcgfHwgIXNlbGYuX2JvdW5kKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgdmFsID0gbnVtYmVyIHx8IGlzUmFuZ2UgPyB0b051bWJlcihlbC52YWx1ZSkgOiBlbC52YWx1ZTsKICAgICAgICBzZWxmLnNldCh2YWwpOyAvLyBmb3JjZSB1cGRhdGUgb24gbmV4dCB0aWNrIHRvIGF2b2lkIGxvY2sgJiBzYW1lIHZhbHVlCiAgICAgICAgLy8gYWxzbyBvbmx5IHVwZGF0ZSB3aGVuIHVzZXIgaXMgbm90IHR5cGluZwoKICAgICAgICBuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoc2VsZi5fYm91bmQgJiYgIXNlbGYuZm9jdXNlZCkgewogICAgICAgICAgICBzZWxmLnVwZGF0ZShzZWxmLl93YXRjaGVyLnZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfTsgLy8gYXBwbHkgZGVib3VuY2UKCgogICAgICBpZiAoZGVib3VuY2UpIHsKICAgICAgICB0aGlzLmxpc3RlbmVyID0gX2RlYm91bmNlKHRoaXMubGlzdGVuZXIsIGRlYm91bmNlKTsKICAgICAgfSAvLyBTdXBwb3J0IGpRdWVyeSBldmVudHMsIHNpbmNlIGpRdWVyeS50cmlnZ2VyKCkgZG9lc24ndAogICAgICAvLyB0cmlnZ2VyIG5hdGl2ZSBldmVudHMgaW4gc29tZSBjYXNlcyBhbmQgc29tZSBwbHVnaW5zCiAgICAgIC8vIHJlbHkgb24gJC50cmlnZ2VyKCkKICAgICAgLy8KICAgICAgLy8gV2Ugd2FudCB0byBtYWtlIHN1cmUgaWYgYSBsaXN0ZW5lciBpcyBhdHRhY2hlZCB1c2luZwogICAgICAvLyBqUXVlcnksIGl0IGlzIGFsc28gcmVtb3ZlZCB3aXRoIGpRdWVyeSwgdGhhdCdzIHdoeQogICAgICAvLyB3ZSBkbyB0aGUgY2hlY2sgZm9yIGVhY2ggZGlyZWN0aXZlIGluc3RhbmNlIGFuZAogICAgICAvLyBzdG9yZSB0aGF0IGNoZWNrIHJlc3VsdCBvbiBpdHNlbGYuIFRoaXMgYWxzbyBhbGxvd3MKICAgICAgLy8gZWFzaWVyIHRlc3QgY292ZXJhZ2UgY29udHJvbCBieSB1bnNldHRpbmcgdGhlIGdsb2JhbAogICAgICAvLyBqUXVlcnkgdmFyaWFibGUgaW4gdGVzdHMuCgoKICAgICAgdGhpcy5oYXNqUXVlcnkgPSB0eXBlb2YgalF1ZXJ5ID09PSAnZnVuY3Rpb24nOwoKICAgICAgaWYgKHRoaXMuaGFzalF1ZXJ5KSB7CiAgICAgICAgdmFyIG1ldGhvZCA9IGpRdWVyeS5mbi5vbiA/ICdvbicgOiAnYmluZCc7CiAgICAgICAgalF1ZXJ5KGVsKVttZXRob2RdKCdjaGFuZ2UnLCB0aGlzLnJhd0xpc3RlbmVyKTsKCiAgICAgICAgaWYgKCFsYXp5KSB7CiAgICAgICAgICBqUXVlcnkoZWwpW21ldGhvZF0oJ2lucHV0JywgdGhpcy5saXN0ZW5lcik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMub24oJ2NoYW5nZScsIHRoaXMucmF3TGlzdGVuZXIpOwoKICAgICAgICBpZiAoIWxhenkpIHsKICAgICAgICAgIHRoaXMub24oJ2lucHV0JywgdGhpcy5saXN0ZW5lcik7CiAgICAgICAgfQogICAgICB9IC8vIElFOSBkb2Vzbid0IGZpcmUgaW5wdXQgZXZlbnQgb24gYmFja3NwYWNlL2RlbC9jdXQKCgogICAgICBpZiAoIWxhenkgJiYgaXNJRTkpIHsKICAgICAgICB0aGlzLm9uKCdjdXQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBuZXh0VGljayhzZWxmLmxpc3RlbmVyKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLm9uKCdrZXl1cCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSA0NiB8fCBlLmtleUNvZGUgPT09IDgpIHsKICAgICAgICAgICAgc2VsZi5saXN0ZW5lcigpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IC8vIHNldCBpbml0aWFsIHZhbHVlIGlmIHByZXNlbnQKCgogICAgICBpZiAoZWwuaGFzQXR0cmlidXRlKCd2YWx1ZScpIHx8IGVsLnRhZ05hbWUgPT09ICdURVhUQVJFQScgJiYgZWwudmFsdWUudHJpbSgpKSB7CiAgICAgICAgdGhpcy5hZnRlckJpbmQgPSB0aGlzLmxpc3RlbmVyOwogICAgICB9CiAgICB9LAogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUodmFsdWUpIHsKICAgICAgLy8gIzMwMjkgb25seSB1cGRhdGUgd2hlbiB0aGUgdmFsdWUgY2hhbmdlcy4gVGhpcyBwcmV2ZW50CiAgICAgIC8vIGJyb3dzZXJzIGZyb20gb3ZlcndyaXRpbmcgdmFsdWVzIGxpa2Ugc2VsZWN0aW9uU3RhcnQKICAgICAgdmFsdWUgPSBfdG9TdHJpbmcodmFsdWUpOwogICAgICBpZiAodmFsdWUgIT09IHRoaXMuZWwudmFsdWUpIHRoaXMuZWwudmFsdWUgPSB2YWx1ZTsKICAgIH0sCiAgICB1bmJpbmQ6IGZ1bmN0aW9uIHVuYmluZCgpIHsKICAgICAgdmFyIGVsID0gdGhpcy5lbDsKCiAgICAgIGlmICh0aGlzLmhhc2pRdWVyeSkgewogICAgICAgIHZhciBtZXRob2QgPSBqUXVlcnkuZm4ub2ZmID8gJ29mZicgOiAndW5iaW5kJzsKICAgICAgICBqUXVlcnkoZWwpW21ldGhvZF0oJ2NoYW5nZScsIHRoaXMubGlzdGVuZXIpOwogICAgICAgIGpRdWVyeShlbClbbWV0aG9kXSgnaW5wdXQnLCB0aGlzLmxpc3RlbmVyKTsKICAgICAgfQogICAgfQogIH07CiAgdmFyIHJhZGlvID0gewogICAgYmluZDogZnVuY3Rpb24gYmluZCgpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgZWwgPSB0aGlzLmVsOwoKICAgICAgdGhpcy5nZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyB2YWx1ZSBvdmVyd3JpdGUgdmlhIHYtYmluZDp2YWx1ZQogICAgICAgIGlmIChlbC5oYXNPd25Qcm9wZXJ0eSgnX3ZhbHVlJykpIHsKICAgICAgICAgIHJldHVybiBlbC5fdmFsdWU7CiAgICAgICAgfQoKICAgICAgICB2YXIgdmFsID0gZWwudmFsdWU7CgogICAgICAgIGlmIChzZWxmLnBhcmFtcy5udW1iZXIpIHsKICAgICAgICAgIHZhbCA9IHRvTnVtYmVyKHZhbCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdmFsOwogICAgICB9OwoKICAgICAgdGhpcy5saXN0ZW5lciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBzZWxmLnNldChzZWxmLmdldFZhbHVlKCkpOwogICAgICB9OwoKICAgICAgdGhpcy5vbignY2hhbmdlJywgdGhpcy5saXN0ZW5lcik7CgogICAgICBpZiAoZWwuaGFzQXR0cmlidXRlKCdjaGVja2VkJykpIHsKICAgICAgICB0aGlzLmFmdGVyQmluZCA9IHRoaXMubGlzdGVuZXI7CiAgICAgIH0KICAgIH0sCiAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZSh2YWx1ZSkgewogICAgICB0aGlzLmVsLmNoZWNrZWQgPSBsb29zZUVxdWFsKHZhbHVlLCB0aGlzLmdldFZhbHVlKCkpOwogICAgfQogIH07CiAgdmFyIHNlbGVjdCA9IHsKICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBlbCA9IHRoaXMuZWw7IC8vIG1ldGhvZCB0byBmb3JjZSB1cGRhdGUgRE9NIHVzaW5nIGxhdGVzdCB2YWx1ZS4KCiAgICAgIHRoaXMuZm9yY2VVcGRhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHNlbGYuX3dhdGNoZXIpIHsKICAgICAgICAgIHNlbGYudXBkYXRlKHNlbGYuX3dhdGNoZXIuZ2V0KCkpOwogICAgICAgIH0KICAgICAgfTsgLy8gY2hlY2sgaWYgdGhpcyBpcyBhIG11bHRpcGxlIHNlbGVjdAoKCiAgICAgIHZhciBtdWx0aXBsZSA9IHRoaXMubXVsdGlwbGUgPSBlbC5oYXNBdHRyaWJ1dGUoJ211bHRpcGxlJyk7IC8vIGF0dGFjaCBsaXN0ZW5lcgoKICAgICAgdGhpcy5saXN0ZW5lciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdmFsdWUgPSBnZXRWYWx1ZShlbCwgbXVsdGlwbGUpOwogICAgICAgIHZhbHVlID0gc2VsZi5wYXJhbXMubnVtYmVyID8gaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAodG9OdW1iZXIpIDogdG9OdW1iZXIodmFsdWUpIDogdmFsdWU7CiAgICAgICAgc2VsZi5zZXQodmFsdWUpOwogICAgICB9OwoKICAgICAgdGhpcy5vbignY2hhbmdlJywgdGhpcy5saXN0ZW5lcik7IC8vIGlmIGhhcyBpbml0aWFsIHZhbHVlLCBzZXQgYWZ0ZXJCaW5kCgogICAgICB2YXIgaW5pdFZhbHVlID0gZ2V0VmFsdWUoZWwsIG11bHRpcGxlLCB0cnVlKTsKCiAgICAgIGlmIChtdWx0aXBsZSAmJiBpbml0VmFsdWUubGVuZ3RoIHx8ICFtdWx0aXBsZSAmJiBpbml0VmFsdWUgIT09IG51bGwpIHsKICAgICAgICB0aGlzLmFmdGVyQmluZCA9IHRoaXMubGlzdGVuZXI7CiAgICAgIH0gLy8gQWxsIG1ham9yIGJyb3dzZXJzIGV4Y2VwdCBGaXJlZm94IHJlc2V0cwogICAgICAvLyBzZWxlY3RlZEluZGV4IHdpdGggdmFsdWUgLTEgdG8gMCB3aGVuIHRoZSBlbGVtZW50CiAgICAgIC8vIGlzIGFwcGVuZGVkIHRvIGEgbmV3IHBhcmVudCwgdGhlcmVmb3JlIHdlIGhhdmUgdG8KICAgICAgLy8gZm9yY2UgYSBET00gdXBkYXRlIHdoZW5ldmVyIHRoYXQgaGFwcGVucy4uLgoKCiAgICAgIHRoaXMudm0uJG9uKCdob29rOmF0dGFjaGVkJywgZnVuY3Rpb24gKCkgewogICAgICAgIG5leHRUaWNrKF90aGlzLmZvcmNlVXBkYXRlKTsKICAgICAgfSk7CgogICAgICBpZiAoIWluRG9jKGVsKSkgewogICAgICAgIG5leHRUaWNrKHRoaXMuZm9yY2VVcGRhdGUpOwogICAgICB9CiAgICB9LAogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUodmFsdWUpIHsKICAgICAgdmFyIGVsID0gdGhpcy5lbDsKICAgICAgZWwuc2VsZWN0ZWRJbmRleCA9IC0xOwogICAgICB2YXIgbXVsdGkgPSB0aGlzLm11bHRpcGxlICYmIGlzQXJyYXkodmFsdWUpOwogICAgICB2YXIgb3B0aW9ucyA9IGVsLm9wdGlvbnM7CiAgICAgIHZhciBpID0gb3B0aW9ucy5sZW5ndGg7CiAgICAgIHZhciBvcCwgdmFsOwoKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIG9wID0gb3B0aW9uc1tpXTsKICAgICAgICB2YWwgPSBvcC5oYXNPd25Qcm9wZXJ0eSgnX3ZhbHVlJykgPyBvcC5fdmFsdWUgOiBvcC52YWx1ZTsKICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBlcWVxZXEgKi8KCiAgICAgICAgb3Auc2VsZWN0ZWQgPSBtdWx0aSA/IGluZGV4T2YkMSh2YWx1ZSwgdmFsKSA+IC0xIDogbG9vc2VFcXVhbCh2YWx1ZSwgdmFsKTsKICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIGVxZXFlcSAqLwogICAgICB9CiAgICB9LAogICAgdW5iaW5kOiBmdW5jdGlvbiB1bmJpbmQoKSB7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgIHRoaXMudm0uJG9mZignaG9vazphdHRhY2hlZCcsIHRoaXMuZm9yY2VVcGRhdGUpOwogICAgfQogIH07CiAgLyoqCiAgICogR2V0IHNlbGVjdCB2YWx1ZQogICAqCiAgICogQHBhcmFtIHtTZWxlY3RFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7Qm9vbGVhbn0gbXVsdGkKICAgKiBAcGFyYW0ge0Jvb2xlYW59IGluaXQKICAgKiBAcmV0dXJuIHtBcnJheXwqfQogICAqLwoKICBmdW5jdGlvbiBnZXRWYWx1ZShlbCwgbXVsdGksIGluaXQpIHsKICAgIHZhciByZXMgPSBtdWx0aSA/IFtdIDogbnVsbDsKICAgIHZhciBvcCwgdmFsLCBzZWxlY3RlZDsKCiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGVsLm9wdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIG9wID0gZWwub3B0aW9uc1tpXTsKICAgICAgc2VsZWN0ZWQgPSBpbml0ID8gb3AuaGFzQXR0cmlidXRlKCdzZWxlY3RlZCcpIDogb3Auc2VsZWN0ZWQ7CgogICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICB2YWwgPSBvcC5oYXNPd25Qcm9wZXJ0eSgnX3ZhbHVlJykgPyBvcC5fdmFsdWUgOiBvcC52YWx1ZTsKCiAgICAgICAgaWYgKG11bHRpKSB7CiAgICAgICAgICByZXMucHVzaCh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXM7CiAgfQogIC8qKgogICAqIE5hdGl2ZSBBcnJheS5pbmRleE9mIHVzZXMgc3RyaWN0IGVxdWFsLCBidXQgaW4gdGhpcwogICAqIGNhc2Ugd2UgbmVlZCB0byBtYXRjaCBzdHJpbmcvbnVtYmVycyB3aXRoIGN1c3RvbSBlcXVhbC4KICAgKgogICAqIEBwYXJhbSB7QXJyYXl9IGFycgogICAqIEBwYXJhbSB7Kn0gdmFsCiAgICovCgoKICBmdW5jdGlvbiBpbmRleE9mJDEoYXJyLCB2YWwpIHsKICAgIHZhciBpID0gYXJyLmxlbmd0aDsKCiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIGlmIChsb29zZUVxdWFsKGFycltpXSwgdmFsKSkgewogICAgICAgIHJldHVybiBpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIC0xOwogIH0KCiAgdmFyIGNoZWNrYm94ID0gewogICAgYmluZDogZnVuY3Rpb24gYmluZCgpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgZWwgPSB0aGlzLmVsOwoKICAgICAgdGhpcy5nZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gZWwuaGFzT3duUHJvcGVydHkoJ192YWx1ZScpID8gZWwuX3ZhbHVlIDogc2VsZi5wYXJhbXMubnVtYmVyID8gdG9OdW1iZXIoZWwudmFsdWUpIDogZWwudmFsdWU7CiAgICAgIH07CgogICAgICBmdW5jdGlvbiBnZXRCb29sZWFuVmFsdWUoKSB7CiAgICAgICAgdmFyIHZhbCA9IGVsLmNoZWNrZWQ7CgogICAgICAgIGlmICh2YWwgJiYgZWwuaGFzT3duUHJvcGVydHkoJ190cnVlVmFsdWUnKSkgewogICAgICAgICAgcmV0dXJuIGVsLl90cnVlVmFsdWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXZhbCAmJiBlbC5oYXNPd25Qcm9wZXJ0eSgnX2ZhbHNlVmFsdWUnKSkgewogICAgICAgICAgcmV0dXJuIGVsLl9mYWxzZVZhbHVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgfQoKICAgICAgdGhpcy5saXN0ZW5lciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbW9kZWwgPSBzZWxmLl93YXRjaGVyLnZhbHVlOwoKICAgICAgICBpZiAoaXNBcnJheShtb2RlbCkpIHsKICAgICAgICAgIHZhciB2YWwgPSBzZWxmLmdldFZhbHVlKCk7CgogICAgICAgICAgaWYgKGVsLmNoZWNrZWQpIHsKICAgICAgICAgICAgaWYgKGluZGV4T2YobW9kZWwsIHZhbCkgPCAwKSB7CiAgICAgICAgICAgICAgbW9kZWwucHVzaCh2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtb2RlbC4kcmVtb3ZlKHZhbCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlbGYuc2V0KGdldEJvb2xlYW5WYWx1ZSgpKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICB0aGlzLm9uKCdjaGFuZ2UnLCB0aGlzLmxpc3RlbmVyKTsKCiAgICAgIGlmIChlbC5oYXNBdHRyaWJ1dGUoJ2NoZWNrZWQnKSkgewogICAgICAgIHRoaXMuYWZ0ZXJCaW5kID0gdGhpcy5saXN0ZW5lcjsKICAgICAgfQogICAgfSwKICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHZhbHVlKSB7CiAgICAgIHZhciBlbCA9IHRoaXMuZWw7CgogICAgICBpZiAoaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICBlbC5jaGVja2VkID0gaW5kZXhPZih2YWx1ZSwgdGhpcy5nZXRWYWx1ZSgpKSA+IC0xOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChlbC5oYXNPd25Qcm9wZXJ0eSgnX3RydWVWYWx1ZScpKSB7CiAgICAgICAgICBlbC5jaGVja2VkID0gbG9vc2VFcXVhbCh2YWx1ZSwgZWwuX3RydWVWYWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGVsLmNoZWNrZWQgPSAhIXZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CiAgdmFyIGhhbmRsZXJzID0gewogICAgdGV4dDogdGV4dCQyLAogICAgcmFkaW86IHJhZGlvLAogICAgc2VsZWN0OiBzZWxlY3QsCiAgICBjaGVja2JveDogY2hlY2tib3gKICB9OwogIHZhciBtb2RlbCA9IHsKICAgIHByaW9yaXR5OiBNT0RFTCwKICAgIHR3b1dheTogdHJ1ZSwKICAgIGhhbmRsZXJzOiBoYW5kbGVycywKICAgIHBhcmFtczogWydsYXp5JywgJ251bWJlcicsICdkZWJvdW5jZSddLAoKICAgIC8qKgogICAgICogUG9zc2libGUgZWxlbWVudHM6CiAgICAgKiAgIDxzZWxlY3Q+CiAgICAgKiAgIDx0ZXh0YXJlYT4KICAgICAqICAgPGlucHV0IHR5cGU9IioiPgogICAgICogICAgIC0gdGV4dAogICAgICogICAgIC0gY2hlY2tib3gKICAgICAqICAgICAtIHJhZGlvCiAgICAgKiAgICAgLSBudW1iZXIKICAgICAqLwogICAgYmluZDogZnVuY3Rpb24gYmluZCgpIHsKICAgICAgLy8gZnJpZW5kbHkgd2FybmluZy4uLgogICAgICB0aGlzLmNoZWNrRmlsdGVycygpOwoKICAgICAgaWYgKHRoaXMuaGFzUmVhZCAmJiAhdGhpcy5oYXNXcml0ZSkgewogICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdJdCBzZWVtcyB5b3UgYXJlIHVzaW5nIGEgcmVhZC1vbmx5IGZpbHRlciB3aXRoICcgKyAndi1tb2RlbD0iJyArIHRoaXMuZGVzY3JpcHRvci5yYXcgKyAnIi4gJyArICdZb3UgbWlnaHQgd2FudCB0byB1c2UgYSB0d28td2F5IGZpbHRlciB0byBlbnN1cmUgY29ycmVjdCBiZWhhdmlvci4nLCB0aGlzLnZtKTsKICAgICAgfQoKICAgICAgdmFyIGVsID0gdGhpcy5lbDsKICAgICAgdmFyIHRhZyA9IGVsLnRhZ05hbWU7CiAgICAgIHZhciBoYW5kbGVyOwoKICAgICAgaWYgKHRhZyA9PT0gJ0lOUFVUJykgewogICAgICAgIGhhbmRsZXIgPSBoYW5kbGVyc1tlbC50eXBlXSB8fCBoYW5kbGVycy50ZXh0OwogICAgICB9IGVsc2UgaWYgKHRhZyA9PT0gJ1NFTEVDVCcpIHsKICAgICAgICBoYW5kbGVyID0gaGFuZGxlcnMuc2VsZWN0OwogICAgICB9IGVsc2UgaWYgKHRhZyA9PT0gJ1RFWFRBUkVBJykgewogICAgICAgIGhhbmRsZXIgPSBoYW5kbGVycy50ZXh0OwogICAgICB9IGVsc2UgewogICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCd2LW1vZGVsIGRvZXMgbm90IHN1cHBvcnQgZWxlbWVudCB0eXBlOiAnICsgdGFnLCB0aGlzLnZtKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGVsLl9fdl9tb2RlbCA9IHRoaXM7CiAgICAgIGhhbmRsZXIuYmluZC5jYWxsKHRoaXMpOwogICAgICB0aGlzLnVwZGF0ZSA9IGhhbmRsZXIudXBkYXRlOwogICAgICB0aGlzLl91bmJpbmQgPSBoYW5kbGVyLnVuYmluZDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayByZWFkL3dyaXRlIGZpbHRlciBzdGF0cy4KICAgICAqLwogICAgY2hlY2tGaWx0ZXJzOiBmdW5jdGlvbiBjaGVja0ZpbHRlcnMoKSB7CiAgICAgIHZhciBmaWx0ZXJzID0gdGhpcy5maWx0ZXJzOwogICAgICBpZiAoIWZpbHRlcnMpIHJldHVybjsKICAgICAgdmFyIGkgPSBmaWx0ZXJzLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB2YXIgZmlsdGVyID0gcmVzb2x2ZUFzc2V0KHRoaXMudm0uJG9wdGlvbnMsICdmaWx0ZXJzJywgZmlsdGVyc1tpXS5uYW1lKTsKCiAgICAgICAgaWYgKHR5cGVvZiBmaWx0ZXIgPT09ICdmdW5jdGlvbicgfHwgZmlsdGVyLnJlYWQpIHsKICAgICAgICAgIHRoaXMuaGFzUmVhZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmlsdGVyLndyaXRlKSB7CiAgICAgICAgICB0aGlzLmhhc1dyaXRlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICB1bmJpbmQ6IGZ1bmN0aW9uIHVuYmluZCgpIHsKICAgICAgdGhpcy5lbC5fX3ZfbW9kZWwgPSBudWxsOwogICAgICB0aGlzLl91bmJpbmQgJiYgdGhpcy5fdW5iaW5kKCk7CiAgICB9CiAgfTsgLy8ga2V5Q29kZSBhbGlhc2VzCgogIHZhciBrZXlDb2RlcyA9IHsKICAgIGVzYzogMjcsCiAgICB0YWI6IDksCiAgICBlbnRlcjogMTMsCiAgICBzcGFjZTogMzIsCiAgICAnZGVsZXRlJzogWzgsIDQ2XSwKICAgIHVwOiAzOCwKICAgIGxlZnQ6IDM3LAogICAgcmlnaHQ6IDM5LAogICAgZG93bjogNDAKICB9OwoKICBmdW5jdGlvbiBrZXlGaWx0ZXIoaGFuZGxlciwga2V5cykgewogICAgdmFyIGNvZGVzID0ga2V5cy5tYXAoZnVuY3Rpb24gKGtleSkgewogICAgICB2YXIgY2hhckNvZGUgPSBrZXkuY2hhckNvZGVBdCgwKTsKCiAgICAgIGlmIChjaGFyQ29kZSA+IDQ3ICYmIGNoYXJDb2RlIDwgNTgpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQoa2V5LCAxMCk7CiAgICAgIH0KCiAgICAgIGlmIChrZXkubGVuZ3RoID09PSAxKSB7CiAgICAgICAgY2hhckNvZGUgPSBrZXkudG9VcHBlckNhc2UoKS5jaGFyQ29kZUF0KDApOwoKICAgICAgICBpZiAoY2hhckNvZGUgPiA2NCAmJiBjaGFyQ29kZSA8IDkxKSB7CiAgICAgICAgICByZXR1cm4gY2hhckNvZGU7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4ga2V5Q29kZXNba2V5XTsKICAgIH0pOwogICAgY29kZXMgPSBbXS5jb25jYXQuYXBwbHkoW10sIGNvZGVzKTsKICAgIHJldHVybiBmdW5jdGlvbiBrZXlIYW5kbGVyKGUpIHsKICAgICAgaWYgKGNvZGVzLmluZGV4T2YoZS5rZXlDb2RlKSA+IC0xKSB7CiAgICAgICAgcmV0dXJuIGhhbmRsZXIuY2FsbCh0aGlzLCBlKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIHN0b3BGaWx0ZXIoaGFuZGxlcikgewogICAgcmV0dXJuIGZ1bmN0aW9uIHN0b3BIYW5kbGVyKGUpIHsKICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgcmV0dXJuIGhhbmRsZXIuY2FsbCh0aGlzLCBlKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBwcmV2ZW50RmlsdGVyKGhhbmRsZXIpIHsKICAgIHJldHVybiBmdW5jdGlvbiBwcmV2ZW50SGFuZGxlcihlKSB7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgcmV0dXJuIGhhbmRsZXIuY2FsbCh0aGlzLCBlKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBzZWxmRmlsdGVyKGhhbmRsZXIpIHsKICAgIHJldHVybiBmdW5jdGlvbiBzZWxmSGFuZGxlcihlKSB7CiAgICAgIGlmIChlLnRhcmdldCA9PT0gZS5jdXJyZW50VGFyZ2V0KSB7CiAgICAgICAgcmV0dXJuIGhhbmRsZXIuY2FsbCh0aGlzLCBlKTsKICAgICAgfQogICAgfTsKICB9CgogIHZhciBvbiQxID0gewogICAgcHJpb3JpdHk6IE9OLAogICAgYWNjZXB0U3RhdGVtZW50OiB0cnVlLAogICAga2V5Q29kZXM6IGtleUNvZGVzLAogICAgYmluZDogZnVuY3Rpb24gYmluZCgpIHsKICAgICAgLy8gZGVhbCB3aXRoIGlmcmFtZXMKICAgICAgaWYgKHRoaXMuZWwudGFnTmFtZSA9PT0gJ0lGUkFNRScgJiYgdGhpcy5hcmcgIT09ICdsb2FkJykgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdGhpcy5pZnJhbWVCaW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgb24oc2VsZi5lbC5jb250ZW50V2luZG93LCBzZWxmLmFyZywgc2VsZi5oYW5kbGVyLCBzZWxmLm1vZGlmaWVycy5jYXB0dXJlKTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLm9uKCdsb2FkJywgdGhpcy5pZnJhbWVCaW5kKTsKICAgICAgfQogICAgfSwKICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKGhhbmRsZXIpIHsKICAgICAgLy8gc3R1YiBhIG5vb3AgZm9yIHYtb24gd2l0aCBubyB2YWx1ZSwKICAgICAgLy8gZS5nLiBAbW91c2Vkb3duLnByZXZlbnQKICAgICAgaWYgKCF0aGlzLmRlc2NyaXB0b3IucmF3KSB7CiAgICAgICAgaGFuZGxlciA9IGZ1bmN0aW9uIGhhbmRsZXIoKSB7fTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBoYW5kbGVyICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oJ3Ytb246JyArIHRoaXMuYXJnICsgJz0iJyArIHRoaXMuZXhwcmVzc2lvbiArICciIGV4cGVjdHMgYSBmdW5jdGlvbiB2YWx1ZSwgJyArICdnb3QgJyArIGhhbmRsZXIsIHRoaXMudm0pOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBhcHBseSBtb2RpZmllcnMKCgogICAgICBpZiAodGhpcy5tb2RpZmllcnMuc3RvcCkgewogICAgICAgIGhhbmRsZXIgPSBzdG9wRmlsdGVyKGhhbmRsZXIpOwogICAgICB9CgogICAgICBpZiAodGhpcy5tb2RpZmllcnMucHJldmVudCkgewogICAgICAgIGhhbmRsZXIgPSBwcmV2ZW50RmlsdGVyKGhhbmRsZXIpOwogICAgICB9CgogICAgICBpZiAodGhpcy5tb2RpZmllcnMuc2VsZikgewogICAgICAgIGhhbmRsZXIgPSBzZWxmRmlsdGVyKGhhbmRsZXIpOwogICAgICB9IC8vIGtleSBmaWx0ZXIKCgogICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMubW9kaWZpZXJzKS5maWx0ZXIoZnVuY3Rpb24gKGtleSkgewogICAgICAgIHJldHVybiBrZXkgIT09ICdzdG9wJyAmJiBrZXkgIT09ICdwcmV2ZW50JyAmJiBrZXkgIT09ICdzZWxmJyAmJiBrZXkgIT09ICdjYXB0dXJlJzsKICAgICAgfSk7CgogICAgICBpZiAoa2V5cy5sZW5ndGgpIHsKICAgICAgICBoYW5kbGVyID0ga2V5RmlsdGVyKGhhbmRsZXIsIGtleXMpOwogICAgICB9CgogICAgICB0aGlzLnJlc2V0KCk7CiAgICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7CgogICAgICBpZiAodGhpcy5pZnJhbWVCaW5kKSB7CiAgICAgICAgdGhpcy5pZnJhbWVCaW5kKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb24odGhpcy5lbCwgdGhpcy5hcmcsIHRoaXMuaGFuZGxlciwgdGhpcy5tb2RpZmllcnMuY2FwdHVyZSk7CiAgICAgIH0KICAgIH0sCiAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7CiAgICAgIHZhciBlbCA9IHRoaXMuaWZyYW1lQmluZCA/IHRoaXMuZWwuY29udGVudFdpbmRvdyA6IHRoaXMuZWw7CgogICAgICBpZiAodGhpcy5oYW5kbGVyKSB7CiAgICAgICAgb2ZmKGVsLCB0aGlzLmFyZywgdGhpcy5oYW5kbGVyKTsKICAgICAgfQogICAgfSwKICAgIHVuYmluZDogZnVuY3Rpb24gdW5iaW5kKCkgewogICAgICB0aGlzLnJlc2V0KCk7CiAgICB9CiAgfTsKICB2YXIgcHJlZml4ZXMgPSBbJy13ZWJraXQtJywgJy1tb3otJywgJy1tcy0nXTsKICB2YXIgY2FtZWxQcmVmaXhlcyA9IFsnV2Via2l0JywgJ01veicsICdtcyddOwogIHZhciBpbXBvcnRhbnRSRSA9IC8haW1wb3J0YW50Oz8kLzsKICB2YXIgcHJvcENhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB2YXIgdGVzdEVsID0gbnVsbDsKICB2YXIgc3R5bGUgPSB7CiAgICBkZWVwOiB0cnVlLAogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUodmFsdWUpIHsKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICB0aGlzLmVsLnN0eWxlLmNzc1RleHQgPSB2YWx1ZTsKICAgICAgfSBlbHNlIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICAgIHRoaXMuaGFuZGxlT2JqZWN0KHZhbHVlLnJlZHVjZShleHRlbmQsIHt9KSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5oYW5kbGVPYmplY3QodmFsdWUgfHwge30pOwogICAgICB9CiAgICB9LAogICAgaGFuZGxlT2JqZWN0OiBmdW5jdGlvbiBoYW5kbGVPYmplY3QodmFsdWUpIHsKICAgICAgLy8gY2FjaGUgb2JqZWN0IHN0eWxlcyBzbyB0aGF0IG9ubHkgY2hhbmdlZCBwcm9wcwogICAgICAvLyBhcmUgYWN0dWFsbHkgdXBkYXRlZC4KICAgICAgdmFyIGNhY2hlID0gdGhpcy5jYWNoZSB8fCAodGhpcy5jYWNoZSA9IHt9KTsKICAgICAgdmFyIG5hbWUsIHZhbDsKCiAgICAgIGZvciAobmFtZSBpbiBjYWNoZSkgewogICAgICAgIGlmICghKG5hbWUgaW4gdmFsdWUpKSB7CiAgICAgICAgICB0aGlzLmhhbmRsZVNpbmdsZShuYW1lLCBudWxsKTsKICAgICAgICAgIGRlbGV0ZSBjYWNoZVtuYW1lXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobmFtZSBpbiB2YWx1ZSkgewogICAgICAgIHZhbCA9IHZhbHVlW25hbWVdOwoKICAgICAgICBpZiAodmFsICE9PSBjYWNoZVtuYW1lXSkgewogICAgICAgICAgY2FjaGVbbmFtZV0gPSB2YWw7CiAgICAgICAgICB0aGlzLmhhbmRsZVNpbmdsZShuYW1lLCB2YWwpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGhhbmRsZVNpbmdsZTogZnVuY3Rpb24gaGFuZGxlU2luZ2xlKHByb3AsIHZhbHVlKSB7CiAgICAgIHByb3AgPSBub3JtYWxpemUocHJvcCk7CiAgICAgIGlmICghcHJvcCkgcmV0dXJuOyAvLyB1bnN1cHBvcnRlZCBwcm9wCiAgICAgIC8vIGNhc3QgcG9zc2libGUgbnVtYmVycy9ib29sZWFucyBpbnRvIHN0cmluZ3MKCiAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB2YWx1ZSArPSAnJzsKCiAgICAgIGlmICh2YWx1ZSkgewogICAgICAgIHZhciBpc0ltcG9ydGFudCA9IGltcG9ydGFudFJFLnRlc3QodmFsdWUpID8gJ2ltcG9ydGFudCcgOiAnJzsKCiAgICAgICAgaWYgKGlzSW1wb3J0YW50KSB7CiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgd2FybignSXRcJ3MgcHJvYmFibHkgYSBiYWQgaWRlYSB0byB1c2UgIWltcG9ydGFudCB3aXRoIGlubGluZSBydWxlcy4gJyArICdUaGlzIGZlYXR1cmUgd2lsbCBiZSBkZXByZWNhdGVkIGluIGEgZnV0dXJlIHZlcnNpb24gb2YgVnVlLicpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZShpbXBvcnRhbnRSRSwgJycpLnRyaW0oKTsKICAgICAgICAgIHRoaXMuZWwuc3R5bGUuc2V0UHJvcGVydHkocHJvcC5rZWJhYiwgdmFsdWUsIGlzSW1wb3J0YW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5lbC5zdHlsZVtwcm9wLmNhbWVsXSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVsLnN0eWxlW3Byb3AuY2FtZWxdID0gJyc7CiAgICAgIH0KICAgIH0KICB9OwogIC8qKgogICAqIE5vcm1hbGl6ZSBhIENTUyBwcm9wZXJ0eSBuYW1lLgogICAqIC0gY2FjaGUgcmVzdWx0CiAgICogLSBhdXRvIHByZWZpeAogICAqIC0gY2FtZWxDYXNlIC0+IGRhc2gtY2FzZQogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHByb3AKICAgKiBAcmV0dXJuIHtTdHJpbmd9CiAgICovCgogIGZ1bmN0aW9uIG5vcm1hbGl6ZShwcm9wKSB7CiAgICBpZiAocHJvcENhY2hlW3Byb3BdKSB7CiAgICAgIHJldHVybiBwcm9wQ2FjaGVbcHJvcF07CiAgICB9CgogICAgdmFyIHJlcyA9IHByZWZpeChwcm9wKTsKICAgIHByb3BDYWNoZVtwcm9wXSA9IHByb3BDYWNoZVtyZXNdID0gcmVzOwogICAgcmV0dXJuIHJlczsKICB9CiAgLyoqCiAgICogQXV0byBkZXRlY3QgdGhlIGFwcHJvcHJpYXRlIHByZWZpeCBmb3IgYSBDU1MgcHJvcGVydHkuCiAgICogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vcGF1bGlyaXNoLzUyMzY5MgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHByb3AKICAgKiBAcmV0dXJuIHtTdHJpbmd9CiAgICovCgoKICBmdW5jdGlvbiBwcmVmaXgocHJvcCkgewogICAgcHJvcCA9IGh5cGhlbmF0ZShwcm9wKTsKICAgIHZhciBjYW1lbCA9IGNhbWVsaXplKHByb3ApOwogICAgdmFyIHVwcGVyID0gY2FtZWwuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBjYW1lbC5zbGljZSgxKTsKCiAgICBpZiAoIXRlc3RFbCkgewogICAgICB0ZXN0RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIH0KCiAgICB2YXIgaSA9IHByZWZpeGVzLmxlbmd0aDsKICAgIHZhciBwcmVmaXhlZDsKCiAgICBpZiAoY2FtZWwgIT09ICdmaWx0ZXInICYmIGNhbWVsIGluIHRlc3RFbC5zdHlsZSkgewogICAgICByZXR1cm4gewogICAgICAgIGtlYmFiOiBwcm9wLAogICAgICAgIGNhbWVsOiBjYW1lbAogICAgICB9OwogICAgfQoKICAgIHdoaWxlIChpLS0pIHsKICAgICAgcHJlZml4ZWQgPSBjYW1lbFByZWZpeGVzW2ldICsgdXBwZXI7CgogICAgICBpZiAocHJlZml4ZWQgaW4gdGVzdEVsLnN0eWxlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGtlYmFiOiBwcmVmaXhlc1tpXSArIHByb3AsCiAgICAgICAgICBjYW1lbDogcHJlZml4ZWQKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgfSAvLyB4bGluawoKCiAgdmFyIHhsaW5rTlMgPSAnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayc7CiAgdmFyIHhsaW5rUkUgPSAvXnhsaW5rOi87IC8vIGNoZWNrIGZvciBhdHRyaWJ1dGVzIHRoYXQgcHJvaGliaXQgaW50ZXJwb2xhdGlvbnMKCiAgdmFyIGRpc2FsbG93ZWRJbnRlcnBBdHRyUkUgPSAvXnYtfF46fF5AfF4oPzppc3x0cmFuc2l0aW9ufHRyYW5zaXRpb24tbW9kZXxkZWJvdW5jZXx0cmFjay1ieXxzdGFnZ2VyfGVudGVyLXN0YWdnZXJ8bGVhdmUtc3RhZ2dlcikkLzsgLy8gdGhlc2UgYXR0cmlidXRlcyBzaG91bGQgYWxzbyBzZXQgdGhlaXIgY29ycmVzcG9uZGluZyBwcm9wZXJ0aWVzCiAgLy8gYmVjYXVzZSB0aGV5IG9ubHkgYWZmZWN0IHRoZSBpbml0aWFsIHN0YXRlIG9mIHRoZSBlbGVtZW50CgogIHZhciBhdHRyV2l0aFByb3BzUkUgPSAvXig/OnZhbHVlfGNoZWNrZWR8c2VsZWN0ZWR8bXV0ZWQpJC87IC8vIHRoZXNlIGF0dHJpYnV0ZXMgZXhwZWN0IGVudW1yYXRlZCB2YWx1ZXMgb2YgInRydWUiIG9yICJmYWxzZSIKICAvLyBidXQgYXJlIG5vdCBib29sZWFuIGF0dHJpYnV0ZXMKCiAgdmFyIGVudW1lcmF0ZWRBdHRyUkUgPSAvXig/OmRyYWdnYWJsZXxjb250ZW50ZWRpdGFibGV8c3BlbGxjaGVjaykkLzsgLy8gdGhlc2UgYXR0cmlidXRlcyBzaG91bGQgc2V0IGEgaGlkZGVuIHByb3BlcnR5IGZvcgogIC8vIGJpbmRpbmcgdi1tb2RlbCB0byBvYmplY3QgdmFsdWVzCgogIHZhciBtb2RlbFByb3BzID0gewogICAgdmFsdWU6ICdfdmFsdWUnLAogICAgJ3RydWUtdmFsdWUnOiAnX3RydWVWYWx1ZScsCiAgICAnZmFsc2UtdmFsdWUnOiAnX2ZhbHNlVmFsdWUnCiAgfTsKICB2YXIgYmluZCQxID0gewogICAgcHJpb3JpdHk6IEJJTkQsCiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKCkgewogICAgICB2YXIgYXR0ciA9IHRoaXMuYXJnOwogICAgICB2YXIgdGFnID0gdGhpcy5lbC50YWdOYW1lOyAvLyBzaG91bGQgYmUgZGVlcCB3YXRjaCBvbiBvYmplY3QgbW9kZQoKICAgICAgaWYgKCFhdHRyKSB7CiAgICAgICAgdGhpcy5kZWVwID0gdHJ1ZTsKICAgICAgfSAvLyBoYW5kbGUgaW50ZXJwb2xhdGlvbiBiaW5kaW5ncwoKCiAgICAgIHZhciBkZXNjcmlwdG9yID0gdGhpcy5kZXNjcmlwdG9yOwogICAgICB2YXIgdG9rZW5zID0gZGVzY3JpcHRvci5pbnRlcnA7CgogICAgICBpZiAodG9rZW5zKSB7CiAgICAgICAgLy8gaGFuZGxlIGludGVycG9sYXRpb25zIHdpdGggb25lLXRpbWUgdG9rZW5zCiAgICAgICAgaWYgKGRlc2NyaXB0b3IuaGFzT25lVGltZSkgewogICAgICAgICAgdGhpcy5leHByZXNzaW9uID0gdG9rZW5zVG9FeHAodG9rZW5zLCB0aGlzLl9zY29wZSB8fCB0aGlzLnZtKTsKICAgICAgICB9IC8vIG9ubHkgYWxsb3cgYmluZGluZyBvbiBuYXRpdmUgYXR0cmlidXRlcwoKCiAgICAgICAgaWYgKGRpc2FsbG93ZWRJbnRlcnBBdHRyUkUudGVzdChhdHRyKSB8fCBhdHRyID09PSAnbmFtZScgJiYgKHRhZyA9PT0gJ1BBUlRJQUwnIHx8IHRhZyA9PT0gJ1NMT1QnKSkgewogICAgICAgICAgJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oYXR0ciArICc9IicgKyBkZXNjcmlwdG9yLnJhdyArICciOiAnICsgJ2F0dHJpYnV0ZSBpbnRlcnBvbGF0aW9uIGlzIG5vdCBhbGxvd2VkIGluIFZ1ZS5qcyAnICsgJ2RpcmVjdGl2ZXMgYW5kIHNwZWNpYWwgYXR0cmlidXRlcy4nLCB0aGlzLnZtKTsKICAgICAgICAgIHRoaXMuZWwucmVtb3ZlQXR0cmlidXRlKGF0dHIpOwogICAgICAgICAgdGhpcy5pbnZhbGlkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgoKICAgICAgICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB2YXIgcmF3ID0gYXR0ciArICc9IicgKyBkZXNjcmlwdG9yLnJhdyArICciOiAnOyAvLyB3YXJuIHNyYwoKICAgICAgICAgIGlmIChhdHRyID09PSAnc3JjJykgewogICAgICAgICAgICB3YXJuKHJhdyArICdpbnRlcnBvbGF0aW9uIGluICJzcmMiIGF0dHJpYnV0ZSB3aWxsIGNhdXNlICcgKyAnYSA0MDQgcmVxdWVzdC4gVXNlIHYtYmluZDpzcmMgaW5zdGVhZC4nLCB0aGlzLnZtKTsKICAgICAgICAgIH0gLy8gd2FybiBzdHlsZQoKCiAgICAgICAgICBpZiAoYXR0ciA9PT0gJ3N0eWxlJykgewogICAgICAgICAgICB3YXJuKHJhdyArICdpbnRlcnBvbGF0aW9uIGluICJzdHlsZSIgYXR0cmlidXRlIHdpbGwgY2F1c2UgJyArICd0aGUgYXR0cmlidXRlIHRvIGJlIGRpc2NhcmRlZCBpbiBJbnRlcm5ldCBFeHBsb3Jlci4gJyArICdVc2Ugdi1iaW5kOnN0eWxlIGluc3RlYWQuJywgdGhpcy52bSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUodmFsdWUpIHsKICAgICAgaWYgKHRoaXMuaW52YWxpZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGF0dHIgPSB0aGlzLmFyZzsKCiAgICAgIGlmICh0aGlzLmFyZykgewogICAgICAgIHRoaXMuaGFuZGxlU2luZ2xlKGF0dHIsIHZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmhhbmRsZU9iamVjdCh2YWx1ZSB8fCB7fSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyBzaGFyZSBvYmplY3QgaGFuZGxlciB3aXRoIHYtYmluZDpjbGFzcwogICAgaGFuZGxlT2JqZWN0OiBzdHlsZS5oYW5kbGVPYmplY3QsCiAgICBoYW5kbGVTaW5nbGU6IGZ1bmN0aW9uIGhhbmRsZVNpbmdsZShhdHRyLCB2YWx1ZSkgewogICAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgICB2YXIgaW50ZXJwID0gdGhpcy5kZXNjcmlwdG9yLmludGVycDsKCiAgICAgIGlmICh0aGlzLm1vZGlmaWVycy5jYW1lbCkgewogICAgICAgIGF0dHIgPSBjYW1lbGl6ZShhdHRyKTsKICAgICAgfQoKICAgICAgaWYgKCFpbnRlcnAgJiYgYXR0cldpdGhQcm9wc1JFLnRlc3QoYXR0cikgJiYgYXR0ciBpbiBlbCkgewogICAgICAgIHZhciBhdHRyVmFsdWUgPSBhdHRyID09PSAndmFsdWUnID8gdmFsdWUgPT0gbnVsbCAvLyBJRTkgd2lsbCBzZXQgaW5wdXQudmFsdWUgdG8gIm51bGwiIGZvciBudWxsLi4uCiAgICAgICAgPyAnJyA6IHZhbHVlIDogdmFsdWU7CgogICAgICAgIGlmIChlbFthdHRyXSAhPT0gYXR0clZhbHVlKSB7CiAgICAgICAgICBlbFthdHRyXSA9IGF0dHJWYWx1ZTsKICAgICAgICB9CiAgICAgIH0gLy8gc2V0IG1vZGVsIHByb3BzCgoKICAgICAgdmFyIG1vZGVsUHJvcCA9IG1vZGVsUHJvcHNbYXR0cl07CgogICAgICBpZiAoIWludGVycCAmJiBtb2RlbFByb3ApIHsKICAgICAgICBlbFttb2RlbFByb3BdID0gdmFsdWU7IC8vIHVwZGF0ZSB2LW1vZGVsIGlmIHByZXNlbnQKCiAgICAgICAgdmFyIG1vZGVsID0gZWwuX192X21vZGVsOwoKICAgICAgICBpZiAobW9kZWwpIHsKICAgICAgICAgIG1vZGVsLmxpc3RlbmVyKCk7CiAgICAgICAgfQogICAgICB9IC8vIGRvIG5vdCBzZXQgdmFsdWUgYXR0cmlidXRlIGZvciB0ZXh0YXJlYQoKCiAgICAgIGlmIChhdHRyID09PSAndmFsdWUnICYmIGVsLnRhZ05hbWUgPT09ICdURVhUQVJFQScpIHsKICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoYXR0cik7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIHVwZGF0ZSBhdHRyaWJ1dGUKCgogICAgICBpZiAoZW51bWVyYXRlZEF0dHJSRS50ZXN0KGF0dHIpKSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKGF0dHIsIHZhbHVlID8gJ3RydWUnIDogJ2ZhbHNlJyk7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgIT0gbnVsbCAmJiB2YWx1ZSAhPT0gZmFsc2UpIHsKICAgICAgICBpZiAoYXR0ciA9PT0gJ2NsYXNzJykgewogICAgICAgICAgLy8gaGFuZGxlIGVkZ2UgY2FzZSAjMTk2MDoKICAgICAgICAgIC8vIGNsYXNzIGludGVycG9sYXRpb24gc2hvdWxkIG5vdCBvdmVyd3JpdGUgVnVlIHRyYW5zaXRpb24gY2xhc3MKICAgICAgICAgIGlmIChlbC5fX3ZfdHJhbnMpIHsKICAgICAgICAgICAgdmFsdWUgKz0gJyAnICsgZWwuX192X3RyYW5zLmlkICsgJy10cmFuc2l0aW9uJzsKICAgICAgICAgIH0KCiAgICAgICAgICBzZXRDbGFzcyhlbCwgdmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoeGxpbmtSRS50ZXN0KGF0dHIpKSB7CiAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGVOUyh4bGlua05TLCBhdHRyLCB2YWx1ZSA9PT0gdHJ1ZSA/ICcnIDogdmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoYXR0ciwgdmFsdWUgPT09IHRydWUgPyAnJyA6IHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWwucmVtb3ZlQXR0cmlidXRlKGF0dHIpOwogICAgICB9CiAgICB9CiAgfTsKICB2YXIgZWwgPSB7CiAgICBwcmlvcml0eTogRUwsCiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKCkgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKCF0aGlzLmFyZykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGlkID0gdGhpcy5pZCA9IGNhbWVsaXplKHRoaXMuYXJnKTsKICAgICAgdmFyIHJlZnMgPSAodGhpcy5fc2NvcGUgfHwgdGhpcy52bSkuJGVsczsKCiAgICAgIGlmIChoYXNPd24ocmVmcywgaWQpKSB7CiAgICAgICAgcmVmc1tpZF0gPSB0aGlzLmVsOwogICAgICB9IGVsc2UgewogICAgICAgIGRlZmluZVJlYWN0aXZlKHJlZnMsIGlkLCB0aGlzLmVsKTsKICAgICAgfQogICAgfSwKICAgIHVuYmluZDogZnVuY3Rpb24gdW5iaW5kKCkgewogICAgICB2YXIgcmVmcyA9ICh0aGlzLl9zY29wZSB8fCB0aGlzLnZtKS4kZWxzOwoKICAgICAgaWYgKHJlZnNbdGhpcy5pZF0gPT09IHRoaXMuZWwpIHsKICAgICAgICByZWZzW3RoaXMuaWRdID0gbnVsbDsKICAgICAgfQogICAgfQogIH07CiAgdmFyIHJlZiA9IHsKICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQoKSB7CiAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCd2LXJlZjonICsgdGhpcy5hcmcgKyAnIG11c3QgYmUgdXNlZCBvbiBhIGNoaWxkICcgKyAnY29tcG9uZW50LiBGb3VuZCBvbiA8JyArIHRoaXMuZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpICsgJz4uJywgdGhpcy52bSk7CiAgICB9CiAgfTsKICB2YXIgY2xvYWsgPSB7CiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKCkgewogICAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgICB0aGlzLnZtLiRvbmNlKCdwcmUtaG9vazpjb21waWxlZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoJ3YtY2xvYWsnKTsKICAgICAgfSk7CiAgICB9CiAgfTsgLy8gbXVzdCBleHBvcnQgcGxhaW4gb2JqZWN0CgogIHZhciBkaXJlY3RpdmVzID0gewogICAgdGV4dDogdGV4dCQxLAogICAgaHRtbDogaHRtbCwKICAgICdmb3InOiB2Rm9yLAogICAgJ2lmJzogdklmLAogICAgc2hvdzogc2hvdywKICAgIG1vZGVsOiBtb2RlbCwKICAgIG9uOiBvbiQxLAogICAgYmluZDogYmluZCQxLAogICAgZWw6IGVsLAogICAgcmVmOiByZWYsCiAgICBjbG9hazogY2xvYWsKICB9OwogIHZhciB2Q2xhc3MgPSB7CiAgICBkZWVwOiB0cnVlLAogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUodmFsdWUpIHsKICAgICAgaWYgKCF2YWx1ZSkgewogICAgICAgIHRoaXMuY2xlYW51cCgpOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICB0aGlzLnNldENsYXNzKHZhbHVlLnRyaW0oKS5zcGxpdCgvXHMrLykpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2V0Q2xhc3Mobm9ybWFsaXplJDEodmFsdWUpKTsKICAgICAgfQogICAgfSwKICAgIHNldENsYXNzOiBmdW5jdGlvbiBzZXRDbGFzcyh2YWx1ZSkgewogICAgICB0aGlzLmNsZWFudXAodmFsdWUpOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB2YWx1ZS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB2YXIgdmFsID0gdmFsdWVbaV07CgogICAgICAgIGlmICh2YWwpIHsKICAgICAgICAgIGFwcGx5KHRoaXMuZWwsIHZhbCwgYWRkQ2xhc3MpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5wcmV2S2V5cyA9IHZhbHVlOwogICAgfSwKICAgIGNsZWFudXA6IGZ1bmN0aW9uIGNsZWFudXAodmFsdWUpIHsKICAgICAgdmFyIHByZXZLZXlzID0gdGhpcy5wcmV2S2V5czsKICAgICAgaWYgKCFwcmV2S2V5cykgcmV0dXJuOwogICAgICB2YXIgaSA9IHByZXZLZXlzLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB2YXIga2V5ID0gcHJldktleXNbaV07CgogICAgICAgIGlmICghdmFsdWUgfHwgdmFsdWUuaW5kZXhPZihrZXkpIDwgMCkgewogICAgICAgICAgYXBwbHkodGhpcy5lbCwga2V5LCByZW1vdmVDbGFzcyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKICAvKioKICAgKiBOb3JtYWxpemUgb2JqZWN0cyBhbmQgYXJyYXlzIChwb3RlbnRpYWxseSBjb250YWluaW5nIG9iamVjdHMpCiAgICogaW50byBhcnJheSBvZiBzdHJpbmdzLgogICAqCiAgICogQHBhcmFtIHtPYmplY3R8QXJyYXk8U3RyaW5nfE9iamVjdD59IHZhbHVlCiAgICogQHJldHVybiB7QXJyYXk8U3RyaW5nPn0KICAgKi8KCiAgZnVuY3Rpb24gbm9ybWFsaXplJDEodmFsdWUpIHsKICAgIHZhciByZXMgPSBbXTsKCiAgICBpZiAoaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB2YWx1ZS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB2YXIgX2tleSA9IHZhbHVlW2ldOwoKICAgICAgICBpZiAoX2tleSkgewogICAgICAgICAgaWYgKHR5cGVvZiBfa2V5ID09PSAnc3RyaW5nJykgewogICAgICAgICAgICByZXMucHVzaChfa2V5KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gX2tleSkgewogICAgICAgICAgICAgIGlmIChfa2V5W2tdKSByZXMucHVzaChrKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmIChpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgZm9yICh2YXIga2V5IGluIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlW2tleV0pIHJlcy5wdXNoKGtleSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmVzOwogIH0KICAvKioKICAgKiBBZGQgb3IgcmVtb3ZlIGEgY2xhc3MvY2xhc3NlcyBvbiBhbiBlbGVtZW50CiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHBhcmFtIHtTdHJpbmd9IGtleSBUaGUgY2xhc3MgbmFtZS4gVGhpcyBtYXkgb3IgbWF5IG5vdAogICAqICAgICAgICAgICAgICAgICAgICAgY29udGFpbiBhIHNwYWNlIGNoYXJhY3RlciwgaW4gc3VjaCBhCiAgICogICAgICAgICAgICAgICAgICAgICBjYXNlIHdlJ2xsIGRlYWwgd2l0aCBtdWx0aXBsZSBjbGFzcwogICAqICAgICAgICAgICAgICAgICAgICAgbmFtZXMgYXQgb25jZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAqLwoKCiAgZnVuY3Rpb24gYXBwbHkoZWwsIGtleSwgZm4pIHsKICAgIGtleSA9IGtleS50cmltKCk7CgogICAgaWYgKGtleS5pbmRleE9mKCcgJykgPT09IC0xKSB7CiAgICAgIGZuKGVsLCBrZXkpOwogICAgICByZXR1cm47CiAgICB9IC8vIFRoZSBrZXkgY29udGFpbnMgb25lIG9yIG1vcmUgc3BhY2UgY2hhcmFjdGVycy4KICAgIC8vIFNpbmNlIGEgY2xhc3MgbmFtZSBkb2Vzbid0IGFjY2VwdCBzdWNoIGNoYXJhY3RlcnMsIHdlCiAgICAvLyB0cmVhdCBpdCBhcyBtdWx0aXBsZSBjbGFzc2VzLgoKCiAgICB2YXIga2V5cyA9IGtleS5zcGxpdCgvXHMrLyk7CgogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBrZXlzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBmbihlbCwga2V5c1tpXSk7CiAgICB9CiAgfQoKICB2YXIgY29tcG9uZW50ID0gewogICAgcHJpb3JpdHk6IENPTVBPTkVOVCwKICAgIHBhcmFtczogWydrZWVwLWFsaXZlJywgJ3RyYW5zaXRpb24tbW9kZScsICdpbmxpbmUtdGVtcGxhdGUnXSwKCiAgICAvKioKICAgICAqIFNldHVwLiBUd28gcG9zc2libGUgdXNhZ2VzOgogICAgICoKICAgICAqIC0gc3RhdGljOgogICAgICogICA8Y29tcD4gb3IgPGRpdiB2LWNvbXBvbmVudD0iY29tcCI+CiAgICAgKgogICAgICogLSBkeW5hbWljOgogICAgICogICA8Y29tcG9uZW50IDppcz0idmlldyI+CiAgICAgKi8KICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQoKSB7CiAgICAgIGlmICghdGhpcy5lbC5fX3Z1ZV9fKSB7CiAgICAgICAgLy8ga2VlcC1hbGl2ZSBjYWNoZQogICAgICAgIHRoaXMua2VlcEFsaXZlID0gdGhpcy5wYXJhbXMua2VlcEFsaXZlOwoKICAgICAgICBpZiAodGhpcy5rZWVwQWxpdmUpIHsKICAgICAgICAgIHRoaXMuY2FjaGUgPSB7fTsKICAgICAgICB9IC8vIGNoZWNrIGlubGluZS10ZW1wbGF0ZQoKCiAgICAgICAgaWYgKHRoaXMucGFyYW1zLmlubGluZVRlbXBsYXRlKSB7CiAgICAgICAgICAvLyBleHRyYWN0IGlubGluZSB0ZW1wbGF0ZSBhcyBhIERvY3VtZW50RnJhZ21lbnQKICAgICAgICAgIHRoaXMuaW5saW5lVGVtcGxhdGUgPSBleHRyYWN0Q29udGVudCh0aGlzLmVsLCB0cnVlKTsKICAgICAgICB9IC8vIGNvbXBvbmVudCByZXNvbHV0aW9uIHJlbGF0ZWQgc3RhdGUKCgogICAgICAgIHRoaXMucGVuZGluZ0NvbXBvbmVudENiID0gdGhpcy5Db21wb25lbnQgPSBudWxsOyAvLyB0cmFuc2l0aW9uIHJlbGF0ZWQgc3RhdGUKCiAgICAgICAgdGhpcy5wZW5kaW5nUmVtb3ZhbHMgPSAwOwogICAgICAgIHRoaXMucGVuZGluZ1JlbW92YWxDYiA9IG51bGw7IC8vIGNyZWF0ZSBhIHJlZiBhbmNob3IKCiAgICAgICAgdGhpcy5hbmNob3IgPSBjcmVhdGVBbmNob3IoJ3YtY29tcG9uZW50Jyk7CiAgICAgICAgcmVwbGFjZSh0aGlzLmVsLCB0aGlzLmFuY2hvcik7IC8vIHJlbW92ZSBpcyBhdHRyaWJ1dGUuCiAgICAgICAgLy8gdGhpcyBpcyByZW1vdmVkIGR1cmluZyBjb21waWxhdGlvbiwgYnV0IGJlY2F1c2UgY29tcGlsYXRpb24gaXMKICAgICAgICAvLyBjYWNoZWQsIHdoZW4gdGhlIGNvbXBvbmVudCBpcyB1c2VkIGVsc2V3aGVyZSB0aGlzIGF0dHJpYnV0ZQogICAgICAgIC8vIHdpbGwgcmVtYWluIGF0IGxpbmsgdGltZS4KCiAgICAgICAgdGhpcy5lbC5yZW1vdmVBdHRyaWJ1dGUoJ2lzJyk7CiAgICAgICAgdGhpcy5lbC5yZW1vdmVBdHRyaWJ1dGUoJzppcycpOyAvLyByZW1vdmUgcmVmLCBzYW1lIGFzIGFib3ZlCgogICAgICAgIGlmICh0aGlzLmRlc2NyaXB0b3IucmVmKSB7CiAgICAgICAgICB0aGlzLmVsLnJlbW92ZUF0dHJpYnV0ZSgndi1yZWY6JyArIGh5cGhlbmF0ZSh0aGlzLmRlc2NyaXB0b3IucmVmKSk7CiAgICAgICAgfSAvLyBpZiBzdGF0aWMsIGJ1aWxkIHJpZ2h0IG5vdy4KCgogICAgICAgIGlmICh0aGlzLmxpdGVyYWwpIHsKICAgICAgICAgIHRoaXMuc2V0Q29tcG9uZW50KHRoaXMuZXhwcmVzc2lvbik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdjYW5ub3QgbW91bnQgY29tcG9uZW50ICInICsgdGhpcy5leHByZXNzaW9uICsgJyIgJyArICdvbiBhbHJlYWR5IG1vdW50ZWQgZWxlbWVudDogJyArIHRoaXMuZWwpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogUHVibGljIHVwZGF0ZSwgY2FsbGVkIGJ5IHRoZSB3YXRjaGVyIGluIHRoZSBkeW5hbWljCiAgICAgKiBsaXRlcmFsIHNjZW5hcmlvLCBlLmcuIDxjb21wb25lbnQgOmlzPSJ2aWV3Ij4KICAgICAqLwogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUodmFsdWUpIHsKICAgICAgaWYgKCF0aGlzLmxpdGVyYWwpIHsKICAgICAgICB0aGlzLnNldENvbXBvbmVudCh2YWx1ZSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBTd2l0Y2ggZHluYW1pYyBjb21wb25lbnRzLiBNYXkgcmVzb2x2ZSB0aGUgY29tcG9uZW50CiAgICAgKiBhc3luY2hyb25vdXNseSwgYW5kIHBlcmZvcm0gdHJhbnNpdGlvbiBiYXNlZCBvbgogICAgICogc3BlY2lmaWVkIHRyYW5zaXRpb24gbW9kZS4gQWNjZXB0cyBhIGZldyBhZGRpdGlvbmFsCiAgICAgKiBhcmd1bWVudHMgc3BlY2lmaWNhbGx5IGZvciB2dWUtcm91dGVyLgogICAgICoKICAgICAqIFRoZSBjYWxsYmFjayBpcyBjYWxsZWQgd2hlbiB0aGUgZnVsbCB0cmFuc2l0aW9uIGlzCiAgICAgKiBmaW5pc2hlZC4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYl0KICAgICAqLwogICAgc2V0Q29tcG9uZW50OiBmdW5jdGlvbiBzZXRDb21wb25lbnQodmFsdWUsIGNiKSB7CiAgICAgIHRoaXMuaW52YWxpZGF0ZVBlbmRpbmcoKTsKCiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICAvLyBqdXN0IHJlbW92ZSBjdXJyZW50CiAgICAgICAgdGhpcy51bmJ1aWxkKHRydWUpOwogICAgICAgIHRoaXMucmVtb3ZlKHRoaXMuY2hpbGRWTSwgY2IpOwogICAgICAgIHRoaXMuY2hpbGRWTSA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHRoaXMucmVzb2x2ZUNvbXBvbmVudCh2YWx1ZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgc2VsZi5tb3VudENvbXBvbmVudChjYik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXNvbHZlIHRoZSBjb21wb25lbnQgY29uc3RydWN0b3IgdG8gdXNlIHdoZW4gY3JlYXRpbmcKICAgICAqIHRoZSBjaGlsZCB2bS4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ3xGdW5jdGlvbn0gdmFsdWUKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNiCiAgICAgKi8KICAgIHJlc29sdmVDb21wb25lbnQ6IGZ1bmN0aW9uIHJlc29sdmVDb21wb25lbnQodmFsdWUsIGNiKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdGhpcy5wZW5kaW5nQ29tcG9uZW50Q2IgPSBjYW5jZWxsYWJsZShmdW5jdGlvbiAoQ29tcG9uZW50KSB7CiAgICAgICAgc2VsZi5Db21wb25lbnROYW1lID0gQ29tcG9uZW50Lm9wdGlvbnMubmFtZSB8fCAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHZhbHVlIDogbnVsbCk7CiAgICAgICAgc2VsZi5Db21wb25lbnQgPSBDb21wb25lbnQ7CiAgICAgICAgY2IoKTsKICAgICAgfSk7CgogICAgICB0aGlzLnZtLl9yZXNvbHZlQ29tcG9uZW50KHZhbHVlLCB0aGlzLnBlbmRpbmdDb21wb25lbnRDYik7CiAgICB9LAoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIHVzaW5nIHRoZSBjdXJyZW50IGNvbnN0cnVjdG9yIGFuZAogICAgICogcmVwbGFjZSB0aGUgZXhpc3RpbmcgaW5zdGFuY2UuIFRoaXMgbWV0aG9kIGRvZXNuJ3QgY2FyZQogICAgICogd2hldGhlciB0aGUgbmV3IGNvbXBvbmVudCBhbmQgdGhlIG9sZCBvbmUgYXJlIGFjdHVhbGx5CiAgICAgKiB0aGUgc2FtZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2JdCiAgICAgKi8KICAgIG1vdW50Q29tcG9uZW50OiBmdW5jdGlvbiBtb3VudENvbXBvbmVudChjYikgewogICAgICAvLyBhY3R1YWwgbW91bnQKICAgICAgdGhpcy51bmJ1aWxkKHRydWUpOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBhY3RpdmF0ZUhvb2tzID0gdGhpcy5Db21wb25lbnQub3B0aW9ucy5hY3RpdmF0ZTsKICAgICAgdmFyIGNhY2hlZCA9IHRoaXMuZ2V0Q2FjaGVkKCk7CiAgICAgIHZhciBuZXdDb21wb25lbnQgPSB0aGlzLmJ1aWxkKCk7CgogICAgICBpZiAoYWN0aXZhdGVIb29rcyAmJiAhY2FjaGVkKSB7CiAgICAgICAgdGhpcy53YWl0aW5nRm9yID0gbmV3Q29tcG9uZW50OwogICAgICAgIGNhbGxBY3RpdmF0ZUhvb2tzKGFjdGl2YXRlSG9va3MsIG5ld0NvbXBvbmVudCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHNlbGYud2FpdGluZ0ZvciAhPT0gbmV3Q29tcG9uZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBzZWxmLndhaXRpbmdGb3IgPSBudWxsOwogICAgICAgICAgc2VsZi50cmFuc2l0aW9uKG5ld0NvbXBvbmVudCwgY2IpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHVwZGF0ZSByZWYgZm9yIGtlcHQtYWxpdmUgY29tcG9uZW50CiAgICAgICAgaWYgKGNhY2hlZCkgewogICAgICAgICAgbmV3Q29tcG9uZW50Ll91cGRhdGVSZWYoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMudHJhbnNpdGlvbihuZXdDb21wb25lbnQsIGNiKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFdoZW4gdGhlIGNvbXBvbmVudCBjaGFuZ2VzIG9yIHVuYmluZHMgYmVmb3JlIGFuIGFzeW5jCiAgICAgKiBjb25zdHJ1Y3RvciBpcyByZXNvbHZlZCwgd2UgbmVlZCB0byBpbnZhbGlkYXRlIGl0cwogICAgICogcGVuZGluZyBjYWxsYmFjay4KICAgICAqLwogICAgaW52YWxpZGF0ZVBlbmRpbmc6IGZ1bmN0aW9uIGludmFsaWRhdGVQZW5kaW5nKCkgewogICAgICBpZiAodGhpcy5wZW5kaW5nQ29tcG9uZW50Q2IpIHsKICAgICAgICB0aGlzLnBlbmRpbmdDb21wb25lbnRDYi5jYW5jZWwoKTsKICAgICAgICB0aGlzLnBlbmRpbmdDb21wb25lbnRDYiA9IG51bGw7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZS9pbnNlcnQgYSBuZXcgY2hpbGQgdm0uCiAgICAgKiBJZiBrZWVwIGFsaXZlIGFuZCBoYXMgY2FjaGVkIGluc3RhbmNlLCBpbnNlcnQgdGhhdAogICAgICogaW5zdGFuY2U7IG90aGVyd2lzZSBidWlsZCBhIG5ldyBvbmUgYW5kIGNhY2hlIGl0LgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbZXh0cmFPcHRpb25zXQogICAgICogQHJldHVybiB7VnVlfSAtIHRoZSBjcmVhdGVkIGluc3RhbmNlCiAgICAgKi8KICAgIGJ1aWxkOiBmdW5jdGlvbiBidWlsZChleHRyYU9wdGlvbnMpIHsKICAgICAgdmFyIGNhY2hlZCA9IHRoaXMuZ2V0Q2FjaGVkKCk7CgogICAgICBpZiAoY2FjaGVkKSB7CiAgICAgICAgcmV0dXJuIGNhY2hlZDsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuQ29tcG9uZW50KSB7CiAgICAgICAgLy8gZGVmYXVsdCBvcHRpb25zCiAgICAgICAgdmFyIG9wdGlvbnMgPSB7CiAgICAgICAgICBuYW1lOiB0aGlzLkNvbXBvbmVudE5hbWUsCiAgICAgICAgICBlbDogY2xvbmVOb2RlKHRoaXMuZWwpLAogICAgICAgICAgdGVtcGxhdGU6IHRoaXMuaW5saW5lVGVtcGxhdGUsCiAgICAgICAgICAvLyBtYWtlIHN1cmUgdG8gYWRkIHRoZSBjaGlsZCB3aXRoIGNvcnJlY3QgcGFyZW50CiAgICAgICAgICAvLyBpZiB0aGlzIGlzIGEgdHJhbnNjbHVkZWQgY29tcG9uZW50LCBpdHMgcGFyZW50CiAgICAgICAgICAvLyBzaG91bGQgYmUgdGhlIHRyYW5zY2x1c2lvbiBob3N0LgogICAgICAgICAgcGFyZW50OiB0aGlzLl9ob3N0IHx8IHRoaXMudm0sCiAgICAgICAgICAvLyBpZiBubyBpbmxpbmUtdGVtcGxhdGUsIHRoZW4gdGhlIGNvbXBpbGVkCiAgICAgICAgICAvLyBsaW5rZXIgY2FuIGJlIGNhY2hlZCBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlLgogICAgICAgICAgX2xpbmtlckNhY2hhYmxlOiAhdGhpcy5pbmxpbmVUZW1wbGF0ZSwKICAgICAgICAgIF9yZWY6IHRoaXMuZGVzY3JpcHRvci5yZWYsCiAgICAgICAgICBfYXNDb21wb25lbnQ6IHRydWUsCiAgICAgICAgICBfaXNSb3V0ZXJWaWV3OiB0aGlzLl9pc1JvdXRlclZpZXcsCiAgICAgICAgICAvLyBpZiB0aGlzIGlzIGEgdHJhbnNjbHVkZWQgY29tcG9uZW50LCBjb250ZXh0CiAgICAgICAgICAvLyB3aWxsIGJlIHRoZSBjb21tb24gcGFyZW50IHZtIG9mIHRoaXMgaW5zdGFuY2UKICAgICAgICAgIC8vIGFuZCBpdHMgaG9zdC4KICAgICAgICAgIF9jb250ZXh0OiB0aGlzLnZtLAogICAgICAgICAgLy8gaWYgdGhpcyBpcyBpbnNpZGUgYW4gaW5saW5lIHYtZm9yLCB0aGUgc2NvcGUKICAgICAgICAgIC8vIHdpbGwgYmUgdGhlIGludGVybWVkaWF0ZSBzY29wZSBjcmVhdGVkIGZvciB0aGlzCiAgICAgICAgICAvLyByZXBlYXQgZnJhZ21lbnQuIHRoaXMgaXMgdXNlZCBmb3IgbGlua2luZyBwcm9wcwogICAgICAgICAgLy8gYW5kIGNvbnRhaW5lciBkaXJlY3RpdmVzLgogICAgICAgICAgX3Njb3BlOiB0aGlzLl9zY29wZSwKICAgICAgICAgIC8vIHBhc3MgaW4gdGhlIG93bmVyIGZyYWdtZW50IG9mIHRoaXMgY29tcG9uZW50LgogICAgICAgICAgLy8gdGhpcyBpcyBuZWNlc3Nhcnkgc28gdGhhdCB0aGUgZnJhZ21lbnQgY2FuIGtlZXAKICAgICAgICAgIC8vIHRyYWNrIG9mIGl0cyBjb250YWluZWQgY29tcG9uZW50cyBpbiBvcmRlciB0bwogICAgICAgICAgLy8gY2FsbCBhdHRhY2gvZGV0YWNoIGhvb2tzIGZvciB0aGVtLgogICAgICAgICAgX2ZyYWc6IHRoaXMuX2ZyYWcKICAgICAgICB9OyAvLyBleHRyYSBvcHRpb25zCiAgICAgICAgLy8gaW4gMS4wLjAgdGhpcyBpcyB1c2VkIGJ5IHZ1ZS1yb3V0ZXIgb25seQoKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgICAgICAgaWYgKGV4dHJhT3B0aW9ucykgewogICAgICAgICAgZXh0ZW5kKG9wdGlvbnMsIGV4dHJhT3B0aW9ucyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2hpbGQgPSBuZXcgdGhpcy5Db21wb25lbnQob3B0aW9ucyk7CgogICAgICAgIGlmICh0aGlzLmtlZXBBbGl2ZSkgewogICAgICAgICAgdGhpcy5jYWNoZVt0aGlzLkNvbXBvbmVudC5jaWRdID0gY2hpbGQ7CiAgICAgICAgfQogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICAgICAgaWYgKCdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB0aGlzLmVsLmhhc0F0dHJpYnV0ZSgndHJhbnNpdGlvbicpICYmIGNoaWxkLl9pc0ZyYWdtZW50KSB7CiAgICAgICAgICB3YXJuKCdUcmFuc2l0aW9ucyB3aWxsIG5vdCB3b3JrIG9uIGEgZnJhZ21lbnQgaW5zdGFuY2UuICcgKyAnVGVtcGxhdGU6ICcgKyBjaGlsZC4kb3B0aW9ucy50ZW1wbGF0ZSwgY2hpbGQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogVHJ5IHRvIGdldCBhIGNhY2hlZCBpbnN0YW5jZSBvZiB0aGUgY3VycmVudCBjb21wb25lbnQuCiAgICAgKgogICAgICogQHJldHVybiB7VnVlfHVuZGVmaW5lZH0KICAgICAqLwogICAgZ2V0Q2FjaGVkOiBmdW5jdGlvbiBnZXRDYWNoZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmtlZXBBbGl2ZSAmJiB0aGlzLmNhY2hlW3RoaXMuQ29tcG9uZW50LmNpZF07CiAgICB9LAoKICAgIC8qKgogICAgICogVGVhcmRvd24gdGhlIGN1cnJlbnQgY2hpbGQsIGJ1dCBkZWZlcnMgY2xlYW51cCBzbwogICAgICogdGhhdCB3ZSBjYW4gc2VwYXJhdGUgdGhlIGRlc3Ryb3kgYW5kIHJlbW92YWwgc3RlcHMuCiAgICAgKgogICAgICogQHBhcmFtIHtCb29sZWFufSBkZWZlcgogICAgICovCiAgICB1bmJ1aWxkOiBmdW5jdGlvbiB1bmJ1aWxkKGRlZmVyKSB7CiAgICAgIGlmICh0aGlzLndhaXRpbmdGb3IpIHsKICAgICAgICBpZiAoIXRoaXMua2VlcEFsaXZlKSB7CiAgICAgICAgICB0aGlzLndhaXRpbmdGb3IuJGRlc3Ryb3koKTsKICAgICAgICB9CgogICAgICAgIHRoaXMud2FpdGluZ0ZvciA9IG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBjaGlsZCA9IHRoaXMuY2hpbGRWTTsKCiAgICAgIGlmICghY2hpbGQgfHwgdGhpcy5rZWVwQWxpdmUpIHsKICAgICAgICBpZiAoY2hpbGQpIHsKICAgICAgICAgIC8vIHJlbW92ZSByZWYKICAgICAgICAgIGNoaWxkLl9pbmFjdGl2ZSA9IHRydWU7CgogICAgICAgICAgY2hpbGQuX3VwZGF0ZVJlZih0cnVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgICAgfSAvLyB0aGUgc29sZSBwdXJwb3NlIG9mIGBkZWZlckNsZWFudXBgIGlzIHNvIHRoYXQgd2UgY2FuCiAgICAgIC8vICJkZWFjdGl2YXRlIiB0aGUgdm0gcmlnaHQgbm93IGFuZCBwZXJmb3JtIERPTSByZW1vdmFsCiAgICAgIC8vIGxhdGVyLgoKCiAgICAgIGNoaWxkLiRkZXN0cm95KGZhbHNlLCBkZWZlcik7CiAgICB9LAoKICAgIC8qKgogICAgICogUmVtb3ZlIGN1cnJlbnQgZGVzdHJveWVkIGNoaWxkIGFuZCBtYW51YWxseSBkbwogICAgICogdGhlIGNsZWFudXAgYWZ0ZXIgcmVtb3ZhbC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYgogICAgICovCiAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZShjaGlsZCwgY2IpIHsKICAgICAgdmFyIGtlZXBBbGl2ZSA9IHRoaXMua2VlcEFsaXZlOwoKICAgICAgaWYgKGNoaWxkKSB7CiAgICAgICAgLy8gd2UgbWF5IGhhdmUgYSBjb21wb25lbnQgc3dpdGNoIHdoZW4gYSBwcmV2aW91cwogICAgICAgIC8vIGNvbXBvbmVudCBpcyBzdGlsbCBiZWluZyB0cmFuc2l0aW9uZWQgb3V0LgogICAgICAgIC8vIHdlIHdhbnQgdG8gdHJpZ2dlciBvbmx5IG9uZSBsYXN0ZXN0IGluc2VydGlvbiBjYgogICAgICAgIC8vIHdoZW4gdGhlIGV4aXN0aW5nIHRyYW5zaXRpb24gZmluaXNoZXMuICgjMTExOSkKICAgICAgICB0aGlzLnBlbmRpbmdSZW1vdmFscysrOwogICAgICAgIHRoaXMucGVuZGluZ1JlbW92YWxDYiA9IGNiOwogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICBjaGlsZC4kcmVtb3ZlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHNlbGYucGVuZGluZ1JlbW92YWxzLS07CiAgICAgICAgICBpZiAoIWtlZXBBbGl2ZSkgY2hpbGQuX2NsZWFudXAoKTsKCiAgICAgICAgICBpZiAoIXNlbGYucGVuZGluZ1JlbW92YWxzICYmIHNlbGYucGVuZGluZ1JlbW92YWxDYikgewogICAgICAgICAgICBzZWxmLnBlbmRpbmdSZW1vdmFsQ2IoKTsKICAgICAgICAgICAgc2VsZi5wZW5kaW5nUmVtb3ZhbENiID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChjYikgewogICAgICAgIGNiKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBBY3R1YWxseSBzd2FwIHRoZSBjb21wb25lbnRzLCBkZXBlbmRpbmcgb24gdGhlCiAgICAgKiB0cmFuc2l0aW9uIG1vZGUuIERlZmF1bHRzIHRvIHNpbXVsdGFuZW91cy4KICAgICAqCiAgICAgKiBAcGFyYW0ge1Z1ZX0gdGFyZ2V0CiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2JdCiAgICAgKi8KICAgIHRyYW5zaXRpb246IGZ1bmN0aW9uIHRyYW5zaXRpb24odGFyZ2V0LCBjYikgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5jaGlsZFZNOyAvLyBmb3IgZGV2dG9vbCBpbnNwZWN0aW9uCgogICAgICBpZiAoY3VycmVudCkgY3VycmVudC5faW5hY3RpdmUgPSB0cnVlOwogICAgICB0YXJnZXQuX2luYWN0aXZlID0gZmFsc2U7CiAgICAgIHRoaXMuY2hpbGRWTSA9IHRhcmdldDsKCiAgICAgIHN3aXRjaCAoc2VsZi5wYXJhbXMudHJhbnNpdGlvbk1vZGUpIHsKICAgICAgICBjYXNlICdpbi1vdXQnOgogICAgICAgICAgdGFyZ2V0LiRiZWZvcmUoc2VsZi5hbmNob3IsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgc2VsZi5yZW1vdmUoY3VycmVudCwgY2IpOwogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnb3V0LWluJzoKICAgICAgICAgIHNlbGYucmVtb3ZlKGN1cnJlbnQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGFyZ2V0LiRiZWZvcmUoc2VsZi5hbmNob3IsIGNiKTsKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBzZWxmLnJlbW92ZShjdXJyZW50KTsKICAgICAgICAgIHRhcmdldC4kYmVmb3JlKHNlbGYuYW5jaG9yLCBjYik7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBVbmJpbmQuCiAgICAgKi8KICAgIHVuYmluZDogZnVuY3Rpb24gdW5iaW5kKCkgewogICAgICB0aGlzLmludmFsaWRhdGVQZW5kaW5nKCk7IC8vIERvIG5vdCBkZWZlciBjbGVhbnVwIHdoZW4gdW5iaW5kaW5nCgogICAgICB0aGlzLnVuYnVpbGQoKTsgLy8gZGVzdHJveSBhbGwga2VlcC1hbGl2ZSBjYWNoZWQgaW5zdGFuY2VzCgogICAgICBpZiAodGhpcy5jYWNoZSkgewogICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLmNhY2hlKSB7CiAgICAgICAgICB0aGlzLmNhY2hlW2tleV0uJGRlc3Ryb3koKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY2FjaGUgPSBudWxsOwogICAgICB9CiAgICB9CiAgfTsKICAvKioKICAgKiBDYWxsIGFjdGl2YXRlIGhvb2tzIGluIG9yZGVyIChhc3luY2hyb25vdXMpCiAgICoKICAgKiBAcGFyYW0ge0FycmF5fSBob29rcwogICAqIEBwYXJhbSB7VnVlfSB2bQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNiCiAgICovCgogIGZ1bmN0aW9uIGNhbGxBY3RpdmF0ZUhvb2tzKGhvb2tzLCB2bSwgY2IpIHsKICAgIHZhciB0b3RhbCA9IGhvb2tzLmxlbmd0aDsKICAgIHZhciBjYWxsZWQgPSAwOwogICAgaG9va3NbMF0uY2FsbCh2bSwgbmV4dCk7CgogICAgZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgaWYgKCsrY2FsbGVkID49IHRvdGFsKSB7CiAgICAgICAgY2IoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBob29rc1tjYWxsZWRdLmNhbGwodm0sIG5leHQpOwogICAgICB9CiAgICB9CiAgfQoKICB2YXIgcHJvcEJpbmRpbmdNb2RlcyA9IGNvbmZpZy5fcHJvcEJpbmRpbmdNb2RlczsKICB2YXIgZW1wdHkgPSB7fTsgLy8gcmVnZXhlcwoKICB2YXIgaWRlbnRSRSQxID0gL15bJF9hLXpBLVpdK1tcdyRdKiQvOwogIHZhciBzZXR0YWJsZVBhdGhSRSA9IC9eW0EtWmEtel8kXVtcdyRdKihcLltBLVphLXpfJF1bXHckXSp8XFtbXlxbXF1dK1xdKSokLzsKICAvKioKICAgKiBDb21waWxlIHByb3BzIG9uIGEgcm9vdCBlbGVtZW50IGFuZCByZXR1cm4KICAgKiBhIHByb3BzIGxpbmsgZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR8RG9jdW1lbnRGcmFnbWVudH0gZWwKICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wT3B0aW9ucwogICAqIEBwYXJhbSB7VnVlfSB2bQogICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBwcm9wc0xpbmtGbgogICAqLwoKICBmdW5jdGlvbiBjb21waWxlUHJvcHMoZWwsIHByb3BPcHRpb25zLCB2bSkgewogICAgdmFyIHByb3BzID0gW107CiAgICB2YXIgbmFtZXMgPSBPYmplY3Qua2V5cyhwcm9wT3B0aW9ucyk7CiAgICB2YXIgaSA9IG5hbWVzLmxlbmd0aDsKICAgIHZhciBvcHRpb25zLCBuYW1lLCBhdHRyLCB2YWx1ZSwgcGF0aCwgcGFyc2VkLCBwcm9wOwoKICAgIHdoaWxlIChpLS0pIHsKICAgICAgbmFtZSA9IG5hbWVzW2ldOwogICAgICBvcHRpb25zID0gcHJvcE9wdGlvbnNbbmFtZV0gfHwgZW1wdHk7CgogICAgICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIG5hbWUgPT09ICckZGF0YScpIHsKICAgICAgICB3YXJuKCdEbyBub3QgdXNlICRkYXRhIGFzIHByb3AuJywgdm0pOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9IC8vIHByb3BzIGNvdWxkIGNvbnRhaW4gZGFzaGVzLCB3aGljaCB3aWxsIGJlCiAgICAgIC8vIGludGVycHJldGVkIGFzIG1pbnVzIGNhbGN1bGF0aW9ucyBieSB0aGUgcGFyc2VyCiAgICAgIC8vIHNvIHdlIG5lZWQgdG8gY2FtZWxpemUgdGhlIHBhdGggaGVyZQoKCiAgICAgIHBhdGggPSBjYW1lbGl6ZShuYW1lKTsKCiAgICAgIGlmICghaWRlbnRSRSQxLnRlc3QocGF0aCkpIHsKICAgICAgICAnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgd2FybignSW52YWxpZCBwcm9wIGtleTogIicgKyBuYW1lICsgJyIuIFByb3Aga2V5cyAnICsgJ211c3QgYmUgdmFsaWQgaWRlbnRpZmllcnMuJywgdm0pOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBwcm9wID0gewogICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgcGF0aDogcGF0aCwKICAgICAgICBvcHRpb25zOiBvcHRpb25zLAogICAgICAgIG1vZGU6IHByb3BCaW5kaW5nTW9kZXMuT05FX1dBWSwKICAgICAgICByYXc6IG51bGwKICAgICAgfTsKICAgICAgYXR0ciA9IGh5cGhlbmF0ZShuYW1lKTsgLy8gZmlyc3QgY2hlY2sgZHluYW1pYyB2ZXJzaW9uCgogICAgICBpZiAoKHZhbHVlID0gZ2V0QmluZEF0dHIoZWwsIGF0dHIpKSA9PT0gbnVsbCkgewogICAgICAgIGlmICgodmFsdWUgPSBnZXRCaW5kQXR0cihlbCwgYXR0ciArICcuc3luYycpKSAhPT0gbnVsbCkgewogICAgICAgICAgcHJvcC5tb2RlID0gcHJvcEJpbmRpbmdNb2Rlcy5UV09fV0FZOwogICAgICAgIH0gZWxzZSBpZiAoKHZhbHVlID0gZ2V0QmluZEF0dHIoZWwsIGF0dHIgKyAnLm9uY2UnKSkgIT09IG51bGwpIHsKICAgICAgICAgIHByb3AubW9kZSA9IHByb3BCaW5kaW5nTW9kZXMuT05FX1RJTUU7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodmFsdWUgIT09IG51bGwpIHsKICAgICAgICAvLyBoYXMgZHluYW1pYyBiaW5kaW5nIQogICAgICAgIHByb3AucmF3ID0gdmFsdWU7CiAgICAgICAgcGFyc2VkID0gcGFyc2VEaXJlY3RpdmUodmFsdWUpOwogICAgICAgIHZhbHVlID0gcGFyc2VkLmV4cHJlc3Npb247CiAgICAgICAgcHJvcC5maWx0ZXJzID0gcGFyc2VkLmZpbHRlcnM7IC8vIGNoZWNrIGJpbmRpbmcgdHlwZQoKICAgICAgICBpZiAoaXNMaXRlcmFsKHZhbHVlKSAmJiAhcGFyc2VkLmZpbHRlcnMpIHsKICAgICAgICAgIC8vIGZvciBleHByZXNzaW9ucyBjb250YWluaW5nIGxpdGVyYWwgbnVtYmVycyBhbmQKICAgICAgICAgIC8vIGJvb2xlYW5zLCB0aGVyZSdzIG5vIG5lZWQgdG8gc2V0dXAgYSBwcm9wIGJpbmRpbmcsCiAgICAgICAgICAvLyBzbyB3ZSBjYW4gb3B0aW1pemUgdGhlbSBhcyBhIG9uZS10aW1lIHNldC4KICAgICAgICAgIHByb3Aub3B0aW1pemVkTGl0ZXJhbCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByb3AuZHluYW1pYyA9IHRydWU7IC8vIGNoZWNrIG5vbi1zZXR0YWJsZSBwYXRoIGZvciB0d28td2F5IGJpbmRpbmdzCgogICAgICAgICAgaWYgKCdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiBwcm9wLm1vZGUgPT09IHByb3BCaW5kaW5nTW9kZXMuVFdPX1dBWSAmJiAhc2V0dGFibGVQYXRoUkUudGVzdCh2YWx1ZSkpIHsKICAgICAgICAgICAgcHJvcC5tb2RlID0gcHJvcEJpbmRpbmdNb2Rlcy5PTkVfV0FZOwogICAgICAgICAgICB3YXJuKCdDYW5ub3QgYmluZCB0d28td2F5IHByb3Agd2l0aCBub24tc2V0dGFibGUgJyArICdwYXJlbnQgcGF0aDogJyArIHZhbHVlLCB2bSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcm9wLnBhcmVudFBhdGggPSB2YWx1ZTsgLy8gd2FybiByZXF1aXJlZCB0d28td2F5CgogICAgICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgb3B0aW9ucy50d29XYXkgJiYgcHJvcC5tb2RlICE9PSBwcm9wQmluZGluZ01vZGVzLlRXT19XQVkpIHsKICAgICAgICAgIHdhcm4oJ1Byb3AgIicgKyBuYW1lICsgJyIgZXhwZWN0cyBhIHR3by13YXkgYmluZGluZyB0eXBlLicsIHZtKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoKHZhbHVlID0gZ2V0QXR0cihlbCwgYXR0cikpICE9PSBudWxsKSB7CiAgICAgICAgLy8gaGFzIGxpdGVyYWwgYmluZGluZyEKICAgICAgICBwcm9wLnJhdyA9IHZhbHVlOwogICAgICB9IGVsc2UgaWYgKCdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgIC8vIGNoZWNrIHBvc3NpYmxlIGNhbWVsQ2FzZSBwcm9wIHVzYWdlCiAgICAgICAgdmFyIGxvd2VyQ2FzZU5hbWUgPSBwYXRoLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgdmFsdWUgPSAvW0EtWlwtXS8udGVzdChuYW1lKSAmJiAoZWwuZ2V0QXR0cmlidXRlKGxvd2VyQ2FzZU5hbWUpIHx8IGVsLmdldEF0dHJpYnV0ZSgnOicgKyBsb3dlckNhc2VOYW1lKSB8fCBlbC5nZXRBdHRyaWJ1dGUoJ3YtYmluZDonICsgbG93ZXJDYXNlTmFtZSkgfHwgZWwuZ2V0QXR0cmlidXRlKCc6JyArIGxvd2VyQ2FzZU5hbWUgKyAnLm9uY2UnKSB8fCBlbC5nZXRBdHRyaWJ1dGUoJ3YtYmluZDonICsgbG93ZXJDYXNlTmFtZSArICcub25jZScpIHx8IGVsLmdldEF0dHJpYnV0ZSgnOicgKyBsb3dlckNhc2VOYW1lICsgJy5zeW5jJykgfHwgZWwuZ2V0QXR0cmlidXRlKCd2LWJpbmQ6JyArIGxvd2VyQ2FzZU5hbWUgKyAnLnN5bmMnKSk7CgogICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgd2FybignUG9zc2libGUgdXNhZ2UgZXJyb3IgZm9yIHByb3AgYCcgKyBsb3dlckNhc2VOYW1lICsgJ2AgLSAnICsgJ2RpZCB5b3UgbWVhbiBgJyArIGF0dHIgKyAnYD8gSFRNTCBpcyBjYXNlLWluc2Vuc2l0aXZlLCByZW1lbWJlciB0byB1c2UgJyArICdrZWJhYi1jYXNlIGZvciBwcm9wcyBpbiB0ZW1wbGF0ZXMuJywgdm0pOwogICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5yZXF1aXJlZCkgewogICAgICAgICAgLy8gd2FybiBtaXNzaW5nIHJlcXVpcmVkCiAgICAgICAgICB3YXJuKCdNaXNzaW5nIHJlcXVpcmVkIHByb3A6ICcgKyBuYW1lLCB2bSk7CiAgICAgICAgfQogICAgICB9IC8vIHB1c2ggcHJvcAoKCiAgICAgIHByb3BzLnB1c2gocHJvcCk7CiAgICB9CgogICAgcmV0dXJuIG1ha2VQcm9wc0xpbmtGbihwcm9wcyk7CiAgfQogIC8qKgogICAqIEJ1aWxkIGEgZnVuY3Rpb24gdGhhdCBhcHBsaWVzIHByb3BzIHRvIGEgdm0uCiAgICoKICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcwogICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBwcm9wc0xpbmtGbgogICAqLwoKCiAgZnVuY3Rpb24gbWFrZVByb3BzTGlua0ZuKHByb3BzKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gcHJvcHNMaW5rRm4odm0sIHNjb3BlKSB7CiAgICAgIC8vIHN0b3JlIHJlc29sdmVkIHByb3BzIGluZm8KICAgICAgdm0uX3Byb3BzID0ge307CiAgICAgIHZhciBpbmxpbmVQcm9wcyA9IHZtLiRvcHRpb25zLnByb3BzRGF0YTsKICAgICAgdmFyIGkgPSBwcm9wcy5sZW5ndGg7CiAgICAgIHZhciBwcm9wLCBwYXRoLCBvcHRpb25zLCB2YWx1ZSwgcmF3OwoKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIHByb3AgPSBwcm9wc1tpXTsKICAgICAgICByYXcgPSBwcm9wLnJhdzsKICAgICAgICBwYXRoID0gcHJvcC5wYXRoOwogICAgICAgIG9wdGlvbnMgPSBwcm9wLm9wdGlvbnM7CiAgICAgICAgdm0uX3Byb3BzW3BhdGhdID0gcHJvcDsKCiAgICAgICAgaWYgKGlubGluZVByb3BzICYmIGhhc093bihpbmxpbmVQcm9wcywgcGF0aCkpIHsKICAgICAgICAgIGluaXRQcm9wKHZtLCBwcm9wLCBpbmxpbmVQcm9wc1twYXRoXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocmF3ID09PSBudWxsKSB7CiAgICAgICAgICAvLyBpbml0aWFsaXplIGFic2VudCBwcm9wCiAgICAgICAgICBpbml0UHJvcCh2bSwgcHJvcCwgdW5kZWZpbmVkKTsKICAgICAgICB9IGVsc2UgaWYgKHByb3AuZHluYW1pYykgewogICAgICAgICAgLy8gZHluYW1pYyBwcm9wCiAgICAgICAgICBpZiAocHJvcC5tb2RlID09PSBwcm9wQmluZGluZ01vZGVzLk9ORV9USU1FKSB7CiAgICAgICAgICAgIC8vIG9uZSB0aW1lIGJpbmRpbmcKICAgICAgICAgICAgdmFsdWUgPSAoc2NvcGUgfHwgdm0uX2NvbnRleHQgfHwgdm0pLiRnZXQocHJvcC5wYXJlbnRQYXRoKTsKICAgICAgICAgICAgaW5pdFByb3Aodm0sIHByb3AsIHZhbHVlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh2bS5fY29udGV4dCkgewogICAgICAgICAgICAgIC8vIGR5bmFtaWMgYmluZGluZwogICAgICAgICAgICAgIHZtLl9iaW5kRGlyKHsKICAgICAgICAgICAgICAgIG5hbWU6ICdwcm9wJywKICAgICAgICAgICAgICAgIGRlZjogcHJvcERlZiwKICAgICAgICAgICAgICAgIHByb3A6IHByb3AKICAgICAgICAgICAgICB9LCBudWxsLCBudWxsLCBzY29wZSk7IC8vIGVsLCBob3N0LCBzY29wZQoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyByb290IGluc3RhbmNlCiAgICAgICAgICAgICAgaW5pdFByb3Aodm0sIHByb3AsIHZtLiRnZXQocHJvcC5wYXJlbnRQYXRoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHByb3Aub3B0aW1pemVkTGl0ZXJhbCkgewogICAgICAgICAgLy8gb3B0aW1pemVkIGxpdGVyYWwsIGNhc3QgaXQgYW5kIGp1c3Qgc2V0IG9uY2UKICAgICAgICAgIHZhciBzdHJpcHBlZCA9IHN0cmlwUXVvdGVzKHJhdyk7CiAgICAgICAgICB2YWx1ZSA9IHN0cmlwcGVkID09PSByYXcgPyB0b0Jvb2xlYW4odG9OdW1iZXIocmF3KSkgOiBzdHJpcHBlZDsKICAgICAgICAgIGluaXRQcm9wKHZtLCBwcm9wLCB2YWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIHN0cmluZyBsaXRlcmFsLCBidXQgd2UgbmVlZCB0byBjYXRlciBmb3IKICAgICAgICAgIC8vIEJvb2xlYW4gcHJvcHMgd2l0aCBubyB2YWx1ZSwgb3Igd2l0aCBzYW1lCiAgICAgICAgICAvLyBsaXRlcmFsIHZhbHVlIChlLmcuIGRpc2FibGVkPSJkaXNhYmxlZCIpCiAgICAgICAgICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS1sb2FkZXIvaXNzdWVzLzE4MgogICAgICAgICAgdmFsdWUgPSBvcHRpb25zLnR5cGUgPT09IEJvb2xlYW4gJiYgKHJhdyA9PT0gJycgfHwgcmF3ID09PSBoeXBoZW5hdGUocHJvcC5uYW1lKSkgPyB0cnVlIDogcmF3OwogICAgICAgICAgaW5pdFByb3Aodm0sIHByb3AsIHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfQogIC8qKgogICAqIFByb2Nlc3MgYSBwcm9wIHdpdGggYSByYXdWYWx1ZSwgYXBwbHlpbmcgbmVjZXNzYXJ5IGNvZXJzaW9ucywKICAgKiBkZWZhdWx0IHZhbHVlcyAmIGFzc2VydGlvbnMgYW5kIGNhbGwgdGhlIGdpdmVuIGNhbGxiYWNrIHdpdGgKICAgKiBwcm9jZXNzZWQgdmFsdWUuCiAgICoKICAgKiBAcGFyYW0ge1Z1ZX0gdm0KICAgKiBAcGFyYW0ge09iamVjdH0gcHJvcAogICAqIEBwYXJhbSB7Kn0gcmF3VmFsdWUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAqLwoKCiAgZnVuY3Rpb24gcHJvY2Vzc1Byb3BWYWx1ZSh2bSwgcHJvcCwgcmF3VmFsdWUsIGZuKSB7CiAgICB2YXIgaXNTaW1wbGUgPSBwcm9wLmR5bmFtaWMgJiYgaXNTaW1wbGVQYXRoKHByb3AucGFyZW50UGF0aCk7CiAgICB2YXIgdmFsdWUgPSByYXdWYWx1ZTsKCiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IGdldFByb3BEZWZhdWx0VmFsdWUodm0sIHByb3ApOwogICAgfQoKICAgIHZhbHVlID0gY29lcmNlUHJvcChwcm9wLCB2YWx1ZSwgdm0pOwogICAgdmFyIGNvZXJjZWQgPSB2YWx1ZSAhPT0gcmF3VmFsdWU7CgogICAgaWYgKCFhc3NlcnRQcm9wKHByb3AsIHZhbHVlLCB2bSkpIHsKICAgICAgdmFsdWUgPSB1bmRlZmluZWQ7CiAgICB9CgogICAgaWYgKGlzU2ltcGxlICYmICFjb2VyY2VkKSB7CiAgICAgIHdpdGhvdXRDb252ZXJzaW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICBmbih2YWx1ZSk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgZm4odmFsdWUpOwogICAgfQogIH0KICAvKioKICAgKiBTZXQgYSBwcm9wJ3MgaW5pdGlhbCB2YWx1ZSBvbiBhIHZtIGFuZCBpdHMgZGF0YSBvYmplY3QuCiAgICoKICAgKiBAcGFyYW0ge1Z1ZX0gdm0KICAgKiBAcGFyYW0ge09iamVjdH0gcHJvcAogICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgKi8KCgogIGZ1bmN0aW9uIGluaXRQcm9wKHZtLCBwcm9wLCB2YWx1ZSkgewogICAgcHJvY2Vzc1Byb3BWYWx1ZSh2bSwgcHJvcCwgdmFsdWUsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICBkZWZpbmVSZWFjdGl2ZSh2bSwgcHJvcC5wYXRoLCB2YWx1ZSk7CiAgICB9KTsKICB9CiAgLyoqCiAgICogVXBkYXRlIGEgcHJvcCdzIHZhbHVlIG9uIGEgdm0uCiAgICoKICAgKiBAcGFyYW0ge1Z1ZX0gdm0KICAgKiBAcGFyYW0ge09iamVjdH0gcHJvcAogICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgKi8KCgogIGZ1bmN0aW9uIHVwZGF0ZVByb3Aodm0sIHByb3AsIHZhbHVlKSB7CiAgICBwcm9jZXNzUHJvcFZhbHVlKHZtLCBwcm9wLCB2YWx1ZSwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgIHZtW3Byb3AucGF0aF0gPSB2YWx1ZTsKICAgIH0pOwogIH0KICAvKioKICAgKiBHZXQgdGhlIGRlZmF1bHQgdmFsdWUgb2YgYSBwcm9wLgogICAqCiAgICogQHBhcmFtIHtWdWV9IHZtCiAgICogQHBhcmFtIHtPYmplY3R9IHByb3AKICAgKiBAcmV0dXJuIHsqfQogICAqLwoKCiAgZnVuY3Rpb24gZ2V0UHJvcERlZmF1bHRWYWx1ZSh2bSwgcHJvcCkgewogICAgLy8gbm8gZGVmYXVsdCwgcmV0dXJuIHVuZGVmaW5lZAogICAgdmFyIG9wdGlvbnMgPSBwcm9wLm9wdGlvbnM7CgogICAgaWYgKCFoYXNPd24ob3B0aW9ucywgJ2RlZmF1bHQnKSkgewogICAgICAvLyBhYnNlbnQgYm9vbGVhbiB2YWx1ZSBkZWZhdWx0cyB0byBmYWxzZQogICAgICByZXR1cm4gb3B0aW9ucy50eXBlID09PSBCb29sZWFuID8gZmFsc2UgOiB1bmRlZmluZWQ7CiAgICB9CgogICAgdmFyIGRlZiA9IG9wdGlvbnNbJ2RlZmF1bHQnXTsgLy8gd2FybiBhZ2FpbnN0IG5vbi1mYWN0b3J5IGRlZmF1bHRzIGZvciBPYmplY3QgJiBBcnJheQoKICAgIGlmIChpc09iamVjdChkZWYpKSB7CiAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdJbnZhbGlkIGRlZmF1bHQgdmFsdWUgZm9yIHByb3AgIicgKyBwcm9wLm5hbWUgKyAnIjogJyArICdQcm9wcyB3aXRoIHR5cGUgT2JqZWN0L0FycmF5IG11c3QgdXNlIGEgZmFjdG9yeSBmdW5jdGlvbiAnICsgJ3RvIHJldHVybiB0aGUgZGVmYXVsdCB2YWx1ZS4nLCB2bSk7CiAgICB9IC8vIGNhbGwgZmFjdG9yeSBmdW5jdGlvbiBmb3Igbm9uLUZ1bmN0aW9uIHR5cGVzCgoKICAgIHJldHVybiB0eXBlb2YgZGVmID09PSAnZnVuY3Rpb24nICYmIG9wdGlvbnMudHlwZSAhPT0gRnVuY3Rpb24gPyBkZWYuY2FsbCh2bSkgOiBkZWY7CiAgfQogIC8qKgogICAqIEFzc2VydCB3aGV0aGVyIGEgcHJvcCBpcyB2YWxpZC4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBwcm9wCiAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAqIEBwYXJhbSB7VnVlfSB2bQogICAqLwoKCiAgZnVuY3Rpb24gYXNzZXJ0UHJvcChwcm9wLCB2YWx1ZSwgdm0pIHsKICAgIGlmICghcHJvcC5vcHRpb25zLnJlcXVpcmVkICYmICggLy8gbm9uLXJlcXVpcmVkCiAgICBwcm9wLnJhdyA9PT0gbnVsbCB8fCAvLyBhYnNjZW50CiAgICB2YWx1ZSA9PSBudWxsKSAvLyBudWxsIG9yIHVuZGVmaW5lZAogICAgKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICB2YXIgb3B0aW9ucyA9IHByb3Aub3B0aW9uczsKICAgIHZhciB0eXBlID0gb3B0aW9ucy50eXBlOwogICAgdmFyIHZhbGlkID0gIXR5cGU7CiAgICB2YXIgZXhwZWN0ZWRUeXBlcyA9IFtdOwoKICAgIGlmICh0eXBlKSB7CiAgICAgIGlmICghaXNBcnJheSh0eXBlKSkgewogICAgICAgIHR5cGUgPSBbdHlwZV07CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHlwZS5sZW5ndGggJiYgIXZhbGlkOyBpKyspIHsKICAgICAgICB2YXIgYXNzZXJ0ZWRUeXBlID0gYXNzZXJ0VHlwZSh2YWx1ZSwgdHlwZVtpXSk7CiAgICAgICAgZXhwZWN0ZWRUeXBlcy5wdXNoKGFzc2VydGVkVHlwZS5leHBlY3RlZFR5cGUpOwogICAgICAgIHZhbGlkID0gYXNzZXJ0ZWRUeXBlLnZhbGlkOwogICAgICB9CiAgICB9CgogICAgaWYgKCF2YWxpZCkgewogICAgICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgd2FybignSW52YWxpZCBwcm9wOiB0eXBlIGNoZWNrIGZhaWxlZCBmb3IgcHJvcCAiJyArIHByb3AubmFtZSArICciLicgKyAnIEV4cGVjdGVkICcgKyBleHBlY3RlZFR5cGVzLm1hcChmb3JtYXRUeXBlKS5qb2luKCcsICcpICsgJywgZ290ICcgKyBmb3JtYXRWYWx1ZSh2YWx1ZSkgKyAnLicsIHZtKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHZhciB2YWxpZGF0b3IgPSBvcHRpb25zLnZhbGlkYXRvcjsKCiAgICBpZiAodmFsaWRhdG9yKSB7CiAgICAgIGlmICghdmFsaWRhdG9yKHZhbHVlKSkgewogICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdJbnZhbGlkIHByb3A6IGN1c3RvbSB2YWxpZGF0b3IgY2hlY2sgZmFpbGVkIGZvciBwcm9wICInICsgcHJvcC5uYW1lICsgJyIuJywgdm0pOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0KICAvKioKICAgKiBGb3JjZSBwYXJzaW5nIHZhbHVlIHdpdGggY29lcmNlIG9wdGlvbi4KICAgKgogICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEByZXR1cm4geyp9CiAgICovCgoKICBmdW5jdGlvbiBjb2VyY2VQcm9wKHByb3AsIHZhbHVlLCB2bSkgewogICAgdmFyIGNvZXJjZSA9IHByb3Aub3B0aW9ucy5jb2VyY2U7CgogICAgaWYgKCFjb2VyY2UpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQoKICAgIGlmICh0eXBlb2YgY29lcmNlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHJldHVybiBjb2VyY2UodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oJ0ludmFsaWQgY29lcmNlIGZvciBwcm9wICInICsgcHJvcC5uYW1lICsgJyI6IGV4cGVjdGVkIGZ1bmN0aW9uLCBnb3QgJyArIF90eXBlb2YoY29lcmNlKSArICcuJywgdm0pOwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgfQogIC8qKgogICAqIEFzc2VydCB0aGUgdHlwZSBvZiBhIHZhbHVlCiAgICoKICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gdHlwZQogICAqIEByZXR1cm4ge09iamVjdH0KICAgKi8KCgogIGZ1bmN0aW9uIGFzc2VydFR5cGUodmFsdWUsIHR5cGUpIHsKICAgIHZhciB2YWxpZDsKICAgIHZhciBleHBlY3RlZFR5cGU7CgogICAgaWYgKHR5cGUgPT09IFN0cmluZykgewogICAgICBleHBlY3RlZFR5cGUgPSAnc3RyaW5nJzsKICAgICAgdmFsaWQgPSBfdHlwZW9mKHZhbHVlKSA9PT0gZXhwZWN0ZWRUeXBlOwogICAgfSBlbHNlIGlmICh0eXBlID09PSBOdW1iZXIpIHsKICAgICAgZXhwZWN0ZWRUeXBlID0gJ251bWJlcic7CiAgICAgIHZhbGlkID0gX3R5cGVvZih2YWx1ZSkgPT09IGV4cGVjdGVkVHlwZTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gQm9vbGVhbikgewogICAgICBleHBlY3RlZFR5cGUgPSAnYm9vbGVhbic7CiAgICAgIHZhbGlkID0gX3R5cGVvZih2YWx1ZSkgPT09IGV4cGVjdGVkVHlwZTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gRnVuY3Rpb24pIHsKICAgICAgZXhwZWN0ZWRUeXBlID0gJ2Z1bmN0aW9uJzsKICAgICAgdmFsaWQgPSBfdHlwZW9mKHZhbHVlKSA9PT0gZXhwZWN0ZWRUeXBlOwogICAgfSBlbHNlIGlmICh0eXBlID09PSBPYmplY3QpIHsKICAgICAgZXhwZWN0ZWRUeXBlID0gJ29iamVjdCc7CiAgICAgIHZhbGlkID0gaXNQbGFpbk9iamVjdCh2YWx1ZSk7CiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IEFycmF5KSB7CiAgICAgIGV4cGVjdGVkVHlwZSA9ICdhcnJheSc7CiAgICAgIHZhbGlkID0gaXNBcnJheSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICB2YWxpZCA9IHZhbHVlIGluc3RhbmNlb2YgdHlwZTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICB2YWxpZDogdmFsaWQsCiAgICAgIGV4cGVjdGVkVHlwZTogZXhwZWN0ZWRUeXBlCiAgICB9OwogIH0KICAvKioKICAgKiBGb3JtYXQgdHlwZSBmb3Igb3V0cHV0CiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAqIEByZXR1cm4ge1N0cmluZ30KICAgKi8KCgogIGZ1bmN0aW9uIGZvcm1hdFR5cGUodHlwZSkgewogICAgcmV0dXJuIHR5cGUgPyB0eXBlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdHlwZS5zbGljZSgxKSA6ICdjdXN0b20gdHlwZSc7CiAgfQogIC8qKgogICAqIEZvcm1hdCB2YWx1ZQogICAqCiAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAqIEByZXR1cm4ge1N0cmluZ30KICAgKi8KCgogIGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbCkgewogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWwpLnNsaWNlKDgsIC0xKTsKICB9CgogIHZhciBiaW5kaW5nTW9kZXMgPSBjb25maWcuX3Byb3BCaW5kaW5nTW9kZXM7CiAgdmFyIHByb3BEZWYgPSB7CiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKCkgewogICAgICB2YXIgY2hpbGQgPSB0aGlzLnZtOwogICAgICB2YXIgcGFyZW50ID0gY2hpbGQuX2NvbnRleHQ7IC8vIHBhc3NlZCBpbiBmcm9tIGNvbXBpbGVyIGRpcmVjdGx5CgogICAgICB2YXIgcHJvcCA9IHRoaXMuZGVzY3JpcHRvci5wcm9wOwogICAgICB2YXIgY2hpbGRLZXkgPSBwcm9wLnBhdGg7CiAgICAgIHZhciBwYXJlbnRLZXkgPSBwcm9wLnBhcmVudFBhdGg7CiAgICAgIHZhciB0d29XYXkgPSBwcm9wLm1vZGUgPT09IGJpbmRpbmdNb2Rlcy5UV09fV0FZOwogICAgICB2YXIgcGFyZW50V2F0Y2hlciA9IHRoaXMucGFyZW50V2F0Y2hlciA9IG5ldyBXYXRjaGVyKHBhcmVudCwgcGFyZW50S2V5LCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgdXBkYXRlUHJvcChjaGlsZCwgcHJvcCwgdmFsKTsKICAgICAgfSwgewogICAgICAgIHR3b1dheTogdHdvV2F5LAogICAgICAgIGZpbHRlcnM6IHByb3AuZmlsdGVycywKICAgICAgICAvLyBpbXBvcnRhbnQ6IHByb3BzIG5lZWQgdG8gYmUgb2JzZXJ2ZWQgb24gdGhlCiAgICAgICAgLy8gdi1mb3Igc2NvcGUgaWYgcHJlc2VudAogICAgICAgIHNjb3BlOiB0aGlzLl9zY29wZQogICAgICB9KTsgLy8gc2V0IHRoZSBjaGlsZCBpbml0aWFsIHZhbHVlLgoKICAgICAgaW5pdFByb3AoY2hpbGQsIHByb3AsIHBhcmVudFdhdGNoZXIudmFsdWUpOyAvLyBzZXR1cCB0d28td2F5IGJpbmRpbmcKCiAgICAgIGlmICh0d29XYXkpIHsKICAgICAgICAvLyBpbXBvcnRhbnQ6IGRlZmVyIHRoZSBjaGlsZCB3YXRjaGVyIGNyZWF0aW9uIHVudGlsCiAgICAgICAgLy8gdGhlIGNyZWF0ZWQgaG9vayAoYWZ0ZXIgZGF0YSBvYnNlcnZhdGlvbikKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgY2hpbGQuJG9uY2UoJ3ByZS1ob29rOmNyZWF0ZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBzZWxmLmNoaWxkV2F0Y2hlciA9IG5ldyBXYXRjaGVyKGNoaWxkLCBjaGlsZEtleSwgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICBwYXJlbnRXYXRjaGVyLnNldCh2YWwpOwogICAgICAgICAgfSwgewogICAgICAgICAgICAvLyBlbnN1cmUgc3luYyB1cHdhcmQgYmVmb3JlIHBhcmVudCBzeW5jIGRvd24uCiAgICAgICAgICAgIC8vIHRoaXMgaXMgbmVjZXNzYXJ5IGluIGNhc2VzIGUuZy4gdGhlIGNoaWxkCiAgICAgICAgICAgIC8vIG11dGF0ZXMgYSBwcm9wIGFycmF5LCB0aGVuIHJlcGxhY2VzIGl0LiAoIzE2ODMpCiAgICAgICAgICAgIHN5bmM6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgdW5iaW5kOiBmdW5jdGlvbiB1bmJpbmQoKSB7CiAgICAgIHRoaXMucGFyZW50V2F0Y2hlci50ZWFyZG93bigpOwoKICAgICAgaWYgKHRoaXMuY2hpbGRXYXRjaGVyKSB7CiAgICAgICAgdGhpcy5jaGlsZFdhdGNoZXIudGVhcmRvd24oKTsKICAgICAgfQogICAgfQogIH07CiAgdmFyIHF1ZXVlJDEgPSBbXTsKICB2YXIgcXVldWVkID0gZmFsc2U7CiAgLyoqCiAgICogUHVzaCBhIGpvYiBpbnRvIHRoZSBxdWV1ZS4KICAgKgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGpvYgogICAqLwoKICBmdW5jdGlvbiBwdXNoSm9iKGpvYikgewogICAgcXVldWUkMS5wdXNoKGpvYik7CgogICAgaWYgKCFxdWV1ZWQpIHsKICAgICAgcXVldWVkID0gdHJ1ZTsKICAgICAgbmV4dFRpY2soZmx1c2gpOwogICAgfQogIH0KICAvKioKICAgKiBGbHVzaCB0aGUgcXVldWUsIGFuZCBkbyBvbmUgZm9yY2VkIHJlZmxvdyBiZWZvcmUKICAgKiB0cmlnZ2VyaW5nIHRyYW5zaXRpb25zLgogICAqLwoKCiAgZnVuY3Rpb24gZmx1c2goKSB7CiAgICAvLyBGb3JjZSBsYXlvdXQKICAgIHZhciBmID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldEhlaWdodDsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1ZXVlJDEubGVuZ3RoOyBpKyspIHsKICAgICAgcXVldWUkMVtpXSgpOwogICAgfQoKICAgIHF1ZXVlJDEgPSBbXTsKICAgIHF1ZXVlZCA9IGZhbHNlOyAvLyBkdW1teSByZXR1cm4sIHNvIGpzIGxpbnRlcnMgZG9uJ3QgY29tcGxhaW4gYWJvdXQKICAgIC8vIHVudXNlZCB2YXJpYWJsZSBmCgogICAgcmV0dXJuIGY7CiAgfQoKICB2YXIgVFlQRV9UUkFOU0lUSU9OID0gJ3RyYW5zaXRpb24nOwogIHZhciBUWVBFX0FOSU1BVElPTiA9ICdhbmltYXRpb24nOwogIHZhciB0cmFuc0R1cmF0aW9uUHJvcCA9IHRyYW5zaXRpb25Qcm9wICsgJ0R1cmF0aW9uJzsKICB2YXIgYW5pbUR1cmF0aW9uUHJvcCA9IGFuaW1hdGlvblByb3AgKyAnRHVyYXRpb24nOwogIC8qKgogICAqIElmIGEganVzdC1lbnRlcmVkIGVsZW1lbnQgaXMgYXBwbGllZCB0aGUKICAgKiBsZWF2ZSBjbGFzcyB3aGlsZSBpdHMgZW50ZXIgdHJhbnNpdGlvbiBoYXNuJ3Qgc3RhcnRlZCB5ZXQsCiAgICogYW5kIHRoZSB0cmFuc2l0aW9uZWQgcHJvcGVydHkgaGFzIHRoZSBzYW1lIHZhbHVlIGZvciBib3RoCiAgICogZW50ZXIvbGVhdmUsIHRoZW4gdGhlIGxlYXZlIHRyYW5zaXRpb24gd2lsbCBiZSBza2lwcGVkIGFuZAogICAqIHRoZSB0cmFuc2l0aW9uZW5kIGV2ZW50IG5ldmVyIGZpcmVzLiBUaGlzIGZ1bmN0aW9uIGVuc3VyZXMKICAgKiBpdHMgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIGFmdGVyIGEgdHJhbnNpdGlvbiBoYXMgc3RhcnRlZAogICAqIGJ5IHdhaXRpbmcgZm9yIGRvdWJsZSByYWYuCiAgICoKICAgKiBJdCBmYWxscyBiYWNrIHRvIHNldFRpbWVvdXQgb24gZGV2aWNlcyB0aGF0IHN1cHBvcnQgQ1NTCiAgICogdHJhbnNpdGlvbnMgYnV0IG5vdCByYWYgKGUuZy4gQW5kcm9pZCA0LjIgYnJvd3NlcikgLSBzaW5jZQogICAqIHRoZXNlIGVudmlyb25tZW50cyBhcmUgdXN1YWxseSBzbG93LCB3ZSBhcmUgZ2l2aW5nIGl0IGEKICAgKiByZWxhdGl2ZWx5IGxhcmdlIHRpbWVvdXQuCiAgICovCgogIHZhciByYWYgPSBpbkJyb3dzZXIgJiYgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZTsKICB2YXIgd2FpdEZvclRyYW5zaXRpb25TdGFydCA9IHJhZgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgPyBmdW5jdGlvbiAoZm4pIHsKICAgIHJhZihmdW5jdGlvbiAoKSB7CiAgICAgIHJhZihmbik7CiAgICB9KTsKICB9IDogZnVuY3Rpb24gKGZuKSB7CiAgICBzZXRUaW1lb3V0KGZuLCA1MCk7CiAgfTsKICAvKioKICAgKiBBIFRyYW5zaXRpb24gb2JqZWN0IHRoYXQgZW5jYXBzdWxhdGVzIHRoZSBzdGF0ZSBhbmQgbG9naWMKICAgKiBvZiB0aGUgdHJhbnNpdGlvbi4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge1N0cmluZ30gaWQKICAgKiBAcGFyYW0ge09iamVjdH0gaG9va3MKICAgKiBAcGFyYW0ge1Z1ZX0gdm0KICAgKi8KCiAgZnVuY3Rpb24gVHJhbnNpdGlvbihlbCwgaWQsIGhvb2tzLCB2bSkgewogICAgdGhpcy5pZCA9IGlkOwogICAgdGhpcy5lbCA9IGVsOwogICAgdGhpcy5lbnRlckNsYXNzID0gaG9va3MgJiYgaG9va3MuZW50ZXJDbGFzcyB8fCBpZCArICctZW50ZXInOwogICAgdGhpcy5sZWF2ZUNsYXNzID0gaG9va3MgJiYgaG9va3MubGVhdmVDbGFzcyB8fCBpZCArICctbGVhdmUnOwogICAgdGhpcy5ob29rcyA9IGhvb2tzOwogICAgdGhpcy52bSA9IHZtOyAvLyBhc3luYyBzdGF0ZQoKICAgIHRoaXMucGVuZGluZ0Nzc0V2ZW50ID0gdGhpcy5wZW5kaW5nQ3NzQ2IgPSB0aGlzLmNhbmNlbCA9IHRoaXMucGVuZGluZ0pzQ2IgPSB0aGlzLm9wID0gdGhpcy5jYiA9IG51bGw7CiAgICB0aGlzLmp1c3RFbnRlcmVkID0gZmFsc2U7CiAgICB0aGlzLmVudGVyZWQgPSB0aGlzLmxlZnQgPSBmYWxzZTsKICAgIHRoaXMudHlwZUNhY2hlID0ge307IC8vIGNoZWNrIGNzcyB0cmFuc2l0aW9uIHR5cGUKCiAgICB0aGlzLnR5cGUgPSBob29rcyAmJiBob29rcy50eXBlOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgogICAgaWYgKCdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJykgewogICAgICBpZiAodGhpcy50eXBlICYmIHRoaXMudHlwZSAhPT0gVFlQRV9UUkFOU0lUSU9OICYmIHRoaXMudHlwZSAhPT0gVFlQRV9BTklNQVRJT04pIHsKICAgICAgICB3YXJuKCdpbnZhbGlkIENTUyB0cmFuc2l0aW9uIHR5cGUgZm9yIHRyYW5zaXRpb249IicgKyB0aGlzLmlkICsgJyI6ICcgKyB0aGlzLnR5cGUsIHZtKTsKICAgICAgfQogICAgfSAvLyBiaW5kCgoKICAgIHZhciBzZWxmID0gdGhpczsKICAgIFsnZW50ZXJOZXh0VGljaycsICdlbnRlckRvbmUnLCAnbGVhdmVOZXh0VGljaycsICdsZWF2ZURvbmUnXS5mb3JFYWNoKGZ1bmN0aW9uIChtKSB7CiAgICAgIHNlbGZbbV0gPSBiaW5kKHNlbGZbbV0sIHNlbGYpOwogICAgfSk7CiAgfQoKICB2YXIgcCQxID0gVHJhbnNpdGlvbi5wcm90b3R5cGU7CiAgLyoqCiAgICogU3RhcnQgYW4gZW50ZXJpbmcgdHJhbnNpdGlvbi4KICAgKgogICAqIDEuIGVudGVyIHRyYW5zaXRpb24gdHJpZ2dlcmVkCiAgICogMi4gY2FsbCBiZWZvcmVFbnRlciBob29rCiAgICogMy4gYWRkIGVudGVyIGNsYXNzCiAgICogNC4gaW5zZXJ0L3Nob3cgZWxlbWVudAogICAqIDUuIGNhbGwgZW50ZXIgaG9vayAod2l0aCBwb3NzaWJsZSBleHBsaWNpdCBqcyBjYWxsYmFjaykKICAgKiA2LiByZWZsb3cKICAgKiA3LiBiYXNlZCBvbiB0cmFuc2l0aW9uIHR5cGU6CiAgICogICAgLSB0cmFuc2l0aW9uOgogICAqICAgICAgICByZW1vdmUgY2xhc3Mgbm93LCB3YWl0IGZvciB0cmFuc2l0aW9uZW5kLAogICAqICAgICAgICB0aGVuIGRvbmUgaWYgdGhlcmUncyBubyBleHBsaWNpdCBqcyBjYWxsYmFjay4KICAgKiAgICAtIGFuaW1hdGlvbjoKICAgKiAgICAgICAgd2FpdCBmb3IgYW5pbWF0aW9uZW5kLCByZW1vdmUgY2xhc3MsCiAgICogICAgICAgIHRoZW4gZG9uZSBpZiB0aGVyZSdzIG5vIGV4cGxpY2l0IGpzIGNhbGxiYWNrLgogICAqICAgIC0gbm8gY3NzIHRyYW5zaXRpb246CiAgICogICAgICAgIGRvbmUgbm93IGlmIHRoZXJlJ3Mgbm8gZXhwbGljaXQganMgY2FsbGJhY2suCiAgICogOC4gd2FpdCBmb3IgZWl0aGVyIGRvbmUgb3IganMgY2FsbGJhY2ssIHRoZW4gY2FsbAogICAqICAgIGFmdGVyRW50ZXIgaG9vay4KICAgKgogICAqIEBwYXJhbSB7RnVuY3Rpb259IG9wIC0gaW5zZXJ0L3Nob3cgdGhlIGVsZW1lbnQKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2JdCiAgICovCgogIHAkMS5lbnRlciA9IGZ1bmN0aW9uIChvcCwgY2IpIHsKICAgIHRoaXMuY2FuY2VsUGVuZGluZygpOwogICAgdGhpcy5jYWxsSG9vaygnYmVmb3JlRW50ZXInKTsKICAgIHRoaXMuY2IgPSBjYjsKICAgIGFkZENsYXNzKHRoaXMuZWwsIHRoaXMuZW50ZXJDbGFzcyk7CiAgICBvcCgpOwogICAgdGhpcy5lbnRlcmVkID0gZmFsc2U7CiAgICB0aGlzLmNhbGxIb29rV2l0aENiKCdlbnRlcicpOwoKICAgIGlmICh0aGlzLmVudGVyZWQpIHsKICAgICAgcmV0dXJuOyAvLyB1c2VyIGNhbGxlZCBkb25lIHN5bmNocm9ub3VzbHkuCiAgICB9CgogICAgdGhpcy5jYW5jZWwgPSB0aGlzLmhvb2tzICYmIHRoaXMuaG9va3MuZW50ZXJDYW5jZWxsZWQ7CiAgICBwdXNoSm9iKHRoaXMuZW50ZXJOZXh0VGljayk7CiAgfTsKICAvKioKICAgKiBUaGUgIm5leHRUaWNrIiBwaGFzZSBvZiBhbiBlbnRlcmluZyB0cmFuc2l0aW9uLCB3aGljaCBpcwogICAqIHRvIGJlIHB1c2hlZCBpbnRvIGEgcXVldWUgYW5kIGV4ZWN1dGVkIGFmdGVyIGEgcmVmbG93IHNvCiAgICogdGhhdCByZW1vdmluZyB0aGUgY2xhc3MgY2FuIHRyaWdnZXIgYSBDU1MgdHJhbnNpdGlvbi4KICAgKi8KCgogIHAkMS5lbnRlck5leHRUaWNrID0gZnVuY3Rpb24gKCkgewogICAgdmFyIF90aGlzID0gdGhpczsgLy8gcHJldmVudCB0cmFuc2l0aW9uIHNraXBwaW5nCgoKICAgIHRoaXMuanVzdEVudGVyZWQgPSB0cnVlOwogICAgd2FpdEZvclRyYW5zaXRpb25TdGFydChmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmp1c3RFbnRlcmVkID0gZmFsc2U7CiAgICB9KTsKICAgIHZhciBlbnRlckRvbmUgPSB0aGlzLmVudGVyRG9uZTsKICAgIHZhciB0eXBlID0gdGhpcy5nZXRDc3NUcmFuc2l0aW9uVHlwZSh0aGlzLmVudGVyQ2xhc3MpOwoKICAgIGlmICghdGhpcy5wZW5kaW5nSnNDYikgewogICAgICBpZiAodHlwZSA9PT0gVFlQRV9UUkFOU0lUSU9OKSB7CiAgICAgICAgLy8gdHJpZ2dlciB0cmFuc2l0aW9uIGJ5IHJlbW92aW5nIGVudGVyIGNsYXNzIG5vdwogICAgICAgIHJlbW92ZUNsYXNzKHRoaXMuZWwsIHRoaXMuZW50ZXJDbGFzcyk7CiAgICAgICAgdGhpcy5zZXR1cENzc0NiKHRyYW5zaXRpb25FbmRFdmVudCwgZW50ZXJEb25lKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBUWVBFX0FOSU1BVElPTikgewogICAgICAgIHRoaXMuc2V0dXBDc3NDYihhbmltYXRpb25FbmRFdmVudCwgZW50ZXJEb25lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlbnRlckRvbmUoKTsKICAgICAgfQogICAgfSBlbHNlIGlmICh0eXBlID09PSBUWVBFX1RSQU5TSVRJT04pIHsKICAgICAgcmVtb3ZlQ2xhc3ModGhpcy5lbCwgdGhpcy5lbnRlckNsYXNzKTsKICAgIH0KICB9OwogIC8qKgogICAqIFRoZSAiY2xlYW51cCIgcGhhc2Ugb2YgYW4gZW50ZXJpbmcgdHJhbnNpdGlvbi4KICAgKi8KCgogIHAkMS5lbnRlckRvbmUgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVudGVyZWQgPSB0cnVlOwogICAgdGhpcy5jYW5jZWwgPSB0aGlzLnBlbmRpbmdKc0NiID0gbnVsbDsKICAgIHJlbW92ZUNsYXNzKHRoaXMuZWwsIHRoaXMuZW50ZXJDbGFzcyk7CiAgICB0aGlzLmNhbGxIb29rKCdhZnRlckVudGVyJyk7CiAgICBpZiAodGhpcy5jYikgdGhpcy5jYigpOwogIH07CiAgLyoqCiAgICogU3RhcnQgYSBsZWF2aW5nIHRyYW5zaXRpb24uCiAgICoKICAgKiAxLiBsZWF2ZSB0cmFuc2l0aW9uIHRyaWdnZXJlZC4KICAgKiAyLiBjYWxsIGJlZm9yZUxlYXZlIGhvb2sKICAgKiAzLiBhZGQgbGVhdmUgY2xhc3MgKHRyaWdnZXIgY3NzIHRyYW5zaXRpb24pCiAgICogNC4gY2FsbCBsZWF2ZSBob29rICh3aXRoIHBvc3NpYmxlIGV4cGxpY2l0IGpzIGNhbGxiYWNrKQogICAqIDUuIHJlZmxvdyBpZiBubyBleHBsaWNpdCBqcyBjYWxsYmFjayBpcyBwcm92aWRlZAogICAqIDYuIGJhc2VkIG9uIHRyYW5zaXRpb24gdHlwZToKICAgKiAgICAtIHRyYW5zaXRpb24gb3IgYW5pbWF0aW9uOgogICAqICAgICAgICB3YWl0IGZvciBlbmQgZXZlbnQsIHJlbW92ZSBjbGFzcywgdGhlbiBkb25lIGlmCiAgICogICAgICAgIHRoZXJlJ3Mgbm8gZXhwbGljaXQganMgY2FsbGJhY2suCiAgICogICAgLSBubyBjc3MgdHJhbnNpdGlvbjoKICAgKiAgICAgICAgZG9uZSBpZiB0aGVyZSdzIG5vIGV4cGxpY2l0IGpzIGNhbGxiYWNrLgogICAqIDcuIHdhaXQgZm9yIGVpdGhlciBkb25lIG9yIGpzIGNhbGxiYWNrLCB0aGVuIGNhbGwKICAgKiAgICBhZnRlckxlYXZlIGhvb2suCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcCAtIHJlbW92ZS9oaWRlIHRoZSBlbGVtZW50CiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NiXQogICAqLwoKCiAgcCQxLmxlYXZlID0gZnVuY3Rpb24gKG9wLCBjYikgewogICAgdGhpcy5jYW5jZWxQZW5kaW5nKCk7CiAgICB0aGlzLmNhbGxIb29rKCdiZWZvcmVMZWF2ZScpOwogICAgdGhpcy5vcCA9IG9wOwogICAgdGhpcy5jYiA9IGNiOwogICAgYWRkQ2xhc3ModGhpcy5lbCwgdGhpcy5sZWF2ZUNsYXNzKTsKICAgIHRoaXMubGVmdCA9IGZhbHNlOwogICAgdGhpcy5jYWxsSG9va1dpdGhDYignbGVhdmUnKTsKCiAgICBpZiAodGhpcy5sZWZ0KSB7CiAgICAgIHJldHVybjsgLy8gdXNlciBjYWxsZWQgZG9uZSBzeW5jaHJvbm91c2x5LgogICAgfQoKICAgIHRoaXMuY2FuY2VsID0gdGhpcy5ob29rcyAmJiB0aGlzLmhvb2tzLmxlYXZlQ2FuY2VsbGVkOyAvLyBvbmx5IG5lZWQgdG8gaGFuZGxlIGxlYXZlRG9uZSBpZgogICAgLy8gMS4gdGhlIHRyYW5zaXRpb24gaXMgYWxyZWFkeSBkb25lIChzeW5jaHJvbm91c2x5IGNhbGxlZAogICAgLy8gICAgYnkgdGhlIHVzZXIsIHdoaWNoIGNhdXNlcyB0aGlzLm9wIHNldCB0byBudWxsKQogICAgLy8gMi4gdGhlcmUncyBubyBleHBsaWNpdCBqcyBjYWxsYmFjawoKICAgIGlmICh0aGlzLm9wICYmICF0aGlzLnBlbmRpbmdKc0NiKSB7CiAgICAgIC8vIGlmIGEgQ1NTIHRyYW5zaXRpb24gbGVhdmVzIGltbWVkaWF0ZWx5IGFmdGVyIGVudGVyLAogICAgICAvLyB0aGUgdHJhbnNpdGlvbmVuZCBldmVudCBuZXZlciBmaXJlcy4gdGhlcmVmb3JlIHdlCiAgICAgIC8vIGRldGVjdCBzdWNoIGNhc2VzIGFuZCBlbmQgdGhlIGxlYXZlIGltbWVkaWF0ZWx5LgogICAgICBpZiAodGhpcy5qdXN0RW50ZXJlZCkgewogICAgICAgIHRoaXMubGVhdmVEb25lKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHVzaEpvYih0aGlzLmxlYXZlTmV4dFRpY2spOwogICAgICB9CiAgICB9CiAgfTsKICAvKioKICAgKiBUaGUgIm5leHRUaWNrIiBwaGFzZSBvZiBhIGxlYXZpbmcgdHJhbnNpdGlvbi4KICAgKi8KCgogIHAkMS5sZWF2ZU5leHRUaWNrID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHR5cGUgPSB0aGlzLmdldENzc1RyYW5zaXRpb25UeXBlKHRoaXMubGVhdmVDbGFzcyk7CgogICAgaWYgKHR5cGUpIHsKICAgICAgdmFyIGV2ZW50ID0gdHlwZSA9PT0gVFlQRV9UUkFOU0lUSU9OID8gdHJhbnNpdGlvbkVuZEV2ZW50IDogYW5pbWF0aW9uRW5kRXZlbnQ7CiAgICAgIHRoaXMuc2V0dXBDc3NDYihldmVudCwgdGhpcy5sZWF2ZURvbmUpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5sZWF2ZURvbmUoKTsKICAgIH0KICB9OwogIC8qKgogICAqIFRoZSAiY2xlYW51cCIgcGhhc2Ugb2YgYSBsZWF2aW5nIHRyYW5zaXRpb24uCiAgICovCgoKICBwJDEubGVhdmVEb25lID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5sZWZ0ID0gdHJ1ZTsKICAgIHRoaXMuY2FuY2VsID0gdGhpcy5wZW5kaW5nSnNDYiA9IG51bGw7CiAgICB0aGlzLm9wKCk7CiAgICByZW1vdmVDbGFzcyh0aGlzLmVsLCB0aGlzLmxlYXZlQ2xhc3MpOwogICAgdGhpcy5jYWxsSG9vaygnYWZ0ZXJMZWF2ZScpOwogICAgaWYgKHRoaXMuY2IpIHRoaXMuY2IoKTsKICAgIHRoaXMub3AgPSBudWxsOwogIH07CiAgLyoqCiAgICogQ2FuY2VsIGFueSBwZW5kaW5nIGNhbGxiYWNrcyBmcm9tIGEgcHJldmlvdXNseSBydW5uaW5nCiAgICogYnV0IG5vdCBmaW5pc2hlZCB0cmFuc2l0aW9uLgogICAqLwoKCiAgcCQxLmNhbmNlbFBlbmRpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm9wID0gdGhpcy5jYiA9IG51bGw7CiAgICB2YXIgaGFzUGVuZGluZyA9IGZhbHNlOwoKICAgIGlmICh0aGlzLnBlbmRpbmdDc3NDYikgewogICAgICBoYXNQZW5kaW5nID0gdHJ1ZTsKICAgICAgb2ZmKHRoaXMuZWwsIHRoaXMucGVuZGluZ0Nzc0V2ZW50LCB0aGlzLnBlbmRpbmdDc3NDYik7CiAgICAgIHRoaXMucGVuZGluZ0Nzc0V2ZW50ID0gdGhpcy5wZW5kaW5nQ3NzQ2IgPSBudWxsOwogICAgfQoKICAgIGlmICh0aGlzLnBlbmRpbmdKc0NiKSB7CiAgICAgIGhhc1BlbmRpbmcgPSB0cnVlOwogICAgICB0aGlzLnBlbmRpbmdKc0NiLmNhbmNlbCgpOwogICAgICB0aGlzLnBlbmRpbmdKc0NiID0gbnVsbDsKICAgIH0KCiAgICBpZiAoaGFzUGVuZGluZykgewogICAgICByZW1vdmVDbGFzcyh0aGlzLmVsLCB0aGlzLmVudGVyQ2xhc3MpOwogICAgICByZW1vdmVDbGFzcyh0aGlzLmVsLCB0aGlzLmxlYXZlQ2xhc3MpOwogICAgfQoKICAgIGlmICh0aGlzLmNhbmNlbCkgewogICAgICB0aGlzLmNhbmNlbC5jYWxsKHRoaXMudm0sIHRoaXMuZWwpOwogICAgICB0aGlzLmNhbmNlbCA9IG51bGw7CiAgICB9CiAgfTsKICAvKioKICAgKiBDYWxsIGEgdXNlci1wcm92aWRlZCBzeW5jaHJvbm91cyBob29rIGZ1bmN0aW9uLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICAgKi8KCgogIHAkMS5jYWxsSG9vayA9IGZ1bmN0aW9uICh0eXBlKSB7CiAgICBpZiAodGhpcy5ob29rcyAmJiB0aGlzLmhvb2tzW3R5cGVdKSB7CiAgICAgIHRoaXMuaG9va3NbdHlwZV0uY2FsbCh0aGlzLnZtLCB0aGlzLmVsKTsKICAgIH0KICB9OwogIC8qKgogICAqIENhbGwgYSB1c2VyLXByb3ZpZGVkLCBwb3RlbnRpYWxseS1hc3luYyBob29rIGZ1bmN0aW9uLgogICAqIFdlIGNoZWNrIGZvciB0aGUgbGVuZ3RoIG9mIGFyZ3VtZW50cyB0byBzZWUgaWYgdGhlIGhvb2sKICAgKiBleHBlY3RzIGEgYGRvbmVgIGNhbGxiYWNrLiBJZiB0cnVlLCB0aGUgdHJhbnNpdGlvbidzIGVuZAogICAqIHdpbGwgYmUgZGV0ZXJtaW5lZCBieSB3aGVuIHRoZSB1c2VyIGNhbGxzIHRoYXQgY2FsbGJhY2s7CiAgICogb3RoZXJ3aXNlLCB0aGUgZW5kIGlzIGRldGVybWluZWQgYnkgdGhlIENTUyB0cmFuc2l0aW9uIG9yCiAgICogYW5pbWF0aW9uLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICAgKi8KCgogIHAkMS5jYWxsSG9va1dpdGhDYiA9IGZ1bmN0aW9uICh0eXBlKSB7CiAgICB2YXIgaG9vayA9IHRoaXMuaG9va3MgJiYgdGhpcy5ob29rc1t0eXBlXTsKCiAgICBpZiAoaG9vaykgewogICAgICBpZiAoaG9vay5sZW5ndGggPiAxKSB7CiAgICAgICAgdGhpcy5wZW5kaW5nSnNDYiA9IGNhbmNlbGxhYmxlKHRoaXNbdHlwZSArICdEb25lJ10pOwogICAgICB9CgogICAgICBob29rLmNhbGwodGhpcy52bSwgdGhpcy5lbCwgdGhpcy5wZW5kaW5nSnNDYik7CiAgICB9CiAgfTsKICAvKioKICAgKiBHZXQgYW4gZWxlbWVudCdzIHRyYW5zaXRpb24gdHlwZSBiYXNlZCBvbiB0aGUKICAgKiBjYWxjdWxhdGVkIHN0eWxlcy4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUKICAgKiBAcmV0dXJuIHtOdW1iZXJ9CiAgICovCgoKICBwJDEuZ2V0Q3NzVHJhbnNpdGlvblR5cGUgPSBmdW5jdGlvbiAoY2xhc3NOYW1lKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICghdHJhbnNpdGlvbkVuZEV2ZW50IHx8IC8vIHNraXAgQ1NTIHRyYW5zaXRpb25zIGlmIHBhZ2UgaXMgbm90IHZpc2libGUgLQogICAgLy8gdGhpcyBzb2x2ZXMgdGhlIGlzc3VlIG9mIHRyYW5zaXRpb25lbmQgZXZlbnRzIG5vdAogICAgLy8gZmlyaW5nIHVudGlsIHRoZSBwYWdlIGlzIHZpc2libGUgYWdhaW4uCiAgICAvLyBwYWdlVmlzaWJpbGl0eSBBUEkgaXMgc3VwcG9ydGVkIGluIElFMTArLCBzYW1lIGFzCiAgICAvLyBDU1MgdHJhbnNpdGlvbnMuCiAgICBkb2N1bWVudC5oaWRkZW4gfHwgLy8gZXhwbGljaXQganMtb25seSB0cmFuc2l0aW9uCiAgICB0aGlzLmhvb2tzICYmIHRoaXMuaG9va3MuY3NzID09PSBmYWxzZSB8fCAvLyBlbGVtZW50IGlzIGhpZGRlbgogICAgaXNIaWRkZW4odGhpcy5lbCkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciB0eXBlID0gdGhpcy50eXBlIHx8IHRoaXMudHlwZUNhY2hlW2NsYXNzTmFtZV07CiAgICBpZiAodHlwZSkgcmV0dXJuIHR5cGU7CiAgICB2YXIgaW5saW5lU3R5bGVzID0gdGhpcy5lbC5zdHlsZTsKICAgIHZhciBjb21wdXRlZFN0eWxlcyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMuZWwpOwogICAgdmFyIHRyYW5zRHVyYXRpb24gPSBpbmxpbmVTdHlsZXNbdHJhbnNEdXJhdGlvblByb3BdIHx8IGNvbXB1dGVkU3R5bGVzW3RyYW5zRHVyYXRpb25Qcm9wXTsKCiAgICBpZiAodHJhbnNEdXJhdGlvbiAmJiB0cmFuc0R1cmF0aW9uICE9PSAnMHMnKSB7CiAgICAgIHR5cGUgPSBUWVBFX1RSQU5TSVRJT047CiAgICB9IGVsc2UgewogICAgICB2YXIgYW5pbUR1cmF0aW9uID0gaW5saW5lU3R5bGVzW2FuaW1EdXJhdGlvblByb3BdIHx8IGNvbXB1dGVkU3R5bGVzW2FuaW1EdXJhdGlvblByb3BdOwoKICAgICAgaWYgKGFuaW1EdXJhdGlvbiAmJiBhbmltRHVyYXRpb24gIT09ICcwcycpIHsKICAgICAgICB0eXBlID0gVFlQRV9BTklNQVRJT047CiAgICAgIH0KICAgIH0KCiAgICBpZiAodHlwZSkgewogICAgICB0aGlzLnR5cGVDYWNoZVtjbGFzc05hbWVdID0gdHlwZTsKICAgIH0KCiAgICByZXR1cm4gdHlwZTsKICB9OwogIC8qKgogICAqIFNldHVwIGEgQ1NTIHRyYW5zaXRpb25lbmQvYW5pbWF0aW9uZW5kIGNhbGxiYWNrLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2IKICAgKi8KCgogIHAkMS5zZXR1cENzc0NiID0gZnVuY3Rpb24gKGV2ZW50LCBjYikgewogICAgdGhpcy5wZW5kaW5nQ3NzRXZlbnQgPSBldmVudDsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBlbCA9IHRoaXMuZWw7CgogICAgdmFyIG9uRW5kID0gdGhpcy5wZW5kaW5nQ3NzQ2IgPSBmdW5jdGlvbiAoZSkgewogICAgICBpZiAoZS50YXJnZXQgPT09IGVsKSB7CiAgICAgICAgb2ZmKGVsLCBldmVudCwgb25FbmQpOwogICAgICAgIHNlbGYucGVuZGluZ0Nzc0V2ZW50ID0gc2VsZi5wZW5kaW5nQ3NzQ2IgPSBudWxsOwoKICAgICAgICBpZiAoIXNlbGYucGVuZGluZ0pzQ2IgJiYgY2IpIHsKICAgICAgICAgIGNiKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIG9uKGVsLCBldmVudCwgb25FbmQpOwogIH07CiAgLyoqCiAgICogQ2hlY2sgaWYgYW4gZWxlbWVudCBpcyBoaWRkZW4gLSBpbiB0aGF0IGNhc2Ugd2UgY2FuIGp1c3QKICAgKiBza2lwIHRoZSB0cmFuc2l0aW9uIGFsbHRvZ2V0aGVyLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEByZXR1cm4ge0Jvb2xlYW59CiAgICovCgoKICBmdW5jdGlvbiBpc0hpZGRlbihlbCkgewogICAgaWYgKC9zdmckLy50ZXN0KGVsLm5hbWVzcGFjZVVSSSkpIHsKICAgICAgLy8gU1ZHIGVsZW1lbnRzIGRvIG5vdCBoYXZlIG9mZnNldChXaWR0aHxIZWlnaHQpCiAgICAgIC8vIHNvIHdlIG5lZWQgdG8gY2hlY2sgdGhlIGNsaWVudCByZWN0CiAgICAgIHZhciByZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIHJldHVybiAhKHJlY3Qud2lkdGggfHwgcmVjdC5oZWlnaHQpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICEoZWwub2Zmc2V0V2lkdGggfHwgZWwub2Zmc2V0SGVpZ2h0IHx8IGVsLmdldENsaWVudFJlY3RzKCkubGVuZ3RoKTsKICAgIH0KICB9CgogIHZhciB0cmFuc2l0aW9uJDEgPSB7CiAgICBwcmlvcml0eTogVFJBTlNJVElPTiwKICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKGlkLCBvbGRJZCkgewogICAgICB2YXIgZWwgPSB0aGlzLmVsOyAvLyByZXNvbHZlIG9uIG93bmVyIHZtCgogICAgICB2YXIgaG9va3MgPSByZXNvbHZlQXNzZXQodGhpcy52bS4kb3B0aW9ucywgJ3RyYW5zaXRpb25zJywgaWQpOwogICAgICBpZCA9IGlkIHx8ICd2JzsKICAgICAgb2xkSWQgPSBvbGRJZCB8fCAndic7CiAgICAgIGVsLl9fdl90cmFucyA9IG5ldyBUcmFuc2l0aW9uKGVsLCBpZCwgaG9va3MsIHRoaXMudm0pOwogICAgICByZW1vdmVDbGFzcyhlbCwgb2xkSWQgKyAnLXRyYW5zaXRpb24nKTsKICAgICAgYWRkQ2xhc3MoZWwsIGlkICsgJy10cmFuc2l0aW9uJyk7CiAgICB9CiAgfTsKICB2YXIgaW50ZXJuYWxEaXJlY3RpdmVzID0gewogICAgc3R5bGU6IHN0eWxlLAogICAgJ2NsYXNzJzogdkNsYXNzLAogICAgY29tcG9uZW50OiBjb21wb25lbnQsCiAgICBwcm9wOiBwcm9wRGVmLAogICAgdHJhbnNpdGlvbjogdHJhbnNpdGlvbiQxCiAgfTsgLy8gc3BlY2lhbCBiaW5kaW5nIHByZWZpeGVzCgogIHZhciBiaW5kUkUgPSAvXnYtYmluZDp8XjovOwogIHZhciBvblJFID0gL152LW9uOnxeQC87CiAgdmFyIGRpckF0dHJSRSA9IC9edi0oW146XSspKD86JHw6KC4qKSQpLzsKICB2YXIgbW9kaWZpZXJSRSA9IC9cLlteXC5dKy9nOwogIHZhciB0cmFuc2l0aW9uUkUgPSAvXih2LWJpbmQ6fDopP3RyYW5zaXRpb24kLzsgLy8gZGVmYXVsdCBkaXJlY3RpdmUgcHJpb3JpdHkKCiAgdmFyIERFRkFVTFRfUFJJT1JJVFkgPSAxMDAwOwogIHZhciBERUZBVUxUX1RFUk1JTkFMX1BSSU9SSVRZID0gMjAwMDsKICAvKioKICAgKiBDb21waWxlIGEgdGVtcGxhdGUgYW5kIHJldHVybiBhIHJldXNhYmxlIGNvbXBvc2l0ZSBsaW5rCiAgICogZnVuY3Rpb24sIHdoaWNoIHJlY3Vyc2l2ZWx5IGNvbnRhaW5zIG1vcmUgbGluayBmdW5jdGlvbnMKICAgKiBpbnNpZGUuIFRoaXMgdG9wIGxldmVsIGNvbXBpbGUgZnVuY3Rpb24gd291bGQgbm9ybWFsbHkKICAgKiBiZSBjYWxsZWQgb24gaW5zdGFuY2Ugcm9vdCBub2RlcywgYnV0IGNhbiBhbHNvIGJlIHVzZWQKICAgKiBmb3IgcGFydGlhbCBjb21waWxhdGlvbiBpZiB0aGUgcGFydGlhbCBhcmd1bWVudCBpcyB0cnVlLgogICAqCiAgICogVGhlIHJldHVybmVkIGNvbXBvc2l0ZSBsaW5rIGZ1bmN0aW9uLCB3aGVuIGNhbGxlZCwgd2lsbAogICAqIHJldHVybiBhbiB1bmxpbmsgZnVuY3Rpb24gdGhhdCB0ZWFyc2Rvd24gYWxsIGRpcmVjdGl2ZXMKICAgKiBjcmVhdGVkIGR1cmluZyB0aGUgbGlua2luZyBwaGFzZS4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudHxEb2N1bWVudEZyYWdtZW50fSBlbAogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICogQHBhcmFtIHtCb29sZWFufSBwYXJ0aWFsCiAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICovCgogIGZ1bmN0aW9uIGNvbXBpbGUoZWwsIG9wdGlvbnMsIHBhcnRpYWwpIHsKICAgIC8vIGxpbmsgZnVuY3Rpb24gZm9yIHRoZSBub2RlIGl0c2VsZi4KICAgIHZhciBub2RlTGlua0ZuID0gcGFydGlhbCB8fCAhb3B0aW9ucy5fYXNDb21wb25lbnQgPyBjb21waWxlTm9kZShlbCwgb3B0aW9ucykgOiBudWxsOyAvLyBsaW5rIGZ1bmN0aW9uIGZvciB0aGUgY2hpbGROb2RlcwoKICAgIHZhciBjaGlsZExpbmtGbiA9ICEobm9kZUxpbmtGbiAmJiBub2RlTGlua0ZuLnRlcm1pbmFsKSAmJiAhaXNTY3JpcHQoZWwpICYmIGVsLmhhc0NoaWxkTm9kZXMoKSA/IGNvbXBpbGVOb2RlTGlzdChlbC5jaGlsZE5vZGVzLCBvcHRpb25zKSA6IG51bGw7CiAgICAvKioKICAgICAqIEEgY29tcG9zaXRlIGxpbmtlciBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb24gYSBhbHJlYWR5CiAgICAgKiBjb21waWxlZCBwaWVjZSBvZiBET00sIHdoaWNoIGluc3RhbnRpYXRlcyBhbGwgZGlyZWN0aXZlCiAgICAgKiBpbnN0YW5jZXMuCiAgICAgKgogICAgICogQHBhcmFtIHtWdWV9IHZtCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR8RG9jdW1lbnRGcmFnbWVudH0gZWwKICAgICAqIEBwYXJhbSB7VnVlfSBbaG9zdF0gLSBob3N0IHZtIG9mIHRyYW5zY2x1ZGVkIGNvbnRlbnQKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbc2NvcGVdIC0gdi1mb3Igc2NvcGUKICAgICAqIEBwYXJhbSB7RnJhZ21lbnR9IFtmcmFnXSAtIGxpbmsgY29udGV4dCBmcmFnbWVudAogICAgICogQHJldHVybiB7RnVuY3Rpb258dW5kZWZpbmVkfQogICAgICovCgogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbXBvc2l0ZUxpbmtGbih2bSwgZWwsIGhvc3QsIHNjb3BlLCBmcmFnKSB7CiAgICAgIC8vIGNhY2hlIGNoaWxkTm9kZXMgYmVmb3JlIGxpbmtpbmcgcGFyZW50LCBmaXggIzY1NwogICAgICB2YXIgY2hpbGROb2RlcyA9IHRvQXJyYXkoZWwuY2hpbGROb2Rlcyk7IC8vIGxpbmsKCiAgICAgIHZhciBkaXJzID0gbGlua0FuZENhcHR1cmUoZnVuY3Rpb24gY29tcG9zaXRlTGlua0NhcHR1cmVyKCkgewogICAgICAgIGlmIChub2RlTGlua0ZuKSBub2RlTGlua0ZuKHZtLCBlbCwgaG9zdCwgc2NvcGUsIGZyYWcpOwogICAgICAgIGlmIChjaGlsZExpbmtGbikgY2hpbGRMaW5rRm4odm0sIGNoaWxkTm9kZXMsIGhvc3QsIHNjb3BlLCBmcmFnKTsKICAgICAgfSwgdm0pOwogICAgICByZXR1cm4gbWFrZVVubGlua0ZuKHZtLCBkaXJzKTsKICAgIH07CiAgfQogIC8qKgogICAqIEFwcGx5IGEgbGlua2VyIHRvIGEgdm0vZWxlbWVudCBwYWlyIGFuZCBjYXB0dXJlIHRoZQogICAqIGRpcmVjdGl2ZXMgY3JlYXRlZCBkdXJpbmcgdGhlIHByb2Nlc3MuCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaW5rZXIKICAgKiBAcGFyYW0ge1Z1ZX0gdm0KICAgKi8KCgogIGZ1bmN0aW9uIGxpbmtBbmRDYXB0dXJlKGxpbmtlciwgdm0pIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKCdkZXZlbG9wbWVudCcgPT09ICdwcm9kdWN0aW9uJykge30KCiAgICB2YXIgb3JpZ2luYWxEaXJDb3VudCA9IHZtLl9kaXJlY3RpdmVzLmxlbmd0aDsKICAgIGxpbmtlcigpOwoKICAgIHZhciBkaXJzID0gdm0uX2RpcmVjdGl2ZXMuc2xpY2Uob3JpZ2luYWxEaXJDb3VudCk7CgogICAgZGlycy5zb3J0KGRpcmVjdGl2ZUNvbXBhcmF0b3IpOwoKICAgIGZvciAodmFyIGkgPSAwLCBsID0gZGlycy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgZGlyc1tpXS5fYmluZCgpOwogICAgfQoKICAgIHJldHVybiBkaXJzOwogIH0KICAvKioKICAgKiBEaXJlY3RpdmUgcHJpb3JpdHkgc29ydCBjb21wYXJhdG9yCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gYQogICAqIEBwYXJhbSB7T2JqZWN0fSBiCiAgICovCgoKICBmdW5jdGlvbiBkaXJlY3RpdmVDb21wYXJhdG9yKGEsIGIpIHsKICAgIGEgPSBhLmRlc2NyaXB0b3IuZGVmLnByaW9yaXR5IHx8IERFRkFVTFRfUFJJT1JJVFk7CiAgICBiID0gYi5kZXNjcmlwdG9yLmRlZi5wcmlvcml0eSB8fCBERUZBVUxUX1BSSU9SSVRZOwogICAgcmV0dXJuIGEgPiBiID8gLTEgOiBhID09PSBiID8gMCA6IDE7CiAgfQogIC8qKgogICAqIExpbmtlciBmdW5jdGlvbnMgcmV0dXJuIGFuIHVubGluayBmdW5jdGlvbiB0aGF0CiAgICogdGVhcnNkb3duIGFsbCBkaXJlY3RpdmVzIGluc3RhbmNlcyBnZW5lcmF0ZWQgZHVyaW5nCiAgICogdGhlIHByb2Nlc3MuCiAgICoKICAgKiBXZSBjcmVhdGUgdW5saW5rIGZ1bmN0aW9ucyB3aXRoIG9ubHkgdGhlIG5lY2Vzc2FyeQogICAqIGluZm9ybWF0aW9uIHRvIGF2b2lkIHJldGFpbmluZyBhZGRpdGlvbmFsIGNsb3N1cmVzLgogICAqCiAgICogQHBhcmFtIHtWdWV9IHZtCiAgICogQHBhcmFtIHtBcnJheX0gZGlycwogICAqIEBwYXJhbSB7VnVlfSBbY29udGV4dF0KICAgKiBAcGFyYW0ge0FycmF5fSBbY29udGV4dERpcnNdCiAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICovCgoKICBmdW5jdGlvbiBtYWtlVW5saW5rRm4odm0sIGRpcnMsIGNvbnRleHQsIGNvbnRleHREaXJzKSB7CiAgICBmdW5jdGlvbiB1bmxpbmsoZGVzdHJveWluZykgewogICAgICB0ZWFyZG93bkRpcnModm0sIGRpcnMsIGRlc3Ryb3lpbmcpOwoKICAgICAgaWYgKGNvbnRleHQgJiYgY29udGV4dERpcnMpIHsKICAgICAgICB0ZWFyZG93bkRpcnMoY29udGV4dCwgY29udGV4dERpcnMpOwogICAgICB9CiAgICB9IC8vIGV4cG9zZSBsaW5rZWQgZGlyZWN0aXZlcwoKCiAgICB1bmxpbmsuZGlycyA9IGRpcnM7CiAgICByZXR1cm4gdW5saW5rOwogIH0KICAvKioKICAgKiBUZWFyZG93biBwYXJ0aWFsIGxpbmtlZCBkaXJlY3RpdmVzLgogICAqCiAgICogQHBhcmFtIHtWdWV9IHZtCiAgICogQHBhcmFtIHtBcnJheX0gZGlycwogICAqIEBwYXJhbSB7Qm9vbGVhbn0gZGVzdHJveWluZwogICAqLwoKCiAgZnVuY3Rpb24gdGVhcmRvd25EaXJzKHZtLCBkaXJzLCBkZXN0cm95aW5nKSB7CiAgICB2YXIgaSA9IGRpcnMubGVuZ3RoOwoKICAgIHdoaWxlIChpLS0pIHsKICAgICAgZGlyc1tpXS5fdGVhcmRvd24oKTsKCiAgICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgIWRlc3Ryb3lpbmcpIHsKICAgICAgICB2bS5fZGlyZWN0aXZlcy4kcmVtb3ZlKGRpcnNbaV0pOwogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIENvbXBpbGUgbGluayBwcm9wcyBvbiBhbiBpbnN0YW5jZS4KICAgKgogICAqIEBwYXJhbSB7VnVlfSB2bQogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge09iamVjdH0gcHJvcHMKICAgKiBAcGFyYW0ge09iamVjdH0gW3Njb3BlXQogICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAqLwoKCiAgZnVuY3Rpb24gY29tcGlsZUFuZExpbmtQcm9wcyh2bSwgZWwsIHByb3BzLCBzY29wZSkgewogICAgdmFyIHByb3BzTGlua0ZuID0gY29tcGlsZVByb3BzKGVsLCBwcm9wcywgdm0pOwogICAgdmFyIHByb3BEaXJzID0gbGlua0FuZENhcHR1cmUoZnVuY3Rpb24gKCkgewogICAgICBwcm9wc0xpbmtGbih2bSwgc2NvcGUpOwogICAgfSwgdm0pOwogICAgcmV0dXJuIG1ha2VVbmxpbmtGbih2bSwgcHJvcERpcnMpOwogIH0KICAvKioKICAgKiBDb21waWxlIHRoZSByb290IGVsZW1lbnQgb2YgYW4gaW5zdGFuY2UuCiAgICoKICAgKiAxLiBhdHRycyBvbiBjb250ZXh0IGNvbnRhaW5lciAoY29udGV4dCBzY29wZSkKICAgKiAyLiBhdHRycyBvbiB0aGUgY29tcG9uZW50IHRlbXBsYXRlIHJvb3Qgbm9kZSwgaWYKICAgKiAgICByZXBsYWNlOnRydWUgKGNoaWxkIHNjb3BlKQogICAqCiAgICogSWYgdGhpcyBpcyBhIGZyYWdtZW50IGluc3RhbmNlLCB3ZSBvbmx5IG5lZWQgdG8gY29tcGlsZSAxLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHRPcHRpb25zCiAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICovCgoKICBmdW5jdGlvbiBjb21waWxlUm9vdChlbCwgb3B0aW9ucywgY29udGV4dE9wdGlvbnMpIHsKICAgIHZhciBjb250YWluZXJBdHRycyA9IG9wdGlvbnMuX2NvbnRhaW5lckF0dHJzOwogICAgdmFyIHJlcGxhY2VyQXR0cnMgPSBvcHRpb25zLl9yZXBsYWNlckF0dHJzOwogICAgdmFyIGNvbnRleHRMaW5rRm4sIHJlcGxhY2VyTGlua0ZuOyAvLyBvbmx5IG5lZWQgdG8gY29tcGlsZSBvdGhlciBhdHRyaWJ1dGVzIGZvcgogICAgLy8gbm9uLWZyYWdtZW50IGluc3RhbmNlcwoKICAgIGlmIChlbC5ub2RlVHlwZSAhPT0gMTEpIHsKICAgICAgLy8gZm9yIGNvbXBvbmVudHMsIGNvbnRhaW5lciBhbmQgcmVwbGFjZXIgbmVlZCB0byBiZQogICAgICAvLyBjb21waWxlZCBzZXBhcmF0ZWx5IGFuZCBsaW5rZWQgaW4gZGlmZmVyZW50IHNjb3Blcy4KICAgICAgaWYgKG9wdGlvbnMuX2FzQ29tcG9uZW50KSB7CiAgICAgICAgLy8gMi4gY29udGFpbmVyIGF0dHJpYnV0ZXMKICAgICAgICBpZiAoY29udGFpbmVyQXR0cnMgJiYgY29udGV4dE9wdGlvbnMpIHsKICAgICAgICAgIGNvbnRleHRMaW5rRm4gPSBjb21waWxlRGlyZWN0aXZlcyhjb250YWluZXJBdHRycywgY29udGV4dE9wdGlvbnMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlcGxhY2VyQXR0cnMpIHsKICAgICAgICAgIC8vIDMuIHJlcGxhY2VyIGF0dHJpYnV0ZXMKICAgICAgICAgIHJlcGxhY2VyTGlua0ZuID0gY29tcGlsZURpcmVjdGl2ZXMocmVwbGFjZXJBdHRycywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIG5vbi1jb21wb25lbnQsIGp1c3QgY29tcGlsZSBhcyBhIG5vcm1hbCBlbGVtZW50LgogICAgICAgIHJlcGxhY2VyTGlua0ZuID0gY29tcGlsZURpcmVjdGl2ZXMoZWwuYXR0cmlidXRlcywgb3B0aW9ucyk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIGNvbnRhaW5lckF0dHJzKSB7CiAgICAgIC8vIHdhcm4gY29udGFpbmVyIGRpcmVjdGl2ZXMgZm9yIGZyYWdtZW50IGluc3RhbmNlcwogICAgICB2YXIgbmFtZXMgPSBjb250YWluZXJBdHRycy5maWx0ZXIoZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgICAvLyBhbGxvdyB2dWUtbG9hZGVyL3Z1ZWlmeSBzY29wZWQgY3NzIGF0dHJpYnV0ZXMKICAgICAgICByZXR1cm4gYXR0ci5uYW1lLmluZGV4T2YoJ192LScpIDwgMCAmJiAvLyBhbGxvdyBldmVudCBsaXN0ZW5lcnMKICAgICAgICAhb25SRS50ZXN0KGF0dHIubmFtZSkgJiYgLy8gYWxsb3cgc2xvdHMKICAgICAgICBhdHRyLm5hbWUgIT09ICdzbG90JzsKICAgICAgfSkubWFwKGZ1bmN0aW9uIChhdHRyKSB7CiAgICAgICAgcmV0dXJuICciJyArIGF0dHIubmFtZSArICciJzsKICAgICAgfSk7CgogICAgICBpZiAobmFtZXMubGVuZ3RoKSB7CiAgICAgICAgdmFyIHBsdXJhbCA9IG5hbWVzLmxlbmd0aCA+IDE7CiAgICAgICAgd2FybignQXR0cmlidXRlJyArIChwbHVyYWwgPyAncyAnIDogJyAnKSArIG5hbWVzLmpvaW4oJywgJykgKyAocGx1cmFsID8gJyBhcmUnIDogJyBpcycpICsgJyBpZ25vcmVkIG9uIGNvbXBvbmVudCAnICsgJzwnICsgb3B0aW9ucy5lbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgKyAnPiBiZWNhdXNlICcgKyAndGhlIGNvbXBvbmVudCBpcyBhIGZyYWdtZW50IGluc3RhbmNlOiAnICsgJ2h0dHA6Ly92dWVqcy5vcmcvZ3VpZGUvY29tcG9uZW50cy5odG1sI0ZyYWdtZW50LUluc3RhbmNlJyk7CiAgICAgIH0KICAgIH0KCiAgICBvcHRpb25zLl9jb250YWluZXJBdHRycyA9IG9wdGlvbnMuX3JlcGxhY2VyQXR0cnMgPSBudWxsOwogICAgcmV0dXJuIGZ1bmN0aW9uIHJvb3RMaW5rRm4odm0sIGVsLCBzY29wZSkgewogICAgICAvLyBsaW5rIGNvbnRleHQgc2NvcGUgZGlycwogICAgICB2YXIgY29udGV4dCA9IHZtLl9jb250ZXh0OwogICAgICB2YXIgY29udGV4dERpcnM7CgogICAgICBpZiAoY29udGV4dCAmJiBjb250ZXh0TGlua0ZuKSB7CiAgICAgICAgY29udGV4dERpcnMgPSBsaW5rQW5kQ2FwdHVyZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjb250ZXh0TGlua0ZuKGNvbnRleHQsIGVsLCBudWxsLCBzY29wZSk7CiAgICAgICAgfSwgY29udGV4dCk7CiAgICAgIH0gLy8gbGluayBzZWxmCgoKICAgICAgdmFyIHNlbGZEaXJzID0gbGlua0FuZENhcHR1cmUoZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChyZXBsYWNlckxpbmtGbikgcmVwbGFjZXJMaW5rRm4odm0sIGVsKTsKICAgICAgfSwgdm0pOyAvLyByZXR1cm4gdGhlIHVubGluayBmdW5jdGlvbiB0aGF0IHRlYXJzZG93biBjb250ZXh0CiAgICAgIC8vIGNvbnRhaW5lciBkaXJlY3RpdmVzLgoKICAgICAgcmV0dXJuIG1ha2VVbmxpbmtGbih2bSwgc2VsZkRpcnMsIGNvbnRleHQsIGNvbnRleHREaXJzKTsKICAgIH07CiAgfQogIC8qKgogICAqIENvbXBpbGUgYSBub2RlIGFuZCByZXR1cm4gYSBub2RlTGlua0ZuIGJhc2VkIG9uIHRoZQogICAqIG5vZGUgdHlwZS4KICAgKgogICAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICogQHJldHVybiB7RnVuY3Rpb258bnVsbH0KICAgKi8KCgogIGZ1bmN0aW9uIGNvbXBpbGVOb2RlKG5vZGUsIG9wdGlvbnMpIHsKICAgIHZhciB0eXBlID0gbm9kZS5ub2RlVHlwZTsKCiAgICBpZiAodHlwZSA9PT0gMSAmJiAhaXNTY3JpcHQobm9kZSkpIHsKICAgICAgcmV0dXJuIGNvbXBpbGVFbGVtZW50KG5vZGUsIG9wdGlvbnMpOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAzICYmIG5vZGUuZGF0YS50cmltKCkpIHsKICAgICAgcmV0dXJuIGNvbXBpbGVUZXh0Tm9kZShub2RlLCBvcHRpb25zKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICAvKioKICAgKiBDb21waWxlIGFuIGVsZW1lbnQgYW5kIHJldHVybiBhIG5vZGVMaW5rRm4uCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcmV0dXJuIHtGdW5jdGlvbnxudWxsfQogICAqLwoKCiAgZnVuY3Rpb24gY29tcGlsZUVsZW1lbnQoZWwsIG9wdGlvbnMpIHsKICAgIC8vIHByZXByb2Nlc3MgdGV4dGFyZWFzLgogICAgLy8gdGV4dGFyZWEgdHJlYXRzIGl0cyB0ZXh0IGNvbnRlbnQgYXMgdGhlIGluaXRpYWwgdmFsdWUuCiAgICAvLyBqdXN0IGJpbmQgaXQgYXMgYW4gYXR0ciBkaXJlY3RpdmUgZm9yIHZhbHVlLgogICAgaWYgKGVsLnRhZ05hbWUgPT09ICdURVhUQVJFQScpIHsKICAgICAgdmFyIHRva2VucyA9IHBhcnNlVGV4dChlbC52YWx1ZSk7CgogICAgICBpZiAodG9rZW5zKSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCc6dmFsdWUnLCB0b2tlbnNUb0V4cCh0b2tlbnMpKTsKICAgICAgICBlbC52YWx1ZSA9ICcnOwogICAgICB9CiAgICB9CgogICAgdmFyIGxpbmtGbjsKICAgIHZhciBoYXNBdHRycyA9IGVsLmhhc0F0dHJpYnV0ZXMoKTsKICAgIHZhciBhdHRycyA9IGhhc0F0dHJzICYmIHRvQXJyYXkoZWwuYXR0cmlidXRlcyk7IC8vIGNoZWNrIHRlcm1pbmFsIGRpcmVjdGl2ZXMgKGZvciAmIGlmKQoKICAgIGlmIChoYXNBdHRycykgewogICAgICBsaW5rRm4gPSBjaGVja1Rlcm1pbmFsRGlyZWN0aXZlcyhlbCwgYXR0cnMsIG9wdGlvbnMpOwogICAgfSAvLyBjaGVjayBlbGVtZW50IGRpcmVjdGl2ZXMKCgogICAgaWYgKCFsaW5rRm4pIHsKICAgICAgbGlua0ZuID0gY2hlY2tFbGVtZW50RGlyZWN0aXZlcyhlbCwgb3B0aW9ucyk7CiAgICB9IC8vIGNoZWNrIGNvbXBvbmVudAoKCiAgICBpZiAoIWxpbmtGbikgewogICAgICBsaW5rRm4gPSBjaGVja0NvbXBvbmVudChlbCwgb3B0aW9ucyk7CiAgICB9IC8vIG5vcm1hbCBkaXJlY3RpdmVzCgoKICAgIGlmICghbGlua0ZuICYmIGhhc0F0dHJzKSB7CiAgICAgIGxpbmtGbiA9IGNvbXBpbGVEaXJlY3RpdmVzKGF0dHJzLCBvcHRpb25zKTsKICAgIH0KCiAgICByZXR1cm4gbGlua0ZuOwogIH0KICAvKioKICAgKiBDb21waWxlIGEgdGV4dE5vZGUgYW5kIHJldHVybiBhIG5vZGVMaW5rRm4uCiAgICoKICAgKiBAcGFyYW0ge1RleHROb2RlfSBub2RlCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcmV0dXJuIHtGdW5jdGlvbnxudWxsfSB0ZXh0Tm9kZUxpbmtGbgogICAqLwoKCiAgZnVuY3Rpb24gY29tcGlsZVRleHROb2RlKG5vZGUsIG9wdGlvbnMpIHsKICAgIC8vIHNraXAgbWFya2VkIHRleHQgbm9kZXMKICAgIGlmIChub2RlLl9za2lwKSB7CiAgICAgIHJldHVybiByZW1vdmVUZXh0OwogICAgfQoKICAgIHZhciB0b2tlbnMgPSBwYXJzZVRleHQobm9kZS53aG9sZVRleHQpOwoKICAgIGlmICghdG9rZW5zKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSAvLyBtYXJrIGFkamFjZW50IHRleHQgbm9kZXMgYXMgc2tpcHBlZCwKICAgIC8vIGJlY2F1c2Ugd2UgYXJlIHVzaW5nIG5vZGUud2hvbGVUZXh0IHRvIGNvbXBpbGUKICAgIC8vIGFsbCBhZGphY2VudCB0ZXh0IG5vZGVzIHRvZ2V0aGVyLiBUaGlzIGZpeGVzCiAgICAvLyBpc3N1ZXMgaW4gSUUgd2hlcmUgc29tZXRpbWVzIGl0IHNwbGl0cyB1cCBhIHNpbmdsZQogICAgLy8gdGV4dCBub2RlIGludG8gbXVsdGlwbGUgb25lcy4KCgogICAgdmFyIG5leHQgPSBub2RlLm5leHRTaWJsaW5nOwoKICAgIHdoaWxlIChuZXh0ICYmIG5leHQubm9kZVR5cGUgPT09IDMpIHsKICAgICAgbmV4dC5fc2tpcCA9IHRydWU7CiAgICAgIG5leHQgPSBuZXh0Lm5leHRTaWJsaW5nOwogICAgfQoKICAgIHZhciBmcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgdmFyIGVsLCB0b2tlbjsKCiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRva2Vucy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdG9rZW4gPSB0b2tlbnNbaV07CiAgICAgIGVsID0gdG9rZW4udGFnID8gcHJvY2Vzc1RleHRUb2tlbih0b2tlbiwgb3B0aW9ucykgOiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0b2tlbi52YWx1ZSk7CiAgICAgIGZyYWcuYXBwZW5kQ2hpbGQoZWwpOwogICAgfQoKICAgIHJldHVybiBtYWtlVGV4dE5vZGVMaW5rRm4odG9rZW5zLCBmcmFnLCBvcHRpb25zKTsKICB9CiAgLyoqCiAgICogTGlua2VyIGZvciBhbiBza2lwcGVkIHRleHQgbm9kZS4KICAgKgogICAqIEBwYXJhbSB7VnVlfSB2bQogICAqIEBwYXJhbSB7VGV4dH0gbm9kZQogICAqLwoKCiAgZnVuY3Rpb24gcmVtb3ZlVGV4dCh2bSwgbm9kZSkgewogICAgcmVtb3ZlKG5vZGUpOwogIH0KICAvKioKICAgKiBQcm9jZXNzIGEgc2luZ2xlIHRleHQgdG9rZW4uCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gdG9rZW4KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEByZXR1cm4ge05vZGV9CiAgICovCgoKICBmdW5jdGlvbiBwcm9jZXNzVGV4dFRva2VuKHRva2VuLCBvcHRpb25zKSB7CiAgICB2YXIgZWw7CgogICAgaWYgKHRva2VuLm9uZVRpbWUpIHsKICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0b2tlbi52YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICBpZiAodG9rZW4uaHRtbCkgewogICAgICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlQ29tbWVudCgndi1odG1sJyk7CiAgICAgICAgc2V0VG9rZW5UeXBlKCdodG1sJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gSUUgd2lsbCBjbGVhbiB1cCBlbXB0eSB0ZXh0Tm9kZXMgZHVyaW5nCiAgICAgICAgLy8gZnJhZy5jbG9uZU5vZGUodHJ1ZSksIHNvIHdlIGhhdmUgdG8gZ2l2ZSBpdAogICAgICAgIC8vIHNvbWV0aGluZyBoZXJlLi4uCiAgICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnICcpOwogICAgICAgIHNldFRva2VuVHlwZSgndGV4dCcpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG9rZW5UeXBlKHR5cGUpIHsKICAgICAgaWYgKHRva2VuLmRlc2NyaXB0b3IpIHJldHVybjsKICAgICAgdmFyIHBhcnNlZCA9IHBhcnNlRGlyZWN0aXZlKHRva2VuLnZhbHVlKTsKICAgICAgdG9rZW4uZGVzY3JpcHRvciA9IHsKICAgICAgICBuYW1lOiB0eXBlLAogICAgICAgIGRlZjogZGlyZWN0aXZlc1t0eXBlXSwKICAgICAgICBleHByZXNzaW9uOiBwYXJzZWQuZXhwcmVzc2lvbiwKICAgICAgICBmaWx0ZXJzOiBwYXJzZWQuZmlsdGVycwogICAgICB9OwogICAgfQoKICAgIHJldHVybiBlbDsKICB9CiAgLyoqCiAgICogQnVpbGQgYSBmdW5jdGlvbiB0aGF0IHByb2Nlc3NlcyBhIHRleHROb2RlLgogICAqCiAgICogQHBhcmFtIHtBcnJheTxPYmplY3Q+fSB0b2tlbnMKICAgKiBAcGFyYW0ge0RvY3VtZW50RnJhZ21lbnR9IGZyYWcKICAgKi8KCgogIGZ1bmN0aW9uIG1ha2VUZXh0Tm9kZUxpbmtGbih0b2tlbnMsIGZyYWcpIHsKICAgIHJldHVybiBmdW5jdGlvbiB0ZXh0Tm9kZUxpbmtGbih2bSwgZWwsIGhvc3QsIHNjb3BlKSB7CiAgICAgIHZhciBmcmFnQ2xvbmUgPSBmcmFnLmNsb25lTm9kZSh0cnVlKTsKICAgICAgdmFyIGNoaWxkTm9kZXMgPSB0b0FycmF5KGZyYWdDbG9uZS5jaGlsZE5vZGVzKTsKICAgICAgdmFyIHRva2VuLCB2YWx1ZSwgbm9kZTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdG9rZW5zLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHRva2VuID0gdG9rZW5zW2ldOwogICAgICAgIHZhbHVlID0gdG9rZW4udmFsdWU7CgogICAgICAgIGlmICh0b2tlbi50YWcpIHsKICAgICAgICAgIG5vZGUgPSBjaGlsZE5vZGVzW2ldOwoKICAgICAgICAgIGlmICh0b2tlbi5vbmVUaW1lKSB7CiAgICAgICAgICAgIHZhbHVlID0gKHNjb3BlIHx8IHZtKS4kZXZhbCh2YWx1ZSk7CgogICAgICAgICAgICBpZiAodG9rZW4uaHRtbCkgewogICAgICAgICAgICAgIHJlcGxhY2Uobm9kZSwgcGFyc2VUZW1wbGF0ZSh2YWx1ZSwgdHJ1ZSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG5vZGUuZGF0YSA9IF90b1N0cmluZyh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLl9iaW5kRGlyKHRva2VuLmRlc2NyaXB0b3IsIG5vZGUsIGhvc3QsIHNjb3BlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJlcGxhY2UoZWwsIGZyYWdDbG9uZSk7CiAgICB9OwogIH0KICAvKioKICAgKiBDb21waWxlIGEgbm9kZSBsaXN0IGFuZCByZXR1cm4gYSBjaGlsZExpbmtGbi4KICAgKgogICAqIEBwYXJhbSB7Tm9kZUxpc3R9IG5vZGVMaXN0CiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcmV0dXJuIHtGdW5jdGlvbnx1bmRlZmluZWR9CiAgICovCgoKICBmdW5jdGlvbiBjb21waWxlTm9kZUxpc3Qobm9kZUxpc3QsIG9wdGlvbnMpIHsKICAgIHZhciBsaW5rRm5zID0gW107CiAgICB2YXIgbm9kZUxpbmtGbiwgY2hpbGRMaW5rRm4sIG5vZGU7CgogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBub2RlTGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgbm9kZSA9IG5vZGVMaXN0W2ldOwogICAgICBub2RlTGlua0ZuID0gY29tcGlsZU5vZGUobm9kZSwgb3B0aW9ucyk7CiAgICAgIGNoaWxkTGlua0ZuID0gIShub2RlTGlua0ZuICYmIG5vZGVMaW5rRm4udGVybWluYWwpICYmIG5vZGUudGFnTmFtZSAhPT0gJ1NDUklQVCcgJiYgbm9kZS5oYXNDaGlsZE5vZGVzKCkgPyBjb21waWxlTm9kZUxpc3Qobm9kZS5jaGlsZE5vZGVzLCBvcHRpb25zKSA6IG51bGw7CiAgICAgIGxpbmtGbnMucHVzaChub2RlTGlua0ZuLCBjaGlsZExpbmtGbik7CiAgICB9CgogICAgcmV0dXJuIGxpbmtGbnMubGVuZ3RoID8gbWFrZUNoaWxkTGlua0ZuKGxpbmtGbnMpIDogbnVsbDsKICB9CiAgLyoqCiAgICogTWFrZSBhIGNoaWxkIGxpbmsgZnVuY3Rpb24gZm9yIGEgbm9kZSdzIGNoaWxkTm9kZXMuCiAgICoKICAgKiBAcGFyYW0ge0FycmF5PEZ1bmN0aW9uPn0gbGlua0ZucwogICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBjaGlsZExpbmtGbgogICAqLwoKCiAgZnVuY3Rpb24gbWFrZUNoaWxkTGlua0ZuKGxpbmtGbnMpIHsKICAgIHJldHVybiBmdW5jdGlvbiBjaGlsZExpbmtGbih2bSwgbm9kZXMsIGhvc3QsIHNjb3BlLCBmcmFnKSB7CiAgICAgIHZhciBub2RlLCBub2RlTGlua0ZuLCBjaGlsZHJlbkxpbmtGbjsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gMCwgbCA9IGxpbmtGbnMubGVuZ3RoOyBpIDwgbDsgbisrKSB7CiAgICAgICAgbm9kZSA9IG5vZGVzW25dOwogICAgICAgIG5vZGVMaW5rRm4gPSBsaW5rRm5zW2krK107CiAgICAgICAgY2hpbGRyZW5MaW5rRm4gPSBsaW5rRm5zW2krK107IC8vIGNhY2hlIGNoaWxkTm9kZXMgYmVmb3JlIGxpbmtpbmcgcGFyZW50LCBmaXggIzY1NwoKICAgICAgICB2YXIgY2hpbGROb2RlcyA9IHRvQXJyYXkobm9kZS5jaGlsZE5vZGVzKTsKCiAgICAgICAgaWYgKG5vZGVMaW5rRm4pIHsKICAgICAgICAgIG5vZGVMaW5rRm4odm0sIG5vZGUsIGhvc3QsIHNjb3BlLCBmcmFnKTsKICAgICAgICB9CgogICAgICAgIGlmIChjaGlsZHJlbkxpbmtGbikgewogICAgICAgICAgY2hpbGRyZW5MaW5rRm4odm0sIGNoaWxkTm9kZXMsIGhvc3QsIHNjb3BlLCBmcmFnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfQogIC8qKgogICAqIENoZWNrIGZvciBlbGVtZW50IGRpcmVjdGl2ZXMgKGN1c3RvbSBlbGVtZW50cyB0aGF0IHNob3VsZAogICAqIGJlIHJlc292bGVkIGFzIHRlcm1pbmFsIGRpcmVjdGl2ZXMpLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICovCgoKICBmdW5jdGlvbiBjaGVja0VsZW1lbnREaXJlY3RpdmVzKGVsLCBvcHRpb25zKSB7CiAgICB2YXIgdGFnID0gZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpOwoKICAgIGlmIChjb21tb25UYWdSRS50ZXN0KHRhZykpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBkZWYgPSByZXNvbHZlQXNzZXQob3B0aW9ucywgJ2VsZW1lbnREaXJlY3RpdmVzJywgdGFnKTsKCiAgICBpZiAoZGVmKSB7CiAgICAgIHJldHVybiBtYWtlVGVybWluYWxOb2RlTGlua0ZuKGVsLCB0YWcsICcnLCBvcHRpb25zLCBkZWYpOwogICAgfQogIH0KICAvKioKICAgKiBDaGVjayBpZiBhbiBlbGVtZW50IGlzIGEgY29tcG9uZW50LiBJZiB5ZXMsIHJldHVybgogICAqIGEgY29tcG9uZW50IGxpbmsgZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcmV0dXJuIHtGdW5jdGlvbnx1bmRlZmluZWR9CiAgICovCgoKICBmdW5jdGlvbiBjaGVja0NvbXBvbmVudChlbCwgb3B0aW9ucykgewogICAgdmFyIGNvbXBvbmVudCA9IGNoZWNrQ29tcG9uZW50QXR0cihlbCwgb3B0aW9ucyk7CgogICAgaWYgKGNvbXBvbmVudCkgewogICAgICB2YXIgcmVmID0gZmluZFJlZihlbCk7CiAgICAgIHZhciBkZXNjcmlwdG9yID0gewogICAgICAgIG5hbWU6ICdjb21wb25lbnQnLAogICAgICAgIHJlZjogcmVmLAogICAgICAgIGV4cHJlc3Npb246IGNvbXBvbmVudC5pZCwKICAgICAgICBkZWY6IGludGVybmFsRGlyZWN0aXZlcy5jb21wb25lbnQsCiAgICAgICAgbW9kaWZpZXJzOiB7CiAgICAgICAgICBsaXRlcmFsOiAhY29tcG9uZW50LmR5bmFtaWMKICAgICAgICB9CiAgICAgIH07CgogICAgICB2YXIgY29tcG9uZW50TGlua0ZuID0gZnVuY3Rpb24gY29tcG9uZW50TGlua0ZuKHZtLCBlbCwgaG9zdCwgc2NvcGUsIGZyYWcpIHsKICAgICAgICBpZiAocmVmKSB7CiAgICAgICAgICBkZWZpbmVSZWFjdGl2ZSgoc2NvcGUgfHwgdm0pLiRyZWZzLCByZWYsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgdm0uX2JpbmREaXIoZGVzY3JpcHRvciwgZWwsIGhvc3QsIHNjb3BlLCBmcmFnKTsKICAgICAgfTsKCiAgICAgIGNvbXBvbmVudExpbmtGbi50ZXJtaW5hbCA9IHRydWU7CiAgICAgIHJldHVybiBjb21wb25lbnRMaW5rRm47CiAgICB9CiAgfQogIC8qKgogICAqIENoZWNrIGFuIGVsZW1lbnQgZm9yIHRlcm1pbmFsIGRpcmVjdGl2ZXMgaW4gZml4ZWQgb3JkZXIuCiAgICogSWYgaXQgZmluZHMgb25lLCByZXR1cm4gYSB0ZXJtaW5hbCBsaW5rIGZ1bmN0aW9uLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7QXJyYXl9IGF0dHJzCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gdGVybWluYWxMaW5rRm4KICAgKi8KCgogIGZ1bmN0aW9uIGNoZWNrVGVybWluYWxEaXJlY3RpdmVzKGVsLCBhdHRycywgb3B0aW9ucykgewogICAgLy8gc2tpcCB2LXByZQogICAgaWYgKGdldEF0dHIoZWwsICd2LXByZScpICE9PSBudWxsKSB7CiAgICAgIHJldHVybiBza2lwOwogICAgfSAvLyBza2lwIHYtZWxzZSBibG9jaywgYnV0IG9ubHkgaWYgZm9sbG93aW5nIHYtaWYKCgogICAgaWYgKGVsLmhhc0F0dHJpYnV0ZSgndi1lbHNlJykpIHsKICAgICAgdmFyIHByZXYgPSBlbC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwoKICAgICAgaWYgKHByZXYgJiYgcHJldi5oYXNBdHRyaWJ1dGUoJ3YtaWYnKSkgewogICAgICAgIHJldHVybiBza2lwOwogICAgICB9CiAgICB9CgogICAgdmFyIGF0dHIsIG5hbWUsIHZhbHVlLCBtb2RpZmllcnMsIG1hdGNoZWQsIGRpck5hbWUsIHJhd05hbWUsIGFyZywgZGVmLCB0ZXJtRGVmOwoKICAgIGZvciAodmFyIGkgPSAwLCBqID0gYXR0cnMubGVuZ3RoOyBpIDwgajsgaSsrKSB7CiAgICAgIGF0dHIgPSBhdHRyc1tpXTsKICAgICAgbmFtZSA9IGF0dHIubmFtZS5yZXBsYWNlKG1vZGlmaWVyUkUsICcnKTsKCiAgICAgIGlmIChtYXRjaGVkID0gbmFtZS5tYXRjaChkaXJBdHRyUkUpKSB7CiAgICAgICAgZGVmID0gcmVzb2x2ZUFzc2V0KG9wdGlvbnMsICdkaXJlY3RpdmVzJywgbWF0Y2hlZFsxXSk7CgogICAgICAgIGlmIChkZWYgJiYgZGVmLnRlcm1pbmFsKSB7CiAgICAgICAgICBpZiAoIXRlcm1EZWYgfHwgKGRlZi5wcmlvcml0eSB8fCBERUZBVUxUX1RFUk1JTkFMX1BSSU9SSVRZKSA+IHRlcm1EZWYucHJpb3JpdHkpIHsKICAgICAgICAgICAgdGVybURlZiA9IGRlZjsKICAgICAgICAgICAgcmF3TmFtZSA9IGF0dHIubmFtZTsKICAgICAgICAgICAgbW9kaWZpZXJzID0gcGFyc2VNb2RpZmllcnMoYXR0ci5uYW1lKTsKICAgICAgICAgICAgdmFsdWUgPSBhdHRyLnZhbHVlOwogICAgICAgICAgICBkaXJOYW1lID0gbWF0Y2hlZFsxXTsKICAgICAgICAgICAgYXJnID0gbWF0Y2hlZFsyXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAodGVybURlZikgewogICAgICByZXR1cm4gbWFrZVRlcm1pbmFsTm9kZUxpbmtGbihlbCwgZGlyTmFtZSwgdmFsdWUsIG9wdGlvbnMsIHRlcm1EZWYsIHJhd05hbWUsIGFyZywgbW9kaWZpZXJzKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHNraXAoKSB7fQoKICBza2lwLnRlcm1pbmFsID0gdHJ1ZTsKICAvKioKICAgKiBCdWlsZCBhIG5vZGUgbGluayBmdW5jdGlvbiBmb3IgYSB0ZXJtaW5hbCBkaXJlY3RpdmUuCiAgICogQSB0ZXJtaW5hbCBsaW5rIGZ1bmN0aW9uIHRlcm1pbmF0ZXMgdGhlIGN1cnJlbnQKICAgKiBjb21waWxhdGlvbiByZWN1cnNpb24gYW5kIGhhbmRsZXMgY29tcGlsYXRpb24gb2YgdGhlCiAgICogc3VidHJlZSBpbiB0aGUgZGlyZWN0aXZlLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7U3RyaW5nfSBkaXJOYW1lCiAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcGFyYW0ge09iamVjdH0gZGVmCiAgICogQHBhcmFtIHtTdHJpbmd9IFtyYXdOYW1lXQogICAqIEBwYXJhbSB7U3RyaW5nfSBbYXJnXQogICAqIEBwYXJhbSB7T2JqZWN0fSBbbW9kaWZpZXJzXQogICAqIEByZXR1cm4ge0Z1bmN0aW9ufSB0ZXJtaW5hbExpbmtGbgogICAqLwoKICBmdW5jdGlvbiBtYWtlVGVybWluYWxOb2RlTGlua0ZuKGVsLCBkaXJOYW1lLCB2YWx1ZSwgb3B0aW9ucywgZGVmLCByYXdOYW1lLCBhcmcsIG1vZGlmaWVycykgewogICAgdmFyIHBhcnNlZCA9IHBhcnNlRGlyZWN0aXZlKHZhbHVlKTsKICAgIHZhciBkZXNjcmlwdG9yID0gewogICAgICBuYW1lOiBkaXJOYW1lLAogICAgICBhcmc6IGFyZywKICAgICAgZXhwcmVzc2lvbjogcGFyc2VkLmV4cHJlc3Npb24sCiAgICAgIGZpbHRlcnM6IHBhcnNlZC5maWx0ZXJzLAogICAgICByYXc6IHZhbHVlLAogICAgICBhdHRyOiByYXdOYW1lLAogICAgICBtb2RpZmllcnM6IG1vZGlmaWVycywKICAgICAgZGVmOiBkZWYKICAgIH07IC8vIGNoZWNrIHJlZiBmb3Igdi1mb3IgYW5kIHJvdXRlci12aWV3CgogICAgaWYgKGRpck5hbWUgPT09ICdmb3InIHx8IGRpck5hbWUgPT09ICdyb3V0ZXItdmlldycpIHsKICAgICAgZGVzY3JpcHRvci5yZWYgPSBmaW5kUmVmKGVsKTsKICAgIH0KCiAgICB2YXIgZm4gPSBmdW5jdGlvbiB0ZXJtaW5hbE5vZGVMaW5rRm4odm0sIGVsLCBob3N0LCBzY29wZSwgZnJhZykgewogICAgICBpZiAoZGVzY3JpcHRvci5yZWYpIHsKICAgICAgICBkZWZpbmVSZWFjdGl2ZSgoc2NvcGUgfHwgdm0pLiRyZWZzLCBkZXNjcmlwdG9yLnJlZiwgbnVsbCk7CiAgICAgIH0KCiAgICAgIHZtLl9iaW5kRGlyKGRlc2NyaXB0b3IsIGVsLCBob3N0LCBzY29wZSwgZnJhZyk7CiAgICB9OwoKICAgIGZuLnRlcm1pbmFsID0gdHJ1ZTsKICAgIHJldHVybiBmbjsKICB9CiAgLyoqCiAgICogQ29tcGlsZSB0aGUgZGlyZWN0aXZlcyBvbiBhbiBlbGVtZW50IGFuZCByZXR1cm4gYSBsaW5rZXIuCiAgICoKICAgKiBAcGFyYW0ge0FycmF5fE5hbWVkTm9kZU1hcH0gYXR0cnMKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAqLwoKCiAgZnVuY3Rpb24gY29tcGlsZURpcmVjdGl2ZXMoYXR0cnMsIG9wdGlvbnMpIHsKICAgIHZhciBpID0gYXR0cnMubGVuZ3RoOwogICAgdmFyIGRpcnMgPSBbXTsKICAgIHZhciBhdHRyLCBuYW1lLCB2YWx1ZSwgcmF3TmFtZSwgcmF3VmFsdWUsIGRpck5hbWUsIGFyZywgbW9kaWZpZXJzLCBkaXJEZWYsIHRva2VucywgbWF0Y2hlZDsKCiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIGF0dHIgPSBhdHRyc1tpXTsKICAgICAgbmFtZSA9IHJhd05hbWUgPSBhdHRyLm5hbWU7CiAgICAgIHZhbHVlID0gcmF3VmFsdWUgPSBhdHRyLnZhbHVlOwogICAgICB0b2tlbnMgPSBwYXJzZVRleHQodmFsdWUpOyAvLyByZXNldCBhcmcKCiAgICAgIGFyZyA9IG51bGw7IC8vIGNoZWNrIG1vZGlmaWVycwoKICAgICAgbW9kaWZpZXJzID0gcGFyc2VNb2RpZmllcnMobmFtZSk7CiAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UobW9kaWZpZXJSRSwgJycpOyAvLyBhdHRyaWJ1dGUgaW50ZXJwb2xhdGlvbnMKCiAgICAgIGlmICh0b2tlbnMpIHsKICAgICAgICB2YWx1ZSA9IHRva2Vuc1RvRXhwKHRva2Vucyk7CiAgICAgICAgYXJnID0gbmFtZTsKICAgICAgICBwdXNoRGlyKCdiaW5kJywgZGlyZWN0aXZlcy5iaW5kLCB0b2tlbnMpOyAvLyB3YXJuIGFnYWluc3QgbWl4aW5nIG11c3RhY2hlcyB3aXRoIHYtYmluZAoKICAgICAgICBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICBpZiAobmFtZSA9PT0gJ2NsYXNzJyAmJiBBcnJheS5wcm90b3R5cGUuc29tZS5jYWxsKGF0dHJzLCBmdW5jdGlvbiAoYXR0cikgewogICAgICAgICAgICByZXR1cm4gYXR0ci5uYW1lID09PSAnOmNsYXNzJyB8fCBhdHRyLm5hbWUgPT09ICd2LWJpbmQ6Y2xhc3MnOwogICAgICAgICAgfSkpIHsKICAgICAgICAgICAgd2FybignY2xhc3M9IicgKyByYXdWYWx1ZSArICciOiBEbyBub3QgbWl4IG11c3RhY2hlIGludGVycG9sYXRpb24gJyArICdhbmQgdi1iaW5kIGZvciAiY2xhc3MiIG9uIHRoZSBzYW1lIGVsZW1lbnQuIFVzZSBvbmUgb3IgdGhlIG90aGVyLicsIG9wdGlvbnMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIC8vIHNwZWNpYWwgYXR0cmlidXRlOiB0cmFuc2l0aW9uCiAgICAgICAgaWYgKHRyYW5zaXRpb25SRS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICBtb2RpZmllcnMubGl0ZXJhbCA9ICFiaW5kUkUudGVzdChuYW1lKTsKICAgICAgICAgIHB1c2hEaXIoJ3RyYW5zaXRpb24nLCBpbnRlcm5hbERpcmVjdGl2ZXMudHJhbnNpdGlvbik7CiAgICAgICAgfSBlbHNlIC8vIGV2ZW50IGhhbmRsZXJzCiAgICAgICAgICBpZiAob25SRS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICAgIGFyZyA9IG5hbWUucmVwbGFjZShvblJFLCAnJyk7CiAgICAgICAgICAgIHB1c2hEaXIoJ29uJywgZGlyZWN0aXZlcy5vbik7CiAgICAgICAgICB9IGVsc2UgLy8gYXR0cmlidXRlIGJpbmRpbmdzCiAgICAgICAgICAgIGlmIChiaW5kUkUudGVzdChuYW1lKSkgewogICAgICAgICAgICAgIGRpck5hbWUgPSBuYW1lLnJlcGxhY2UoYmluZFJFLCAnJyk7CgogICAgICAgICAgICAgIGlmIChkaXJOYW1lID09PSAnc3R5bGUnIHx8IGRpck5hbWUgPT09ICdjbGFzcycpIHsKICAgICAgICAgICAgICAgIHB1c2hEaXIoZGlyTmFtZSwgaW50ZXJuYWxEaXJlY3RpdmVzW2Rpck5hbWVdKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXJnID0gZGlyTmFtZTsKICAgICAgICAgICAgICAgIHB1c2hEaXIoJ2JpbmQnLCBkaXJlY3RpdmVzLmJpbmQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIC8vIG5vcm1hbCBkaXJlY3RpdmVzCiAgICAgICAgICAgICAgaWYgKG1hdGNoZWQgPSBuYW1lLm1hdGNoKGRpckF0dHJSRSkpIHsKICAgICAgICAgICAgICAgIGRpck5hbWUgPSBtYXRjaGVkWzFdOwogICAgICAgICAgICAgICAgYXJnID0gbWF0Y2hlZFsyXTsgLy8gc2tpcCB2LWVsc2UgKHdoZW4gdXNlZCB3aXRoIHYtc2hvdykKCiAgICAgICAgICAgICAgICBpZiAoZGlyTmFtZSA9PT0gJ2Vsc2UnKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGRpckRlZiA9IHJlc29sdmVBc3NldChvcHRpb25zLCAnZGlyZWN0aXZlcycsIGRpck5hbWUsIHRydWUpOwoKICAgICAgICAgICAgICAgIGlmIChkaXJEZWYpIHsKICAgICAgICAgICAgICAgICAgcHVzaERpcihkaXJOYW1lLCBkaXJEZWYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUHVzaCBhIGRpcmVjdGl2ZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZGlyTmFtZQogICAgICogQHBhcmFtIHtPYmplY3R8RnVuY3Rpb259IGRlZgogICAgICogQHBhcmFtIHtBcnJheX0gW2ludGVycFRva2Vuc10KICAgICAqLwoKCiAgICBmdW5jdGlvbiBwdXNoRGlyKGRpck5hbWUsIGRlZiwgaW50ZXJwVG9rZW5zKSB7CiAgICAgIHZhciBoYXNPbmVUaW1lVG9rZW4gPSBpbnRlcnBUb2tlbnMgJiYgaGFzT25lVGltZShpbnRlcnBUb2tlbnMpOwogICAgICB2YXIgcGFyc2VkID0gIWhhc09uZVRpbWVUb2tlbiAmJiBwYXJzZURpcmVjdGl2ZSh2YWx1ZSk7CiAgICAgIGRpcnMucHVzaCh7CiAgICAgICAgbmFtZTogZGlyTmFtZSwKICAgICAgICBhdHRyOiByYXdOYW1lLAogICAgICAgIHJhdzogcmF3VmFsdWUsCiAgICAgICAgZGVmOiBkZWYsCiAgICAgICAgYXJnOiBhcmcsCiAgICAgICAgbW9kaWZpZXJzOiBtb2RpZmllcnMsCiAgICAgICAgLy8gY29udmVyc2lvbiBmcm9tIGludGVycG9sYXRpb24gc3RyaW5ncyB3aXRoIG9uZS10aW1lIHRva2VuCiAgICAgICAgLy8gdG8gZXhwcmVzc2lvbiBpcyBkaWZmZXJlZCB1bnRpbCBkaXJlY3RpdmUgYmluZCB0aW1lIHNvIHRoYXQgd2UKICAgICAgICAvLyBoYXZlIGFjY2VzcyB0byB0aGUgYWN0dWFsIHZtIGNvbnRleHQgZm9yIG9uZS10aW1lIGJpbmRpbmdzLgogICAgICAgIGV4cHJlc3Npb246IHBhcnNlZCAmJiBwYXJzZWQuZXhwcmVzc2lvbiwKICAgICAgICBmaWx0ZXJzOiBwYXJzZWQgJiYgcGFyc2VkLmZpbHRlcnMsCiAgICAgICAgaW50ZXJwOiBpbnRlcnBUb2tlbnMsCiAgICAgICAgaGFzT25lVGltZTogaGFzT25lVGltZVRva2VuCiAgICAgIH0pOwogICAgfQoKICAgIGlmIChkaXJzLmxlbmd0aCkgewogICAgICByZXR1cm4gbWFrZU5vZGVMaW5rRm4oZGlycyk7CiAgICB9CiAgfQogIC8qKgogICAqIFBhcnNlIG1vZGlmaWVycyBmcm9tIGRpcmVjdGl2ZSBhdHRyaWJ1dGUgbmFtZS4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAgICogQHJldHVybiB7T2JqZWN0fQogICAqLwoKCiAgZnVuY3Rpb24gcGFyc2VNb2RpZmllcnMobmFtZSkgewogICAgdmFyIHJlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB2YXIgbWF0Y2ggPSBuYW1lLm1hdGNoKG1vZGlmaWVyUkUpOwoKICAgIGlmIChtYXRjaCkgewogICAgICB2YXIgaSA9IG1hdGNoLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICByZXNbbWF0Y2hbaV0uc2xpY2UoMSldID0gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXM7CiAgfQogIC8qKgogICAqIEJ1aWxkIGEgbGluayBmdW5jdGlvbiBmb3IgYWxsIGRpcmVjdGl2ZXMgb24gYSBzaW5nbGUgbm9kZS4KICAgKgogICAqIEBwYXJhbSB7QXJyYXl9IGRpcmVjdGl2ZXMKICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gZGlyZWN0aXZlc0xpbmtGbgogICAqLwoKCiAgZnVuY3Rpb24gbWFrZU5vZGVMaW5rRm4oZGlyZWN0aXZlcykgewogICAgcmV0dXJuIGZ1bmN0aW9uIG5vZGVMaW5rRm4odm0sIGVsLCBob3N0LCBzY29wZSwgZnJhZykgewogICAgICAvLyByZXZlcnNlIGFwcGx5IGJlY2F1c2UgaXQncyBzb3J0ZWQgbG93IHRvIGhpZ2gKICAgICAgdmFyIGkgPSBkaXJlY3RpdmVzLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB2bS5fYmluZERpcihkaXJlY3RpdmVzW2ldLCBlbCwgaG9zdCwgc2NvcGUsIGZyYWcpOwogICAgICB9CiAgICB9OwogIH0KICAvKioKICAgKiBDaGVjayBpZiBhbiBpbnRlcnBvbGF0aW9uIHN0cmluZyBjb250YWlucyBvbmUtdGltZSB0b2tlbnMuCiAgICoKICAgKiBAcGFyYW0ge0FycmF5fSB0b2tlbnMKICAgKiBAcmV0dXJuIHtCb29sZWFufQogICAqLwoKCiAgZnVuY3Rpb24gaGFzT25lVGltZSh0b2tlbnMpIHsKICAgIHZhciBpID0gdG9rZW5zLmxlbmd0aDsKCiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIGlmICh0b2tlbnNbaV0ub25lVGltZSkgcmV0dXJuIHRydWU7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpc1NjcmlwdChlbCkgewogICAgcmV0dXJuIGVsLnRhZ05hbWUgPT09ICdTQ1JJUFQnICYmICghZWwuaGFzQXR0cmlidXRlKCd0eXBlJykgfHwgZWwuZ2V0QXR0cmlidXRlKCd0eXBlJykgPT09ICd0ZXh0L2phdmFzY3JpcHQnKTsKICB9CgogIHZhciBzcGVjaWFsQ2hhclJFID0gL1teXHdcLTpcLl0vOwogIC8qKgogICAqIFByb2Nlc3MgYW4gZWxlbWVudCBvciBhIERvY3VtZW50RnJhZ21lbnQgYmFzZWQgb24gYQogICAqIGluc3RhbmNlIG9wdGlvbiBvYmplY3QuIFRoaXMgYWxsb3dzIHVzIHRvIHRyYW5zY2x1ZGUKICAgKiBhIHRlbXBsYXRlIG5vZGUvZnJhZ21lbnQgYmVmb3JlIHRoZSBpbnN0YW5jZSBpcyBjcmVhdGVkLAogICAqIHNvIHRoZSBwcm9jZXNzZWQgZnJhZ21lbnQgY2FuIHRoZW4gYmUgY2xvbmVkIGFuZCByZXVzZWQKICAgKiBpbiB2LWZvci4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEByZXR1cm4ge0VsZW1lbnR8RG9jdW1lbnRGcmFnbWVudH0KICAgKi8KCiAgZnVuY3Rpb24gdHJhbnNjbHVkZShlbCwgb3B0aW9ucykgewogICAgLy8gZXh0cmFjdCBjb250YWluZXIgYXR0cmlidXRlcyB0byBwYXNzIHRoZW0gZG93bgogICAgLy8gdG8gY29tcGlsZXIsIGJlY2F1c2UgdGhleSBuZWVkIHRvIGJlIGNvbXBpbGVkIGluCiAgICAvLyBwYXJlbnQgc2NvcGUuIHdlIGFyZSBtdXRhdGluZyB0aGUgb3B0aW9ucyBvYmplY3QgaGVyZQogICAgLy8gYXNzdW1pbmcgdGhlIHNhbWUgb2JqZWN0IHdpbGwgYmUgdXNlZCBmb3IgY29tcGlsZQogICAgLy8gcmlnaHQgYWZ0ZXIgdGhpcy4KICAgIGlmIChvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMuX2NvbnRhaW5lckF0dHJzID0gZXh0cmFjdEF0dHJzKGVsKTsKICAgIH0gLy8gZm9yIHRlbXBsYXRlIHRhZ3MsIHdoYXQgd2Ugd2FudCBpcyBpdHMgY29udGVudCBhcwogICAgLy8gYSBkb2N1bWVudEZyYWdtZW50IChmb3IgZnJhZ21lbnQgaW5zdGFuY2VzKQoKCiAgICBpZiAoaXNUZW1wbGF0ZShlbCkpIHsKICAgICAgZWwgPSBwYXJzZVRlbXBsYXRlKGVsKTsKICAgIH0KCiAgICBpZiAob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucy5fYXNDb21wb25lbnQgJiYgIW9wdGlvbnMudGVtcGxhdGUpIHsKICAgICAgICBvcHRpb25zLnRlbXBsYXRlID0gJzxzbG90Pjwvc2xvdD4nOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50ZW1wbGF0ZSkgewogICAgICAgIG9wdGlvbnMuX2NvbnRlbnQgPSBleHRyYWN0Q29udGVudChlbCk7CiAgICAgICAgZWwgPSB0cmFuc2NsdWRlVGVtcGxhdGUoZWwsIG9wdGlvbnMpOwogICAgICB9CiAgICB9CgogICAgaWYgKGlzRnJhZ21lbnQoZWwpKSB7CiAgICAgIC8vIGFuY2hvcnMgZm9yIGZyYWdtZW50IGluc3RhbmNlCiAgICAgIC8vIHBhc3NpbmcgaW4gYHBlcnNpc3Q6IHRydWVgIHRvIGF2b2lkIHRoZW0gYmVpbmcKICAgICAgLy8gZGlzY2FyZGVkIGJ5IElFIGR1cmluZyB0ZW1wbGF0ZSBjbG9uaW5nCiAgICAgIHByZXBlbmQoY3JlYXRlQW5jaG9yKCd2LXN0YXJ0JywgdHJ1ZSksIGVsKTsKICAgICAgZWwuYXBwZW5kQ2hpbGQoY3JlYXRlQW5jaG9yKCd2LWVuZCcsIHRydWUpKTsKICAgIH0KCiAgICByZXR1cm4gZWw7CiAgfQogIC8qKgogICAqIFByb2Nlc3MgdGhlIHRlbXBsYXRlIG9wdGlvbi4KICAgKiBJZiB0aGUgcmVwbGFjZSBvcHRpb24gaXMgdHJ1ZSB0aGlzIHdpbGwgc3dhcCB0aGUgJGVsLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICogQHJldHVybiB7RWxlbWVudHxEb2N1bWVudEZyYWdtZW50fQogICAqLwoKCiAgZnVuY3Rpb24gdHJhbnNjbHVkZVRlbXBsYXRlKGVsLCBvcHRpb25zKSB7CiAgICB2YXIgdGVtcGxhdGUgPSBvcHRpb25zLnRlbXBsYXRlOwogICAgdmFyIGZyYWcgPSBwYXJzZVRlbXBsYXRlKHRlbXBsYXRlLCB0cnVlKTsKCiAgICBpZiAoZnJhZykgewogICAgICB2YXIgcmVwbGFjZXIgPSBmcmFnLmZpcnN0Q2hpbGQ7CiAgICAgIHZhciB0YWcgPSByZXBsYWNlci50YWdOYW1lICYmIHJlcGxhY2VyLnRhZ05hbWUudG9Mb3dlckNhc2UoKTsKCiAgICAgIGlmIChvcHRpb25zLnJlcGxhY2UpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoZWwgPT09IGRvY3VtZW50LmJvZHkpIHsKICAgICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdZb3UgYXJlIG1vdW50aW5nIGFuIGluc3RhbmNlIHdpdGggYSB0ZW1wbGF0ZSB0byAnICsgJzxib2R5Pi4gVGhpcyB3aWxsIHJlcGxhY2UgPGJvZHk+IGVudGlyZWx5LiBZb3UgJyArICdzaG91bGQgcHJvYmFibHkgdXNlIGByZXBsYWNlOiBmYWxzZWAgaGVyZS4nKTsKICAgICAgICB9IC8vIHRoZXJlIGFyZSBtYW55IGNhc2VzIHdoZXJlIHRoZSBpbnN0YW5jZSBtdXN0CiAgICAgICAgLy8gYmVjb21lIGEgZnJhZ21lbnQgaW5zdGFuY2U6IGJhc2ljYWxseSBhbnl0aGluZyB0aGF0CiAgICAgICAgLy8gY2FuIGNyZWF0ZSBtb3JlIHRoYW4gMSByb290IG5vZGVzLgoKCiAgICAgICAgaWYgKCAvLyBtdWx0aS1jaGlsZHJlbiB0ZW1wbGF0ZQogICAgICAgIGZyYWcuY2hpbGROb2Rlcy5sZW5ndGggPiAxIHx8IC8vIG5vbi1lbGVtZW50IHRlbXBsYXRlCiAgICAgICAgcmVwbGFjZXIubm9kZVR5cGUgIT09IDEgfHwgLy8gc2luZ2xlIG5lc3RlZCBjb21wb25lbnQKICAgICAgICB0YWcgPT09ICdjb21wb25lbnQnIHx8IHJlc29sdmVBc3NldChvcHRpb25zLCAnY29tcG9uZW50cycsIHRhZykgfHwgaGFzQmluZEF0dHIocmVwbGFjZXIsICdpcycpIHx8IC8vIGVsZW1lbnQgZGlyZWN0aXZlCiAgICAgICAgcmVzb2x2ZUFzc2V0KG9wdGlvbnMsICdlbGVtZW50RGlyZWN0aXZlcycsIHRhZykgfHwgLy8gZm9yIGJsb2NrCiAgICAgICAgcmVwbGFjZXIuaGFzQXR0cmlidXRlKCd2LWZvcicpIHx8IC8vIGlmIGJsb2NrCiAgICAgICAgcmVwbGFjZXIuaGFzQXR0cmlidXRlKCd2LWlmJykpIHsKICAgICAgICAgIHJldHVybiBmcmFnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvcHRpb25zLl9yZXBsYWNlckF0dHJzID0gZXh0cmFjdEF0dHJzKHJlcGxhY2VyKTsKICAgICAgICAgIG1lcmdlQXR0cnMoZWwsIHJlcGxhY2VyKTsKICAgICAgICAgIHJldHVybiByZXBsYWNlcjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWwuYXBwZW5kQ2hpbGQoZnJhZyk7CiAgICAgICAgcmV0dXJuIGVsOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgd2FybignSW52YWxpZCB0ZW1wbGF0ZSBvcHRpb246ICcgKyB0ZW1wbGF0ZSk7CiAgICB9CiAgfQogIC8qKgogICAqIEhlbHBlciB0byBleHRyYWN0IGEgY29tcG9uZW50IGNvbnRhaW5lcidzIGF0dHJpYnV0ZXMKICAgKiBpbnRvIGEgcGxhaW4gb2JqZWN0IGFycmF5LgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEByZXR1cm4ge0FycmF5fQogICAqLwoKCiAgZnVuY3Rpb24gZXh0cmFjdEF0dHJzKGVsKSB7CiAgICBpZiAoZWwubm9kZVR5cGUgPT09IDEgJiYgZWwuaGFzQXR0cmlidXRlcygpKSB7CiAgICAgIHJldHVybiB0b0FycmF5KGVsLmF0dHJpYnV0ZXMpOwogICAgfQogIH0KICAvKioKICAgKiBNZXJnZSB0aGUgYXR0cmlidXRlcyBvZiB0d28gZWxlbWVudHMsIGFuZCBtYWtlIHN1cmUKICAgKiB0aGUgY2xhc3MgbmFtZXMgYXJlIG1lcmdlZCBwcm9wZXJseS4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZnJvbQogICAqIEBwYXJhbSB7RWxlbWVudH0gdG8KICAgKi8KCgogIGZ1bmN0aW9uIG1lcmdlQXR0cnMoZnJvbSwgdG8pIHsKICAgIHZhciBhdHRycyA9IGZyb20uYXR0cmlidXRlczsKICAgIHZhciBpID0gYXR0cnMubGVuZ3RoOwogICAgdmFyIG5hbWUsIHZhbHVlOwoKICAgIHdoaWxlIChpLS0pIHsKICAgICAgbmFtZSA9IGF0dHJzW2ldLm5hbWU7CiAgICAgIHZhbHVlID0gYXR0cnNbaV0udmFsdWU7CgogICAgICBpZiAoIXRvLmhhc0F0dHJpYnV0ZShuYW1lKSAmJiAhc3BlY2lhbENoYXJSRS50ZXN0KG5hbWUpKSB7CiAgICAgICAgdG8uc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTsKICAgICAgfSBlbHNlIGlmIChuYW1lID09PSAnY2xhc3MnICYmICFwYXJzZVRleHQodmFsdWUpICYmICh2YWx1ZSA9IHZhbHVlLnRyaW0oKSkpIHsKICAgICAgICB2YWx1ZS5zcGxpdCgvXHMrLykuZm9yRWFjaChmdW5jdGlvbiAoY2xzKSB7CiAgICAgICAgICBhZGRDbGFzcyh0bywgY2xzKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0KICAvKioKICAgKiBTY2FuIGFuZCBkZXRlcm1pbmUgc2xvdCBjb250ZW50IGRpc3RyaWJ1dGlvbi4KICAgKiBXZSBkbyB0aGlzIGR1cmluZyB0cmFuc2NsdXNpb24gaW5zdGVhZCBhdCBjb21waWxlIHRpbWUgc28gdGhhdAogICAqIHRoZSBkaXN0cmlidXRpb24gaXMgZGVjb3VwbGVkIGZyb20gdGhlIGNvbXBpbGF0aW9uIG9yZGVyIG9mCiAgICogdGhlIHNsb3RzLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fERvY3VtZW50RnJhZ21lbnR9IHRlbXBsYXRlCiAgICogQHBhcmFtIHtFbGVtZW50fSBjb250ZW50CiAgICogQHBhcmFtIHtWdWV9IHZtCiAgICovCgoKICBmdW5jdGlvbiByZXNvbHZlU2xvdHModm0sIGNvbnRlbnQpIHsKICAgIGlmICghY29udGVudCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGNvbnRlbnRzID0gdm0uX3Nsb3RDb250ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB2YXIgZWwsIG5hbWU7CgogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjb250ZW50LmNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBlbCA9IGNvbnRlbnQuY2hpbGRyZW5baV07CiAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWNvbmQtYXNzaWduICovCgogICAgICBpZiAobmFtZSA9IGVsLmdldEF0dHJpYnV0ZSgnc2xvdCcpKSB7CiAgICAgICAgKGNvbnRlbnRzW25hbWVdIHx8IChjb250ZW50c1tuYW1lXSA9IFtdKSkucHVzaChlbCk7CiAgICAgIH0KICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1jb25kLWFzc2lnbiAqLwoKCiAgICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgZ2V0QmluZEF0dHIoZWwsICdzbG90JykpIHsKICAgICAgICB3YXJuKCdUaGUgInNsb3QiIGF0dHJpYnV0ZSBtdXN0IGJlIHN0YXRpYy4nLCB2bS4kcGFyZW50KTsKICAgICAgfQogICAgfQoKICAgIGZvciAobmFtZSBpbiBjb250ZW50cykgewogICAgICBjb250ZW50c1tuYW1lXSA9IGV4dHJhY3RGcmFnbWVudChjb250ZW50c1tuYW1lXSwgY29udGVudCk7CiAgICB9CgogICAgaWYgKGNvbnRlbnQuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgIHZhciBub2RlcyA9IGNvbnRlbnQuY2hpbGROb2RlczsKCiAgICAgIGlmIChub2Rlcy5sZW5ndGggPT09IDEgJiYgbm9kZXNbMF0ubm9kZVR5cGUgPT09IDMgJiYgIW5vZGVzWzBdLmRhdGEudHJpbSgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb250ZW50c1snZGVmYXVsdCddID0gZXh0cmFjdEZyYWdtZW50KGNvbnRlbnQuY2hpbGROb2RlcywgY29udGVudCk7CiAgICB9CiAgfQogIC8qKgogICAqIEV4dHJhY3QgcXVhbGlmaWVkIGNvbnRlbnQgbm9kZXMgZnJvbSBhIG5vZGUgbGlzdC4KICAgKgogICAqIEBwYXJhbSB7Tm9kZUxpc3R9IG5vZGVzCiAgICogQHJldHVybiB7RG9jdW1lbnRGcmFnbWVudH0KICAgKi8KCgogIGZ1bmN0aW9uIGV4dHJhY3RGcmFnbWVudChub2RlcywgcGFyZW50KSB7CiAgICB2YXIgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgIG5vZGVzID0gdG9BcnJheShub2Rlcyk7CgogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBub2Rlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdmFyIG5vZGUgPSBub2Rlc1tpXTsKCiAgICAgIGlmIChpc1RlbXBsYXRlKG5vZGUpICYmICFub2RlLmhhc0F0dHJpYnV0ZSgndi1pZicpICYmICFub2RlLmhhc0F0dHJpYnV0ZSgndi1mb3InKSkgewogICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChub2RlKTsKICAgICAgICBub2RlID0gcGFyc2VUZW1wbGF0ZShub2RlLCB0cnVlKTsKICAgICAgfQoKICAgICAgZnJhZy5hcHBlbmRDaGlsZChub2RlKTsKICAgIH0KCiAgICByZXR1cm4gZnJhZzsKICB9CgogIHZhciBjb21waWxlciA9IE9iamVjdC5mcmVlemUoewogICAgY29tcGlsZTogY29tcGlsZSwKICAgIGNvbXBpbGVBbmRMaW5rUHJvcHM6IGNvbXBpbGVBbmRMaW5rUHJvcHMsCiAgICBjb21waWxlUm9vdDogY29tcGlsZVJvb3QsCiAgICB0cmFuc2NsdWRlOiB0cmFuc2NsdWRlLAogICAgcmVzb2x2ZVNsb3RzOiByZXNvbHZlU2xvdHMKICB9KTsKCiAgZnVuY3Rpb24gc3RhdGVNaXhpbihWdWUpIHsKICAgIC8qKgogICAgICogQWNjZXNzb3IgZm9yIGAkZGF0YWAgcHJvcGVydHksIHNpbmNlIHNldHRpbmcgJGRhdGEKICAgICAqIHJlcXVpcmVzIG9ic2VydmluZyB0aGUgbmV3IG9iamVjdCBhbmQgdXBkYXRpbmcKICAgICAqIHByb3hpZWQgcHJvcGVydGllcy4KICAgICAqLwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZS5wcm90b3R5cGUsICckZGF0YScsIHsKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGE7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KG5ld0RhdGEpIHsKICAgICAgICBpZiAobmV3RGF0YSAhPT0gdGhpcy5fZGF0YSkgewogICAgICAgICAgdGhpcy5fc2V0RGF0YShuZXdEYXRhKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgLyoqCiAgICAgKiBTZXR1cCB0aGUgc2NvcGUgb2YgYW4gaW5zdGFuY2UsIHdoaWNoIGNvbnRhaW5zOgogICAgICogLSBvYnNlcnZlZCBkYXRhCiAgICAgKiAtIGNvbXB1dGVkIHByb3BlcnRpZXMKICAgICAqIC0gdXNlciBtZXRob2RzCiAgICAgKiAtIG1ldGEgcHJvcGVydGllcwogICAgICovCgogICAgVnVlLnByb3RvdHlwZS5faW5pdFN0YXRlID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl9pbml0UHJvcHMoKTsKCiAgICAgIHRoaXMuX2luaXRNZXRhKCk7CgogICAgICB0aGlzLl9pbml0TWV0aG9kcygpOwoKICAgICAgdGhpcy5faW5pdERhdGEoKTsKCiAgICAgIHRoaXMuX2luaXRDb21wdXRlZCgpOwogICAgfTsKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBwcm9wcy4KICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLl9pbml0UHJvcHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBvcHRpb25zID0gdGhpcy4kb3B0aW9uczsKICAgICAgdmFyIGVsID0gb3B0aW9ucy5lbDsKICAgICAgdmFyIHByb3BzID0gb3B0aW9ucy5wcm9wczsKCiAgICAgIGlmIChwcm9wcyAmJiAhZWwpIHsKICAgICAgICAnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgd2FybignUHJvcHMgd2lsbCBub3QgYmUgY29tcGlsZWQgaWYgbm8gYGVsYCBvcHRpb24gaXMgJyArICdwcm92aWRlZCBhdCBpbnN0YW50aWF0aW9uLicsIHRoaXMpOwogICAgICB9IC8vIG1ha2Ugc3VyZSB0byBjb252ZXJ0IHN0cmluZyBzZWxlY3RvcnMgaW50byBlbGVtZW50IG5vdwoKCiAgICAgIGVsID0gb3B0aW9ucy5lbCA9IHF1ZXJ5KGVsKTsKICAgICAgdGhpcy5fcHJvcHNVbmxpbmtGbiA9IGVsICYmIGVsLm5vZGVUeXBlID09PSAxICYmIHByb3BzIC8vIHByb3BzIG11c3QgYmUgbGlua2VkIGluIHByb3BlciBzY29wZSBpZiBpbnNpZGUgdi1mb3IKICAgICAgPyBjb21waWxlQW5kTGlua1Byb3BzKHRoaXMsIGVsLCBwcm9wcywgdGhpcy5fc2NvcGUpIDogbnVsbDsKICAgIH07CiAgICAvKioKICAgICAqIEluaXRpYWxpemUgdGhlIGRhdGEuCiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS5faW5pdERhdGEgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBkYXRhRm4gPSB0aGlzLiRvcHRpb25zLmRhdGE7CiAgICAgIHZhciBkYXRhID0gdGhpcy5fZGF0YSA9IGRhdGFGbiA/IGRhdGFGbigpIDoge307CgogICAgICBpZiAoIWlzUGxhaW5PYmplY3QoZGF0YSkpIHsKICAgICAgICBkYXRhID0ge307CiAgICAgICAgJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oJ2RhdGEgZnVuY3Rpb25zIHNob3VsZCByZXR1cm4gYW4gb2JqZWN0LicsIHRoaXMpOwogICAgICB9CgogICAgICB2YXIgcHJvcHMgPSB0aGlzLl9wcm9wczsgLy8gcHJveHkgZGF0YSBvbiBpbnN0YW5jZQoKICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhkYXRhKTsKICAgICAgdmFyIGksIGtleTsKICAgICAgaSA9IGtleXMubGVuZ3RoOwoKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIGtleSA9IGtleXNbaV07IC8vIHRoZXJlIGFyZSB0d28gc2NlbmFyaW9zIHdoZXJlIHdlIGNhbiBwcm94eSBhIGRhdGEga2V5OgogICAgICAgIC8vIDEuIGl0J3Mgbm90IGFscmVhZHkgZGVmaW5lZCBhcyBhIHByb3AKICAgICAgICAvLyAyLiBpdCdzIHByb3ZpZGVkIHZpYSBhIGluc3RhbnRpYXRpb24gb3B0aW9uIEFORCB0aGVyZSBhcmUgbm8KICAgICAgICAvLyAgICB0ZW1wbGF0ZSBwcm9wIHByZXNlbnQKCiAgICAgICAgaWYgKCFwcm9wcyB8fCAhaGFzT3duKHByb3BzLCBrZXkpKSB7CiAgICAgICAgICB0aGlzLl9wcm94eShrZXkpOwogICAgICAgIH0gZWxzZSBpZiAoJ2RldmVsb3BtZW50JyAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB3YXJuKCdEYXRhIGZpZWxkICInICsga2V5ICsgJyIgaXMgYWxyZWFkeSBkZWZpbmVkICcgKyAnYXMgYSBwcm9wLiBUbyBwcm92aWRlIGRlZmF1bHQgdmFsdWUgZm9yIGEgcHJvcCwgdXNlIHRoZSAiZGVmYXVsdCIgJyArICdwcm9wIG9wdGlvbjsgaWYgeW91IHdhbnQgdG8gcGFzcyBwcm9wIHZhbHVlcyB0byBhbiBpbnN0YW50aWF0aW9uICcgKyAnY2FsbCwgdXNlIHRoZSAicHJvcHNEYXRhIiBvcHRpb24uJywgdGhpcyk7CiAgICAgICAgfQogICAgICB9IC8vIG9ic2VydmUgZGF0YQoKCiAgICAgIG9ic2VydmUoZGF0YSwgdGhpcyk7CiAgICB9OwogICAgLyoqCiAgICAgKiBTd2FwIHRoZSBpbnN0YW5jZSdzICRkYXRhLiBDYWxsZWQgaW4gJGRhdGEncyBzZXR0ZXIuCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IG5ld0RhdGEKICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLl9zZXREYXRhID0gZnVuY3Rpb24gKG5ld0RhdGEpIHsKICAgICAgbmV3RGF0YSA9IG5ld0RhdGEgfHwge307CiAgICAgIHZhciBvbGREYXRhID0gdGhpcy5fZGF0YTsKICAgICAgdGhpcy5fZGF0YSA9IG5ld0RhdGE7CiAgICAgIHZhciBrZXlzLCBrZXksIGk7IC8vIHVucHJveHkga2V5cyBub3QgcHJlc2VudCBpbiBuZXcgZGF0YQoKICAgICAga2V5cyA9IE9iamVjdC5rZXlzKG9sZERhdGEpOwogICAgICBpID0ga2V5cy5sZW5ndGg7CgogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAga2V5ID0ga2V5c1tpXTsKCiAgICAgICAgaWYgKCEoa2V5IGluIG5ld0RhdGEpKSB7CiAgICAgICAgICB0aGlzLl91bnByb3h5KGtleSk7CiAgICAgICAgfQogICAgICB9IC8vIHByb3h5IGtleXMgbm90IGFscmVhZHkgcHJveGllZCwKICAgICAgLy8gYW5kIHRyaWdnZXIgY2hhbmdlIGZvciBjaGFuZ2VkIHZhbHVlcwoKCiAgICAgIGtleXMgPSBPYmplY3Qua2V5cyhuZXdEYXRhKTsKICAgICAgaSA9IGtleXMubGVuZ3RoOwoKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIGtleSA9IGtleXNbaV07CgogICAgICAgIGlmICghaGFzT3duKHRoaXMsIGtleSkpIHsKICAgICAgICAgIC8vIG5ldyBwcm9wZXJ0eQogICAgICAgICAgdGhpcy5fcHJveHkoa2V5KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG9sZERhdGEuX19vYl9fLnJlbW92ZVZtKHRoaXMpOwoKICAgICAgb2JzZXJ2ZShuZXdEYXRhLCB0aGlzKTsKCiAgICAgIHRoaXMuX2RpZ2VzdCgpOwogICAgfTsKICAgIC8qKgogICAgICogUHJveHkgYSBwcm9wZXJ0eSwgc28gdGhhdAogICAgICogdm0ucHJvcCA9PT0gdm0uX2RhdGEucHJvcAogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBrZXkKICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLl9wcm94eSA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgaWYgKCFpc1Jlc2VydmVkKGtleSkpIHsKICAgICAgICAvLyBuZWVkIHRvIHN0b3JlIHJlZiB0byBzZWxmIGhlcmUKICAgICAgICAvLyBiZWNhdXNlIHRoZXNlIGdldHRlci9zZXR0ZXJzIG1pZ2h0CiAgICAgICAgLy8gYmUgY2FsbGVkIGJ5IGNoaWxkIHNjb3BlcyB2aWEKICAgICAgICAvLyBwcm90b3R5cGUgaW5oZXJpdGFuY2UuCiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLCBrZXksIHsKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIHByb3h5R2V0dGVyKCkgewogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0YVtrZXldOwogICAgICAgICAgfSwKICAgICAgICAgIHNldDogZnVuY3Rpb24gcHJveHlTZXR0ZXIodmFsKSB7CiAgICAgICAgICAgIHNlbGYuX2RhdGFba2V5XSA9IHZhbDsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogVW5wcm94eSBhIHByb3BlcnR5LgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBrZXkKICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLl91bnByb3h5ID0gZnVuY3Rpb24gKGtleSkgewogICAgICBpZiAoIWlzUmVzZXJ2ZWQoa2V5KSkgewogICAgICAgIGRlbGV0ZSB0aGlzW2tleV07CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEZvcmNlIHVwZGF0ZSBvbiBldmVyeSB3YXRjaGVyIGluIHNjb3BlLgogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuX2RpZ2VzdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLl93YXRjaGVycy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLl93YXRjaGVyc1tpXS51cGRhdGUodHJ1ZSk7IC8vIHNoYWxsb3cgdXBkYXRlcwoKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogU2V0dXAgY29tcHV0ZWQgcHJvcGVydGllcy4gVGhleSBhcmUgZXNzZW50aWFsbHkKICAgICAqIHNwZWNpYWwgZ2V0dGVyL3NldHRlcnMKICAgICAqLwoKCiAgICBmdW5jdGlvbiBub29wKCkge30KCiAgICBWdWUucHJvdG90eXBlLl9pbml0Q29tcHV0ZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBjb21wdXRlZCA9IHRoaXMuJG9wdGlvbnMuY29tcHV0ZWQ7CgogICAgICBpZiAoY29tcHV0ZWQpIHsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gY29tcHV0ZWQpIHsKICAgICAgICAgIHZhciB1c2VyRGVmID0gY29tcHV0ZWRba2V5XTsKICAgICAgICAgIHZhciBkZWYgPSB7CiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgfTsKCiAgICAgICAgICBpZiAodHlwZW9mIHVzZXJEZWYgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgZGVmLmdldCA9IG1ha2VDb21wdXRlZEdldHRlcih1c2VyRGVmLCB0aGlzKTsKICAgICAgICAgICAgZGVmLnNldCA9IG5vb3A7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkZWYuZ2V0ID0gdXNlckRlZi5nZXQgPyB1c2VyRGVmLmNhY2hlICE9PSBmYWxzZSA/IG1ha2VDb21wdXRlZEdldHRlcih1c2VyRGVmLmdldCwgdGhpcykgOiBiaW5kKHVzZXJEZWYuZ2V0LCB0aGlzKSA6IG5vb3A7CiAgICAgICAgICAgIGRlZi5zZXQgPSB1c2VyRGVmLnNldCA/IGJpbmQodXNlckRlZi5zZXQsIHRoaXMpIDogbm9vcDsKICAgICAgICAgIH0KCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywga2V5LCBkZWYpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiBtYWtlQ29tcHV0ZWRHZXR0ZXIoZ2V0dGVyLCBvd25lcikgewogICAgICB2YXIgd2F0Y2hlciA9IG5ldyBXYXRjaGVyKG93bmVyLCBnZXR0ZXIsIG51bGwsIHsKICAgICAgICBsYXp5OiB0cnVlCiAgICAgIH0pOwogICAgICByZXR1cm4gZnVuY3Rpb24gY29tcHV0ZWRHZXR0ZXIoKSB7CiAgICAgICAgaWYgKHdhdGNoZXIuZGlydHkpIHsKICAgICAgICAgIHdhdGNoZXIuZXZhbHVhdGUoKTsKICAgICAgICB9CgogICAgICAgIGlmIChEZXAudGFyZ2V0KSB7CiAgICAgICAgICB3YXRjaGVyLmRlcGVuZCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHdhdGNoZXIudmFsdWU7CiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNldHVwIGluc3RhbmNlIG1ldGhvZHMuIE1ldGhvZHMgbXVzdCBiZSBib3VuZCB0byB0aGUKICAgICAqIGluc3RhbmNlIHNpbmNlIHRoZXkgbWlnaHQgYmUgcGFzc2VkIGRvd24gYXMgYSBwcm9wIHRvCiAgICAgKiBjaGlsZCBjb21wb25lbnRzLgogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuX2luaXRNZXRob2RzID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgbWV0aG9kcyA9IHRoaXMuJG9wdGlvbnMubWV0aG9kczsKCiAgICAgIGlmIChtZXRob2RzKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIG1ldGhvZHMpIHsKICAgICAgICAgIHRoaXNba2V5XSA9IGJpbmQobWV0aG9kc1trZXldLCB0aGlzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEluaXRpYWxpemUgbWV0YSBpbmZvcm1hdGlvbiBsaWtlICRpbmRleCwgJGtleSAmICR2YWx1ZS4KICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLl9pbml0TWV0YSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIG1ldGFzID0gdGhpcy4kb3B0aW9ucy5fbWV0YTsKCiAgICAgIGlmIChtZXRhcykgewogICAgICAgIGZvciAodmFyIGtleSBpbiBtZXRhcykgewogICAgICAgICAgZGVmaW5lUmVhY3RpdmUodGhpcywga2V5LCBtZXRhc1trZXldKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfQoKICB2YXIgZXZlbnRSRSA9IC9edi1vbjp8XkAvOwoKICBmdW5jdGlvbiBldmVudHNNaXhpbihWdWUpIHsKICAgIC8qKgogICAgICogU2V0dXAgdGhlIGluc3RhbmNlJ3Mgb3B0aW9uIGV2ZW50cyAmIHdhdGNoZXJzLgogICAgICogSWYgdGhlIHZhbHVlIGlzIGEgc3RyaW5nLCB3ZSBwdWxsIGl0IGZyb20gdGhlCiAgICAgKiBpbnN0YW5jZSdzIG1ldGhvZHMgYnkgbmFtZS4KICAgICAqLwogICAgVnVlLnByb3RvdHlwZS5faW5pdEV2ZW50cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLiRvcHRpb25zOwoKICAgICAgaWYgKG9wdGlvbnMuX2FzQ29tcG9uZW50KSB7CiAgICAgICAgcmVnaXN0ZXJDb21wb25lbnRFdmVudHModGhpcywgb3B0aW9ucy5lbCk7CiAgICAgIH0KCiAgICAgIHJlZ2lzdGVyQ2FsbGJhY2tzKHRoaXMsICckb24nLCBvcHRpb25zLmV2ZW50cyk7CiAgICAgIHJlZ2lzdGVyQ2FsbGJhY2tzKHRoaXMsICckd2F0Y2gnLCBvcHRpb25zLndhdGNoKTsKICAgIH07CiAgICAvKioKICAgICAqIFJlZ2lzdGVyIHYtb24gZXZlbnRzIG9uIGEgY2hpbGQgY29tcG9uZW50CiAgICAgKgogICAgICogQHBhcmFtIHtWdWV9IHZtCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICAgKi8KCgogICAgZnVuY3Rpb24gcmVnaXN0ZXJDb21wb25lbnRFdmVudHModm0sIGVsKSB7CiAgICAgIHZhciBhdHRycyA9IGVsLmF0dHJpYnV0ZXM7CiAgICAgIHZhciBuYW1lLCB2YWx1ZSwgaGFuZGxlcjsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gYXR0cnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgbmFtZSA9IGF0dHJzW2ldLm5hbWU7CgogICAgICAgIGlmIChldmVudFJFLnRlc3QobmFtZSkpIHsKICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoZXZlbnRSRSwgJycpOyAvLyBmb3JjZSB0aGUgZXhwcmVzc2lvbiBpbnRvIGEgc3RhdGVtZW50IHNvIHRoYXQKICAgICAgICAgIC8vIGl0IGFsd2F5cyBkeW5hbWljYWxseSByZXNvbHZlcyB0aGUgbWV0aG9kIHRvIGNhbGwgKCMyNjcwKQogICAgICAgICAgLy8ga2luZGEgdWdseSBoYWNrLCBidXQgZG9lcyB0aGUgam9iLgoKICAgICAgICAgIHZhbHVlID0gYXR0cnNbaV0udmFsdWU7CgogICAgICAgICAgaWYgKGlzU2ltcGxlUGF0aCh2YWx1ZSkpIHsKICAgICAgICAgICAgdmFsdWUgKz0gJy5hcHBseSh0aGlzLCAkYXJndW1lbnRzKSc7CiAgICAgICAgICB9CgogICAgICAgICAgaGFuZGxlciA9ICh2bS5fc2NvcGUgfHwgdm0uX2NvbnRleHQpLiRldmFsKHZhbHVlLCB0cnVlKTsKICAgICAgICAgIGhhbmRsZXIuX2Zyb21QYXJlbnQgPSB0cnVlOwogICAgICAgICAgdm0uJG9uKG5hbWUucmVwbGFjZShldmVudFJFKSwgaGFuZGxlcik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJlZ2lzdGVyIGNhbGxiYWNrcyBmb3Igb3B0aW9uIGV2ZW50cyBhbmQgd2F0Y2hlcnMuCiAgICAgKgogICAgICogQHBhcmFtIHtWdWV9IHZtCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYWN0aW9uCiAgICAgKiBAcGFyYW0ge09iamVjdH0gaGFzaAogICAgICovCgoKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyQ2FsbGJhY2tzKHZtLCBhY3Rpb24sIGhhc2gpIHsKICAgICAgaWYgKCFoYXNoKSByZXR1cm47CiAgICAgIHZhciBoYW5kbGVycywga2V5LCBpLCBqOwoKICAgICAgZm9yIChrZXkgaW4gaGFzaCkgewogICAgICAgIGhhbmRsZXJzID0gaGFzaFtrZXldOwoKICAgICAgICBpZiAoaXNBcnJheShoYW5kbGVycykpIHsKICAgICAgICAgIGZvciAoaSA9IDAsIGogPSBoYW5kbGVycy5sZW5ndGg7IGkgPCBqOyBpKyspIHsKICAgICAgICAgICAgcmVnaXN0ZXIodm0sIGFjdGlvbiwga2V5LCBoYW5kbGVyc1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlZ2lzdGVyKHZtLCBhY3Rpb24sIGtleSwgaGFuZGxlcnMpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBIZWxwZXIgdG8gcmVnaXN0ZXIgYW4gZXZlbnQvd2F0Y2ggY2FsbGJhY2suCiAgICAgKgogICAgICogQHBhcmFtIHtWdWV9IHZtCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYWN0aW9uCiAgICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5CiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufFN0cmluZ3xPYmplY3R9IGhhbmRsZXIKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10KICAgICAqLwoKCiAgICBmdW5jdGlvbiByZWdpc3Rlcih2bSwgYWN0aW9uLCBrZXksIGhhbmRsZXIsIG9wdGlvbnMpIHsKICAgICAgdmFyIHR5cGUgPSBfdHlwZW9mKGhhbmRsZXIpOwoKICAgICAgaWYgKHR5cGUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICB2bVthY3Rpb25dKGtleSwgaGFuZGxlciwgb3B0aW9ucyk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICB2YXIgbWV0aG9kcyA9IHZtLiRvcHRpb25zLm1ldGhvZHM7CiAgICAgICAgdmFyIG1ldGhvZCA9IG1ldGhvZHMgJiYgbWV0aG9kc1toYW5kbGVyXTsKCiAgICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgICAgdm1bYWN0aW9uXShrZXksIG1ldGhvZCwgb3B0aW9ucyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdVbmtub3duIG1ldGhvZDogIicgKyBoYW5kbGVyICsgJyIgd2hlbiAnICsgJ3JlZ2lzdGVyaW5nIGNhbGxiYWNrIGZvciAnICsgYWN0aW9uICsgJzogIicgKyBrZXkgKyAnIi4nLCB2bSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGhhbmRsZXIgJiYgdHlwZSA9PT0gJ29iamVjdCcpIHsKICAgICAgICByZWdpc3Rlcih2bSwgYWN0aW9uLCBrZXksIGhhbmRsZXIuaGFuZGxlciwgaGFuZGxlcik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0dXAgcmVjdXJzaXZlIGF0dGFjaGVkL2RldGFjaGVkIGNhbGxzCiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS5faW5pdERPTUhvb2tzID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLiRvbignaG9vazphdHRhY2hlZCcsIG9uQXR0YWNoZWQpOwogICAgICB0aGlzLiRvbignaG9vazpkZXRhY2hlZCcsIG9uRGV0YWNoZWQpOwogICAgfTsKICAgIC8qKgogICAgICogQ2FsbGJhY2sgdG8gcmVjdXJzaXZlbHkgY2FsbCBhdHRhY2hlZCBob29rIG9uIGNoaWxkcmVuCiAgICAgKi8KCgogICAgZnVuY3Rpb24gb25BdHRhY2hlZCgpIHsKICAgICAgaWYgKCF0aGlzLl9pc0F0dGFjaGVkKSB7CiAgICAgICAgdGhpcy5faXNBdHRhY2hlZCA9IHRydWU7CiAgICAgICAgdGhpcy4kY2hpbGRyZW4uZm9yRWFjaChjYWxsQXR0YWNoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJdGVyYXRvciB0byBjYWxsIGF0dGFjaGVkIGhvb2sKICAgICAqCiAgICAgKiBAcGFyYW0ge1Z1ZX0gY2hpbGQKICAgICAqLwoKCiAgICBmdW5jdGlvbiBjYWxsQXR0YWNoKGNoaWxkKSB7CiAgICAgIGlmICghY2hpbGQuX2lzQXR0YWNoZWQgJiYgaW5Eb2MoY2hpbGQuJGVsKSkgewogICAgICAgIGNoaWxkLl9jYWxsSG9vaygnYXR0YWNoZWQnKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDYWxsYmFjayB0byByZWN1cnNpdmVseSBjYWxsIGRldGFjaGVkIGhvb2sgb24gY2hpbGRyZW4KICAgICAqLwoKCiAgICBmdW5jdGlvbiBvbkRldGFjaGVkKCkgewogICAgICBpZiAodGhpcy5faXNBdHRhY2hlZCkgewogICAgICAgIHRoaXMuX2lzQXR0YWNoZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLiRjaGlsZHJlbi5mb3JFYWNoKGNhbGxEZXRhY2gpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEl0ZXJhdG9yIHRvIGNhbGwgZGV0YWNoZWQgaG9vawogICAgICoKICAgICAqIEBwYXJhbSB7VnVlfSBjaGlsZAogICAgICovCgoKICAgIGZ1bmN0aW9uIGNhbGxEZXRhY2goY2hpbGQpIHsKICAgICAgaWYgKGNoaWxkLl9pc0F0dGFjaGVkICYmICFpbkRvYyhjaGlsZC4kZWwpKSB7CiAgICAgICAgY2hpbGQuX2NhbGxIb29rKCdkZXRhY2hlZCcpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFRyaWdnZXIgYWxsIGhhbmRsZXJzIGZvciBhIGhvb2sKICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaG9vawogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuX2NhbGxIb29rID0gZnVuY3Rpb24gKGhvb2spIHsKICAgICAgdGhpcy4kZW1pdCgncHJlLWhvb2s6JyArIGhvb2spOwogICAgICB2YXIgaGFuZGxlcnMgPSB0aGlzLiRvcHRpb25zW2hvb2tdOwoKICAgICAgaWYgKGhhbmRsZXJzKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSBoYW5kbGVycy5sZW5ndGg7IGkgPCBqOyBpKyspIHsKICAgICAgICAgIGhhbmRsZXJzW2ldLmNhbGwodGhpcyk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLiRlbWl0KCdob29rOicgKyBob29rKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBub29wJDEoKSB7fQogIC8qKgogICAqIEEgZGlyZWN0aXZlIGxpbmtzIGEgRE9NIGVsZW1lbnQgd2l0aCBhIHBpZWNlIG9mIGRhdGEsCiAgICogd2hpY2ggaXMgdGhlIHJlc3VsdCBvZiBldmFsdWF0aW5nIGFuIGV4cHJlc3Npb24uCiAgICogSXQgcmVnaXN0ZXJzIGEgd2F0Y2hlciB3aXRoIHRoZSBleHByZXNzaW9uIGFuZCBjYWxscwogICAqIHRoZSBET00gdXBkYXRlIGZ1bmN0aW9uIHdoZW4gYSBjaGFuZ2UgaXMgdHJpZ2dlcmVkLgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IGRlc2NyaXB0b3IKICAgKiAgICAgICAgICAgICAgICAgLSB7U3RyaW5nfSBuYW1lCiAgICogICAgICAgICAgICAgICAgIC0ge09iamVjdH0gZGVmCiAgICogICAgICAgICAgICAgICAgIC0ge1N0cmluZ30gZXhwcmVzc2lvbgogICAqICAgICAgICAgICAgICAgICAtIHtBcnJheTxPYmplY3Q+fSBbZmlsdGVyc10KICAgKiAgICAgICAgICAgICAgICAgLSB7T2JqZWN0fSBbbW9kaWZpZXJzXQogICAqICAgICAgICAgICAgICAgICAtIHtCb29sZWFufSBsaXRlcmFsCiAgICogICAgICAgICAgICAgICAgIC0ge1N0cmluZ30gYXR0cgogICAqICAgICAgICAgICAgICAgICAtIHtTdHJpbmd9IGFyZwogICAqICAgICAgICAgICAgICAgICAtIHtTdHJpbmd9IHJhdwogICAqICAgICAgICAgICAgICAgICAtIHtTdHJpbmd9IFtyZWZdCiAgICogICAgICAgICAgICAgICAgIC0ge0FycmF5PE9iamVjdD59IFtpbnRlcnBdCiAgICogICAgICAgICAgICAgICAgIC0ge0Jvb2xlYW59IFtoYXNPbmVUaW1lXQogICAqIEBwYXJhbSB7VnVlfSB2bQogICAqIEBwYXJhbSB7Tm9kZX0gZWwKICAgKiBAcGFyYW0ge1Z1ZX0gW2hvc3RdIC0gdHJhbnNjbHVzaW9uIGhvc3QgY29tcG9uZW50CiAgICogQHBhcmFtIHtPYmplY3R9IFtzY29wZV0gLSB2LWZvciBzY29wZQogICAqIEBwYXJhbSB7RnJhZ21lbnR9IFtmcmFnXSAtIG93bmVyIGZyYWdtZW50CiAgICogQGNvbnN0cnVjdG9yCiAgICovCgoKICBmdW5jdGlvbiBEaXJlY3RpdmUoZGVzY3JpcHRvciwgdm0sIGVsLCBob3N0LCBzY29wZSwgZnJhZykgewogICAgdGhpcy52bSA9IHZtOwogICAgdGhpcy5lbCA9IGVsOyAvLyBjb3B5IGRlc2NyaXB0b3IgcHJvcGVydGllcwoKICAgIHRoaXMuZGVzY3JpcHRvciA9IGRlc2NyaXB0b3I7CiAgICB0aGlzLm5hbWUgPSBkZXNjcmlwdG9yLm5hbWU7CiAgICB0aGlzLmV4cHJlc3Npb24gPSBkZXNjcmlwdG9yLmV4cHJlc3Npb247CiAgICB0aGlzLmFyZyA9IGRlc2NyaXB0b3IuYXJnOwogICAgdGhpcy5tb2RpZmllcnMgPSBkZXNjcmlwdG9yLm1vZGlmaWVyczsKICAgIHRoaXMuZmlsdGVycyA9IGRlc2NyaXB0b3IuZmlsdGVyczsKICAgIHRoaXMubGl0ZXJhbCA9IHRoaXMubW9kaWZpZXJzICYmIHRoaXMubW9kaWZpZXJzLmxpdGVyYWw7IC8vIHByaXZhdGUKCiAgICB0aGlzLl9sb2NrZWQgPSBmYWxzZTsKICAgIHRoaXMuX2JvdW5kID0gZmFsc2U7CiAgICB0aGlzLl9saXN0ZW5lcnMgPSBudWxsOyAvLyBsaW5rIGNvbnRleHQKCiAgICB0aGlzLl9ob3N0ID0gaG9zdDsKICAgIHRoaXMuX3Njb3BlID0gc2NvcGU7CiAgICB0aGlzLl9mcmFnID0gZnJhZzsgLy8gc3RvcmUgZGlyZWN0aXZlcyBvbiBub2RlIGluIGRldiBtb2RlCgogICAgaWYgKCdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB0aGlzLmVsKSB7CiAgICAgIHRoaXMuZWwuX3Z1ZV9kaXJlY3RpdmVzID0gdGhpcy5lbC5fdnVlX2RpcmVjdGl2ZXMgfHwgW107CgogICAgICB0aGlzLmVsLl92dWVfZGlyZWN0aXZlcy5wdXNoKHRoaXMpOwogICAgfQogIH0KICAvKioKICAgKiBJbml0aWFsaXplIHRoZSBkaXJlY3RpdmUsIG1peGluIGRlZmluaXRpb24gcHJvcGVydGllcywKICAgKiBzZXR1cCB0aGUgd2F0Y2hlciwgY2FsbCBkZWZpbml0aW9uIGJpbmQoKSBhbmQgdXBkYXRlKCkKICAgKiBpZiBwcmVzZW50LgogICAqLwoKCiAgRGlyZWN0aXZlLnByb3RvdHlwZS5fYmluZCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBuYW1lID0gdGhpcy5uYW1lOwogICAgdmFyIGRlc2NyaXB0b3IgPSB0aGlzLmRlc2NyaXB0b3I7IC8vIHJlbW92ZSBhdHRyaWJ1dGUKCiAgICBpZiAoKG5hbWUgIT09ICdjbG9haycgfHwgdGhpcy52bS5faXNDb21waWxlZCkgJiYgdGhpcy5lbCAmJiB0aGlzLmVsLnJlbW92ZUF0dHJpYnV0ZSkgewogICAgICB2YXIgYXR0ciA9IGRlc2NyaXB0b3IuYXR0ciB8fCAndi0nICsgbmFtZTsKICAgICAgdGhpcy5lbC5yZW1vdmVBdHRyaWJ1dGUoYXR0cik7CiAgICB9IC8vIGNvcHkgZGVmIHByb3BlcnRpZXMKCgogICAgdmFyIGRlZiA9IGRlc2NyaXB0b3IuZGVmOwoKICAgIGlmICh0eXBlb2YgZGVmID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHRoaXMudXBkYXRlID0gZGVmOwogICAgfSBlbHNlIHsKICAgICAgZXh0ZW5kKHRoaXMsIGRlZik7CiAgICB9IC8vIHNldHVwIGRpcmVjdGl2ZSBwYXJhbXMKCgogICAgdGhpcy5fc2V0dXBQYXJhbXMoKTsgLy8gaW5pdGlhbCBiaW5kCgoKICAgIGlmICh0aGlzLmJpbmQpIHsKICAgICAgdGhpcy5iaW5kKCk7CiAgICB9CgogICAgdGhpcy5fYm91bmQgPSB0cnVlOwoKICAgIGlmICh0aGlzLmxpdGVyYWwpIHsKICAgICAgdGhpcy51cGRhdGUgJiYgdGhpcy51cGRhdGUoZGVzY3JpcHRvci5yYXcpOwogICAgfSBlbHNlIGlmICgodGhpcy5leHByZXNzaW9uIHx8IHRoaXMubW9kaWZpZXJzKSAmJiAodGhpcy51cGRhdGUgfHwgdGhpcy50d29XYXkpICYmICF0aGlzLl9jaGVja1N0YXRlbWVudCgpKSB7CiAgICAgIC8vIHdyYXBwZWQgdXBkYXRlciBmb3IgY29udGV4dAogICAgICB2YXIgZGlyID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnVwZGF0ZSkgewogICAgICAgIHRoaXMuX3VwZGF0ZSA9IGZ1bmN0aW9uICh2YWwsIG9sZFZhbCkgewogICAgICAgICAgaWYgKCFkaXIuX2xvY2tlZCkgewogICAgICAgICAgICBkaXIudXBkYXRlKHZhbCwgb2xkVmFsKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX3VwZGF0ZSA9IG5vb3AkMTsKICAgICAgfQoKICAgICAgdmFyIHByZVByb2Nlc3MgPSB0aGlzLl9wcmVQcm9jZXNzID8gYmluZCh0aGlzLl9wcmVQcm9jZXNzLCB0aGlzKSA6IG51bGw7CiAgICAgIHZhciBwb3N0UHJvY2VzcyA9IHRoaXMuX3Bvc3RQcm9jZXNzID8gYmluZCh0aGlzLl9wb3N0UHJvY2VzcywgdGhpcykgOiBudWxsOwogICAgICB2YXIgd2F0Y2hlciA9IHRoaXMuX3dhdGNoZXIgPSBuZXcgV2F0Y2hlcih0aGlzLnZtLCB0aGlzLmV4cHJlc3Npb24sIHRoaXMuX3VwZGF0ZSwgLy8gY2FsbGJhY2sKICAgICAgewogICAgICAgIGZpbHRlcnM6IHRoaXMuZmlsdGVycywKICAgICAgICB0d29XYXk6IHRoaXMudHdvV2F5LAogICAgICAgIGRlZXA6IHRoaXMuZGVlcCwKICAgICAgICBwcmVQcm9jZXNzOiBwcmVQcm9jZXNzLAogICAgICAgIHBvc3RQcm9jZXNzOiBwb3N0UHJvY2VzcywKICAgICAgICBzY29wZTogdGhpcy5fc2NvcGUKICAgICAgfSk7IC8vIHYtbW9kZWwgd2l0aCBpbml0YWwgaW5saW5lIHZhbHVlIG5lZWQgdG8gc3luYyBiYWNrIHRvCiAgICAgIC8vIG1vZGVsIGluc3RlYWQgb2YgdXBkYXRlIHRvIERPTSBvbiBpbml0LiBUaGV5IHdvdWxkCiAgICAgIC8vIHNldCB0aGUgYWZ0ZXJCaW5kIGhvb2sgdG8gaW5kaWNhdGUgdGhhdC4KCiAgICAgIGlmICh0aGlzLmFmdGVyQmluZCkgewogICAgICAgIHRoaXMuYWZ0ZXJCaW5kKCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy51cGRhdGUpIHsKICAgICAgICB0aGlzLnVwZGF0ZSh3YXRjaGVyLnZhbHVlKTsKICAgICAgfQogICAgfQogIH07CiAgLyoqCiAgICogU2V0dXAgYWxsIHBhcmFtIGF0dHJpYnV0ZXMsIGUuZy4gdHJhY2stYnksCiAgICogdHJhbnNpdGlvbi1tb2RlLCBldGMuLi4KICAgKi8KCgogIERpcmVjdGl2ZS5wcm90b3R5cGUuX3NldHVwUGFyYW1zID0gZnVuY3Rpb24gKCkgewogICAgaWYgKCF0aGlzLnBhcmFtcykgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHBhcmFtcyA9IHRoaXMucGFyYW1zOyAvLyBzd2FwIHRoZSBwYXJhbXMgYXJyYXkgd2l0aCBhIGZyZXNoIG9iamVjdC4KCiAgICB0aGlzLnBhcmFtcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB2YXIgaSA9IHBhcmFtcy5sZW5ndGg7CiAgICB2YXIga2V5LCB2YWwsIG1hcHBlZEtleTsKCiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIGtleSA9IGh5cGhlbmF0ZShwYXJhbXNbaV0pOwogICAgICBtYXBwZWRLZXkgPSBjYW1lbGl6ZShrZXkpOwogICAgICB2YWwgPSBnZXRCaW5kQXR0cih0aGlzLmVsLCBrZXkpOwoKICAgICAgaWYgKHZhbCAhPSBudWxsKSB7CiAgICAgICAgLy8gZHluYW1pYwogICAgICAgIHRoaXMuX3NldHVwUGFyYW1XYXRjaGVyKG1hcHBlZEtleSwgdmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBzdGF0aWMKICAgICAgICB2YWwgPSBnZXRBdHRyKHRoaXMuZWwsIGtleSk7CgogICAgICAgIGlmICh2YWwgIT0gbnVsbCkgewogICAgICAgICAgdGhpcy5wYXJhbXNbbWFwcGVkS2V5XSA9IHZhbCA9PT0gJycgPyB0cnVlIDogdmFsOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CiAgLyoqCiAgICogU2V0dXAgYSB3YXRjaGVyIGZvciBhIGR5bmFtaWMgcGFyYW0uCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5CiAgICogQHBhcmFtIHtTdHJpbmd9IGV4cHJlc3Npb24KICAgKi8KCgogIERpcmVjdGl2ZS5wcm90b3R5cGUuX3NldHVwUGFyYW1XYXRjaGVyID0gZnVuY3Rpb24gKGtleSwgZXhwcmVzc2lvbikgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIGNhbGxlZCA9IGZhbHNlOwogICAgdmFyIHVud2F0Y2ggPSAodGhpcy5fc2NvcGUgfHwgdGhpcy52bSkuJHdhdGNoKGV4cHJlc3Npb24sIGZ1bmN0aW9uICh2YWwsIG9sZFZhbCkgewogICAgICBzZWxmLnBhcmFtc1trZXldID0gdmFsOyAvLyBzaW5jZSB3ZSBhcmUgaW4gaW1tZWRpYXRlIG1vZGUsCiAgICAgIC8vIG9ubHkgY2FsbCB0aGUgcGFyYW0gY2hhbmdlIGNhbGxiYWNrcyBpZiB0aGlzIGlzIG5vdCB0aGUgZmlyc3QgdXBkYXRlLgoKICAgICAgaWYgKGNhbGxlZCkgewogICAgICAgIHZhciBjYiA9IHNlbGYucGFyYW1XYXRjaGVycyAmJiBzZWxmLnBhcmFtV2F0Y2hlcnNba2V5XTsKCiAgICAgICAgaWYgKGNiKSB7CiAgICAgICAgICBjYi5jYWxsKHNlbGYsIHZhbCwgb2xkVmFsKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FsbGVkID0gdHJ1ZTsKICAgICAgfQogICAgfSwgewogICAgICBpbW1lZGlhdGU6IHRydWUsCiAgICAgIHVzZXI6IGZhbHNlCiAgICB9KTsKICAgICh0aGlzLl9wYXJhbVVud2F0Y2hGbnMgfHwgKHRoaXMuX3BhcmFtVW53YXRjaEZucyA9IFtdKSkucHVzaCh1bndhdGNoKTsKICB9OwogIC8qKgogICAqIENoZWNrIGlmIHRoZSBkaXJlY3RpdmUgaXMgYSBmdW5jdGlvbiBjYWxsZXIKICAgKiBhbmQgaWYgdGhlIGV4cHJlc3Npb24gaXMgYSBjYWxsYWJsZSBvbmUuIElmIGJvdGggdHJ1ZSwKICAgKiB3ZSB3cmFwIHVwIHRoZSBleHByZXNzaW9uIGFuZCB1c2UgaXQgYXMgdGhlIGV2ZW50CiAgICogaGFuZGxlci4KICAgKgogICAqIGUuZy4gb24tY2xpY2s9ImErKyIKICAgKgogICAqIEByZXR1cm4ge0Jvb2xlYW59CiAgICovCgoKICBEaXJlY3RpdmUucHJvdG90eXBlLl9jaGVja1N0YXRlbWVudCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBleHByZXNzaW9uID0gdGhpcy5leHByZXNzaW9uOwoKICAgIGlmIChleHByZXNzaW9uICYmIHRoaXMuYWNjZXB0U3RhdGVtZW50ICYmICFpc1NpbXBsZVBhdGgoZXhwcmVzc2lvbikpIHsKICAgICAgdmFyIGZuID0gcGFyc2VFeHByZXNzaW9uKGV4cHJlc3Npb24pLmdldDsKICAgICAgdmFyIHNjb3BlID0gdGhpcy5fc2NvcGUgfHwgdGhpcy52bTsKCiAgICAgIHZhciBoYW5kbGVyID0gZnVuY3Rpb24gaGFuZGxlcihlKSB7CiAgICAgICAgc2NvcGUuJGV2ZW50ID0gZTsKICAgICAgICBmbi5jYWxsKHNjb3BlLCBzY29wZSk7CiAgICAgICAgc2NvcGUuJGV2ZW50ID0gbnVsbDsKICAgICAgfTsKCiAgICAgIGlmICh0aGlzLmZpbHRlcnMpIHsKICAgICAgICBoYW5kbGVyID0gc2NvcGUuX2FwcGx5RmlsdGVycyhoYW5kbGVyLCBudWxsLCB0aGlzLmZpbHRlcnMpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZShoYW5kbGVyKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfTsKICAvKioKICAgKiBTZXQgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUgd2l0aCB0aGUgc2V0dGVyLgogICAqIFRoaXMgc2hvdWxkIG9ubHkgYmUgdXNlZCBpbiB0d28td2F5IGRpcmVjdGl2ZXMKICAgKiBlLmcuIHYtbW9kZWwuCiAgICoKICAgKiBAcGFyYW0geyp9IHZhbHVlCiAgICogQHB1YmxpYwogICAqLwoKCiAgRGlyZWN0aXZlLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICBpZiAodGhpcy50d29XYXkpIHsKICAgICAgdGhpcy5fd2l0aExvY2soZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX3dhdGNoZXIuc2V0KHZhbHVlKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKCdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJykgewogICAgICB3YXJuKCdEaXJlY3RpdmUuc2V0KCkgY2FuIG9ubHkgYmUgdXNlZCBpbnNpZGUgdHdvV2F5JyArICdkaXJlY3RpdmVzLicpOwogICAgfQogIH07CiAgLyoqCiAgICogRXhlY3V0ZSBhIGZ1bmN0aW9uIHdoaWxlIHByZXZlbnRpbmcgdGhhdCBmdW5jdGlvbiBmcm9tCiAgICogdHJpZ2dlcmluZyB1cGRhdGVzIG9uIHRoaXMgZGlyZWN0aXZlIGluc3RhbmNlLgogICAqCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICAgKi8KCgogIERpcmVjdGl2ZS5wcm90b3R5cGUuX3dpdGhMb2NrID0gZnVuY3Rpb24gKGZuKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBzZWxmLl9sb2NrZWQgPSB0cnVlOwogICAgZm4uY2FsbChzZWxmKTsKICAgIG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgc2VsZi5fbG9ja2VkID0gZmFsc2U7CiAgICB9KTsKICB9OwogIC8qKgogICAqIENvbnZlbmllbmNlIG1ldGhvZCB0aGF0IGF0dGFjaGVzIGEgRE9NIGV2ZW50IGxpc3RlbmVyCiAgICogdG8gdGhlIGRpcmVjdGl2ZSBlbGVtZW50IGFuZCBhdXRvbWV0aWNhbGx5IHRlYXJzIGl0IGRvd24KICAgKiBkdXJpbmcgdW5iaW5kLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlcgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3VzZUNhcHR1cmVdCiAgICovCgoKICBEaXJlY3RpdmUucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKGV2ZW50LCBoYW5kbGVyLCB1c2VDYXB0dXJlKSB7CiAgICBvbih0aGlzLmVsLCBldmVudCwgaGFuZGxlciwgdXNlQ2FwdHVyZSk7CiAgICAodGhpcy5fbGlzdGVuZXJzIHx8ICh0aGlzLl9saXN0ZW5lcnMgPSBbXSkpLnB1c2goW2V2ZW50LCBoYW5kbGVyXSk7CiAgfTsKICAvKioKICAgKiBUZWFyZG93biB0aGUgd2F0Y2hlciBhbmQgY2FsbCB1bmJpbmQuCiAgICovCgoKICBEaXJlY3RpdmUucHJvdG90eXBlLl90ZWFyZG93biA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLl9ib3VuZCkgewogICAgICB0aGlzLl9ib3VuZCA9IGZhbHNlOwoKICAgICAgaWYgKHRoaXMudW5iaW5kKSB7CiAgICAgICAgdGhpcy51bmJpbmQoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX3dhdGNoZXIpIHsKICAgICAgICB0aGlzLl93YXRjaGVyLnRlYXJkb3duKCk7CiAgICAgIH0KCiAgICAgIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CiAgICAgIHZhciBpOwoKICAgICAgaWYgKGxpc3RlbmVycykgewogICAgICAgIGkgPSBsaXN0ZW5lcnMubGVuZ3RoOwoKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICBvZmYodGhpcy5lbCwgbGlzdGVuZXJzW2ldWzBdLCBsaXN0ZW5lcnNbaV1bMV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHVud2F0Y2hGbnMgPSB0aGlzLl9wYXJhbVVud2F0Y2hGbnM7CgogICAgICBpZiAodW53YXRjaEZucykgewogICAgICAgIGkgPSB1bndhdGNoRm5zLmxlbmd0aDsKCiAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgdW53YXRjaEZuc1tpXSgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB0aGlzLmVsKSB7CiAgICAgICAgdGhpcy5lbC5fdnVlX2RpcmVjdGl2ZXMuJHJlbW92ZSh0aGlzKTsKICAgICAgfQoKICAgICAgdGhpcy52bSA9IHRoaXMuZWwgPSB0aGlzLl93YXRjaGVyID0gdGhpcy5fbGlzdGVuZXJzID0gbnVsbDsKICAgIH0KICB9OwoKICBmdW5jdGlvbiBsaWZlY3ljbGVNaXhpbihWdWUpIHsKICAgIC8qKgogICAgICogVXBkYXRlIHYtcmVmIGZvciBjb21wb25lbnQuCiAgICAgKgogICAgICogQHBhcmFtIHtCb29sZWFufSByZW1vdmUKICAgICAqLwogICAgVnVlLnByb3RvdHlwZS5fdXBkYXRlUmVmID0gZnVuY3Rpb24gKHJlbW92ZSkgewogICAgICB2YXIgcmVmID0gdGhpcy4kb3B0aW9ucy5fcmVmOwoKICAgICAgaWYgKHJlZikgewogICAgICAgIHZhciByZWZzID0gKHRoaXMuX3Njb3BlIHx8IHRoaXMuX2NvbnRleHQpLiRyZWZzOwoKICAgICAgICBpZiAocmVtb3ZlKSB7CiAgICAgICAgICBpZiAocmVmc1tyZWZdID09PSB0aGlzKSB7CiAgICAgICAgICAgIHJlZnNbcmVmXSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlZnNbcmVmXSA9IHRoaXM7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBUcmFuc2NsdWRlLCBjb21waWxlIGFuZCBsaW5rIGVsZW1lbnQuCiAgICAgKgogICAgICogSWYgYSBwcmUtY29tcGlsZWQgbGlua2VyIGlzIGF2YWlsYWJsZSwgdGhhdCBtZWFucyB0aGUKICAgICAqIHBhc3NlZCBpbiBlbGVtZW50IHdpbGwgYmUgcHJlLXRyYW5zY2x1ZGVkIGFuZCBjb21waWxlZAogICAgICogYXMgd2VsbCAtIGFsbCB3ZSBuZWVkIHRvIGRvIGlzIHRvIGNhbGwgdGhlIGxpbmtlci4KICAgICAqCiAgICAgKiBPdGhlcndpc2Ugd2UgbmVlZCB0byBjYWxsIHRyYW5zY2x1ZGUvY29tcGlsZS9saW5rIGhlcmUuCiAgICAgKgogICAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuX2NvbXBpbGUgPSBmdW5jdGlvbiAoZWwpIHsKICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLiRvcHRpb25zOyAvLyB0cmFuc2NsdWRlIGFuZCBpbml0IGVsZW1lbnQKICAgICAgLy8gdHJhbnNjbHVkZSBjYW4gcG90ZW50aWFsbHkgcmVwbGFjZSBvcmlnaW5hbAogICAgICAvLyBzbyB3ZSBuZWVkIHRvIGtlZXAgcmVmZXJlbmNlOyB0aGlzIHN0ZXAgYWxzbyBpbmplY3RzCiAgICAgIC8vIHRoZSB0ZW1wbGF0ZSBhbmQgY2FjaGVzIHRoZSBvcmlnaW5hbCBhdHRyaWJ1dGVzCiAgICAgIC8vIG9uIHRoZSBjb250YWluZXIgbm9kZSBhbmQgcmVwbGFjZXIgbm9kZS4KCiAgICAgIHZhciBvcmlnaW5hbCA9IGVsOwogICAgICBlbCA9IHRyYW5zY2x1ZGUoZWwsIG9wdGlvbnMpOwoKICAgICAgdGhpcy5faW5pdEVsZW1lbnQoZWwpOyAvLyBoYW5kbGUgdi1wcmUgb24gcm9vdCBub2RlICgjMjAyNikKCgogICAgICBpZiAoZWwubm9kZVR5cGUgPT09IDEgJiYgZ2V0QXR0cihlbCwgJ3YtcHJlJykgIT09IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gcm9vdCBpcyBhbHdheXMgY29tcGlsZWQgcGVyLWluc3RhbmNlLCBiZWNhdXNlCiAgICAgIC8vIGNvbnRhaW5lciBhdHRycyBhbmQgcHJvcHMgY2FuIGJlIGRpZmZlcmVudCBldmVyeSB0aW1lLgoKCiAgICAgIHZhciBjb250ZXh0T3B0aW9ucyA9IHRoaXMuX2NvbnRleHQgJiYgdGhpcy5fY29udGV4dC4kb3B0aW9uczsKICAgICAgdmFyIHJvb3RMaW5rZXIgPSBjb21waWxlUm9vdChlbCwgb3B0aW9ucywgY29udGV4dE9wdGlvbnMpOyAvLyByZXNvbHZlIHNsb3QgZGlzdHJpYnV0aW9uCgogICAgICByZXNvbHZlU2xvdHModGhpcywgb3B0aW9ucy5fY29udGVudCk7IC8vIGNvbXBpbGUgYW5kIGxpbmsgdGhlIHJlc3QKCiAgICAgIHZhciBjb250ZW50TGlua0ZuOwogICAgICB2YXIgY3RvciA9IHRoaXMuY29uc3RydWN0b3I7IC8vIGNvbXBvbmVudCBjb21waWxhdGlvbiBjYW4gYmUgY2FjaGVkCiAgICAgIC8vIGFzIGxvbmcgYXMgaXQncyBub3QgdXNpbmcgaW5saW5lLXRlbXBsYXRlCgogICAgICBpZiAob3B0aW9ucy5fbGlua2VyQ2FjaGFibGUpIHsKICAgICAgICBjb250ZW50TGlua0ZuID0gY3Rvci5saW5rZXI7CgogICAgICAgIGlmICghY29udGVudExpbmtGbikgewogICAgICAgICAgY29udGVudExpbmtGbiA9IGN0b3IubGlua2VyID0gY29tcGlsZShlbCwgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9IC8vIGxpbmsgcGhhc2UKICAgICAgLy8gbWFrZSBzdXJlIHRvIGxpbmsgcm9vdCB3aXRoIHByb3Agc2NvcGUhCgoKICAgICAgdmFyIHJvb3RVbmxpbmtGbiA9IHJvb3RMaW5rZXIodGhpcywgZWwsIHRoaXMuX3Njb3BlKTsKICAgICAgdmFyIGNvbnRlbnRVbmxpbmtGbiA9IGNvbnRlbnRMaW5rRm4gPyBjb250ZW50TGlua0ZuKHRoaXMsIGVsKSA6IGNvbXBpbGUoZWwsIG9wdGlvbnMpKHRoaXMsIGVsKTsgLy8gcmVnaXN0ZXIgY29tcG9zaXRlIHVubGluayBmdW5jdGlvbgogICAgICAvLyB0byBiZSBjYWxsZWQgZHVyaW5nIGluc3RhbmNlIGRlc3RydWN0aW9uCgogICAgICB0aGlzLl91bmxpbmtGbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByb290VW5saW5rRm4oKTsgLy8gcGFzc2luZyBkZXN0cm95aW5nOiB0cnVlIHRvIGF2b2lkIHNlYXJjaGluZyBhbmQKICAgICAgICAvLyBzcGxpY2luZyB0aGUgZGlyZWN0aXZlcwoKICAgICAgICBjb250ZW50VW5saW5rRm4odHJ1ZSk7CiAgICAgIH07IC8vIGZpbmFsbHkgcmVwbGFjZSBvcmlnaW5hbAoKCiAgICAgIGlmIChvcHRpb25zLnJlcGxhY2UpIHsKICAgICAgICByZXBsYWNlKG9yaWdpbmFsLCBlbCk7CiAgICAgIH0KCiAgICAgIHRoaXMuX2lzQ29tcGlsZWQgPSB0cnVlOwoKICAgICAgdGhpcy5fY2FsbEhvb2soJ2NvbXBpbGVkJyk7CiAgICB9OwogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIGluc3RhbmNlIGVsZW1lbnQuIENhbGxlZCBpbiB0aGUgcHVibGljCiAgICAgKiAkbW91bnQoKSBtZXRob2QuCiAgICAgKgogICAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuX2luaXRFbGVtZW50ID0gZnVuY3Rpb24gKGVsKSB7CiAgICAgIGlmIChpc0ZyYWdtZW50KGVsKSkgewogICAgICAgIHRoaXMuX2lzRnJhZ21lbnQgPSB0cnVlOwogICAgICAgIHRoaXMuJGVsID0gdGhpcy5fZnJhZ21lbnRTdGFydCA9IGVsLmZpcnN0Q2hpbGQ7CiAgICAgICAgdGhpcy5fZnJhZ21lbnRFbmQgPSBlbC5sYXN0Q2hpbGQ7IC8vIHNldCBwZXJzaXN0ZWQgdGV4dCBhbmNob3JzIHRvIGVtcHR5CgogICAgICAgIGlmICh0aGlzLl9mcmFnbWVudFN0YXJ0Lm5vZGVUeXBlID09PSAzKSB7CiAgICAgICAgICB0aGlzLl9mcmFnbWVudFN0YXJ0LmRhdGEgPSB0aGlzLl9mcmFnbWVudEVuZC5kYXRhID0gJyc7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9mcmFnbWVudCA9IGVsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJGVsID0gZWw7CiAgICAgIH0KCiAgICAgIHRoaXMuJGVsLl9fdnVlX18gPSB0aGlzOwoKICAgICAgdGhpcy5fY2FsbEhvb2soJ2JlZm9yZUNvbXBpbGUnKTsKICAgIH07CiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgYmluZCBhIGRpcmVjdGl2ZSB0byBhbiBlbGVtZW50LgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdG9yIC0gcGFyc2VkIGRpcmVjdGl2ZSBkZXNjcmlwdG9yCiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUgICAtIHRhcmdldCBub2RlCiAgICAgKiBAcGFyYW0ge1Z1ZX0gW2hvc3RdIC0gdHJhbnNjbHVzaW9uIGhvc3QgY29tcG9uZW50CiAgICAgKiBAcGFyYW0ge09iamVjdH0gW3Njb3BlXSAtIHYtZm9yIHNjb3BlCiAgICAgKiBAcGFyYW0ge0ZyYWdtZW50fSBbZnJhZ10gLSBvd25lciBmcmFnbWVudAogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuX2JpbmREaXIgPSBmdW5jdGlvbiAoZGVzY3JpcHRvciwgbm9kZSwgaG9zdCwgc2NvcGUsIGZyYWcpIHsKICAgICAgdGhpcy5fZGlyZWN0aXZlcy5wdXNoKG5ldyBEaXJlY3RpdmUoZGVzY3JpcHRvciwgdGhpcywgbm9kZSwgaG9zdCwgc2NvcGUsIGZyYWcpKTsKICAgIH07CiAgICAvKioKICAgICAqIFRlYXJkb3duIGFuIGluc3RhbmNlLCB1bm9ic2VydmVzIHRoZSBkYXRhLCB1bmJpbmQgYWxsIHRoZQogICAgICogZGlyZWN0aXZlcywgdHVybiBvZmYgYWxsIHRoZSBldmVudCBsaXN0ZW5lcnMsIGV0Yy4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHJlbW92ZSAtIHdoZXRoZXIgdG8gcmVtb3ZlIHRoZSBET00gbm9kZS4KICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gZGVmZXJDbGVhbnVwIC0gaWYgdHJ1ZSwgZGVmZXIgY2xlYW51cCB0bwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZSBjYWxsZWQgbGF0ZXIKICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLl9kZXN0cm95ID0gZnVuY3Rpb24gKHJlbW92ZSwgZGVmZXJDbGVhbnVwKSB7CiAgICAgIGlmICh0aGlzLl9pc0JlaW5nRGVzdHJveWVkKSB7CiAgICAgICAgaWYgKCFkZWZlckNsZWFudXApIHsKICAgICAgICAgIHRoaXMuX2NsZWFudXAoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGRlc3Ryb3lSZWFkeTsKICAgICAgdmFyIHBlbmRpbmdSZW1vdmFsOwogICAgICB2YXIgc2VsZiA9IHRoaXM7IC8vIENsZWFudXAgc2hvdWxkIGJlIGNhbGxlZCBlaXRoZXIgc3luY2hyb25vdXNseSBvciBhc3luY2hyb25veXNseSBhcwogICAgICAvLyBjYWxsYmFjayBvZiB0aGlzLiRyZW1vdmUoKSwgb3IgaWYgcmVtb3ZlIGFuZCBkZWZlckNsZWFudXAgYXJlIGZhbHNlLgogICAgICAvLyBJbiBhbnkgY2FzZSBpdCBzaG91bGQgYmUgY2FsbGVkIGFmdGVyIGFsbCBvdGhlciByZW1vdmluZywgdW5iaW5kaW5nIGFuZAogICAgICAvLyB0dXJuaW5nIG9mIGlzIGRvbmUKCiAgICAgIHZhciBjbGVhbnVwSWZQb3NzaWJsZSA9IGZ1bmN0aW9uIGNsZWFudXBJZlBvc3NpYmxlKCkgewogICAgICAgIGlmIChkZXN0cm95UmVhZHkgJiYgIXBlbmRpbmdSZW1vdmFsICYmICFkZWZlckNsZWFudXApIHsKICAgICAgICAgIHNlbGYuX2NsZWFudXAoKTsKICAgICAgICB9CiAgICAgIH07IC8vIHJlbW92ZSBET00gZWxlbWVudAoKCiAgICAgIGlmIChyZW1vdmUgJiYgdGhpcy4kZWwpIHsKICAgICAgICBwZW5kaW5nUmVtb3ZhbCA9IHRydWU7CiAgICAgICAgdGhpcy4kcmVtb3ZlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHBlbmRpbmdSZW1vdmFsID0gZmFsc2U7CiAgICAgICAgICBjbGVhbnVwSWZQb3NzaWJsZSgpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLl9jYWxsSG9vaygnYmVmb3JlRGVzdHJveScpOwoKICAgICAgdGhpcy5faXNCZWluZ0Rlc3Ryb3llZCA9IHRydWU7CiAgICAgIHZhciBpOyAvLyByZW1vdmUgc2VsZiBmcm9tIHBhcmVudC4gb25seSBuZWNlc3NhcnkKICAgICAgLy8gaWYgcGFyZW50IGlzIG5vdCBiZWluZyBkZXN0cm95ZWQgYXMgd2VsbC4KCiAgICAgIHZhciBwYXJlbnQgPSB0aGlzLiRwYXJlbnQ7CgogICAgICBpZiAocGFyZW50ICYmICFwYXJlbnQuX2lzQmVpbmdEZXN0cm95ZWQpIHsKICAgICAgICBwYXJlbnQuJGNoaWxkcmVuLiRyZW1vdmUodGhpcyk7IC8vIHVucmVnaXN0ZXIgcmVmIChyZW1vdmU6IHRydWUpCgogICAgICAgIHRoaXMuX3VwZGF0ZVJlZih0cnVlKTsKICAgICAgfSAvLyBkZXN0cm95IGFsbCBjaGlsZHJlbi4KCgogICAgICBpID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoOwoKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIHRoaXMuJGNoaWxkcmVuW2ldLiRkZXN0cm95KCk7CiAgICAgIH0gLy8gdGVhcmRvd24gcHJvcHMKCgogICAgICBpZiAodGhpcy5fcHJvcHNVbmxpbmtGbikgewogICAgICAgIHRoaXMuX3Byb3BzVW5saW5rRm4oKTsKICAgICAgfSAvLyB0ZWFyZG93biBhbGwgZGlyZWN0aXZlcy4gdGhpcyBhbHNvIHRlYXJzZG93biBhbGwKICAgICAgLy8gZGlyZWN0aXZlLW93bmVkIHdhdGNoZXJzLgoKCiAgICAgIGlmICh0aGlzLl91bmxpbmtGbikgewogICAgICAgIHRoaXMuX3VubGlua0ZuKCk7CiAgICAgIH0KCiAgICAgIGkgPSB0aGlzLl93YXRjaGVycy5sZW5ndGg7CgogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgdGhpcy5fd2F0Y2hlcnNbaV0udGVhcmRvd24oKTsKICAgICAgfSAvLyByZW1vdmUgcmVmZXJlbmNlIHRvIHNlbGYgb24gJGVsCgoKICAgICAgaWYgKHRoaXMuJGVsKSB7CiAgICAgICAgdGhpcy4kZWwuX192dWVfXyA9IG51bGw7CiAgICAgIH0KCiAgICAgIGRlc3Ryb3lSZWFkeSA9IHRydWU7CiAgICAgIGNsZWFudXBJZlBvc3NpYmxlKCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBDbGVhbiB1cCB0byBlbnN1cmUgZ2FyYmFnZSBjb2xsZWN0aW9uLgogICAgICogVGhpcyBpcyBjYWxsZWQgYWZ0ZXIgdGhlIGxlYXZlIHRyYW5zaXRpb24gaWYgdGhlcmUKICAgICAqIGlzIGFueS4KICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLl9jbGVhbnVwID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy5faXNEZXN0cm95ZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gcmVtb3ZlIHNlbGYgZnJvbSBvd25lciBmcmFnbWVudAogICAgICAvLyBkbyBpdCBpbiBjbGVhbnVwIHNvIHRoYXQgd2UgY2FuIGNhbGwgJGRlc3Ryb3kgd2l0aAogICAgICAvLyBkZWZlciByaWdodCB3aGVuIGEgZnJhZ21lbnQgaXMgYWJvdXQgdG8gYmUgcmVtb3ZlZC4KCgogICAgICBpZiAodGhpcy5fZnJhZykgewogICAgICAgIHRoaXMuX2ZyYWcuY2hpbGRyZW4uJHJlbW92ZSh0aGlzKTsKICAgICAgfSAvLyByZW1vdmUgcmVmZXJlbmNlIGZyb20gZGF0YSBvYgogICAgICAvLyBmcm96ZW4gb2JqZWN0IG1heSBub3QgaGF2ZSBvYnNlcnZlci4KCgogICAgICBpZiAodGhpcy5fZGF0YSAmJiB0aGlzLl9kYXRhLl9fb2JfXykgewogICAgICAgIHRoaXMuX2RhdGEuX19vYl9fLnJlbW92ZVZtKHRoaXMpOwogICAgICB9IC8vIENsZWFuIHVwIHJlZmVyZW5jZXMgdG8gcHJpdmF0ZSBwcm9wZXJ0aWVzIGFuZCBvdGhlcgogICAgICAvLyBpbnN0YW5jZXMuIHByZXNlcnZlIHJlZmVyZW5jZSB0byBfZGF0YSBzbyB0aGF0IHByb3h5CiAgICAgIC8vIGFjY2Vzc29ycyBzdGlsbCB3b3JrLiBUaGUgb25seSBwb3RlbnRpYWwgc2lkZSBlZmZlY3QKICAgICAgLy8gaGVyZSBpcyB0aGF0IG11dGF0aW5nIHRoZSBpbnN0YW5jZSBhZnRlciBpdCdzIGRlc3Ryb3llZAogICAgICAvLyBtYXkgYWZmZWN0IHRoZSBzdGF0ZSBvZiBvdGhlciBjb21wb25lbnRzIHRoYXQgYXJlIHN0aWxsCiAgICAgIC8vIG9ic2VydmluZyB0aGUgc2FtZSBvYmplY3QsIGJ1dCB0aGF0IHNlZW1zIHRvIGJlIGEKICAgICAgLy8gcmVhc29uYWJsZSByZXNwb25zaWJpbGl0eSBmb3IgdGhlIHVzZXIgcmF0aGVyIHRoYW4KICAgICAgLy8gYWx3YXlzIHRocm93aW5nIGFuIGVycm9yIG9uIHRoZW0uCgoKICAgICAgdGhpcy4kZWwgPSB0aGlzLiRwYXJlbnQgPSB0aGlzLiRyb290ID0gdGhpcy4kY2hpbGRyZW4gPSB0aGlzLl93YXRjaGVycyA9IHRoaXMuX2NvbnRleHQgPSB0aGlzLl9zY29wZSA9IHRoaXMuX2RpcmVjdGl2ZXMgPSBudWxsOyAvLyBjYWxsIHRoZSBsYXN0IGhvb2suLi4KCiAgICAgIHRoaXMuX2lzRGVzdHJveWVkID0gdHJ1ZTsKCiAgICAgIHRoaXMuX2NhbGxIb29rKCdkZXN0cm95ZWQnKTsgLy8gdHVybiBvZmYgYWxsIGluc3RhbmNlIGxpc3RlbmVycy4KCgogICAgICB0aGlzLiRvZmYoKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBtaXNjTWl4aW4oVnVlKSB7CiAgICAvKioKICAgICAqIEFwcGx5IGEgbGlzdCBvZiBmaWx0ZXIgKGRlc2NyaXB0b3JzKSB0byBhIHZhbHVlLgogICAgICogVXNpbmcgcGxhaW4gZm9yIGxvb3BzIGhlcmUgYmVjYXVzZSB0aGlzIHdpbGwgYmUgY2FsbGVkIGluCiAgICAgKiB0aGUgZ2V0dGVyIG9mIGFueSB3YXRjaGVyIHdpdGggZmlsdGVycyBzbyBpdCBpcyB2ZXJ5CiAgICAgKiBwZXJmb3JtYW5jZSBzZW5zaXRpdmUuCiAgICAgKgogICAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAgICogQHBhcmFtIHsqfSBbb2xkVmFsdWVdCiAgICAgKiBAcGFyYW0ge0FycmF5fSBmaWx0ZXJzCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHdyaXRlCiAgICAgKiBAcmV0dXJuIHsqfQogICAgICovCiAgICBWdWUucHJvdG90eXBlLl9hcHBseUZpbHRlcnMgPSBmdW5jdGlvbiAodmFsdWUsIG9sZFZhbHVlLCBmaWx0ZXJzLCB3cml0ZSkgewogICAgICB2YXIgZmlsdGVyLCBmbiwgYXJncywgYXJnLCBvZmZzZXQsIGksIGwsIGosIGs7CgogICAgICBmb3IgKGkgPSAwLCBsID0gZmlsdGVycy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBmaWx0ZXIgPSBmaWx0ZXJzW3dyaXRlID8gbCAtIGkgLSAxIDogaV07CiAgICAgICAgZm4gPSByZXNvbHZlQXNzZXQodGhpcy4kb3B0aW9ucywgJ2ZpbHRlcnMnLCBmaWx0ZXIubmFtZSwgdHJ1ZSk7CiAgICAgICAgaWYgKCFmbikgY29udGludWU7CiAgICAgICAgZm4gPSB3cml0ZSA/IGZuLndyaXRlIDogZm4ucmVhZCB8fCBmbjsKICAgICAgICBpZiAodHlwZW9mIGZuICE9PSAnZnVuY3Rpb24nKSBjb250aW51ZTsKICAgICAgICBhcmdzID0gd3JpdGUgPyBbdmFsdWUsIG9sZFZhbHVlXSA6IFt2YWx1ZV07CiAgICAgICAgb2Zmc2V0ID0gd3JpdGUgPyAyIDogMTsKCiAgICAgICAgaWYgKGZpbHRlci5hcmdzKSB7CiAgICAgICAgICBmb3IgKGogPSAwLCBrID0gZmlsdGVyLmFyZ3MubGVuZ3RoOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGFyZyA9IGZpbHRlci5hcmdzW2pdOwogICAgICAgICAgICBhcmdzW2ogKyBvZmZzZXRdID0gYXJnLmR5bmFtaWMgPyB0aGlzLiRnZXQoYXJnLnZhbHVlKSA6IGFyZy52YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhbHVlID0gZm4uYXBwbHkodGhpcywgYXJncyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgICAvKioKICAgICAqIFJlc29sdmUgYSBjb21wb25lbnQsIGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSBjb21wb25lbnQKICAgICAqIGlzIGRlZmluZWQgbm9ybWFsbHkgb3IgdXNpbmcgYW4gYXN5bmMgZmFjdG9yeSBmdW5jdGlvbi4KICAgICAqIFJlc29sdmVzIHN5bmNocm9ub3VzbHkgaWYgYWxyZWFkeSByZXNvbHZlZCwgb3RoZXJ3aXNlCiAgICAgKiByZXNvbHZlcyBhc3luY2hyb25vdXNseSBhbmQgY2FjaGVzIHRoZSByZXNvbHZlZAogICAgICogY29uc3RydWN0b3Igb24gdGhlIGZhY3RvcnkuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd8RnVuY3Rpb259IHZhbHVlCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYgogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuX3Jlc29sdmVDb21wb25lbnQgPSBmdW5jdGlvbiAodmFsdWUsIGNiKSB7CiAgICAgIHZhciBmYWN0b3J5OwoKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGZhY3RvcnkgPSB2YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmYWN0b3J5ID0gcmVzb2x2ZUFzc2V0KHRoaXMuJG9wdGlvbnMsICdjb21wb25lbnRzJywgdmFsdWUsIHRydWUpOwogICAgICB9CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICAgIGlmICghZmFjdG9yeSkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBhc3luYyBjb21wb25lbnQgZmFjdG9yeQoKCiAgICAgIGlmICghZmFjdG9yeS5vcHRpb25zKSB7CiAgICAgICAgaWYgKGZhY3RvcnkucmVzb2x2ZWQpIHsKICAgICAgICAgIC8vIGNhY2hlZAogICAgICAgICAgY2IoZmFjdG9yeS5yZXNvbHZlZCk7CiAgICAgICAgfSBlbHNlIGlmIChmYWN0b3J5LnJlcXVlc3RlZCkgewogICAgICAgICAgLy8gcG9vbCBjYWxsYmFja3MKICAgICAgICAgIGZhY3RvcnkucGVuZGluZ0NhbGxiYWNrcy5wdXNoKGNiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZmFjdG9yeS5yZXF1ZXN0ZWQgPSB0cnVlOwogICAgICAgICAgdmFyIGNicyA9IGZhY3RvcnkucGVuZGluZ0NhbGxiYWNrcyA9IFtjYl07CiAgICAgICAgICBmYWN0b3J5LmNhbGwodGhpcywgZnVuY3Rpb24gcmVzb2x2ZShyZXMpIHsKICAgICAgICAgICAgaWYgKGlzUGxhaW5PYmplY3QocmVzKSkgewogICAgICAgICAgICAgIHJlcyA9IFZ1ZS5leHRlbmQocmVzKTsKICAgICAgICAgICAgfSAvLyBjYWNoZSByZXNvbHZlZAoKCiAgICAgICAgICAgIGZhY3RvcnkucmVzb2x2ZWQgPSByZXM7IC8vIGludm9rZSBjYWxsYmFja3MKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2JzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgIGNic1tpXShyZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBmdW5jdGlvbiByZWplY3QocmVhc29uKSB7CiAgICAgICAgICAgICdkZXZlbG9wbWVudCcgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuKCdGYWlsZWQgdG8gcmVzb2x2ZSBhc3luYyBjb21wb25lbnQnICsgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyAnOiAnICsgdmFsdWUgOiAnJykgKyAnLiAnICsgKHJlYXNvbiA/ICdcblJlYXNvbjogJyArIHJlYXNvbiA6ICcnKSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gbm9ybWFsIGNvbXBvbmVudAogICAgICAgIGNiKGZhY3RvcnkpOwogICAgICB9CiAgICB9OwogIH0KCiAgdmFyIGZpbHRlclJFJDEgPSAvW158XVx8W158XS87CgogIGZ1bmN0aW9uIGRhdGFBUEkoVnVlKSB7CiAgICAvKioKICAgICAqIEdldCB0aGUgdmFsdWUgZnJvbSBhbiBleHByZXNzaW9uIG9uIHRoaXMgdm0uCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IGV4cAogICAgICogQHBhcmFtIHtCb29sZWFufSBbYXNTdGF0ZW1lbnRdCiAgICAgKiBAcmV0dXJuIHsqfQogICAgICovCiAgICBWdWUucHJvdG90eXBlLiRnZXQgPSBmdW5jdGlvbiAoZXhwLCBhc1N0YXRlbWVudCkgewogICAgICB2YXIgcmVzID0gcGFyc2VFeHByZXNzaW9uKGV4cCk7CgogICAgICBpZiAocmVzKSB7CiAgICAgICAgaWYgKGFzU3RhdGVtZW50KSB7CiAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gc3RhdGVtZW50SGFuZGxlcigpIHsKICAgICAgICAgICAgc2VsZi4kYXJndW1lbnRzID0gdG9BcnJheShhcmd1bWVudHMpOwogICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVzLmdldC5jYWxsKHNlbGYsIHNlbGYpOwogICAgICAgICAgICBzZWxmLiRhcmd1bWVudHMgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHJlcy5nZXQuY2FsbCh0aGlzLCB0aGlzKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlIGZyb20gYW4gZXhwcmVzc2lvbiBvbiB0aGlzIHZtLgogICAgICogVGhlIGV4cHJlc3Npb24gbXVzdCBiZSBhIHZhbGlkIGxlZnQtaGFuZAogICAgICogZXhwcmVzc2lvbiBpbiBhbiBhc3NpZ25tZW50LgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBleHAKICAgICAqIEBwYXJhbSB7Kn0gdmFsCiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS4kc2V0ID0gZnVuY3Rpb24gKGV4cCwgdmFsKSB7CiAgICAgIHZhciByZXMgPSBwYXJzZUV4cHJlc3Npb24oZXhwLCB0cnVlKTsKCiAgICAgIGlmIChyZXMgJiYgcmVzLnNldCkgewogICAgICAgIHJlcy5zZXQuY2FsbCh0aGlzLCB0aGlzLCB2YWwpOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBEZWxldGUgYSBwcm9wZXJ0eSBvbiB0aGUgVk0KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5CiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS4kZGVsZXRlID0gZnVuY3Rpb24gKGtleSkgewogICAgICBkZWwodGhpcy5fZGF0YSwga2V5KTsKICAgIH07CiAgICAvKioKICAgICAqIFdhdGNoIGFuIGV4cHJlc3Npb24sIHRyaWdnZXIgY2FsbGJhY2sgd2hlbiBpdHMKICAgICAqIHZhbHVlIGNoYW5nZXMuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd8RnVuY3Rpb259IGV4cE9yRm4KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNiCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdCiAgICAgKiAgICAgICAgICAgICAgICAgLSB7Qm9vbGVhbn0gZGVlcAogICAgICogICAgICAgICAgICAgICAgIC0ge0Jvb2xlYW59IGltbWVkaWF0ZQogICAgICogQHJldHVybiB7RnVuY3Rpb259IC0gdW53YXRjaEZuCiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS4kd2F0Y2ggPSBmdW5jdGlvbiAoZXhwT3JGbiwgY2IsIG9wdGlvbnMpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdmFyIHBhcnNlZDsKCiAgICAgIGlmICh0eXBlb2YgZXhwT3JGbiA9PT0gJ3N0cmluZycpIHsKICAgICAgICBwYXJzZWQgPSBwYXJzZURpcmVjdGl2ZShleHBPckZuKTsKICAgICAgICBleHBPckZuID0gcGFyc2VkLmV4cHJlc3Npb247CiAgICAgIH0KCiAgICAgIHZhciB3YXRjaGVyID0gbmV3IFdhdGNoZXIodm0sIGV4cE9yRm4sIGNiLCB7CiAgICAgICAgZGVlcDogb3B0aW9ucyAmJiBvcHRpb25zLmRlZXAsCiAgICAgICAgc3luYzogb3B0aW9ucyAmJiBvcHRpb25zLnN5bmMsCiAgICAgICAgZmlsdGVyczogcGFyc2VkICYmIHBhcnNlZC5maWx0ZXJzLAogICAgICAgIHVzZXI6ICFvcHRpb25zIHx8IG9wdGlvbnMudXNlciAhPT0gZmFsc2UKICAgICAgfSk7CgogICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmltbWVkaWF0ZSkgewogICAgICAgIGNiLmNhbGwodm0sIHdhdGNoZXIudmFsdWUpOwogICAgICB9CgogICAgICByZXR1cm4gZnVuY3Rpb24gdW53YXRjaEZuKCkgewogICAgICAgIHdhdGNoZXIudGVhcmRvd24oKTsKICAgICAgfTsKICAgIH07CiAgICAvKioKICAgICAqIEV2YWx1YXRlIGEgdGV4dCBkaXJlY3RpdmUsIGluY2x1ZGluZyBmaWx0ZXJzLgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0CiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFthc1N0YXRlbWVudF0KICAgICAqIEByZXR1cm4ge1N0cmluZ30KICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLiRldmFsID0gZnVuY3Rpb24gKHRleHQsIGFzU3RhdGVtZW50KSB7CiAgICAgIC8vIGNoZWNrIGZvciBmaWx0ZXJzLgogICAgICBpZiAoZmlsdGVyUkUkMS50ZXN0KHRleHQpKSB7CiAgICAgICAgdmFyIGRpciA9IHBhcnNlRGlyZWN0aXZlKHRleHQpOyAvLyB0aGUgZmlsdGVyIHJlZ2V4IGNoZWNrIG1pZ2h0IGdpdmUgZmFsc2UgcG9zaXRpdmUKICAgICAgICAvLyBmb3IgcGlwZXMgaW5zaWRlIHN0cmluZ3MsIHNvIGl0J3MgcG9zc2libGUgdGhhdAogICAgICAgIC8vIHdlIGRvbid0IGdldCBhbnkgZmlsdGVycyBoZXJlCgogICAgICAgIHZhciB2YWwgPSB0aGlzLiRnZXQoZGlyLmV4cHJlc3Npb24sIGFzU3RhdGVtZW50KTsKICAgICAgICByZXR1cm4gZGlyLmZpbHRlcnMgPyB0aGlzLl9hcHBseUZpbHRlcnModmFsLCBudWxsLCBkaXIuZmlsdGVycykgOiB2YWw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gbm8gZmlsdGVyCiAgICAgICAgcmV0dXJuIHRoaXMuJGdldCh0ZXh0LCBhc1N0YXRlbWVudCk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEludGVycG9sYXRlIGEgcGllY2Ugb2YgdGVtcGxhdGUgdGV4dC4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dAogICAgICogQHJldHVybiB7U3RyaW5nfQogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuJGludGVycG9sYXRlID0gZnVuY3Rpb24gKHRleHQpIHsKICAgICAgdmFyIHRva2VucyA9IHBhcnNlVGV4dCh0ZXh0KTsKICAgICAgdmFyIHZtID0gdGhpczsKCiAgICAgIGlmICh0b2tlbnMpIHsKICAgICAgICBpZiAodG9rZW5zLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgcmV0dXJuIHZtLiRldmFsKHRva2Vuc1swXS52YWx1ZSkgKyAnJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHRva2Vucy5tYXAoZnVuY3Rpb24gKHRva2VuKSB7CiAgICAgICAgICAgIHJldHVybiB0b2tlbi50YWcgPyB2bS4kZXZhbCh0b2tlbi52YWx1ZSkgOiB0b2tlbi52YWx1ZTsKICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGV4dDsKICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogTG9nIGluc3RhbmNlIGRhdGEgYXMgYSBwbGFpbiBKUyBvYmplY3QKICAgICAqIHNvIHRoYXQgaXQgaXMgZWFzaWVyIHRvIGluc3BlY3QgaW4gY29uc29sZS4KICAgICAqIFRoaXMgbWV0aG9kIGFzc3VtZXMgY29uc29sZSBpcyBhdmFpbGFibGUuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IFtwYXRoXQogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuJGxvZyA9IGZ1bmN0aW9uIChwYXRoKSB7CiAgICAgIHZhciBkYXRhID0gcGF0aCA/IGdldFBhdGgodGhpcy5fZGF0YSwgcGF0aCkgOiB0aGlzLl9kYXRhOwoKICAgICAgaWYgKGRhdGEpIHsKICAgICAgICBkYXRhID0gY2xlYW4oZGF0YSk7CiAgICAgIH0gLy8gaW5jbHVkZSBjb21wdXRlZCBmaWVsZHMKCgogICAgICBpZiAoIXBhdGgpIHsKICAgICAgICB2YXIga2V5OwoKICAgICAgICBmb3IgKGtleSBpbiB0aGlzLiRvcHRpb25zLmNvbXB1dGVkKSB7CiAgICAgICAgICBkYXRhW2tleV0gPSBjbGVhbih0aGlzW2tleV0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuX3Byb3BzKSB7CiAgICAgICAgICBmb3IgKGtleSBpbiB0aGlzLl9wcm9wcykgewogICAgICAgICAgICBkYXRhW2tleV0gPSBjbGVhbih0aGlzW2tleV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc29sZS5sb2coZGF0YSk7CiAgICB9OwogICAgLyoqCiAgICAgKiAiY2xlYW4iIGEgZ2V0dGVyL3NldHRlciBjb252ZXJ0ZWQgb2JqZWN0IGludG8gYSBwbGFpbgogICAgICogb2JqZWN0IGNvcHkuCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IC0gb2JqCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICAgKi8KCgogICAgZnVuY3Rpb24gY2xlYW4ob2JqKSB7CiAgICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZG9tQVBJKFZ1ZSkgewogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBvbi1pbnN0YW5jZSBuZXh0VGljay4gVGhlIGNhbGxiYWNrIGlzCiAgICAgKiBhdXRvLWJvdW5kIHRvIHRoZSBpbnN0YW5jZSwgYW5kIHRoaXMgYXZvaWRzIGNvbXBvbmVudAogICAgICogbW9kdWxlcyBoYXZpbmcgdG8gcmVseSBvbiB0aGUgZ2xvYmFsIFZ1ZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAgICovCiAgICBWdWUucHJvdG90eXBlLiRuZXh0VGljayA9IGZ1bmN0aW9uIChmbikgewogICAgICBuZXh0VGljayhmbiwgdGhpcyk7CiAgICB9OwogICAgLyoqCiAgICAgKiBBcHBlbmQgaW5zdGFuY2UgdG8gdGFyZ2V0CiAgICAgKgogICAgICogQHBhcmFtIHtOb2RlfSB0YXJnZXQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYl0KICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3dpdGhUcmFuc2l0aW9uXSAtIGRlZmF1bHRzIHRvIHRydWUKICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLiRhcHBlbmRUbyA9IGZ1bmN0aW9uICh0YXJnZXQsIGNiLCB3aXRoVHJhbnNpdGlvbikgewogICAgICByZXR1cm4gaW5zZXJ0KHRoaXMsIHRhcmdldCwgY2IsIHdpdGhUcmFuc2l0aW9uLCBhcHBlbmQsIGFwcGVuZFdpdGhUcmFuc2l0aW9uKTsKICAgIH07CiAgICAvKioKICAgICAqIFByZXBlbmQgaW5zdGFuY2UgdG8gdGFyZ2V0CiAgICAgKgogICAgICogQHBhcmFtIHtOb2RlfSB0YXJnZXQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYl0KICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3dpdGhUcmFuc2l0aW9uXSAtIGRlZmF1bHRzIHRvIHRydWUKICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLiRwcmVwZW5kVG8gPSBmdW5jdGlvbiAodGFyZ2V0LCBjYiwgd2l0aFRyYW5zaXRpb24pIHsKICAgICAgdGFyZ2V0ID0gcXVlcnkodGFyZ2V0KTsKCiAgICAgIGlmICh0YXJnZXQuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgICAgdGhpcy4kYmVmb3JlKHRhcmdldC5maXJzdENoaWxkLCBjYiwgd2l0aFRyYW5zaXRpb24pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJGFwcGVuZFRvKHRhcmdldCwgY2IsIHdpdGhUcmFuc2l0aW9uKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLyoqCiAgICAgKiBJbnNlcnQgaW5zdGFuY2UgYmVmb3JlIHRhcmdldAogICAgICoKICAgICAqIEBwYXJhbSB7Tm9kZX0gdGFyZ2V0CiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2JdCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt3aXRoVHJhbnNpdGlvbl0gLSBkZWZhdWx0cyB0byB0cnVlCiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS4kYmVmb3JlID0gZnVuY3Rpb24gKHRhcmdldCwgY2IsIHdpdGhUcmFuc2l0aW9uKSB7CiAgICAgIHJldHVybiBpbnNlcnQodGhpcywgdGFyZ2V0LCBjYiwgd2l0aFRyYW5zaXRpb24sIGJlZm9yZVdpdGhDYiwgYmVmb3JlV2l0aFRyYW5zaXRpb24pOwogICAgfTsKICAgIC8qKgogICAgICogSW5zZXJ0IGluc3RhbmNlIGFmdGVyIHRhcmdldAogICAgICoKICAgICAqIEBwYXJhbSB7Tm9kZX0gdGFyZ2V0CiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2JdCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt3aXRoVHJhbnNpdGlvbl0gLSBkZWZhdWx0cyB0byB0cnVlCiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS4kYWZ0ZXIgPSBmdW5jdGlvbiAodGFyZ2V0LCBjYiwgd2l0aFRyYW5zaXRpb24pIHsKICAgICAgdGFyZ2V0ID0gcXVlcnkodGFyZ2V0KTsKCiAgICAgIGlmICh0YXJnZXQubmV4dFNpYmxpbmcpIHsKICAgICAgICB0aGlzLiRiZWZvcmUodGFyZ2V0Lm5leHRTaWJsaW5nLCBjYiwgd2l0aFRyYW5zaXRpb24pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJGFwcGVuZFRvKHRhcmdldC5wYXJlbnROb2RlLCBjYiwgd2l0aFRyYW5zaXRpb24pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKioKICAgICAqIFJlbW92ZSBpbnN0YW5jZSBmcm9tIERPTQogICAgICoKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYl0KICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3dpdGhUcmFuc2l0aW9uXSAtIGRlZmF1bHRzIHRvIHRydWUKICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLiRyZW1vdmUgPSBmdW5jdGlvbiAoY2IsIHdpdGhUcmFuc2l0aW9uKSB7CiAgICAgIGlmICghdGhpcy4kZWwucGFyZW50Tm9kZSkgewogICAgICAgIHJldHVybiBjYiAmJiBjYigpOwogICAgICB9CgogICAgICB2YXIgaW5Eb2N1bWVudCA9IHRoaXMuX2lzQXR0YWNoZWQgJiYgaW5Eb2ModGhpcy4kZWwpOyAvLyBpZiB3ZSBhcmUgbm90IGluIGRvY3VtZW50LCBubyBuZWVkIHRvIGNoZWNrCiAgICAgIC8vIGZvciB0cmFuc2l0aW9ucwoKICAgICAgaWYgKCFpbkRvY3VtZW50KSB3aXRoVHJhbnNpdGlvbiA9IGZhbHNlOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICB2YXIgcmVhbENiID0gZnVuY3Rpb24gcmVhbENiKCkgewogICAgICAgIGlmIChpbkRvY3VtZW50KSBzZWxmLl9jYWxsSG9vaygnZGV0YWNoZWQnKTsKICAgICAgICBpZiAoY2IpIGNiKCk7CiAgICAgIH07CgogICAgICBpZiAodGhpcy5faXNGcmFnbWVudCkgewogICAgICAgIHJlbW92ZU5vZGVSYW5nZSh0aGlzLl9mcmFnbWVudFN0YXJ0LCB0aGlzLl9mcmFnbWVudEVuZCwgdGhpcywgdGhpcy5fZnJhZ21lbnQsIHJlYWxDYik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIG9wID0gd2l0aFRyYW5zaXRpb24gPT09IGZhbHNlID8gcmVtb3ZlV2l0aENiIDogcmVtb3ZlV2l0aFRyYW5zaXRpb247CiAgICAgICAgb3AodGhpcy4kZWwsIHRoaXMsIHJlYWxDYik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIC8qKgogICAgICogU2hhcmVkIERPTSBpbnNlcnRpb24gZnVuY3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIHtWdWV9IHZtCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IHRhcmdldAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NiXQogICAgICogQHBhcmFtIHtCb29sZWFufSBbd2l0aFRyYW5zaXRpb25dCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcDEgLSBvcCBmb3Igbm9uLXRyYW5zaXRpb24gaW5zZXJ0CiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcDIgLSBvcCBmb3IgdHJhbnNpdGlvbiBpbnNlcnQKICAgICAqIEByZXR1cm4gdm0KICAgICAqLwoKCiAgICBmdW5jdGlvbiBpbnNlcnQodm0sIHRhcmdldCwgY2IsIHdpdGhUcmFuc2l0aW9uLCBvcDEsIG9wMikgewogICAgICB0YXJnZXQgPSBxdWVyeSh0YXJnZXQpOwogICAgICB2YXIgdGFyZ2V0SXNEZXRhY2hlZCA9ICFpbkRvYyh0YXJnZXQpOwogICAgICB2YXIgb3AgPSB3aXRoVHJhbnNpdGlvbiA9PT0gZmFsc2UgfHwgdGFyZ2V0SXNEZXRhY2hlZCA/IG9wMSA6IG9wMjsKICAgICAgdmFyIHNob3VsZENhbGxIb29rID0gIXRhcmdldElzRGV0YWNoZWQgJiYgIXZtLl9pc0F0dGFjaGVkICYmICFpbkRvYyh2bS4kZWwpOwoKICAgICAgaWYgKHZtLl9pc0ZyYWdtZW50KSB7CiAgICAgICAgbWFwTm9kZVJhbmdlKHZtLl9mcmFnbWVudFN0YXJ0LCB2bS5fZnJhZ21lbnRFbmQsIGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICBvcChub2RlLCB0YXJnZXQsIHZtKTsKICAgICAgICB9KTsKICAgICAgICBjYiAmJiBjYigpOwogICAgICB9IGVsc2UgewogICAgICAgIG9wKHZtLiRlbCwgdGFyZ2V0LCB2bSwgY2IpOwogICAgICB9CgogICAgICBpZiAoc2hvdWxkQ2FsbEhvb2spIHsKICAgICAgICB2bS5fY2FsbEhvb2soJ2F0dGFjaGVkJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB2bTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgZm9yIHNlbGVjdG9ycwogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfEVsZW1lbnR9IGVsCiAgICAgKi8KCgogICAgZnVuY3Rpb24gcXVlcnkoZWwpIHsKICAgICAgcmV0dXJuIHR5cGVvZiBlbCA9PT0gJ3N0cmluZycgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsKSA6IGVsOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBlbmQgb3BlcmF0aW9uIHRoYXQgdGFrZXMgYSBjYWxsYmFjay4KICAgICAqCiAgICAgKiBAcGFyYW0ge05vZGV9IGVsCiAgICAgKiBAcGFyYW0ge05vZGV9IHRhcmdldAogICAgICogQHBhcmFtIHtWdWV9IHZtIC0gdW51c2VkCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2JdCiAgICAgKi8KCgogICAgZnVuY3Rpb24gYXBwZW5kKGVsLCB0YXJnZXQsIHZtLCBjYikgewogICAgICB0YXJnZXQuYXBwZW5kQ2hpbGQoZWwpOwogICAgICBpZiAoY2IpIGNiKCk7CiAgICB9CiAgICAvKioKICAgICAqIEluc2VydEJlZm9yZSBvcGVyYXRpb24gdGhhdCB0YWtlcyBhIGNhbGxiYWNrLgogICAgICoKICAgICAqIEBwYXJhbSB7Tm9kZX0gZWwKICAgICAqIEBwYXJhbSB7Tm9kZX0gdGFyZ2V0CiAgICAgKiBAcGFyYW0ge1Z1ZX0gdm0gLSB1bnVzZWQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYl0KICAgICAqLwoKCiAgICBmdW5jdGlvbiBiZWZvcmVXaXRoQ2IoZWwsIHRhcmdldCwgdm0sIGNiKSB7CiAgICAgIGJlZm9yZShlbCwgdGFyZ2V0KTsKICAgICAgaWYgKGNiKSBjYigpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgb3BlcmF0aW9uIHRoYXQgdGFrZXMgYSBjYWxsYmFjay4KICAgICAqCiAgICAgKiBAcGFyYW0ge05vZGV9IGVsCiAgICAgKiBAcGFyYW0ge1Z1ZX0gdm0gLSB1bnVzZWQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYl0KICAgICAqLwoKCiAgICBmdW5jdGlvbiByZW1vdmVXaXRoQ2IoZWwsIHZtLCBjYikgewogICAgICByZW1vdmUoZWwpOwogICAgICBpZiAoY2IpIGNiKCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBldmVudHNBUEkoVnVlKSB7CiAgICAvKioKICAgICAqIExpc3RlbiBvbiB0aGUgZ2l2ZW4gYGV2ZW50YCB3aXRoIGBmbmAuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAgICovCiAgICBWdWUucHJvdG90eXBlLiRvbiA9IGZ1bmN0aW9uIChldmVudCwgZm4pIHsKICAgICAgKHRoaXMuX2V2ZW50c1tldmVudF0gfHwgKHRoaXMuX2V2ZW50c1tldmVudF0gPSBbXSkpLnB1c2goZm4pOwogICAgICBtb2RpZnlMaXN0ZW5lckNvdW50KHRoaXMsIGV2ZW50LCAxKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLyoqCiAgICAgKiBBZGRzIGFuIGBldmVudGAgbGlzdGVuZXIgdGhhdCB3aWxsIGJlIGludm9rZWQgYSBzaW5nbGUKICAgICAqIHRpbWUgdGhlbiBhdXRvbWF0aWNhbGx5IHJlbW92ZWQuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuJG9uY2UgPSBmdW5jdGlvbiAoZXZlbnQsIGZuKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIGZ1bmN0aW9uIG9uKCkgewogICAgICAgIHNlbGYuJG9mZihldmVudCwgb24pOwogICAgICAgIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIG9uLmZuID0gZm47CiAgICAgIHRoaXMuJG9uKGV2ZW50LCBvbik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBjYWxsYmFjayBmb3IgYGV2ZW50YCBvciBhbGwKICAgICAqIHJlZ2lzdGVyZWQgY2FsbGJhY2tzLgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICAgICAqLwoKCiAgICBWdWUucHJvdG90eXBlLiRvZmYgPSBmdW5jdGlvbiAoZXZlbnQsIGZuKSB7CiAgICAgIHZhciBjYnM7IC8vIGFsbAoKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgaWYgKHRoaXMuJHBhcmVudCkgewogICAgICAgICAgZm9yIChldmVudCBpbiB0aGlzLl9ldmVudHMpIHsKICAgICAgICAgICAgY2JzID0gdGhpcy5fZXZlbnRzW2V2ZW50XTsKCiAgICAgICAgICAgIGlmIChjYnMpIHsKICAgICAgICAgICAgICBtb2RpZnlMaXN0ZW5lckNvdW50KHRoaXMsIGV2ZW50LCAtY2JzLmxlbmd0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuX2V2ZW50cyA9IHt9OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9IC8vIHNwZWNpZmljIGV2ZW50CgoKICAgICAgY2JzID0gdGhpcy5fZXZlbnRzW2V2ZW50XTsKCiAgICAgIGlmICghY2JzKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgbW9kaWZ5TGlzdGVuZXJDb3VudCh0aGlzLCBldmVudCwgLWNicy5sZW5ndGgpOwogICAgICAgIHRoaXMuX2V2ZW50c1tldmVudF0gPSBudWxsOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9IC8vIHNwZWNpZmljIGhhbmRsZXIKCgogICAgICB2YXIgY2I7CiAgICAgIHZhciBpID0gY2JzLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICBjYiA9IGNic1tpXTsKCiAgICAgICAgaWYgKGNiID09PSBmbiB8fCBjYi5mbiA9PT0gZm4pIHsKICAgICAgICAgIG1vZGlmeUxpc3RlbmVyQ291bnQodGhpcywgZXZlbnQsIC0xKTsKICAgICAgICAgIGNicy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIC8qKgogICAgICogVHJpZ2dlciBhbiBldmVudCBvbiBzZWxmLgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfE9iamVjdH0gZXZlbnQKICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHNob3VsZFByb3BhZ2F0ZQogICAgICovCgoKICAgIFZ1ZS5wcm90b3R5cGUuJGVtaXQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgdmFyIGlzU291cmNlID0gdHlwZW9mIGV2ZW50ID09PSAnc3RyaW5nJzsKICAgICAgZXZlbnQgPSBpc1NvdXJjZSA/IGV2ZW50IDogZXZlbnQubmFtZTsKICAgICAgdmFyIGNicyA9IHRoaXMuX2V2ZW50c1tldmVudF07CiAgICAgIHZhciBzaG91bGRQcm9wYWdhdGUgPSBpc1NvdXJjZSB8fCAhY2JzOwoKICAgICAgaWYgKGNicykgewogICAgICAgIGNicyA9IGNicy5sZW5ndGggPiAxID8gdG9BcnJheShjYnMpIDogY2JzOyAvLyB0aGlzIGlzIGEgc29tZXdoYXQgaGFja3kgc29sdXRpb24gdG8gdGhlIHF1ZXN0aW9uIHJhaXNlZAogICAgICAgIC8vIGluICMyMTAyOiBmb3IgYW4gaW5saW5lIGNvbXBvbmVudCBsaXN0ZW5lciBsaWtlIDxjb21wIEB0ZXN0PSJkb1RoaXMiPiwKICAgICAgICAvLyB0aGUgcHJvcGFnYXRpb24gaGFuZGxpbmcgaXMgc29tZXdoYXQgYnJva2VuLiBUaGVyZWZvcmUgd2UKICAgICAgICAvLyBuZWVkIHRvIHRyZWF0IHRoZXNlIGlubGluZSBjYWxsYmFja3MgZGlmZmVyZW50bHkuCgogICAgICAgIHZhciBoYXNQYXJlbnRDYnMgPSBpc1NvdXJjZSAmJiBjYnMuc29tZShmdW5jdGlvbiAoY2IpIHsKICAgICAgICAgIHJldHVybiBjYi5fZnJvbVBhcmVudDsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGhhc1BhcmVudENicykgewogICAgICAgICAgc2hvdWxkUHJvcGFnYXRlID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzLCAxKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjYnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICB2YXIgY2IgPSBjYnNbaV07CiAgICAgICAgICB2YXIgcmVzID0gY2IuYXBwbHkodGhpcywgYXJncyk7CgogICAgICAgICAgaWYgKHJlcyA9PT0gdHJ1ZSAmJiAoIWhhc1BhcmVudENicyB8fCBjYi5fZnJvbVBhcmVudCkpIHsKICAgICAgICAgICAgc2hvdWxkUHJvcGFnYXRlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzaG91bGRQcm9wYWdhdGU7CiAgICB9OwogICAgLyoqCiAgICAgKiBSZWN1cnNpdmVseSBicm9hZGNhc3QgYW4gZXZlbnQgdG8gYWxsIGNoaWxkcmVuIGluc3RhbmNlcy4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ3xPYmplY3R9IGV2ZW50CiAgICAgKiBAcGFyYW0gey4uLip9IGFkZGl0aW9uYWwgYXJndW1lbnRzCiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS4kYnJvYWRjYXN0ID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIHZhciBpc1NvdXJjZSA9IHR5cGVvZiBldmVudCA9PT0gJ3N0cmluZyc7CiAgICAgIGV2ZW50ID0gaXNTb3VyY2UgPyBldmVudCA6IGV2ZW50Lm5hbWU7IC8vIGlmIG5vIGNoaWxkIGhhcyByZWdpc3RlcmVkIGZvciB0aGlzIGV2ZW50LAogICAgICAvLyB0aGVuIHRoZXJlJ3Mgbm8gbmVlZCB0byBicm9hZGNhc3QuCgogICAgICBpZiAoIXRoaXMuX2V2ZW50c0NvdW50W2V2ZW50XSkgcmV0dXJuOwogICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLiRjaGlsZHJlbjsKICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7CgogICAgICBpZiAoaXNTb3VyY2UpIHsKICAgICAgICAvLyB1c2Ugb2JqZWN0IGV2ZW50IHRvIGluZGljYXRlIG5vbi1zb3VyY2UgZW1pdAogICAgICAgIC8vIG9uIGNoaWxkcmVuCiAgICAgICAgYXJnc1swXSA9IHsKICAgICAgICAgIG5hbWU6IGV2ZW50LAogICAgICAgICAgc291cmNlOiB0aGlzCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTsKICAgICAgICB2YXIgc2hvdWxkUHJvcGFnYXRlID0gY2hpbGQuJGVtaXQuYXBwbHkoY2hpbGQsIGFyZ3MpOwoKICAgICAgICBpZiAoc2hvdWxkUHJvcGFnYXRlKSB7CiAgICAgICAgICBjaGlsZC4kYnJvYWRjYXN0LmFwcGx5KGNoaWxkLCBhcmdzKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIC8qKgogICAgICogUmVjdXJzaXZlbHkgcHJvcGFnYXRlIGFuIGV2ZW50IHVwIHRoZSBwYXJlbnQgY2hhaW4uCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICAgKiBAcGFyYW0gey4uLip9IGFkZGl0aW9uYWwgYXJndW1lbnRzCiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS4kZGlzcGF0Y2ggPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgdmFyIHNob3VsZFByb3BhZ2F0ZSA9IHRoaXMuJGVtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaWYgKCFzaG91bGRQcm9wYWdhdGUpIHJldHVybjsKICAgICAgdmFyIHBhcmVudCA9IHRoaXMuJHBhcmVudDsKICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7IC8vIHVzZSBvYmplY3QgZXZlbnQgdG8gaW5kaWNhdGUgbm9uLXNvdXJjZSBlbWl0CiAgICAgIC8vIG9uIHBhcmVudHMKCiAgICAgIGFyZ3NbMF0gPSB7CiAgICAgICAgbmFtZTogZXZlbnQsCiAgICAgICAgc291cmNlOiB0aGlzCiAgICAgIH07CgogICAgICB3aGlsZSAocGFyZW50KSB7CiAgICAgICAgc2hvdWxkUHJvcGFnYXRlID0gcGFyZW50LiRlbWl0LmFwcGx5KHBhcmVudCwgYXJncyk7CiAgICAgICAgcGFyZW50ID0gc2hvdWxkUHJvcGFnYXRlID8gcGFyZW50LiRwYXJlbnQgOiBudWxsOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKioKICAgICAqIE1vZGlmeSB0aGUgbGlzdGVuZXIgY291bnRzIG9uIGFsbCBwYXJlbnRzLgogICAgICogVGhpcyBib29ra2VlcGluZyBhbGxvd3MgJGJyb2FkY2FzdCB0byByZXR1cm4gZWFybHkgd2hlbgogICAgICogbm8gY2hpbGQgaGFzIGxpc3RlbmVkIHRvIGEgY2VydGFpbiBldmVudC4KICAgICAqCiAgICAgKiBAcGFyYW0ge1Z1ZX0gdm0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudAogICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvdW50CiAgICAgKi8KCgogICAgdmFyIGhvb2tSRSA9IC9eaG9vazovOwoKICAgIGZ1bmN0aW9uIG1vZGlmeUxpc3RlbmVyQ291bnQodm0sIGV2ZW50LCBjb3VudCkgewogICAgICB2YXIgcGFyZW50ID0gdm0uJHBhcmVudDsgLy8gaG9va3MgZG8gbm90IGdldCBicm9hZGNhc3RlZCBzbyBubyBuZWVkCiAgICAgIC8vIHRvIGRvIGJvb2trZWVwaW5nIGZvciB0aGVtCgogICAgICBpZiAoIXBhcmVudCB8fCAhY291bnQgfHwgaG9va1JFLnRlc3QoZXZlbnQpKSByZXR1cm47CgogICAgICB3aGlsZSAocGFyZW50KSB7CiAgICAgICAgcGFyZW50Ll9ldmVudHNDb3VudFtldmVudF0gPSAocGFyZW50Ll9ldmVudHNDb3VudFtldmVudF0gfHwgMCkgKyBjb3VudDsKICAgICAgICBwYXJlbnQgPSBwYXJlbnQuJHBhcmVudDsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gbGlmZWN5Y2xlQVBJKFZ1ZSkgewogICAgLyoqCiAgICAgKiBTZXQgaW5zdGFuY2UgdGFyZ2V0IGVsZW1lbnQgYW5kIGtpY2sgb2ZmIHRoZSBjb21waWxhdGlvbgogICAgICogcHJvY2Vzcy4gVGhlIHBhc3NlZCBpbiBgZWxgIGNhbiBiZSBhIHNlbGVjdG9yIHN0cmluZywgYW4KICAgICAqIGV4aXN0aW5nIEVsZW1lbnQsIG9yIGEgRG9jdW1lbnRGcmFnbWVudCAoZm9yIGJsb2NrCiAgICAgKiBpbnN0YW5jZXMpLgogICAgICoKICAgICAqIEBwYXJhbSB7RWxlbWVudHxEb2N1bWVudEZyYWdtZW50fHN0cmluZ30gZWwKICAgICAqIEBwdWJsaWMKICAgICAqLwogICAgVnVlLnByb3RvdHlwZS4kbW91bnQgPSBmdW5jdGlvbiAoZWwpIHsKICAgICAgaWYgKHRoaXMuX2lzQ29tcGlsZWQpIHsKICAgICAgICAnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgd2FybignJG1vdW50KCkgc2hvdWxkIGJlIGNhbGxlZCBvbmx5IG9uY2UuJywgdGhpcyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBlbCA9IHF1ZXJ5KGVsKTsKCiAgICAgIGlmICghZWwpIHsKICAgICAgICBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICB9CgogICAgICB0aGlzLl9jb21waWxlKGVsKTsKCiAgICAgIHRoaXMuX2luaXRET01Ib29rcygpOwoKICAgICAgaWYgKGluRG9jKHRoaXMuJGVsKSkgewogICAgICAgIHRoaXMuX2NhbGxIb29rKCdhdHRhY2hlZCcpOwoKICAgICAgICByZWFkeS5jYWxsKHRoaXMpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJG9uY2UoJ2hvb2s6YXR0YWNoZWQnLCByZWFkeSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIC8qKgogICAgICogTWFyayBhbiBpbnN0YW5jZSBhcyByZWFkeS4KICAgICAqLwoKCiAgICBmdW5jdGlvbiByZWFkeSgpIHsKICAgICAgdGhpcy5faXNBdHRhY2hlZCA9IHRydWU7CiAgICAgIHRoaXMuX2lzUmVhZHkgPSB0cnVlOwoKICAgICAgdGhpcy5fY2FsbEhvb2soJ3JlYWR5Jyk7CiAgICB9CiAgICAvKioKICAgICAqIFRlYXJkb3duIHRoZSBpbnN0YW5jZSwgc2ltcGx5IGRlbGVnYXRlIHRvIHRoZSBpbnRlcm5hbAogICAgICogX2Rlc3Ryb3kuCiAgICAgKgogICAgICogQHBhcmFtIHtCb29sZWFufSByZW1vdmUKICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gZGVmZXJDbGVhbnVwCiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS4kZGVzdHJveSA9IGZ1bmN0aW9uIChyZW1vdmUsIGRlZmVyQ2xlYW51cCkgewogICAgICB0aGlzLl9kZXN0cm95KHJlbW92ZSwgZGVmZXJDbGVhbnVwKTsKICAgIH07CiAgICAvKioKICAgICAqIFBhcnRpYWxseSBjb21waWxlIGEgcGllY2Ugb2YgRE9NIGFuZCByZXR1cm4gYQogICAgICogZGVjb21waWxlIGZ1bmN0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSB7RWxlbWVudHxEb2N1bWVudEZyYWdtZW50fSBlbAogICAgICogQHBhcmFtIHtWdWV9IFtob3N0XQogICAgICogQHBhcmFtIHtPYmplY3R9IFtzY29wZV0KICAgICAqIEBwYXJhbSB7RnJhZ21lbnR9IFtmcmFnXQogICAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICAgKi8KCgogICAgVnVlLnByb3RvdHlwZS4kY29tcGlsZSA9IGZ1bmN0aW9uIChlbCwgaG9zdCwgc2NvcGUsIGZyYWcpIHsKICAgICAgcmV0dXJuIGNvbXBpbGUoZWwsIHRoaXMuJG9wdGlvbnMsIHRydWUpKHRoaXMsIGVsLCBob3N0LCBzY29wZSwgZnJhZyk7CiAgICB9OwogIH0KICAvKioKICAgKiBUaGUgZXhwb3NlZCBWdWUgY29uc3RydWN0b3IuCiAgICoKICAgKiBBUEkgY29udmVudGlvbnM6CiAgICogLSBwdWJsaWMgQVBJIG1ldGhvZHMvcHJvcGVydGllcyBhcmUgcHJlZml4ZWQgd2l0aCBgJGAKICAgKiAtIGludGVybmFsIG1ldGhvZHMvcHJvcGVydGllcyBhcmUgcHJlZml4ZWQgd2l0aCBgX2AKICAgKiAtIG5vbi1wcmVmaXhlZCBwcm9wZXJ0aWVzIGFyZSBhc3N1bWVkIHRvIGJlIHByb3hpZWQgdXNlcgogICAqICAgZGF0YS4KICAgKgogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10KICAgKiBAcHVibGljCiAgICovCgoKICBmdW5jdGlvbiBWdWUob3B0aW9ucykgewogICAgdGhpcy5faW5pdChvcHRpb25zKTsKICB9IC8vIGluc3RhbGwgaW50ZXJuYWxzCgoKICBpbml0TWl4aW4oVnVlKTsKICBzdGF0ZU1peGluKFZ1ZSk7CiAgZXZlbnRzTWl4aW4oVnVlKTsKICBsaWZlY3ljbGVNaXhpbihWdWUpOwogIG1pc2NNaXhpbihWdWUpOyAvLyBpbnN0YWxsIGluc3RhbmNlIEFQSXMKCiAgZGF0YUFQSShWdWUpOwogIGRvbUFQSShWdWUpOwogIGV2ZW50c0FQSShWdWUpOwogIGxpZmVjeWNsZUFQSShWdWUpOwogIHZhciBzbG90ID0gewogICAgcHJpb3JpdHk6IFNMT1QsCiAgICBwYXJhbXM6IFsnbmFtZSddLAogICAgYmluZDogZnVuY3Rpb24gYmluZCgpIHsKICAgICAgLy8gdGhpcyB3YXMgcmVzb2x2ZWQgZHVyaW5nIGNvbXBvbmVudCB0cmFuc2NsdXNpb24KICAgICAgdmFyIG5hbWUgPSB0aGlzLnBhcmFtcy5uYW1lIHx8ICdkZWZhdWx0JzsKICAgICAgdmFyIGNvbnRlbnQgPSB0aGlzLnZtLl9zbG90Q29udGVudHMgJiYgdGhpcy52bS5fc2xvdENvbnRlbnRzW25hbWVdOwoKICAgICAgaWYgKCFjb250ZW50IHx8ICFjb250ZW50Lmhhc0NoaWxkTm9kZXMoKSkgewogICAgICAgIHRoaXMuZmFsbGJhY2soKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbXBpbGUoY29udGVudC5jbG9uZU5vZGUodHJ1ZSksIHRoaXMudm0uX2NvbnRleHQsIHRoaXMudm0pOwogICAgICB9CiAgICB9LAogICAgY29tcGlsZTogZnVuY3Rpb24gY29tcGlsZShjb250ZW50LCBjb250ZXh0LCBob3N0KSB7CiAgICAgIGlmIChjb250ZW50ICYmIGNvbnRleHQpIHsKICAgICAgICBpZiAodGhpcy5lbC5oYXNDaGlsZE5vZGVzKCkgJiYgY29udGVudC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMSAmJiBjb250ZW50LmNoaWxkTm9kZXNbMF0ubm9kZVR5cGUgPT09IDEgJiYgY29udGVudC5jaGlsZE5vZGVzWzBdLmhhc0F0dHJpYnV0ZSgndi1pZicpKSB7CiAgICAgICAgICAvLyBpZiB0aGUgaW5zZXJ0ZWQgc2xvdCBoYXMgdi1pZgogICAgICAgICAgLy8gaW5qZWN0IGZhbGxiYWNrIGNvbnRlbnQgYXMgdGhlIHYtZWxzZQogICAgICAgICAgdmFyIGVsc2VCbG9jayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RlbXBsYXRlJyk7CiAgICAgICAgICBlbHNlQmxvY2suc2V0QXR0cmlidXRlKCd2LWVsc2UnLCAnJyk7CiAgICAgICAgICBlbHNlQmxvY2suaW5uZXJIVE1MID0gdGhpcy5lbC5pbm5lckhUTUw7IC8vIHRoZSBlbHNlIGJsb2NrIHNob3VsZCBiZSBjb21waWxlZCBpbiBjaGlsZCBzY29wZQoKICAgICAgICAgIGVsc2VCbG9jay5fY29udGV4dCA9IHRoaXMudm07CiAgICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKGVsc2VCbG9jayk7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2NvcGUgPSBob3N0ID8gaG9zdC5fc2NvcGUgOiB0aGlzLl9zY29wZTsKICAgICAgICB0aGlzLnVubGluayA9IGNvbnRleHQuJGNvbXBpbGUoY29udGVudCwgaG9zdCwgc2NvcGUsIHRoaXMuX2ZyYWcpOwogICAgICB9CgogICAgICBpZiAoY29udGVudCkgewogICAgICAgIHJlcGxhY2UodGhpcy5lbCwgY29udGVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVtb3ZlKHRoaXMuZWwpOwogICAgICB9CiAgICB9LAogICAgZmFsbGJhY2s6IGZ1bmN0aW9uIGZhbGxiYWNrKCkgewogICAgICB0aGlzLmNvbXBpbGUoZXh0cmFjdENvbnRlbnQodGhpcy5lbCwgdHJ1ZSksIHRoaXMudm0pOwogICAgfSwKICAgIHVuYmluZDogZnVuY3Rpb24gdW5iaW5kKCkgewogICAgICBpZiAodGhpcy51bmxpbmspIHsKICAgICAgICB0aGlzLnVubGluaygpOwogICAgICB9CiAgICB9CiAgfTsKICB2YXIgcGFydGlhbCA9IHsKICAgIHByaW9yaXR5OiBQQVJUSUFMLAogICAgcGFyYW1zOiBbJ25hbWUnXSwKICAgIC8vIHdhdGNoIGNoYW5nZXMgdG8gbmFtZSBmb3IgZHluYW1pYyBwYXJ0aWFscwogICAgcGFyYW1XYXRjaGVyczogewogICAgICBuYW1lOiBmdW5jdGlvbiBuYW1lKHZhbHVlKSB7CiAgICAgICAgdklmLnJlbW92ZS5jYWxsKHRoaXMpOwoKICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgIHRoaXMuaW5zZXJ0KHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKCkgewogICAgICB0aGlzLmFuY2hvciA9IGNyZWF0ZUFuY2hvcigndi1wYXJ0aWFsJyk7CiAgICAgIHJlcGxhY2UodGhpcy5lbCwgdGhpcy5hbmNob3IpOwogICAgICB0aGlzLmluc2VydCh0aGlzLnBhcmFtcy5uYW1lKTsKICAgIH0sCiAgICBpbnNlcnQ6IGZ1bmN0aW9uIGluc2VydChpZCkgewogICAgICB2YXIgcGFydGlhbCA9IHJlc29sdmVBc3NldCh0aGlzLnZtLiRvcHRpb25zLCAncGFydGlhbHMnLCBpZCwgdHJ1ZSk7CgogICAgICBpZiAocGFydGlhbCkgewogICAgICAgIHRoaXMuZmFjdG9yeSA9IG5ldyBGcmFnbWVudEZhY3RvcnkodGhpcy52bSwgcGFydGlhbCk7CiAgICAgICAgdklmLmluc2VydC5jYWxsKHRoaXMpOwogICAgICB9CiAgICB9LAogICAgdW5iaW5kOiBmdW5jdGlvbiB1bmJpbmQoKSB7CiAgICAgIGlmICh0aGlzLmZyYWcpIHsKICAgICAgICB0aGlzLmZyYWcuZGVzdHJveSgpOwogICAgICB9CiAgICB9CiAgfTsKICB2YXIgZWxlbWVudERpcmVjdGl2ZXMgPSB7CiAgICBzbG90OiBzbG90LAogICAgcGFydGlhbDogcGFydGlhbAogIH07CiAgdmFyIGNvbnZlcnRBcnJheSA9IHZGb3IuX3Bvc3RQcm9jZXNzOwogIC8qKgogICAqIExpbWl0IGZpbHRlciBmb3IgYXJyYXlzCiAgICoKICAgKiBAcGFyYW0ge051bWJlcn0gbgogICAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgKERlY2ltYWwgZXhwZWN0ZWQpCiAgICovCgogIGZ1bmN0aW9uIGxpbWl0QnkoYXJyLCBuLCBvZmZzZXQpIHsKICAgIG9mZnNldCA9IG9mZnNldCA/IHBhcnNlSW50KG9mZnNldCwgMTApIDogMDsKICAgIG4gPSB0b051bWJlcihuKTsKICAgIHJldHVybiB0eXBlb2YgbiA9PT0gJ251bWJlcicgPyBhcnIuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBuKSA6IGFycjsKICB9CiAgLyoqCiAgICogRmlsdGVyIGZpbHRlciBmb3IgYXJyYXlzCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gc2VhcmNoCiAgICogQHBhcmFtIHtTdHJpbmd9IFtkZWxpbWl0ZXJdCiAgICogQHBhcmFtIHtTdHJpbmd9IC4uLmRhdGFLZXlzCiAgICovCgoKICBmdW5jdGlvbiBmaWx0ZXJCeShhcnIsIHNlYXJjaCwgZGVsaW1pdGVyKSB7CiAgICBhcnIgPSBjb252ZXJ0QXJyYXkoYXJyKTsKCiAgICBpZiAoc2VhcmNoID09IG51bGwpIHsKICAgICAgcmV0dXJuIGFycjsKICAgIH0KCiAgICBpZiAodHlwZW9mIHNlYXJjaCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICByZXR1cm4gYXJyLmZpbHRlcihzZWFyY2gpOwogICAgfSAvLyBjYXN0IHRvIGxvd2VyY2FzZSBzdHJpbmcKCgogICAgc2VhcmNoID0gKCcnICsgc2VhcmNoKS50b0xvd2VyQ2FzZSgpOyAvLyBhbGxvdyBvcHRpb25hbCBgaW5gIGRlbGltaXRlcgogICAgLy8gYmVjYXVzZSB3aHkgbm90CgogICAgdmFyIG4gPSBkZWxpbWl0ZXIgPT09ICdpbicgPyAzIDogMjsgLy8gZXh0cmFjdCBhbmQgZmxhdHRlbiBrZXlzCgogICAgdmFyIGtleXMgPSBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCB0b0FycmF5KGFyZ3VtZW50cywgbikpOwogICAgdmFyIHJlcyA9IFtdOwogICAgdmFyIGl0ZW0sIGtleSwgdmFsLCBqOwoKICAgIGZvciAodmFyIGkgPSAwLCBsID0gYXJyLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBpdGVtID0gYXJyW2ldOwogICAgICB2YWwgPSBpdGVtICYmIGl0ZW0uJHZhbHVlIHx8IGl0ZW07CiAgICAgIGogPSBrZXlzLmxlbmd0aDsKCiAgICAgIGlmIChqKSB7CiAgICAgICAgd2hpbGUgKGotLSkgewogICAgICAgICAga2V5ID0ga2V5c1tqXTsKCiAgICAgICAgICBpZiAoa2V5ID09PSAnJGtleScgJiYgY29udGFpbnMoaXRlbS4ka2V5LCBzZWFyY2gpIHx8IGNvbnRhaW5zKGdldFBhdGgodmFsLCBrZXkpLCBzZWFyY2gpKSB7CiAgICAgICAgICAgIHJlcy5wdXNoKGl0ZW0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY29udGFpbnMoaXRlbSwgc2VhcmNoKSkgewogICAgICAgIHJlcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlczsKICB9CiAgLyoqCiAgICogRmlsdGVyIGZpbHRlciBmb3IgYXJyYXlzCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheTxTdHJpbmc+fEZ1bmN0aW9ufSAuLi5zb3J0S2V5cwogICAqIEBwYXJhbSB7TnVtYmVyfSBbb3JkZXJdCiAgICovCgoKICBmdW5jdGlvbiBvcmRlckJ5KGFycikgewogICAgdmFyIF9jb21wYXJhdG9yID0gbnVsbDsKICAgIHZhciBzb3J0S2V5cyA9IHVuZGVmaW5lZDsKICAgIGFyciA9IGNvbnZlcnRBcnJheShhcnIpOyAvLyBkZXRlcm1pbmUgb3JkZXIgKGxhc3QgYXJndW1lbnQpCgogICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cywgMSk7CiAgICB2YXIgb3JkZXIgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07CgogICAgaWYgKHR5cGVvZiBvcmRlciA9PT0gJ251bWJlcicpIHsKICAgICAgb3JkZXIgPSBvcmRlciA8IDAgPyAtMSA6IDE7CiAgICAgIGFyZ3MgPSBhcmdzLmxlbmd0aCA+IDEgPyBhcmdzLnNsaWNlKDAsIC0xKSA6IGFyZ3M7CiAgICB9IGVsc2UgewogICAgICBvcmRlciA9IDE7CiAgICB9IC8vIGRldGVybWluZSBzb3J0S2V5cyAmIGNvbXBhcmF0b3IKCgogICAgdmFyIGZpcnN0QXJnID0gYXJnc1swXTsKCiAgICBpZiAoIWZpcnN0QXJnKSB7CiAgICAgIHJldHVybiBhcnI7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBmaXJzdEFyZyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAvLyBjdXN0b20gY29tcGFyYXRvcgogICAgICBfY29tcGFyYXRvciA9IGZ1bmN0aW9uIGNvbXBhcmF0b3IoYSwgYikgewogICAgICAgIHJldHVybiBmaXJzdEFyZyhhLCBiKSAqIG9yZGVyOwogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgLy8gc3RyaW5nIGtleXMuIGZsYXR0ZW4gZmlyc3QKICAgICAgc29ydEtleXMgPSBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCBhcmdzKTsKCiAgICAgIF9jb21wYXJhdG9yID0gZnVuY3Rpb24gY29tcGFyYXRvcihhLCBiLCBpKSB7CiAgICAgICAgaSA9IGkgfHwgMDsKICAgICAgICByZXR1cm4gaSA+PSBzb3J0S2V5cy5sZW5ndGggLSAxID8gYmFzZUNvbXBhcmUoYSwgYiwgaSkgOiBiYXNlQ29tcGFyZShhLCBiLCBpKSB8fCBfY29tcGFyYXRvcihhLCBiLCBpICsgMSk7CiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gYmFzZUNvbXBhcmUoYSwgYiwgc29ydEtleUluZGV4KSB7CiAgICAgIHZhciBzb3J0S2V5ID0gc29ydEtleXNbc29ydEtleUluZGV4XTsKCiAgICAgIGlmIChzb3J0S2V5KSB7CiAgICAgICAgaWYgKHNvcnRLZXkgIT09ICcka2V5JykgewogICAgICAgICAgaWYgKGlzT2JqZWN0KGEpICYmICckdmFsdWUnIGluIGEpIGEgPSBhLiR2YWx1ZTsKICAgICAgICAgIGlmIChpc09iamVjdChiKSAmJiAnJHZhbHVlJyBpbiBiKSBiID0gYi4kdmFsdWU7CiAgICAgICAgfQoKICAgICAgICBhID0gaXNPYmplY3QoYSkgPyBnZXRQYXRoKGEsIHNvcnRLZXkpIDogYTsKICAgICAgICBiID0gaXNPYmplY3QoYikgPyBnZXRQYXRoKGIsIHNvcnRLZXkpIDogYjsKICAgICAgfQoKICAgICAgcmV0dXJuIGEgPT09IGIgPyAwIDogYSA+IGIgPyBvcmRlciA6IC1vcmRlcjsKICAgIH0gLy8gc29ydCBvbiBhIGNvcHkgdG8gYXZvaWQgbXV0YXRpbmcgb3JpZ2luYWwgYXJyYXkKCgogICAgcmV0dXJuIGFyci5zbGljZSgpLnNvcnQoX2NvbXBhcmF0b3IpOwogIH0KICAvKioKICAgKiBTdHJpbmcgY29udGFpbiBoZWxwZXIKICAgKgogICAqIEBwYXJhbSB7Kn0gdmFsCiAgICogQHBhcmFtIHtTdHJpbmd9IHNlYXJjaAogICAqLwoKCiAgZnVuY3Rpb24gY29udGFpbnModmFsLCBzZWFyY2gpIHsKICAgIHZhciBpOwoKICAgIGlmIChpc1BsYWluT2JqZWN0KHZhbCkpIHsKICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh2YWwpOwogICAgICBpID0ga2V5cy5sZW5ndGg7CgogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgaWYgKGNvbnRhaW5zKHZhbFtrZXlzW2ldXSwgc2VhcmNoKSkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKGlzQXJyYXkodmFsKSkgewogICAgICBpID0gdmFsLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICBpZiAoY29udGFpbnModmFsW2ldLCBzZWFyY2gpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodmFsICE9IG51bGwpIHsKICAgICAgcmV0dXJuIHZhbC50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihzZWFyY2gpID4gLTE7CiAgICB9CiAgfQoKICB2YXIgZGlnaXRzUkUgPSAvKFxkezN9KSg/PVxkKS9nOyAvLyBhc3NldCBjb2xsZWN0aW9ucyBtdXN0IGJlIGEgcGxhaW4gb2JqZWN0LgoKICB2YXIgZmlsdGVycyA9IHsKICAgIG9yZGVyQnk6IG9yZGVyQnksCiAgICBmaWx0ZXJCeTogZmlsdGVyQnksCiAgICBsaW1pdEJ5OiBsaW1pdEJ5LAoKICAgIC8qKgogICAgICogU3RyaW5naWZ5IHZhbHVlLgogICAgICoKICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRlbnQKICAgICAqLwogICAganNvbjogewogICAgICByZWFkOiBmdW5jdGlvbiByZWFkKHZhbHVlLCBpbmRlbnQpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHZhbHVlIDogSlNPTi5zdHJpbmdpZnkodmFsdWUsIG51bGwsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gaW5kZW50IDogMik7CiAgICAgIH0sCiAgICAgIHdyaXRlOiBmdW5jdGlvbiB3cml0ZSh2YWx1ZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh2YWx1ZSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqICdhYmMnID0+ICdBYmMnCiAgICAgKi8KICAgIGNhcGl0YWxpemU6IGZ1bmN0aW9uIGNhcGl0YWxpemUodmFsdWUpIHsKICAgICAgaWYgKCF2YWx1ZSAmJiB2YWx1ZSAhPT0gMCkgcmV0dXJuICcnOwogICAgICB2YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCk7CiAgICAgIHJldHVybiB2YWx1ZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHZhbHVlLnNsaWNlKDEpOwogICAgfSwKCiAgICAvKioKICAgICAqICdhYmMnID0+ICdBQkMnCiAgICAgKi8KICAgIHVwcGVyY2FzZTogZnVuY3Rpb24gdXBwZXJjYXNlKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZSB8fCB2YWx1ZSA9PT0gMCA/IHZhbHVlLnRvU3RyaW5nKCkudG9VcHBlckNhc2UoKSA6ICcnOwogICAgfSwKCiAgICAvKioKICAgICAqICdBYkMnID0+ICdhYmMnCiAgICAgKi8KICAgIGxvd2VyY2FzZTogZnVuY3Rpb24gbG93ZXJjYXNlKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZSB8fCB2YWx1ZSA9PT0gMCA/IHZhbHVlLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA6ICcnOwogICAgfSwKCiAgICAvKioKICAgICAqIDEyMzQ1ID0+ICQxMiwzNDUuMDAKICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2lnbgogICAgICogQHBhcmFtIHtOdW1iZXJ9IGRlY2ltYWxzIERlY2ltYWwgcGxhY2VzCiAgICAgKi8KICAgIGN1cnJlbmN5OiBmdW5jdGlvbiBjdXJyZW5jeSh2YWx1ZSwgX2N1cnJlbmN5LCBkZWNpbWFscykgewogICAgICB2YWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpOwogICAgICBpZiAoIWlzRmluaXRlKHZhbHVlKSB8fCAhdmFsdWUgJiYgdmFsdWUgIT09IDApIHJldHVybiAnJzsKICAgICAgX2N1cnJlbmN5ID0gX2N1cnJlbmN5ICE9IG51bGwgPyBfY3VycmVuY3kgOiAnJCc7CiAgICAgIGRlY2ltYWxzID0gZGVjaW1hbHMgIT0gbnVsbCA/IGRlY2ltYWxzIDogMjsKICAgICAgdmFyIHN0cmluZ2lmaWVkID0gTWF0aC5hYnModmFsdWUpLnRvRml4ZWQoZGVjaW1hbHMpOwoKICAgICAgdmFyIF9pbnQgPSBkZWNpbWFscyA/IHN0cmluZ2lmaWVkLnNsaWNlKDAsIC0xIC0gZGVjaW1hbHMpIDogc3RyaW5naWZpZWQ7CgogICAgICB2YXIgaSA9IF9pbnQubGVuZ3RoICUgMzsKICAgICAgdmFyIGhlYWQgPSBpID4gMCA/IF9pbnQuc2xpY2UoMCwgaSkgKyAoX2ludC5sZW5ndGggPiAzID8gJywnIDogJycpIDogJyc7CgogICAgICB2YXIgX2Zsb2F0ID0gZGVjaW1hbHMgPyBzdHJpbmdpZmllZC5zbGljZSgtMSAtIGRlY2ltYWxzKSA6ICcnOwoKICAgICAgdmFyIHNpZ24gPSB2YWx1ZSA8IDAgPyAnLScgOiAnJzsKICAgICAgcmV0dXJuIHNpZ24gKyBfY3VycmVuY3kgKyBoZWFkICsgX2ludC5zbGljZShpKS5yZXBsYWNlKGRpZ2l0c1JFLCAnJDEsJykgKyBfZmxvYXQ7CiAgICB9LAoKICAgIC8qKgogICAgICogJ2l0ZW0nID0+ICdpdGVtcycKICAgICAqCiAgICAgKiBAcGFyYW1zCiAgICAgKiAgYW4gYXJyYXkgb2Ygc3RyaW5ncyBjb3JyZXNwb25kaW5nIHRvCiAgICAgKiAgdGhlIHNpbmdsZSwgZG91YmxlLCB0cmlwbGUgLi4uIGZvcm1zIG9mIHRoZSB3b3JkIHRvCiAgICAgKiAgYmUgcGx1cmFsaXplZC4gV2hlbiB0aGUgbnVtYmVyIHRvIGJlIHBsdXJhbGl6ZWQKICAgICAqICBleGNlZWRzIHRoZSBsZW5ndGggb2YgdGhlIGFyZ3MsIGl0IHdpbGwgdXNlIHRoZSBsYXN0CiAgICAgKiAgZW50cnkgaW4gdGhlIGFycmF5LgogICAgICoKICAgICAqICBlLmcuIFsnc2luZ2xlJywgJ2RvdWJsZScsICd0cmlwbGUnLCAnbXVsdGlwbGUnXQogICAgICovCiAgICBwbHVyYWxpemU6IGZ1bmN0aW9uIHBsdXJhbGl6ZSh2YWx1ZSkgewogICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzLCAxKTsKICAgICAgdmFyIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOwoKICAgICAgaWYgKGxlbmd0aCA+IDEpIHsKICAgICAgICB2YXIgaW5kZXggPSB2YWx1ZSAlIDEwIC0gMTsKICAgICAgICByZXR1cm4gaW5kZXggaW4gYXJncyA/IGFyZ3NbaW5kZXhdIDogYXJnc1tsZW5ndGggLSAxXTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYXJnc1swXSArICh2YWx1ZSA9PT0gMSA/ICcnIDogJ3MnKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIERlYm91bmNlIGEgaGFuZGxlciBmdW5jdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyCiAgICAgKiBAcGFyYW0ge051bWJlcn0gZGVsYXkgPSAzMDAKICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAgICovCiAgICBkZWJvdW5jZTogZnVuY3Rpb24gZGVib3VuY2UoaGFuZGxlciwgZGVsYXkpIHsKICAgICAgaWYgKCFoYW5kbGVyKSByZXR1cm47CgogICAgICBpZiAoIWRlbGF5KSB7CiAgICAgICAgZGVsYXkgPSAzMDA7CiAgICAgIH0KCiAgICAgIHJldHVybiBfZGVib3VuY2UoaGFuZGxlciwgZGVsYXkpOwogICAgfQogIH07CgogIGZ1bmN0aW9uIGluc3RhbGxHbG9iYWxBUEkoVnVlKSB7CiAgICAvKioKICAgICAqIFZ1ZSBhbmQgZXZlcnkgY29uc3RydWN0b3IgdGhhdCBleHRlbmRzIFZ1ZSBoYXMgYW4KICAgICAqIGFzc29jaWF0ZWQgb3B0aW9ucyBvYmplY3QsIHdoaWNoIGNhbiBiZSBhY2Nlc3NlZCBkdXJpbmcKICAgICAqIGNvbXBpbGF0aW9uIHN0ZXBzIGFzIGB0aGlzLmNvbnN0cnVjdG9yLm9wdGlvbnNgLgogICAgICoKICAgICAqIFRoZXNlIGNhbiBiZSBzZWVuIGFzIHRoZSBkZWZhdWx0IG9wdGlvbnMgb2YgZXZlcnkKICAgICAqIFZ1ZSBpbnN0YW5jZS4KICAgICAqLwogICAgVnVlLm9wdGlvbnMgPSB7CiAgICAgIGRpcmVjdGl2ZXM6IGRpcmVjdGl2ZXMsCiAgICAgIGVsZW1lbnREaXJlY3RpdmVzOiBlbGVtZW50RGlyZWN0aXZlcywKICAgICAgZmlsdGVyczogZmlsdGVycywKICAgICAgdHJhbnNpdGlvbnM6IHt9LAogICAgICBjb21wb25lbnRzOiB7fSwKICAgICAgcGFydGlhbHM6IHt9LAogICAgICByZXBsYWNlOiB0cnVlCiAgICB9OwogICAgLyoqCiAgICAgKiBFeHBvc2UgdXNlZnVsIGludGVybmFscwogICAgICovCgogICAgVnVlLnV0aWwgPSB1dGlsOwogICAgVnVlLmNvbmZpZyA9IGNvbmZpZzsKICAgIFZ1ZS5zZXQgPSBzZXQ7CiAgICBWdWVbJ2RlbGV0ZSddID0gZGVsOwogICAgVnVlLm5leHRUaWNrID0gbmV4dFRpY2s7CiAgICAvKioKICAgICAqIFRoZSBmb2xsb3dpbmcgYXJlIGV4cG9zZWQgZm9yIGFkdmFuY2VkIHVzYWdlIC8gcGx1Z2lucwogICAgICovCgogICAgVnVlLmNvbXBpbGVyID0gY29tcGlsZXI7CiAgICBWdWUuRnJhZ21lbnRGYWN0b3J5ID0gRnJhZ21lbnRGYWN0b3J5OwogICAgVnVlLmludGVybmFsRGlyZWN0aXZlcyA9IGludGVybmFsRGlyZWN0aXZlczsKICAgIFZ1ZS5wYXJzZXJzID0gewogICAgICBwYXRoOiBwYXRoLAogICAgICB0ZXh0OiB0ZXh0LAogICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUsCiAgICAgIGRpcmVjdGl2ZTogZGlyZWN0aXZlLAogICAgICBleHByZXNzaW9uOiBleHByZXNzaW9uCiAgICB9OwogICAgLyoqCiAgICAgKiBFYWNoIGluc3RhbmNlIGNvbnN0cnVjdG9yLCBpbmNsdWRpbmcgVnVlLCBoYXMgYSB1bmlxdWUKICAgICAqIGNpZC4gVGhpcyBlbmFibGVzIHVzIHRvIGNyZWF0ZSB3cmFwcGVkICJjaGlsZAogICAgICogY29uc3RydWN0b3JzIiBmb3IgcHJvdG90eXBhbCBpbmhlcml0YW5jZSBhbmQgY2FjaGUgdGhlbS4KICAgICAqLwoKICAgIFZ1ZS5jaWQgPSAwOwogICAgdmFyIGNpZCA9IDE7CiAgICAvKioKICAgICAqIENsYXNzIGluaGVyaXRhbmNlCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IGV4dGVuZE9wdGlvbnMKICAgICAqLwoKICAgIFZ1ZS5leHRlbmQgPSBmdW5jdGlvbiAoZXh0ZW5kT3B0aW9ucykgewogICAgICBleHRlbmRPcHRpb25zID0gZXh0ZW5kT3B0aW9ucyB8fCB7fTsKICAgICAgdmFyIFN1cGVyID0gdGhpczsKICAgICAgdmFyIGlzRmlyc3RFeHRlbmQgPSBTdXBlci5jaWQgPT09IDA7CgogICAgICBpZiAoaXNGaXJzdEV4dGVuZCAmJiBleHRlbmRPcHRpb25zLl9DdG9yKSB7CiAgICAgICAgcmV0dXJuIGV4dGVuZE9wdGlvbnMuX0N0b3I7CiAgICAgIH0KCiAgICAgIHZhciBuYW1lID0gZXh0ZW5kT3B0aW9ucy5uYW1lIHx8IFN1cGVyLm9wdGlvbnMubmFtZTsKCiAgICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICBpZiAoIS9eW2EtekEtWl1bXHctXSokLy50ZXN0KG5hbWUpKSB7CiAgICAgICAgICB3YXJuKCdJbnZhbGlkIGNvbXBvbmVudCBuYW1lOiAiJyArIG5hbWUgKyAnIi4gQ29tcG9uZW50IG5hbWVzICcgKyAnY2FuIG9ubHkgY29udGFpbiBhbHBoYW51bWVyaWMgY2hhcmFjYXRlcnMgYW5kIHRoZSBoeXBoZW4uJyk7CiAgICAgICAgICBuYW1lID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBTdWIgPSBjcmVhdGVDbGFzcyhuYW1lIHx8ICdWdWVDb21wb25lbnQnKTsKICAgICAgU3ViLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU3VwZXIucHJvdG90eXBlKTsKICAgICAgU3ViLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFN1YjsKICAgICAgU3ViLmNpZCA9IGNpZCsrOwogICAgICBTdWIub3B0aW9ucyA9IG1lcmdlT3B0aW9ucyhTdXBlci5vcHRpb25zLCBleHRlbmRPcHRpb25zKTsKICAgICAgU3ViWydzdXBlciddID0gU3VwZXI7IC8vIGFsbG93IGZ1cnRoZXIgZXh0ZW5zaW9uCgogICAgICBTdWIuZXh0ZW5kID0gU3VwZXIuZXh0ZW5kOyAvLyBjcmVhdGUgYXNzZXQgcmVnaXN0ZXJzLCBzbyBleHRlbmRlZCBjbGFzc2VzCiAgICAgIC8vIGNhbiBoYXZlIHRoZWlyIHByaXZhdGUgYXNzZXRzIHRvby4KCiAgICAgIGNvbmZpZy5fYXNzZXRUeXBlcy5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgU3ViW3R5cGVdID0gU3VwZXJbdHlwZV07CiAgICAgIH0pOyAvLyBlbmFibGUgcmVjdXJzaXZlIHNlbGYtbG9va3VwCgoKICAgICAgaWYgKG5hbWUpIHsKICAgICAgICBTdWIub3B0aW9ucy5jb21wb25lbnRzW25hbWVdID0gU3ViOwogICAgICB9IC8vIGNhY2hlIGNvbnN0cnVjdG9yCgoKICAgICAgaWYgKGlzRmlyc3RFeHRlbmQpIHsKICAgICAgICBleHRlbmRPcHRpb25zLl9DdG9yID0gU3ViOwogICAgICB9CgogICAgICByZXR1cm4gU3ViOwogICAgfTsKICAgIC8qKgogICAgICogQSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYSBzdWItY2xhc3MgY29uc3RydWN0b3Igd2l0aCB0aGUKICAgICAqIGdpdmVuIG5hbWUuIFRoaXMgZ2l2ZXMgdXMgbXVjaCBuaWNlciBvdXRwdXQgd2hlbgogICAgICogbG9nZ2luZyBpbnN0YW5jZXMgaW4gdGhlIGNvbnNvbGUuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAgICovCgoKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsYXNzKG5hbWUpIHsKICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tbmV3LWZ1bmMgKi8KICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbigncmV0dXJuIGZ1bmN0aW9uICcgKyBjbGFzc2lmeShuYW1lKSArICcgKG9wdGlvbnMpIHsgdGhpcy5faW5pdChvcHRpb25zKSB9JykoKTsKICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1uZXctZnVuYyAqLwogICAgfQogICAgLyoqCiAgICAgKiBQbHVnaW4gc3lzdGVtCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IHBsdWdpbgogICAgICovCgoKICAgIFZ1ZS51c2UgPSBmdW5jdGlvbiAocGx1Z2luKSB7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICBpZiAocGx1Z2luLmluc3RhbGxlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBhZGRpdGlvbmFsIHBhcmFtZXRlcnMKCgogICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzLCAxKTsKICAgICAgYXJncy51bnNoaWZ0KHRoaXMpOwoKICAgICAgaWYgKHR5cGVvZiBwbHVnaW4uaW5zdGFsbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHBsdWdpbi5pbnN0YWxsLmFwcGx5KHBsdWdpbiwgYXJncyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGx1Z2luLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICB9CgogICAgICBwbHVnaW4uaW5zdGFsbGVkID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLyoqCiAgICAgKiBBcHBseSBhIGdsb2JhbCBtaXhpbiBieSBtZXJnaW5nIGl0IGludG8gdGhlIGRlZmF1bHQKICAgICAqIG9wdGlvbnMuCiAgICAgKi8KCgogICAgVnVlLm1peGluID0gZnVuY3Rpb24gKG1peGluKSB7CiAgICAgIFZ1ZS5vcHRpb25zID0gbWVyZ2VPcHRpb25zKFZ1ZS5vcHRpb25zLCBtaXhpbik7CiAgICB9OwogICAgLyoqCiAgICAgKiBDcmVhdGUgYXNzZXQgcmVnaXN0cmF0aW9uIG1ldGhvZHMgd2l0aCB0aGUgZm9sbG93aW5nCiAgICAgKiBzaWduYXR1cmU6CiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IGlkCiAgICAgKiBAcGFyYW0geyp9IGRlZmluaXRpb24KICAgICAqLwoKCiAgICBjb25maWcuX2Fzc2V0VHlwZXMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkgewogICAgICBWdWVbdHlwZV0gPSBmdW5jdGlvbiAoaWQsIGRlZmluaXRpb24pIHsKICAgICAgICBpZiAoIWRlZmluaXRpb24pIHsKICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnNbdHlwZSArICdzJ11baWRdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICAgIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdjb21wb25lbnQnICYmIChjb21tb25UYWdSRS50ZXN0KGlkKSB8fCByZXNlcnZlZFRhZ1JFLnRlc3QoaWQpKSkgewogICAgICAgICAgICAgIHdhcm4oJ0RvIG5vdCB1c2UgYnVpbHQtaW4gb3IgcmVzZXJ2ZWQgSFRNTCBlbGVtZW50cyBhcyBjb21wb25lbnQgJyArICdpZDogJyArIGlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0eXBlID09PSAnY29tcG9uZW50JyAmJiBpc1BsYWluT2JqZWN0KGRlZmluaXRpb24pKSB7CiAgICAgICAgICAgIGlmICghZGVmaW5pdGlvbi5uYW1lKSB7CiAgICAgICAgICAgICAgZGVmaW5pdGlvbi5uYW1lID0gaWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRlZmluaXRpb24gPSBWdWUuZXh0ZW5kKGRlZmluaXRpb24pOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMub3B0aW9uc1t0eXBlICsgJ3MnXVtpZF0gPSBkZWZpbml0aW9uOwogICAgICAgICAgcmV0dXJuIGRlZmluaXRpb247CiAgICAgICAgfQogICAgICB9OwogICAgfSk7IC8vIGV4cG9zZSBpbnRlcm5hbCB0cmFuc2l0aW9uIEFQSQoKCiAgICBleHRlbmQoVnVlLnRyYW5zaXRpb24sIHRyYW5zaXRpb24pOwogIH0KCiAgaW5zdGFsbEdsb2JhbEFQSShWdWUpOwogIFZ1ZS52ZXJzaW9uID0gJzEuMC4yNic7IC8vIGRldnRvb2xzIGdsb2JhbCBob29rCgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgaWYgKGNvbmZpZy5kZXZ0b29scykgewogICAgICBpZiAoZGV2dG9vbHMpIHsKICAgICAgICBkZXZ0b29scy5lbWl0KCdpbml0JywgVnVlKTsKICAgICAgfSBlbHNlIGlmICgnZGV2ZWxvcG1lbnQnICE9PSAncHJvZHVjdGlvbicgJiYgaW5Ccm93c2VyICYmIC9DaHJvbWVcL1xkKy8udGVzdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsKICAgICAgICBjb25zb2xlLmxvZygnRG93bmxvYWQgdGhlIFZ1ZSBEZXZ0b29scyBmb3IgYSBiZXR0ZXIgZGV2ZWxvcG1lbnQgZXhwZXJpZW5jZTpcbicgKyAnaHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS1kZXZ0b29scycpOwogICAgICB9CiAgICB9CiAgfSwgMCk7CiAgcmV0dXJuIFZ1ZTsKfSk7"},{"version":3,"sources":["F:/Web_design/item/src/assets/promanage/js/vue.js"],"names":["global","factory","exports","module","define","amd","Vue","set","obj","key","val","hasOwn","_isVue","_data","ob","__ob__","convert","dep","notify","vms","i","length","vm","_proxy","_digest","del","_unproxy","hasOwnProperty","Object","prototype","call","literalValueRE","isLiteral","exp","test","isReserved","str","c","charCodeAt","_toString","value","toString","toNumber","parsed","Number","isNaN","toBoolean","stripQuotes","a","b","slice","camelizeRE","camelize","replace","toUpper","_","toUpperCase","hyphenateRE","hyphenate","toLowerCase","classifyRE","classify","bind","fn","ctx","l","arguments","apply","toArray","list","start","ret","Array","extend","to","from","keys","isObject","OBJECT_STRING","isPlainObject","isArray","def","enumerable","defineProperty","writable","configurable","_debounce","func","wait","timeout","args","context","timestamp","result","later","last","Date","now","setTimeout","indexOf","arr","cancellable","cb","cancelled","cancel","looseEqual","JSON","stringify","hasProto","inBrowser","window","devtools","__VUE_DEVTOOLS_GLOBAL_HOOK__","UA","navigator","userAgent","isIE","isIE9","isAndroid","isIos","iosVersionMatch","match","iosVersion","split","hasMutationObserverBug","indexedDB","transitionProp","undefined","transitionEndEvent","animationProp","animationEndEvent","isWebkitTrans","ontransitionend","onwebkittransitionend","isWebkitAnim","onanimationend","onwebkitanimationend","nextTick","callbacks","pending","timerFunc","nextTickHandler","copies","MutationObserver","counter","observer","textNode","document","createTextNode","observe","characterData","data","setImmediate","push","_Set","Set","create","has","add","clear","Cache","limit","size","head","tail","_keymap","p","put","removed","entry","get","shift","newer","older","returnEntry","cache$1","filterTokenRE","reservedArgRE","dir","prev","lastFilterIndex","inSingle","inDouble","curly","square","paren","pushFilter","trim","filter","tokens","name","map","processFilterArg","filters","arg","dynamic","stripped","parseDirective","s","hit","expression","directive","freeze","regexEscapeRE","cache","tagRE","htmlRE","escapeRegex","compileRegex","open","config","delimiters","close","unsafeOpen","unsafeDelimiters","unsafeClose","RegExp","parseText","text","lastIndex","index","html","first","oneTime","exec","tag","tokensToExp","token","formatToken","join","single","$eval","inlineFilters","filterRE","defineProperties","debug","silent","async","warnExpressionErrors","_delimitersChanged","_assetTypes","_propBindingModes","ONE_WAY","TWO_WAY","ONE_TIME","_maxUpdateCount","warn","formatComponentName","hasConsole","console","msg","error","$options","appendWithTransition","el","target","applyTransition","appendChild","beforeWithTransition","before","removeWithTransition","remove","direction","op","transition","__v_trans","hooks","_isCompiled","$parent","action","query","selector","querySelector","inDoc","node","doc","ownerDocument","documentElement","parent","parentNode","nodeType","contains","getAttr","_attr","getAttribute","removeAttribute","getBindAttr","hasBindAttr","hasAttribute","insertBefore","after","nextSibling","removeChild","prepend","firstChild","replaceChild","on","event","useCapture","addEventListener","off","removeEventListener","getClass","classname","className","baseVal","setClass","cls","namespaceURI","setAttribute","addClass","classList","cur","removeClass","tar","extractContent","asFragment","child","rawContent","isTemplate","isFragment","content","hasChildNodes","trimNode","createDocumentFragment","createElement","isTrimmable","lastChild","tagName","createAnchor","persist","anchor","createComment","__v_anchor","refRE","findRef","hasAttributes","attrs","attributes","mapNodeRange","end","next","removeNodeRange","frag","done","nodes","onRemoved","getOuterHTML","outerHTML","container","cloneNode","innerHTML","commonTagRE","reservedTagRE","isUnknownElement","constructor","HTMLUnknownElement","HTMLElement","checkComponentAttr","options","hasAttrs","resolveAsset","id","is","getIsBinding","expectedTag","_componentNameMap","strats","optionMergeStrategies","mergeData","toVal","fromVal","parentVal","childVal","mergedDataFn","mergedInstanceDataFn","instanceData","defaultData","init","created","ready","attached","detached","beforeCompile","compiled","beforeDestroy","destroyed","activate","concat","mergeAssets","res","guardArrayAssets","forEach","type","watch","events","props","methods","computed","defaultStrat","guardComponents","components","ids","guardProps","assets","asset","mergeOptions","propsData","mixins","mixin","mixinOptions","mergeField","strat","warnMissing","camelizedId","charAt","uid$1","Dep","subs","addSub","sub","removeSub","$remove","depend","addDep","update","arrayProto","arrayMethods","method","original","mutator","inserted","observeArray","$set","splice","item","arrayKeys","getOwnPropertyNames","shouldConvert","withoutConversion","Observer","augment","protoAugment","copyAugment","walk","items","defineReactive","addVm","removeVm","src","__proto__","isExtensible","property","getOwnPropertyDescriptor","getter","setter","childOb","reactiveGetter","e","reactiveSetter","newVal","util","debounce","uid","initMixin","_init","$el","$root","$children","$refs","$els","_watchers","_directives","_uid","_events","_eventsCount","_isFragment","_fragment","_fragmentStart","_fragmentEnd","_isDestroyed","_isReady","_isAttached","_isBeingDestroyed","_vForRemoving","_unlinkFn","_context","_scope","_frag","children","_updateRef","_callHook","_initState","_initEvents","$mount","pathCache","APPEND","PUSH","INC_SUB_PATH_DEPTH","PUSH_SUB_PATH","BEFORE_PATH","IN_PATH","BEFORE_IDENT","IN_IDENT","IN_SUB_PATH","IN_SINGLE_QUOTE","IN_DOUBLE_QUOTE","AFTER_PATH","ERROR","pathStateMachine","getPathCharType","ch","code","formatSubPath","path","trimmed","parse","mode","subPathDepth","newChar","typeMap","actions","maybeUnescapeQuote","nextChar","raw","parsePath","getPath","parseExpression","warnNonExistent","setPath","expressionCache","allowedKeywords","allowedKeywordsRE","improperKeywords","improperKeywordsRE","wsRE","newlineRE","saveRE","restoreRE","pathTestRE","identRE","literalValueRE$1","noop","saved","save","isString","rewrite","restore","compileGetter","body","makeGetterFn","Function","compileSetter","scope","needSet","isSimplePath","queue","userQueue","circular","waiting","resetBatcherState","flushBatcherQueue","_again","_function","runBatcherQueue","emit","watcher","run","pushWatcher","q","user","uid$2","Watcher","expOrFn","isFn","active","dirty","lazy","deps","newDeps","depIds","newDepIds","prevError","twoWay","queued","shallow","beforeGet","deep","traverse","preProcess","_applyFilters","postProcess","afterGet","forContext","$forContext","alias","_withLock","$key","rawValue","$index","tmp","sync","Error","oldValue","evaluate","current","teardown","seenObjects","seen","isA","isO","depId","text$1","attr","templateCache","idSelectorCache","efault","legend","tr","col","td","th","option","optgroup","thead","tbody","colgroup","caption","tfoot","g","defs","symbol","use","image","circle","ellipse","line","polygon","polyline","rect","isRealTemplate","tagRE$1","entityRE","commentRE","stringToFragment","templateString","cacheKey","tagMatch","entityMatch","commentMatch","wrap","depth","prefix","suffix","nodeToFragment","textContent","clonedNode","hasBrokenTemplate","hasTextareaCloneBug","t","placeholder","querySelectorAll","cloned","tempClone","parseTemplate","template","shouldClone","getElementById","swap","childNodes","Fragment","linker","host","parentFrag","childFrags","unlink","singleBefore","singleRemove","multiBefore","multiRemove","__v_frag","callHook","hook","withTransition","attach","shouldCallRemove","self","beforeRemove","detach","destroy","$destroy","dirs","_watcher","linkerCache","FragmentFactory","cid","cacheId","compile","ON","MODEL","BIND","TRANSITION","EL","COMPONENT","PARTIAL","IF","FOR","SLOT","uid$3","vFor","priority","terminal","params","inMatch","itMatch","iterator","descriptor","isOption","diff","updateRef","updateModel","convertedFromObject","fromObject","trackByKey","trackBy","oldFrags","frags","inDocument","primitive","$value","getCachedFrag","reused","fresh","removalIndex","totalRemoved","deleteCachedFrag","w","targetPrev","prevEl","currentPrev","insertionIndex","staggerCb","staggerAnchor","findPrevFrag","move","insert","_host","parentScope","forId","cacheFrag","ref","hash","refs","findVmFromFrag","model","__v_model","forceUpdate","staggerAmount","getStagger","total","getTrackByKey","warnDuplicate","trans","stagger","parseInt","_preProcess","_postProcess","range","unbind","previousSibling","__vue__","n","Math","floor","vIf","nextElementSibling","elseEl","invalid","elseFrag","elseFactory","show","toggle","style","display","text$2","isRange","number","composing","listener","focused","rawListener","_bound","hasjQuery","jQuery","keyCode","afterBind","radio","getValue","_value","checked","select","_this","multiple","initValue","$on","selectedIndex","multi","selected","indexOf$1","$off","checkbox","getBooleanValue","_trueValue","_falseValue","handlers","checkFilters","hasRead","hasWrite","handler","_unbind","read","write","keyCodes","esc","tab","enter","space","up","left","right","down","keyFilter","codes","charCode","keyHandler","stopFilter","stopHandler","stopPropagation","preventFilter","preventHandler","preventDefault","selfFilter","selfHandler","currentTarget","on$1","acceptStatement","iframeBind","contentWindow","modifiers","capture","stop","prevent","reset","prefixes","camelPrefixes","importantRE","propCache","testEl","cssText","handleObject","reduce","handleSingle","prop","normalize","isImportant","setProperty","kebab","camel","upper","prefixed","xlinkNS","xlinkRE","disallowedInterpAttrRE","attrWithPropsRE","enumeratedAttrRE","modelProps","bind$1","interp","hasOneTime","attrValue","modelProp","setAttributeNS","cloak","$once","directives","vClass","cleanup","normalize$1","prevKeys","_key","k","component","keepAlive","inlineTemplate","pendingComponentCb","Component","pendingRemovals","pendingRemovalCb","literal","setComponent","invalidatePending","unbuild","childVM","resolveComponent","mountComponent","ComponentName","_resolveComponent","activateHooks","cached","getCached","newComponent","build","waitingFor","callActivateHooks","extraOptions","_linkerCachable","_ref","_asComponent","_isRouterView","defer","_inactive","_cleanup","transitionMode","$before","called","propBindingModes","empty","identRE$1","settablePathRE","compileProps","propOptions","names","optimizedLiteral","parentPath","lowerCaseName","required","makePropsLinkFn","propsLinkFn","_props","inlineProps","initProp","$get","_bindDir","propDef","Boolean","processPropValue","isSimple","getPropDefaultValue","coerceProp","coerced","assertProp","updateProp","valid","expectedTypes","assertedType","assertType","expectedType","formatType","formatValue","validator","coerce","String","bindingModes","childKey","parentKey","parentWatcher","childWatcher","queue$1","pushJob","job","flush","f","offsetHeight","TYPE_TRANSITION","TYPE_ANIMATION","transDurationProp","animDurationProp","raf","requestAnimationFrame","waitForTransitionStart","Transition","enterClass","leaveClass","pendingCssEvent","pendingCssCb","pendingJsCb","justEntered","entered","typeCache","m","p$1","cancelPending","callHookWithCb","enterCancelled","enterNextTick","enterDone","getCssTransitionType","setupCssCb","leave","leaveCancelled","leaveDone","leaveNextTick","hasPending","hidden","css","isHidden","inlineStyles","computedStyles","getComputedStyle","transDuration","animDuration","onEnd","getBoundingClientRect","width","height","offsetWidth","getClientRects","transition$1","oldId","internalDirectives","bindRE","onRE","dirAttrRE","modifierRE","transitionRE","DEFAULT_PRIORITY","DEFAULT_TERMINAL_PRIORITY","partial","nodeLinkFn","compileNode","childLinkFn","isScript","compileNodeList","compositeLinkFn","linkAndCapture","compositeLinkCapturer","makeUnlinkFn","originalDirCount","sort","directiveComparator","_bind","contextDirs","destroying","teardownDirs","_teardown","compileAndLinkProps","propDirs","compileRoot","contextOptions","containerAttrs","_containerAttrs","replacerAttrs","_replacerAttrs","contextLinkFn","replacerLinkFn","compileDirectives","plural","rootLinkFn","selfDirs","compileElement","compileTextNode","linkFn","checkTerminalDirectives","checkElementDirectives","checkComponent","_skip","removeText","wholeText","processTextToken","makeTextNodeLinkFn","setTokenType","textNodeLinkFn","fragClone","nodeList","linkFns","makeChildLinkFn","childrenLinkFn","makeTerminalNodeLinkFn","componentLinkFn","skip","previousElementSibling","matched","dirName","rawName","termDef","j","parseModifiers","terminalNodeLinkFn","dirDef","pushDir","some","interpTokens","hasOneTimeToken","makeNodeLinkFn","specialCharRE","transclude","extractAttrs","_content","transcludeTemplate","replacer","mergeAttrs","resolveSlots","contents","_slotContents","extractFragment","compiler","stateMixin","newData","_setData","_initProps","_initMeta","_initMethods","_initData","_initComputed","_propsUnlinkFn","dataFn","oldData","proxyGetter","proxySetter","userDef","makeComputedGetter","owner","computedGetter","metas","_meta","eventRE","eventsMixin","registerComponentEvents","registerCallbacks","_fromParent","register","_initDOMHooks","onAttached","onDetached","callAttach","callDetach","$emit","noop$1","Directive","_locked","_listeners","_vue_directives","_setupParams","_checkStatement","_update","oldVal","mappedKey","_setupParamWatcher","unwatch","$watch","paramWatchers","immediate","_paramUnwatchFns","$event","listeners","unwatchFns","lifecycleMixin","_compile","_initElement","rootLinker","contentLinkFn","ctor","rootUnlinkFn","contentUnlinkFn","_destroy","deferCleanup","destroyReady","pendingRemoval","cleanupIfPossible","miscMixin","offset","resolved","requested","pendingCallbacks","cbs","resolve","reject","reason","filterRE$1","dataAPI","asStatement","statementHandler","$arguments","$delete","unwatchFn","$interpolate","$log","clean","log","domAPI","$nextTick","$appendTo","append","$prependTo","beforeWithCb","$after","realCb","removeWithCb","op1","op2","targetIsDetached","shouldCallHook","eventsAPI","modifyListenerCount","isSource","shouldPropagate","hasParentCbs","$broadcast","source","$dispatch","hookRE","count","lifecycleAPI","$compile","slot","fallback","elseBlock","elementDirectives","convertArray","limitBy","filterBy","search","delimiter","orderBy","comparator","sortKeys","order","firstArg","baseCompare","sortKeyIndex","sortKey","digitsRE","json","indent","capitalize","uppercase","lowercase","currency","_currency","decimals","parseFloat","isFinite","stringified","abs","toFixed","_int","_float","sign","pluralize","delay","installGlobalAPI","transitions","partials","parsers","extendOptions","Super","isFirstExtend","_Ctor","Sub","createClass","plugin","installed","unshift","install","definition","version"],"mappings":"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","sourcesContent":["/*!\n * Vue.js v1.0.26\n * (c) 2016 Evan You\n * Released under the MIT License.\n */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (global.Vue = factory());\n}(this, function () { 'use strict';\n\n  function set(obj, key, val) {\n    if (hasOwn(obj, key)) {\n      obj[key] = val;\n      return;\n    }\n    if (obj._isVue) {\n      set(obj._data, key, val);\n      return;\n    }\n    var ob = obj.__ob__;\n    if (!ob) {\n      obj[key] = val;\n      return;\n    }\n    ob.convert(key, val);\n    ob.dep.notify();\n    if (ob.vms) {\n      var i = ob.vms.length;\n      while (i--) {\n        var vm = ob.vms[i];\n        vm._proxy(key);\n        vm._digest();\n      }\n    }\n    return val;\n  }\n\n  /**\n   * Delete a property and trigger change if necessary.\n   *\n   * @param {Object} obj\n   * @param {String} key\n   */\n\n  function del(obj, key) {\n    if (!hasOwn(obj, key)) {\n      return;\n    }\n    delete obj[key];\n    var ob = obj.__ob__;\n    if (!ob) {\n      if (obj._isVue) {\n        delete obj._data[key];\n        obj._digest();\n      }\n      return;\n    }\n    ob.dep.notify();\n    if (ob.vms) {\n      var i = ob.vms.length;\n      while (i--) {\n        var vm = ob.vms[i];\n        vm._unproxy(key);\n        vm._digest();\n      }\n    }\n  }\n\n  var hasOwnProperty = Object.prototype.hasOwnProperty;\n  /**\n   * Check whether the object has the property.\n   *\n   * @param {Object} obj\n   * @param {String} key\n   * @return {Boolean}\n   */\n\n  function hasOwn(obj, key) {\n    return hasOwnProperty.call(obj, key);\n  }\n\n  /**\n   * Check if an expression is a literal value.\n   *\n   * @param {String} exp\n   * @return {Boolean}\n   */\n\n  var literalValueRE = /^\\s?(true|false|-?[\\d\\.]+|'[^']*'|\"[^\"]*\")\\s?$/;\n\n  function isLiteral(exp) {\n    return literalValueRE.test(exp);\n  }\n\n  /**\n   * Check if a string starts with $ or _\n   *\n   * @param {String} str\n   * @return {Boolean}\n   */\n\n  function isReserved(str) {\n    var c = (str + '').charCodeAt(0);\n    return c === 0x24 || c === 0x5F;\n  }\n\n  /**\n   * Guard text output, make sure undefined outputs\n   * empty string\n   *\n   * @param {*} value\n   * @return {String}\n   */\n\n  function _toString(value) {\n    return value == null ? '' : value.toString();\n  }\n\n  /**\n   * Check and convert possible numeric strings to numbers\n   * before setting back to data\n   *\n   * @param {*} value\n   * @return {*|Number}\n   */\n\n  function toNumber(value) {\n    if (typeof value !== 'string') {\n      return value;\n    } else {\n      var parsed = Number(value);\n      return isNaN(parsed) ? value : parsed;\n    }\n  }\n\n  /**\n   * Convert string boolean literals into real booleans.\n   *\n   * @param {*} value\n   * @return {*|Boolean}\n   */\n\n  function toBoolean(value) {\n    return value === 'true' ? true : value === 'false' ? false : value;\n  }\n\n  /**\n   * Strip quotes from a string\n   *\n   * @param {String} str\n   * @return {String | false}\n   */\n\n  function stripQuotes(str) {\n    var a = str.charCodeAt(0);\n    var b = str.charCodeAt(str.length - 1);\n    return a === b && (a === 0x22 || a === 0x27) ? str.slice(1, -1) : str;\n  }\n\n  /**\n   * Camelize a hyphen-delmited string.\n   *\n   * @param {String} str\n   * @return {String}\n   */\n\n  var camelizeRE = /-(\\w)/g;\n\n  function camelize(str) {\n    return str.replace(camelizeRE, toUpper);\n  }\n\n  function toUpper(_, c) {\n    return c ? c.toUpperCase() : '';\n  }\n\n  /**\n   * Hyphenate a camelCase string.\n   *\n   * @param {String} str\n   * @return {String}\n   */\n\n  var hyphenateRE = /([a-z\\d])([A-Z])/g;\n\n  function hyphenate(str) {\n    return str.replace(hyphenateRE, '$1-$2').toLowerCase();\n  }\n\n  /**\n   * Converts hyphen/underscore/slash delimitered names into\n   * camelized classNames.\n   *\n   * e.g. my-component => MyComponent\n   *      some_else    => SomeElse\n   *      some/comp    => SomeComp\n   *\n   * @param {String} str\n   * @return {String}\n   */\n\n  var classifyRE = /(?:^|[-_\\/])(\\w)/g;\n\n  function classify(str) {\n    return str.replace(classifyRE, toUpper);\n  }\n\n  /**\n   * Simple bind, faster than native\n   *\n   * @param {Function} fn\n   * @param {Object} ctx\n   * @return {Function}\n   */\n\n  function bind(fn, ctx) {\n    return function (a) {\n      var l = arguments.length;\n      return l ? l > 1 ? fn.apply(ctx, arguments) : fn.call(ctx, a) : fn.call(ctx);\n    };\n  }\n\n  /**\n   * Convert an Array-like object to a real Array.\n   *\n   * @param {Array-like} list\n   * @param {Number} [start] - start index\n   * @return {Array}\n   */\n\n  function toArray(list, start) {\n    start = start || 0;\n    var i = list.length - start;\n    var ret = new Array(i);\n    while (i--) {\n      ret[i] = list[i + start];\n    }\n    return ret;\n  }\n\n  /**\n   * Mix properties into target object.\n   *\n   * @param {Object} to\n   * @param {Object} from\n   */\n\n  function extend(to, from) {\n    var keys = Object.keys(from);\n    var i = keys.length;\n    while (i--) {\n      to[keys[i]] = from[keys[i]];\n    }\n    return to;\n  }\n\n  /**\n   * Quick object check - this is primarily used to tell\n   * Objects from primitive values when we know the value\n   * is a JSON-compliant type.\n   *\n   * @param {*} obj\n   * @return {Boolean}\n   */\n\n  function isObject(obj) {\n    return obj !== null && typeof obj === 'object';\n  }\n\n  /**\n   * Strict object type check. Only returns true\n   * for plain JavaScript objects.\n   *\n   * @param {*} obj\n   * @return {Boolean}\n   */\n\n  var toString = Object.prototype.toString;\n  var OBJECT_STRING = '[object Object]';\n\n  function isPlainObject(obj) {\n    return toString.call(obj) === OBJECT_STRING;\n  }\n\n  /**\n   * Array type check.\n   *\n   * @param {*} obj\n   * @return {Boolean}\n   */\n\n  var isArray = Array.isArray;\n\n  /**\n   * Define a property.\n   *\n   * @param {Object} obj\n   * @param {String} key\n   * @param {*} val\n   * @param {Boolean} [enumerable]\n   */\n\n  function def(obj, key, val, enumerable) {\n    Object.defineProperty(obj, key, {\n      value: val,\n      enumerable: !!enumerable,\n      writable: true,\n      configurable: true\n    });\n  }\n\n  /**\n   * Debounce a function so it only gets called after the\n   * input stops arriving after the given wait period.\n   *\n   * @param {Function} func\n   * @param {Number} wait\n   * @return {Function} - the debounced function\n   */\n\n  function _debounce(func, wait) {\n    var timeout, args, context, timestamp, result;\n    var later = function later() {\n      var last = Date.now() - timestamp;\n      if (last < wait && last >= 0) {\n        timeout = setTimeout(later, wait - last);\n      } else {\n        timeout = null;\n        result = func.apply(context, args);\n        if (!timeout) context = args = null;\n      }\n    };\n    return function () {\n      context = this;\n      args = arguments;\n      timestamp = Date.now();\n      if (!timeout) {\n        timeout = setTimeout(later, wait);\n      }\n      return result;\n    };\n  }\n\n  /**\n   * Manual indexOf because it's slightly faster than\n   * native.\n   *\n   * @param {Array} arr\n   * @param {*} obj\n   */\n\n  function indexOf(arr, obj) {\n    var i = arr.length;\n    while (i--) {\n      if (arr[i] === obj) return i;\n    }\n    return -1;\n  }\n\n  /**\n   * Make a cancellable version of an async callback.\n   *\n   * @param {Function} fn\n   * @return {Function}\n   */\n\n  function cancellable(fn) {\n    var cb = function cb() {\n      if (!cb.cancelled) {\n        return fn.apply(this, arguments);\n      }\n    };\n    cb.cancel = function () {\n      cb.cancelled = true;\n    };\n    return cb;\n  }\n\n  /**\n   * Check if two values are loosely equal - that is,\n   * if they are plain objects, do they have the same shape?\n   *\n   * @param {*} a\n   * @param {*} b\n   * @return {Boolean}\n   */\n\n  function looseEqual(a, b) {\n    /* eslint-disable eqeqeq */\n    return a == b || (isObject(a) && isObject(b) ? JSON.stringify(a) === JSON.stringify(b) : false);\n    /* eslint-enable eqeqeq */\n  }\n\n  var hasProto = ('__proto__' in {});\n\n  // Browser environment sniffing\n  var inBrowser = typeof window !== 'undefined' && Object.prototype.toString.call(window) !== '[object Object]';\n\n  // detect devtools\n  var devtools = inBrowser && window.__VUE_DEVTOOLS_GLOBAL_HOOK__;\n\n  // UA sniffing for working around browser-specific quirks\n  var UA = inBrowser && window.navigator.userAgent.toLowerCase();\n  var isIE = UA && UA.indexOf('trident') > 0;\n  var isIE9 = UA && UA.indexOf('msie 9.0') > 0;\n  var isAndroid = UA && UA.indexOf('android') > 0;\n  var isIos = UA && /(iphone|ipad|ipod|ios)/i.test(UA);\n  var iosVersionMatch = isIos && UA.match(/os ([\\d_]+)/);\n  var iosVersion = iosVersionMatch && iosVersionMatch[1].split('_');\n\n  // detecting iOS UIWebView by indexedDB\n  var hasMutationObserverBug = iosVersion && Number(iosVersion[0]) >= 9 && Number(iosVersion[1]) >= 3 && !window.indexedDB;\n\n  var transitionProp = undefined;\n  var transitionEndEvent = undefined;\n  var animationProp = undefined;\n  var animationEndEvent = undefined;\n\n  // Transition property/event sniffing\n  if (inBrowser && !isIE9) {\n    var isWebkitTrans = window.ontransitionend === undefined && window.onwebkittransitionend !== undefined;\n    var isWebkitAnim = window.onanimationend === undefined && window.onwebkitanimationend !== undefined;\n    transitionProp = isWebkitTrans ? 'WebkitTransition' : 'transition';\n    transitionEndEvent = isWebkitTrans ? 'webkitTransitionEnd' : 'transitionend';\n    animationProp = isWebkitAnim ? 'WebkitAnimation' : 'animation';\n    animationEndEvent = isWebkitAnim ? 'webkitAnimationEnd' : 'animationend';\n  }\n\n  /**\n   * Defer a task to execute it asynchronously. Ideally this\n   * should be executed as a microtask, so we leverage\n   * MutationObserver if it's available, and fallback to\n   * setTimeout(0).\n   *\n   * @param {Function} cb\n   * @param {Object} ctx\n   */\n\n  var nextTick = (function () {\n    var callbacks = [];\n    var pending = false;\n    var timerFunc;\n    function nextTickHandler() {\n      pending = false;\n      var copies = callbacks.slice(0);\n      callbacks = [];\n      for (var i = 0; i < copies.length; i++) {\n        copies[i]();\n      }\n    }\n\n    /* istanbul ignore if */\n    if (typeof MutationObserver !== 'undefined' && !hasMutationObserverBug) {\n      var counter = 1;\n      var observer = new MutationObserver(nextTickHandler);\n      var textNode = document.createTextNode(counter);\n      observer.observe(textNode, {\n        characterData: true\n      });\n      timerFunc = function () {\n        counter = (counter + 1) % 2;\n        textNode.data = counter;\n      };\n    } else {\n      // webpack attempts to inject a shim for setImmediate\n      // if it is used as a global, so we have to work around that to\n      // avoid bundling unnecessary code.\n      var context = inBrowser ? window : typeof global !== 'undefined' ? global : {};\n      timerFunc = context.setImmediate || setTimeout;\n    }\n    return function (cb, ctx) {\n      var func = ctx ? function () {\n        cb.call(ctx);\n      } : cb;\n      callbacks.push(func);\n      if (pending) return;\n      pending = true;\n      timerFunc(nextTickHandler, 0);\n    };\n  })();\n\n  var _Set = undefined;\n  /* istanbul ignore if */\n  if (typeof Set !== 'undefined' && Set.toString().match(/native code/)) {\n    // use native Set when available.\n    _Set = Set;\n  } else {\n    // a non-standard Set polyfill that only works with primitive keys.\n    _Set = function () {\n      this.set = Object.create(null);\n    };\n    _Set.prototype.has = function (key) {\n      return this.set[key] !== undefined;\n    };\n    _Set.prototype.add = function (key) {\n      this.set[key] = 1;\n    };\n    _Set.prototype.clear = function () {\n      this.set = Object.create(null);\n    };\n  }\n\n  function Cache(limit) {\n    this.size = 0;\n    this.limit = limit;\n    this.head = this.tail = undefined;\n    this._keymap = Object.create(null);\n  }\n\n  var p = Cache.prototype;\n\n  /**\n   * Put <value> into the cache associated with <key>.\n   * Returns the entry which was removed to make room for\n   * the new entry. Otherwise undefined is returned.\n   * (i.e. if there was enough room already).\n   *\n   * @param {String} key\n   * @param {*} value\n   * @return {Entry|undefined}\n   */\n\n  p.put = function (key, value) {\n    var removed;\n\n    var entry = this.get(key, true);\n    if (!entry) {\n      if (this.size === this.limit) {\n        removed = this.shift();\n      }\n      entry = {\n        key: key\n      };\n      this._keymap[key] = entry;\n      if (this.tail) {\n        this.tail.newer = entry;\n        entry.older = this.tail;\n      } else {\n        this.head = entry;\n      }\n      this.tail = entry;\n      this.size++;\n    }\n    entry.value = value;\n\n    return removed;\n  };\n\n  /**\n   * Purge the least recently used (oldest) entry from the\n   * cache. Returns the removed entry or undefined if the\n   * cache was empty.\n   */\n\n  p.shift = function () {\n    var entry = this.head;\n    if (entry) {\n      this.head = this.head.newer;\n      this.head.older = undefined;\n      entry.newer = entry.older = undefined;\n      this._keymap[entry.key] = undefined;\n      this.size--;\n    }\n    return entry;\n  };\n\n  /**\n   * Get and register recent use of <key>. Returns the value\n   * associated with <key> or undefined if not in cache.\n   *\n   * @param {String} key\n   * @param {Boolean} returnEntry\n   * @return {Entry|*}\n   */\n\n  p.get = function (key, returnEntry) {\n    var entry = this._keymap[key];\n    if (entry === undefined) return;\n    if (entry === this.tail) {\n      return returnEntry ? entry : entry.value;\n    }\n    // HEAD--------------TAIL\n    //   <.older   .newer>\n    //  <--- add direction --\n    //   A  B  C  <D>  E\n    if (entry.newer) {\n      if (entry === this.head) {\n        this.head = entry.newer;\n      }\n      entry.newer.older = entry.older; // C <-- E.\n    }\n    if (entry.older) {\n      entry.older.newer = entry.newer; // C. --> E\n    }\n    entry.newer = undefined; // D --x\n    entry.older = this.tail; // D. --> E\n    if (this.tail) {\n      this.tail.newer = entry; // E. <-- D\n    }\n    this.tail = entry;\n    return returnEntry ? entry : entry.value;\n  };\n\n  var cache$1 = new Cache(1000);\n  var filterTokenRE = /[^\\s'\"]+|'[^']*'|\"[^\"]*\"/g;\n  var reservedArgRE = /^in$|^-?\\d+/;\n\n  /**\n   * Parser state\n   */\n\n  var str;\n  var dir;\n  var c;\n  var prev;\n  var i;\n  var l;\n  var lastFilterIndex;\n  var inSingle;\n  var inDouble;\n  var curly;\n  var square;\n  var paren;\n  /**\n   * Push a filter to the current directive object\n   */\n\n  function pushFilter() {\n    var exp = str.slice(lastFilterIndex, i).trim();\n    var filter;\n    if (exp) {\n      filter = {};\n      var tokens = exp.match(filterTokenRE);\n      filter.name = tokens[0];\n      if (tokens.length > 1) {\n        filter.args = tokens.slice(1).map(processFilterArg);\n      }\n    }\n    if (filter) {\n      (dir.filters = dir.filters || []).push(filter);\n    }\n    lastFilterIndex = i + 1;\n  }\n\n  /**\n   * Check if an argument is dynamic and strip quotes.\n   *\n   * @param {String} arg\n   * @return {Object}\n   */\n\n  function processFilterArg(arg) {\n    if (reservedArgRE.test(arg)) {\n      return {\n        value: toNumber(arg),\n        dynamic: false\n      };\n    } else {\n      var stripped = stripQuotes(arg);\n      var dynamic = stripped === arg;\n      return {\n        value: dynamic ? arg : stripped,\n        dynamic: dynamic\n      };\n    }\n  }\n\n  /**\n   * Parse a directive value and extract the expression\n   * and its filters into a descriptor.\n   *\n   * Example:\n   *\n   * \"a + 1 | uppercase\" will yield:\n   * {\n   *   expression: 'a + 1',\n   *   filters: [\n   *     { name: 'uppercase', args: null }\n   *   ]\n   * }\n   *\n   * @param {String} s\n   * @return {Object}\n   */\n\n  function parseDirective(s) {\n    var hit = cache$1.get(s);\n    if (hit) {\n      return hit;\n    }\n\n    // reset parser state\n    str = s;\n    inSingle = inDouble = false;\n    curly = square = paren = 0;\n    lastFilterIndex = 0;\n    dir = {};\n\n    for (i = 0, l = str.length; i < l; i++) {\n      prev = c;\n      c = str.charCodeAt(i);\n      if (inSingle) {\n        // check single quote\n        if (c === 0x27 && prev !== 0x5C) inSingle = !inSingle;\n      } else if (inDouble) {\n        // check double quote\n        if (c === 0x22 && prev !== 0x5C) inDouble = !inDouble;\n      } else if (c === 0x7C && // pipe\n      str.charCodeAt(i + 1) !== 0x7C && str.charCodeAt(i - 1) !== 0x7C) {\n        if (dir.expression == null) {\n          // first filter, end of expression\n          lastFilterIndex = i + 1;\n          dir.expression = str.slice(0, i).trim();\n        } else {\n          // already has filter\n          pushFilter();\n        }\n      } else {\n        switch (c) {\n          case 0x22:\n            inDouble = true;break; // \"\n          case 0x27:\n            inSingle = true;break; // '\n          case 0x28:\n            paren++;break; // (\n          case 0x29:\n            paren--;break; // )\n          case 0x5B:\n            square++;break; // [\n          case 0x5D:\n            square--;break; // ]\n          case 0x7B:\n            curly++;break; // {\n          case 0x7D:\n            curly--;break; // }\n        }\n      }\n    }\n\n    if (dir.expression == null) {\n      dir.expression = str.slice(0, i).trim();\n    } else if (lastFilterIndex !== 0) {\n      pushFilter();\n    }\n\n    cache$1.put(s, dir);\n    return dir;\n  }\n\nvar directive = Object.freeze({\n    parseDirective: parseDirective\n  });\n\n  var regexEscapeRE = /[-.*+?^${}()|[\\]\\/\\\\]/g;\n  var cache = undefined;\n  var tagRE = undefined;\n  var htmlRE = undefined;\n  /**\n   * Escape a string so it can be used in a RegExp\n   * constructor.\n   *\n   * @param {String} str\n   */\n\n  function escapeRegex(str) {\n    return str.replace(regexEscapeRE, '\\\\$&');\n  }\n\n  function compileRegex() {\n    var open = escapeRegex(config.delimiters[0]);\n    var close = escapeRegex(config.delimiters[1]);\n    var unsafeOpen = escapeRegex(config.unsafeDelimiters[0]);\n    var unsafeClose = escapeRegex(config.unsafeDelimiters[1]);\n    tagRE = new RegExp(unsafeOpen + '((?:.|\\\\n)+?)' + unsafeClose + '|' + open + '((?:.|\\\\n)+?)' + close, 'g');\n    htmlRE = new RegExp('^' + unsafeOpen + '((?:.|\\\\n)+?)' + unsafeClose + '$');\n    // reset cache\n    cache = new Cache(1000);\n  }\n\n  /**\n   * Parse a template text string into an array of tokens.\n   *\n   * @param {String} text\n   * @return {Array<Object> | null}\n   *               - {String} type\n   *               - {String} value\n   *               - {Boolean} [html]\n   *               - {Boolean} [oneTime]\n   */\n\n  function parseText(text) {\n    if (!cache) {\n      compileRegex();\n    }\n    var hit = cache.get(text);\n    if (hit) {\n      return hit;\n    }\n    if (!tagRE.test(text)) {\n      return null;\n    }\n    var tokens = [];\n    var lastIndex = tagRE.lastIndex = 0;\n    var match, index, html, value, first, oneTime;\n    /* eslint-disable no-cond-assign */\n    while (match = tagRE.exec(text)) {\n      /* eslint-enable no-cond-assign */\n      index = match.index;\n      // push text token\n      if (index > lastIndex) {\n        tokens.push({\n          value: text.slice(lastIndex, index)\n        });\n      }\n      // tag token\n      html = htmlRE.test(match[0]);\n      value = html ? match[1] : match[2];\n      first = value.charCodeAt(0);\n      oneTime = first === 42; // *\n      value = oneTime ? value.slice(1) : value;\n      tokens.push({\n        tag: true,\n        value: value.trim(),\n        html: html,\n        oneTime: oneTime\n      });\n      lastIndex = index + match[0].length;\n    }\n    if (lastIndex < text.length) {\n      tokens.push({\n        value: text.slice(lastIndex)\n      });\n    }\n    cache.put(text, tokens);\n    return tokens;\n  }\n\n  /**\n   * Format a list of tokens into an expression.\n   * e.g. tokens parsed from 'a {{b}} c' can be serialized\n   * into one single expression as '\"a \" + b + \" c\"'.\n   *\n   * @param {Array} tokens\n   * @param {Vue} [vm]\n   * @return {String}\n   */\n\n  function tokensToExp(tokens, vm) {\n    if (tokens.length > 1) {\n      return tokens.map(function (token) {\n        return formatToken(token, vm);\n      }).join('+');\n    } else {\n      return formatToken(tokens[0], vm, true);\n    }\n  }\n\n  /**\n   * Format a single token.\n   *\n   * @param {Object} token\n   * @param {Vue} [vm]\n   * @param {Boolean} [single]\n   * @return {String}\n   */\n\n  function formatToken(token, vm, single) {\n    return token.tag ? token.oneTime && vm ? '\"' + vm.$eval(token.value) + '\"' : inlineFilters(token.value, single) : '\"' + token.value + '\"';\n  }\n\n  /**\n   * For an attribute with multiple interpolation tags,\n   * e.g. attr=\"some-{{thing | filter}}\", in order to combine\n   * the whole thing into a single watchable expression, we\n   * have to inline those filters. This function does exactly\n   * that. This is a bit hacky but it avoids heavy changes\n   * to directive parser and watcher mechanism.\n   *\n   * @param {String} exp\n   * @param {Boolean} single\n   * @return {String}\n   */\n\n  var filterRE = /[^|]\\|[^|]/;\n  function inlineFilters(exp, single) {\n    if (!filterRE.test(exp)) {\n      return single ? exp : '(' + exp + ')';\n    } else {\n      var dir = parseDirective(exp);\n      if (!dir.filters) {\n        return '(' + exp + ')';\n      } else {\n        return 'this._applyFilters(' + dir.expression + // value\n        ',null,' + // oldValue (null for read)\n        JSON.stringify(dir.filters) + // filter descriptors\n        ',false)'; // write?\n      }\n    }\n  }\n\nvar text = Object.freeze({\n    compileRegex: compileRegex,\n    parseText: parseText,\n    tokensToExp: tokensToExp\n  });\n\n  var delimiters = ['{{', '}}'];\n  var unsafeDelimiters = ['{{{', '}}}'];\n\n  var config = Object.defineProperties({\n\n    /**\n     * Whether to print debug messages.\n     * Also enables stack trace for warnings.\n     *\n     * @type {Boolean}\n     */\n\n    debug: false,\n\n    /**\n     * Whether to suppress warnings.\n     *\n     * @type {Boolean}\n     */\n\n    silent: false,\n\n    /**\n     * Whether to use async rendering.\n     */\n\n    async: true,\n\n    /**\n     * Whether to warn against errors caught when evaluating\n     * expressions.\n     */\n\n    warnExpressionErrors: true,\n\n    /**\n     * Whether to allow devtools inspection.\n     * Disabled by default in production builds.\n     */\n\n    devtools: 'development' !== 'production',\n\n    /**\n     * Internal flag to indicate the delimiters have been\n     * changed.\n     *\n     * @type {Boolean}\n     */\n\n    _delimitersChanged: true,\n\n    /**\n     * List of asset types that a component can own.\n     *\n     * @type {Array}\n     */\n\n    _assetTypes: ['component', 'directive', 'elementDirective', 'filter', 'transition', 'partial'],\n\n    /**\n     * prop binding modes\n     */\n\n    _propBindingModes: {\n      ONE_WAY: 0,\n      TWO_WAY: 1,\n      ONE_TIME: 2\n    },\n\n    /**\n     * Max circular updates allowed in a batcher flush cycle.\n     */\n\n    _maxUpdateCount: 100\n\n  }, {\n    delimiters: { /**\n                   * Interpolation delimiters. Changing these would trigger\n                   * the text parser to re-compile the regular expressions.\n                   *\n                   * @type {Array<String>}\n                   */\n\n      get: function get() {\n        return delimiters;\n      },\n      set: function set(val) {\n        delimiters = val;\n        compileRegex();\n      },\n      configurable: true,\n      enumerable: true\n    },\n    unsafeDelimiters: {\n      get: function get() {\n        return unsafeDelimiters;\n      },\n      set: function set(val) {\n        unsafeDelimiters = val;\n        compileRegex();\n      },\n      configurable: true,\n      enumerable: true\n    }\n  });\n\n  var warn = undefined;\n  var formatComponentName = undefined;\n\n  if ('development' !== 'production') {\n    (function () {\n      var hasConsole = typeof console !== 'undefined';\n\n      warn = function (msg, vm) {\n        if (hasConsole && !config.silent) {\n          console.error('[Vue warn]: ' + msg + (vm ? formatComponentName(vm) : ''));\n        }\n      };\n\n      formatComponentName = function (vm) {\n        var name = vm._isVue ? vm.$options.name : vm.name;\n        return name ? ' (found in component: <' + hyphenate(name) + '>)' : '';\n      };\n    })();\n  }\n\n  /**\n   * Append with transition.\n   *\n   * @param {Element} el\n   * @param {Element} target\n   * @param {Vue} vm\n   * @param {Function} [cb]\n   */\n\n  function appendWithTransition(el, target, vm, cb) {\n    applyTransition(el, 1, function () {\n      target.appendChild(el);\n    }, vm, cb);\n  }\n\n  /**\n   * InsertBefore with transition.\n   *\n   * @param {Element} el\n   * @param {Element} target\n   * @param {Vue} vm\n   * @param {Function} [cb]\n   */\n\n  function beforeWithTransition(el, target, vm, cb) {\n    applyTransition(el, 1, function () {\n      before(el, target);\n    }, vm, cb);\n  }\n\n  /**\n   * Remove with transition.\n   *\n   * @param {Element} el\n   * @param {Vue} vm\n   * @param {Function} [cb]\n   */\n\n  function removeWithTransition(el, vm, cb) {\n    applyTransition(el, -1, function () {\n      remove(el);\n    }, vm, cb);\n  }\n\n  /**\n   * Apply transitions with an operation callback.\n   *\n   * @param {Element} el\n   * @param {Number} direction\n   *                  1: enter\n   *                 -1: leave\n   * @param {Function} op - the actual DOM operation\n   * @param {Vue} vm\n   * @param {Function} [cb]\n   */\n\n  function applyTransition(el, direction, op, vm, cb) {\n    var transition = el.__v_trans;\n    if (!transition ||\n    // skip if there are no js hooks and CSS transition is\n    // not supported\n    !transition.hooks && !transitionEndEvent ||\n    // skip transitions for initial compile\n    !vm._isCompiled ||\n    // if the vm is being manipulated by a parent directive\n    // during the parent's compilation phase, skip the\n    // animation.\n    vm.$parent && !vm.$parent._isCompiled) {\n      op();\n      if (cb) cb();\n      return;\n    }\n    var action = direction > 0 ? 'enter' : 'leave';\n    transition[action](op, cb);\n  }\n\nvar transition = Object.freeze({\n    appendWithTransition: appendWithTransition,\n    beforeWithTransition: beforeWithTransition,\n    removeWithTransition: removeWithTransition,\n    applyTransition: applyTransition\n  });\n\n  /**\n   * Query an element selector if it's not an element already.\n   *\n   * @param {String|Element} el\n   * @return {Element}\n   */\n\n  function query(el) {\n    if (typeof el === 'string') {\n      var selector = el;\n      el = document.querySelector(el);\n      if (!el) {\n        'development' !== 'production' && warn('Cannot find element: ' + selector);\n      }\n    }\n    return el;\n  }\n\n  /**\n   * Check if a node is in the document.\n   * Note: document.documentElement.contains should work here\n   * but always returns false for comment nodes in phantomjs,\n   * making unit tests difficult. This is fixed by doing the\n   * contains() check on the node's parentNode instead of\n   * the node itself.\n   *\n   * @param {Node} node\n   * @return {Boolean}\n   */\n\n  function inDoc(node) {\n    if (!node) return false;\n    var doc = node.ownerDocument.documentElement;\n    var parent = node.parentNode;\n    return doc === node || doc === parent || !!(parent && parent.nodeType === 1 && doc.contains(parent));\n  }\n\n  /**\n   * Get and remove an attribute from a node.\n   *\n   * @param {Node} node\n   * @param {String} _attr\n   */\n\n  function getAttr(node, _attr) {\n    var val = node.getAttribute(_attr);\n    if (val !== null) {\n      node.removeAttribute(_attr);\n    }\n    return val;\n  }\n\n  /**\n   * Get an attribute with colon or v-bind: prefix.\n   *\n   * @param {Node} node\n   * @param {String} name\n   * @return {String|null}\n   */\n\n  function getBindAttr(node, name) {\n    var val = getAttr(node, ':' + name);\n    if (val === null) {\n      val = getAttr(node, 'v-bind:' + name);\n    }\n    return val;\n  }\n\n  /**\n   * Check the presence of a bind attribute.\n   *\n   * @param {Node} node\n   * @param {String} name\n   * @return {Boolean}\n   */\n\n  function hasBindAttr(node, name) {\n    return node.hasAttribute(name) || node.hasAttribute(':' + name) || node.hasAttribute('v-bind:' + name);\n  }\n\n  /**\n   * Insert el before target\n   *\n   * @param {Element} el\n   * @param {Element} target\n   */\n\n  function before(el, target) {\n    target.parentNode.insertBefore(el, target);\n  }\n\n  /**\n   * Insert el after target\n   *\n   * @param {Element} el\n   * @param {Element} target\n   */\n\n  function after(el, target) {\n    if (target.nextSibling) {\n      before(el, target.nextSibling);\n    } else {\n      target.parentNode.appendChild(el);\n    }\n  }\n\n  /**\n   * Remove el from DOM\n   *\n   * @param {Element} el\n   */\n\n  function remove(el) {\n    el.parentNode.removeChild(el);\n  }\n\n  /**\n   * Prepend el to target\n   *\n   * @param {Element} el\n   * @param {Element} target\n   */\n\n  function prepend(el, target) {\n    if (target.firstChild) {\n      before(el, target.firstChild);\n    } else {\n      target.appendChild(el);\n    }\n  }\n\n  /**\n   * Replace target with el\n   *\n   * @param {Element} target\n   * @param {Element} el\n   */\n\n  function replace(target, el) {\n    var parent = target.parentNode;\n    if (parent) {\n      parent.replaceChild(el, target);\n    }\n  }\n\n  /**\n   * Add event listener shorthand.\n   *\n   * @param {Element} el\n   * @param {String} event\n   * @param {Function} cb\n   * @param {Boolean} [useCapture]\n   */\n\n  function on(el, event, cb, useCapture) {\n    el.addEventListener(event, cb, useCapture);\n  }\n\n  /**\n   * Remove event listener shorthand.\n   *\n   * @param {Element} el\n   * @param {String} event\n   * @param {Function} cb\n   */\n\n  function off(el, event, cb) {\n    el.removeEventListener(event, cb);\n  }\n\n  /**\n   * For IE9 compat: when both class and :class are present\n   * getAttribute('class') returns wrong value...\n   *\n   * @param {Element} el\n   * @return {String}\n   */\n\n  function getClass(el) {\n    var classname = el.className;\n    if (typeof classname === 'object') {\n      classname = classname.baseVal || '';\n    }\n    return classname;\n  }\n\n  /**\n   * In IE9, setAttribute('class') will result in empty class\n   * if the element also has the :class attribute; However in\n   * PhantomJS, setting `className` does not work on SVG elements...\n   * So we have to do a conditional check here.\n   *\n   * @param {Element} el\n   * @param {String} cls\n   */\n\n  function setClass(el, cls) {\n    /* istanbul ignore if */\n    if (isIE9 && !/svg$/.test(el.namespaceURI)) {\n      el.className = cls;\n    } else {\n      el.setAttribute('class', cls);\n    }\n  }\n\n  /**\n   * Add class with compatibility for IE & SVG\n   *\n   * @param {Element} el\n   * @param {String} cls\n   */\n\n  function addClass(el, cls) {\n    if (el.classList) {\n      el.classList.add(cls);\n    } else {\n      var cur = ' ' + getClass(el) + ' ';\n      if (cur.indexOf(' ' + cls + ' ') < 0) {\n        setClass(el, (cur + cls).trim());\n      }\n    }\n  }\n\n  /**\n   * Remove class with compatibility for IE & SVG\n   *\n   * @param {Element} el\n   * @param {String} cls\n   */\n\n  function removeClass(el, cls) {\n    if (el.classList) {\n      el.classList.remove(cls);\n    } else {\n      var cur = ' ' + getClass(el) + ' ';\n      var tar = ' ' + cls + ' ';\n      while (cur.indexOf(tar) >= 0) {\n        cur = cur.replace(tar, ' ');\n      }\n      setClass(el, cur.trim());\n    }\n    if (!el.className) {\n      el.removeAttribute('class');\n    }\n  }\n\n  /**\n   * Extract raw content inside an element into a temporary\n   * container div\n   *\n   * @param {Element} el\n   * @param {Boolean} asFragment\n   * @return {Element|DocumentFragment}\n   */\n\n  function extractContent(el, asFragment) {\n    var child;\n    var rawContent;\n    /* istanbul ignore if */\n    if (isTemplate(el) && isFragment(el.content)) {\n      el = el.content;\n    }\n    if (el.hasChildNodes()) {\n      trimNode(el);\n      rawContent = asFragment ? document.createDocumentFragment() : document.createElement('div');\n      /* eslint-disable no-cond-assign */\n      while (child = el.firstChild) {\n        /* eslint-enable no-cond-assign */\n        rawContent.appendChild(child);\n      }\n    }\n    return rawContent;\n  }\n\n  /**\n   * Trim possible empty head/tail text and comment\n   * nodes inside a parent.\n   *\n   * @param {Node} node\n   */\n\n  function trimNode(node) {\n    var child;\n    /* eslint-disable no-sequences */\n    while ((child = node.firstChild, isTrimmable(child))) {\n      node.removeChild(child);\n    }\n    while ((child = node.lastChild, isTrimmable(child))) {\n      node.removeChild(child);\n    }\n    /* eslint-enable no-sequences */\n  }\n\n  function isTrimmable(node) {\n    return node && (node.nodeType === 3 && !node.data.trim() || node.nodeType === 8);\n  }\n\n  /**\n   * Check if an element is a template tag.\n   * Note if the template appears inside an SVG its tagName\n   * will be in lowercase.\n   *\n   * @param {Element} el\n   */\n\n  function isTemplate(el) {\n    return el.tagName && el.tagName.toLowerCase() === 'template';\n  }\n\n  /**\n   * Create an \"anchor\" for performing dom insertion/removals.\n   * This is used in a number of scenarios:\n   * - fragment instance\n   * - v-html\n   * - v-if\n   * - v-for\n   * - component\n   *\n   * @param {String} content\n   * @param {Boolean} persist - IE trashes empty textNodes on\n   *                            cloneNode(true), so in certain\n   *                            cases the anchor needs to be\n   *                            non-empty to be persisted in\n   *                            templates.\n   * @return {Comment|Text}\n   */\n\n  function createAnchor(content, persist) {\n    var anchor = config.debug ? document.createComment(content) : document.createTextNode(persist ? ' ' : '');\n    anchor.__v_anchor = true;\n    return anchor;\n  }\n\n  /**\n   * Find a component ref attribute that starts with $.\n   *\n   * @param {Element} node\n   * @return {String|undefined}\n   */\n\n  var refRE = /^v-ref:/;\n\n  function findRef(node) {\n    if (node.hasAttributes()) {\n      var attrs = node.attributes;\n      for (var i = 0, l = attrs.length; i < l; i++) {\n        var name = attrs[i].name;\n        if (refRE.test(name)) {\n          return camelize(name.replace(refRE, ''));\n        }\n      }\n    }\n  }\n\n  /**\n   * Map a function to a range of nodes .\n   *\n   * @param {Node} node\n   * @param {Node} end\n   * @param {Function} op\n   */\n\n  function mapNodeRange(node, end, op) {\n    var next;\n    while (node !== end) {\n      next = node.nextSibling;\n      op(node);\n      node = next;\n    }\n    op(end);\n  }\n\n  /**\n   * Remove a range of nodes with transition, store\n   * the nodes in a fragment with correct ordering,\n   * and call callback when done.\n   *\n   * @param {Node} start\n   * @param {Node} end\n   * @param {Vue} vm\n   * @param {DocumentFragment} frag\n   * @param {Function} cb\n   */\n\n  function removeNodeRange(start, end, vm, frag, cb) {\n    var done = false;\n    var removed = 0;\n    var nodes = [];\n    mapNodeRange(start, end, function (node) {\n      if (node === end) done = true;\n      nodes.push(node);\n      removeWithTransition(node, vm, onRemoved);\n    });\n    function onRemoved() {\n      removed++;\n      if (done && removed >= nodes.length) {\n        for (var i = 0; i < nodes.length; i++) {\n          frag.appendChild(nodes[i]);\n        }\n        cb && cb();\n      }\n    }\n  }\n\n  /**\n   * Check if a node is a DocumentFragment.\n   *\n   * @param {Node} node\n   * @return {Boolean}\n   */\n\n  function isFragment(node) {\n    return node && node.nodeType === 11;\n  }\n\n  /**\n   * Get outerHTML of elements, taking care\n   * of SVG elements in IE as well.\n   *\n   * @param {Element} el\n   * @return {String}\n   */\n\n  function getOuterHTML(el) {\n    if (el.outerHTML) {\n      return el.outerHTML;\n    } else {\n      var container = document.createElement('div');\n      container.appendChild(el.cloneNode(true));\n      return container.innerHTML;\n    }\n  }\n\n  var commonTagRE = /^(div|p|span|img|a|b|i|br|ul|ol|li|h1|h2|h3|h4|h5|h6|code|pre|table|th|td|tr|form|label|input|select|option|nav|article|section|header|footer)$/i;\n  var reservedTagRE = /^(slot|partial|component)$/i;\n\n  var isUnknownElement = undefined;\n  if ('development' !== 'production') {\n    isUnknownElement = function (el, tag) {\n      if (tag.indexOf('-') > -1) {\n        // http://stackoverflow.com/a/28210364/1070244\n        return el.constructor === window.HTMLUnknownElement || el.constructor === window.HTMLElement;\n      } else {\n        return (/HTMLUnknownElement/.test(el.toString()) &&\n          // Chrome returns unknown for several HTML5 elements.\n          // https://code.google.com/p/chromium/issues/detail?id=540526\n          // Firefox returns unknown for some \"Interactive elements.\"\n          !/^(data|time|rtc|rb|details|dialog|summary)$/.test(tag)\n        );\n      }\n    };\n  }\n\n  /**\n   * Check if an element is a component, if yes return its\n   * component id.\n   *\n   * @param {Element} el\n   * @param {Object} options\n   * @return {Object|undefined}\n   */\n\n  function checkComponentAttr(el, options) {\n    var tag = el.tagName.toLowerCase();\n    var hasAttrs = el.hasAttributes();\n    if (!commonTagRE.test(tag) && !reservedTagRE.test(tag)) {\n      if (resolveAsset(options, 'components', tag)) {\n        return { id: tag };\n      } else {\n        var is = hasAttrs && getIsBinding(el, options);\n        if (is) {\n          return is;\n        } else if ('development' !== 'production') {\n          var expectedTag = options._componentNameMap && options._componentNameMap[tag];\n          if (expectedTag) {\n            warn('Unknown custom element: <' + tag + '> - ' + 'did you mean <' + expectedTag + '>? ' + 'HTML is case-insensitive, remember to use kebab-case in templates.');\n          } else if (isUnknownElement(el, tag)) {\n            warn('Unknown custom element: <' + tag + '> - did you ' + 'register the component correctly? For recursive components, ' + 'make sure to provide the \"name\" option.');\n          }\n        }\n      }\n    } else if (hasAttrs) {\n      return getIsBinding(el, options);\n    }\n  }\n\n  /**\n   * Get \"is\" binding from an element.\n   *\n   * @param {Element} el\n   * @param {Object} options\n   * @return {Object|undefined}\n   */\n\n  function getIsBinding(el, options) {\n    // dynamic syntax\n    var exp = el.getAttribute('is');\n    if (exp != null) {\n      if (resolveAsset(options, 'components', exp)) {\n        el.removeAttribute('is');\n        return { id: exp };\n      }\n    } else {\n      exp = getBindAttr(el, 'is');\n      if (exp != null) {\n        return { id: exp, dynamic: true };\n      }\n    }\n  }\n\n  /**\n   * Option overwriting strategies are functions that handle\n   * how to merge a parent option value and a child option\n   * value into the final value.\n   *\n   * All strategy functions follow the same signature:\n   *\n   * @param {*} parentVal\n   * @param {*} childVal\n   * @param {Vue} [vm]\n   */\n\n  var strats = config.optionMergeStrategies = Object.create(null);\n\n  /**\n   * Helper that recursively merges two data objects together.\n   */\n\n  function mergeData(to, from) {\n    var key, toVal, fromVal;\n    for (key in from) {\n      toVal = to[key];\n      fromVal = from[key];\n      if (!hasOwn(to, key)) {\n        set(to, key, fromVal);\n      } else if (isObject(toVal) && isObject(fromVal)) {\n        mergeData(toVal, fromVal);\n      }\n    }\n    return to;\n  }\n\n  /**\n   * Data\n   */\n\n  strats.data = function (parentVal, childVal, vm) {\n    if (!vm) {\n      // in a Vue.extend merge, both should be functions\n      if (!childVal) {\n        return parentVal;\n      }\n      if (typeof childVal !== 'function') {\n        'development' !== 'production' && warn('The \"data\" option should be a function ' + 'that returns a per-instance value in component ' + 'definitions.', vm);\n        return parentVal;\n      }\n      if (!parentVal) {\n        return childVal;\n      }\n      // when parentVal & childVal are both present,\n      // we need to return a function that returns the\n      // merged result of both functions... no need to\n      // check if parentVal is a function here because\n      // it has to be a function to pass previous merges.\n      return function mergedDataFn() {\n        return mergeData(childVal.call(this), parentVal.call(this));\n      };\n    } else if (parentVal || childVal) {\n      return function mergedInstanceDataFn() {\n        // instance merge\n        var instanceData = typeof childVal === 'function' ? childVal.call(vm) : childVal;\n        var defaultData = typeof parentVal === 'function' ? parentVal.call(vm) : undefined;\n        if (instanceData) {\n          return mergeData(instanceData, defaultData);\n        } else {\n          return defaultData;\n        }\n      };\n    }\n  };\n\n  /**\n   * El\n   */\n\n  strats.el = function (parentVal, childVal, vm) {\n    if (!vm && childVal && typeof childVal !== 'function') {\n      'development' !== 'production' && warn('The \"el\" option should be a function ' + 'that returns a per-instance value in component ' + 'definitions.', vm);\n      return;\n    }\n    var ret = childVal || parentVal;\n    // invoke the element factory if this is instance merge\n    return vm && typeof ret === 'function' ? ret.call(vm) : ret;\n  };\n\n  /**\n   * Hooks and param attributes are merged as arrays.\n   */\n\n  strats.init = strats.created = strats.ready = strats.attached = strats.detached = strats.beforeCompile = strats.compiled = strats.beforeDestroy = strats.destroyed = strats.activate = function (parentVal, childVal) {\n    return childVal ? parentVal ? parentVal.concat(childVal) : isArray(childVal) ? childVal : [childVal] : parentVal;\n  };\n\n  /**\n   * Assets\n   *\n   * When a vm is present (instance creation), we need to do\n   * a three-way merge between constructor options, instance\n   * options and parent options.\n   */\n\n  function mergeAssets(parentVal, childVal) {\n    var res = Object.create(parentVal || null);\n    return childVal ? extend(res, guardArrayAssets(childVal)) : res;\n  }\n\n  config._assetTypes.forEach(function (type) {\n    strats[type + 's'] = mergeAssets;\n  });\n\n  /**\n   * Events & Watchers.\n   *\n   * Events & watchers hashes should not overwrite one\n   * another, so we merge them as arrays.\n   */\n\n  strats.watch = strats.events = function (parentVal, childVal) {\n    if (!childVal) return parentVal;\n    if (!parentVal) return childVal;\n    var ret = {};\n    extend(ret, parentVal);\n    for (var key in childVal) {\n      var parent = ret[key];\n      var child = childVal[key];\n      if (parent && !isArray(parent)) {\n        parent = [parent];\n      }\n      ret[key] = parent ? parent.concat(child) : [child];\n    }\n    return ret;\n  };\n\n  /**\n   * Other object hashes.\n   */\n\n  strats.props = strats.methods = strats.computed = function (parentVal, childVal) {\n    if (!childVal) return parentVal;\n    if (!parentVal) return childVal;\n    var ret = Object.create(null);\n    extend(ret, parentVal);\n    extend(ret, childVal);\n    return ret;\n  };\n\n  /**\n   * Default strategy.\n   */\n\n  var defaultStrat = function defaultStrat(parentVal, childVal) {\n    return childVal === undefined ? parentVal : childVal;\n  };\n\n  /**\n   * Make sure component options get converted to actual\n   * constructors.\n   *\n   * @param {Object} options\n   */\n\n  function guardComponents(options) {\n    if (options.components) {\n      var components = options.components = guardArrayAssets(options.components);\n      var ids = Object.keys(components);\n      var def;\n      if ('development' !== 'production') {\n        var map = options._componentNameMap = {};\n      }\n      for (var i = 0, l = ids.length; i < l; i++) {\n        var key = ids[i];\n        if (commonTagRE.test(key) || reservedTagRE.test(key)) {\n          'development' !== 'production' && warn('Do not use built-in or reserved HTML elements as component ' + 'id: ' + key);\n          continue;\n        }\n        // record a all lowercase <-> kebab-case mapping for\n        // possible custom element case error warning\n        if ('development' !== 'production') {\n          map[key.replace(/-/g, '').toLowerCase()] = hyphenate(key);\n        }\n        def = components[key];\n        if (isPlainObject(def)) {\n          components[key] = Vue.extend(def);\n        }\n      }\n    }\n  }\n\n  /**\n   * Ensure all props option syntax are normalized into the\n   * Object-based format.\n   *\n   * @param {Object} options\n   */\n\n  function guardProps(options) {\n    var props = options.props;\n    var i, val;\n    if (isArray(props)) {\n      options.props = {};\n      i = props.length;\n      while (i--) {\n        val = props[i];\n        if (typeof val === 'string') {\n          options.props[val] = null;\n        } else if (val.name) {\n          options.props[val.name] = val;\n        }\n      }\n    } else if (isPlainObject(props)) {\n      var keys = Object.keys(props);\n      i = keys.length;\n      while (i--) {\n        val = props[keys[i]];\n        if (typeof val === 'function') {\n          props[keys[i]] = { type: val };\n        }\n      }\n    }\n  }\n\n  /**\n   * Guard an Array-format assets option and converted it\n   * into the key-value Object format.\n   *\n   * @param {Object|Array} assets\n   * @return {Object}\n   */\n\n  function guardArrayAssets(assets) {\n    if (isArray(assets)) {\n      var res = {};\n      var i = assets.length;\n      var asset;\n      while (i--) {\n        asset = assets[i];\n        var id = typeof asset === 'function' ? asset.options && asset.options.name || asset.id : asset.name || asset.id;\n        if (!id) {\n          'development' !== 'production' && warn('Array-syntax assets must provide a \"name\" or \"id\" field.');\n        } else {\n          res[id] = asset;\n        }\n      }\n      return res;\n    }\n    return assets;\n  }\n\n  /**\n   * Merge two option objects into a new one.\n   * Core utility used in both instantiation and inheritance.\n   *\n   * @param {Object} parent\n   * @param {Object} child\n   * @param {Vue} [vm] - if vm is present, indicates this is\n   *                     an instantiation merge.\n   */\n\n  function mergeOptions(parent, child, vm) {\n    guardComponents(child);\n    guardProps(child);\n    if ('development' !== 'production') {\n      if (child.propsData && !vm) {\n        warn('propsData can only be used as an instantiation option.');\n      }\n    }\n    var options = {};\n    var key;\n    if (child['extends']) {\n      parent = typeof child['extends'] === 'function' ? mergeOptions(parent, child['extends'].options, vm) : mergeOptions(parent, child['extends'], vm);\n    }\n    if (child.mixins) {\n      for (var i = 0, l = child.mixins.length; i < l; i++) {\n        var mixin = child.mixins[i];\n        var mixinOptions = mixin.prototype instanceof Vue ? mixin.options : mixin;\n        parent = mergeOptions(parent, mixinOptions, vm);\n      }\n    }\n    for (key in parent) {\n      mergeField(key);\n    }\n    for (key in child) {\n      if (!hasOwn(parent, key)) {\n        mergeField(key);\n      }\n    }\n    function mergeField(key) {\n      var strat = strats[key] || defaultStrat;\n      options[key] = strat(parent[key], child[key], vm, key);\n    }\n    return options;\n  }\n\n  /**\n   * Resolve an asset.\n   * This function is used because child instances need access\n   * to assets defined in its ancestor chain.\n   *\n   * @param {Object} options\n   * @param {String} type\n   * @param {String} id\n   * @param {Boolean} warnMissing\n   * @return {Object|Function}\n   */\n\n  function resolveAsset(options, type, id, warnMissing) {\n    /* istanbul ignore if */\n    if (typeof id !== 'string') {\n      return;\n    }\n    var assets = options[type];\n    var camelizedId;\n    var res = assets[id] ||\n    // camelCase ID\n    assets[camelizedId = camelize(id)] ||\n    // Pascal Case ID\n    assets[camelizedId.charAt(0).toUpperCase() + camelizedId.slice(1)];\n    if ('development' !== 'production' && warnMissing && !res) {\n      warn('Failed to resolve ' + type.slice(0, -1) + ': ' + id, options);\n    }\n    return res;\n  }\n\n  var uid$1 = 0;\n\n  /**\n   * A dep is an observable that can have multiple\n   * directives subscribing to it.\n   *\n   * @constructor\n   */\n  function Dep() {\n    this.id = uid$1++;\n    this.subs = [];\n  }\n\n  // the current target watcher being evaluated.\n  // this is globally unique because there could be only one\n  // watcher being evaluated at any time.\n  Dep.target = null;\n\n  /**\n   * Add a directive subscriber.\n   *\n   * @param {Directive} sub\n   */\n\n  Dep.prototype.addSub = function (sub) {\n    this.subs.push(sub);\n  };\n\n  /**\n   * Remove a directive subscriber.\n   *\n   * @param {Directive} sub\n   */\n\n  Dep.prototype.removeSub = function (sub) {\n    this.subs.$remove(sub);\n  };\n\n  /**\n   * Add self as a dependency to the target watcher.\n   */\n\n  Dep.prototype.depend = function () {\n    Dep.target.addDep(this);\n  };\n\n  /**\n   * Notify all subscribers of a new value.\n   */\n\n  Dep.prototype.notify = function () {\n    // stablize the subscriber list first\n    var subs = toArray(this.subs);\n    for (var i = 0, l = subs.length; i < l; i++) {\n      subs[i].update();\n    }\n  };\n\n  var arrayProto = Array.prototype;\n  var arrayMethods = Object.create(arrayProto)\n\n  /**\n   * Intercept mutating methods and emit events\n   */\n\n  ;['push', 'pop', 'shift', 'unshift', 'splice', 'sort', 'reverse'].forEach(function (method) {\n    // cache original method\n    var original = arrayProto[method];\n    def(arrayMethods, method, function mutator() {\n      // avoid leaking arguments:\n      // http://jsperf.com/closure-with-arguments\n      var i = arguments.length;\n      var args = new Array(i);\n      while (i--) {\n        args[i] = arguments[i];\n      }\n      var result = original.apply(this, args);\n      var ob = this.__ob__;\n      var inserted;\n      switch (method) {\n        case 'push':\n          inserted = args;\n          break;\n        case 'unshift':\n          inserted = args;\n          break;\n        case 'splice':\n          inserted = args.slice(2);\n          break;\n      }\n      if (inserted) ob.observeArray(inserted);\n      // notify change\n      ob.dep.notify();\n      return result;\n    });\n  });\n\n  /**\n   * Swap the element at the given index with a new value\n   * and emits corresponding event.\n   *\n   * @param {Number} index\n   * @param {*} val\n   * @return {*} - replaced element\n   */\n\n  def(arrayProto, '$set', function $set(index, val) {\n    if (index >= this.length) {\n      this.length = Number(index) + 1;\n    }\n    return this.splice(index, 1, val)[0];\n  });\n\n  /**\n   * Convenience method to remove the element at given index or target element reference.\n   *\n   * @param {*} item\n   */\n\n  def(arrayProto, '$remove', function $remove(item) {\n    /* istanbul ignore if */\n    if (!this.length) return;\n    var index = indexOf(this, item);\n    if (index > -1) {\n      return this.splice(index, 1);\n    }\n  });\n\n  var arrayKeys = Object.getOwnPropertyNames(arrayMethods);\n\n  /**\n   * By default, when a reactive property is set, the new value is\n   * also converted to become reactive. However in certain cases, e.g.\n   * v-for scope alias and props, we don't want to force conversion\n   * because the value may be a nested value under a frozen data structure.\n   *\n   * So whenever we want to set a reactive property without forcing\n   * conversion on the new value, we wrap that call inside this function.\n   */\n\n  var shouldConvert = true;\n\n  function withoutConversion(fn) {\n    shouldConvert = false;\n    fn();\n    shouldConvert = true;\n  }\n\n  /**\n   * Observer class that are attached to each observed\n   * object. Once attached, the observer converts target\n   * object's property keys into getter/setters that\n   * collect dependencies and dispatches updates.\n   *\n   * @param {Array|Object} value\n   * @constructor\n   */\n\n  function Observer(value) {\n    this.value = value;\n    this.dep = new Dep();\n    def(value, '__ob__', this);\n    if (isArray(value)) {\n      var augment = hasProto ? protoAugment : copyAugment;\n      augment(value, arrayMethods, arrayKeys);\n      this.observeArray(value);\n    } else {\n      this.walk(value);\n    }\n  }\n\n  // Instance methods\n\n  /**\n   * Walk through each property and convert them into\n   * getter/setters. This method should only be called when\n   * value type is Object.\n   *\n   * @param {Object} obj\n   */\n\n  Observer.prototype.walk = function (obj) {\n    var keys = Object.keys(obj);\n    for (var i = 0, l = keys.length; i < l; i++) {\n      this.convert(keys[i], obj[keys[i]]);\n    }\n  };\n\n  /**\n   * Observe a list of Array items.\n   *\n   * @param {Array} items\n   */\n\n  Observer.prototype.observeArray = function (items) {\n    for (var i = 0, l = items.length; i < l; i++) {\n      observe(items[i]);\n    }\n  };\n\n  /**\n   * Convert a property into getter/setter so we can emit\n   * the events when the property is accessed/changed.\n   *\n   * @param {String} key\n   * @param {*} val\n   */\n\n  Observer.prototype.convert = function (key, val) {\n    defineReactive(this.value, key, val);\n  };\n\n  /**\n   * Add an owner vm, so that when $set/$delete mutations\n   * happen we can notify owner vms to proxy the keys and\n   * digest the watchers. This is only called when the object\n   * is observed as an instance's root $data.\n   *\n   * @param {Vue} vm\n   */\n\n  Observer.prototype.addVm = function (vm) {\n    (this.vms || (this.vms = [])).push(vm);\n  };\n\n  /**\n   * Remove an owner vm. This is called when the object is\n   * swapped out as an instance's $data object.\n   *\n   * @param {Vue} vm\n   */\n\n  Observer.prototype.removeVm = function (vm) {\n    this.vms.$remove(vm);\n  };\n\n  // helpers\n\n  /**\n   * Augment an target Object or Array by intercepting\n   * the prototype chain using __proto__\n   *\n   * @param {Object|Array} target\n   * @param {Object} src\n   */\n\n  function protoAugment(target, src) {\n    /* eslint-disable no-proto */\n    target.__proto__ = src;\n    /* eslint-enable no-proto */\n  }\n\n  /**\n   * Augment an target Object or Array by defining\n   * hidden properties.\n   *\n   * @param {Object|Array} target\n   * @param {Object} proto\n   */\n\n  function copyAugment(target, src, keys) {\n    for (var i = 0, l = keys.length; i < l; i++) {\n      var key = keys[i];\n      def(target, key, src[key]);\n    }\n  }\n\n  /**\n   * Attempt to create an observer instance for a value,\n   * returns the new observer if successfully observed,\n   * or the existing observer if the value already has one.\n   *\n   * @param {*} value\n   * @param {Vue} [vm]\n   * @return {Observer|undefined}\n   * @static\n   */\n\n  function observe(value, vm) {\n    if (!value || typeof value !== 'object') {\n      return;\n    }\n    var ob;\n    if (hasOwn(value, '__ob__') && value.__ob__ instanceof Observer) {\n      ob = value.__ob__;\n    } else if (shouldConvert && (isArray(value) || isPlainObject(value)) && Object.isExtensible(value) && !value._isVue) {\n      ob = new Observer(value);\n    }\n    if (ob && vm) {\n      ob.addVm(vm);\n    }\n    return ob;\n  }\n\n  /**\n   * Define a reactive property on an Object.\n   *\n   * @param {Object} obj\n   * @param {String} key\n   * @param {*} val\n   */\n\n  function defineReactive(obj, key, val) {\n    var dep = new Dep();\n\n    var property = Object.getOwnPropertyDescriptor(obj, key);\n    if (property && property.configurable === false) {\n      return;\n    }\n\n    // cater for pre-defined getter/setters\n    var getter = property && property.get;\n    var setter = property && property.set;\n\n    var childOb = observe(val);\n    Object.defineProperty(obj, key, {\n      enumerable: true,\n      configurable: true,\n      get: function reactiveGetter() {\n        var value = getter ? getter.call(obj) : val;\n        if (Dep.target) {\n          dep.depend();\n          if (childOb) {\n            childOb.dep.depend();\n          }\n          if (isArray(value)) {\n            for (var e, i = 0, l = value.length; i < l; i++) {\n              e = value[i];\n              e && e.__ob__ && e.__ob__.dep.depend();\n            }\n          }\n        }\n        return value;\n      },\n      set: function reactiveSetter(newVal) {\n        var value = getter ? getter.call(obj) : val;\n        if (newVal === value) {\n          return;\n        }\n        if (setter) {\n          setter.call(obj, newVal);\n        } else {\n          val = newVal;\n        }\n        childOb = observe(newVal);\n        dep.notify();\n      }\n    });\n  }\n\n\n\n  var util = Object.freeze({\n  \tdefineReactive: defineReactive,\n  \tset: set,\n  \tdel: del,\n  \thasOwn: hasOwn,\n  \tisLiteral: isLiteral,\n  \tisReserved: isReserved,\n  \t_toString: _toString,\n  \ttoNumber: toNumber,\n  \ttoBoolean: toBoolean,\n  \tstripQuotes: stripQuotes,\n  \tcamelize: camelize,\n  \thyphenate: hyphenate,\n  \tclassify: classify,\n  \tbind: bind,\n  \ttoArray: toArray,\n  \textend: extend,\n  \tisObject: isObject,\n  \tisPlainObject: isPlainObject,\n  \tdef: def,\n  \tdebounce: _debounce,\n  \tindexOf: indexOf,\n  \tcancellable: cancellable,\n  \tlooseEqual: looseEqual,\n  \tisArray: isArray,\n  \thasProto: hasProto,\n  \tinBrowser: inBrowser,\n  \tdevtools: devtools,\n  \tisIE: isIE,\n  \tisIE9: isIE9,\n  \tisAndroid: isAndroid,\n  \tisIos: isIos,\n  \tiosVersionMatch: iosVersionMatch,\n  \tiosVersion: iosVersion,\n  \thasMutationObserverBug: hasMutationObserverBug,\n  \tget transitionProp () { return transitionProp; },\n  \tget transitionEndEvent () { return transitionEndEvent; },\n  \tget animationProp () { return animationProp; },\n  \tget animationEndEvent () { return animationEndEvent; },\n  \tnextTick: nextTick,\n  \tget _Set () { return _Set; },\n  \tquery: query,\n  \tinDoc: inDoc,\n  \tgetAttr: getAttr,\n  \tgetBindAttr: getBindAttr,\n  \thasBindAttr: hasBindAttr,\n  \tbefore: before,\n  \tafter: after,\n  \tremove: remove,\n  \tprepend: prepend,\n  \treplace: replace,\n  \ton: on,\n  \toff: off,\n  \tsetClass: setClass,\n  \taddClass: addClass,\n  \tremoveClass: removeClass,\n  \textractContent: extractContent,\n  \ttrimNode: trimNode,\n  \tisTemplate: isTemplate,\n  \tcreateAnchor: createAnchor,\n  \tfindRef: findRef,\n  \tmapNodeRange: mapNodeRange,\n  \tremoveNodeRange: removeNodeRange,\n  \tisFragment: isFragment,\n  \tgetOuterHTML: getOuterHTML,\n  \tmergeOptions: mergeOptions,\n  \tresolveAsset: resolveAsset,\n  \tcheckComponentAttr: checkComponentAttr,\n  \tcommonTagRE: commonTagRE,\n  \treservedTagRE: reservedTagRE,\n  \tget warn () { return warn; }\n  });\n\n  var uid = 0;\n\n  function initMixin (Vue) {\n    /**\n     * The main init sequence. This is called for every\n     * instance, including ones that are created from extended\n     * constructors.\n     *\n     * @param {Object} options - this options object should be\n     *                           the result of merging class\n     *                           options and the options passed\n     *                           in to the constructor.\n     */\n\n    Vue.prototype._init = function (options) {\n      options = options || {};\n\n      this.$el = null;\n      this.$parent = options.parent;\n      this.$root = this.$parent ? this.$parent.$root : this;\n      this.$children = [];\n      this.$refs = {}; // child vm references\n      this.$els = {}; // element references\n      this._watchers = []; // all watchers as an array\n      this._directives = []; // all directives\n\n      // a uid\n      this._uid = uid++;\n\n      // a flag to avoid this being observed\n      this._isVue = true;\n\n      // events bookkeeping\n      this._events = {}; // registered callbacks\n      this._eventsCount = {}; // for $broadcast optimization\n\n      // fragment instance properties\n      this._isFragment = false;\n      this._fragment = // @type {DocumentFragment}\n      this._fragmentStart = // @type {Text|Comment}\n      this._fragmentEnd = null; // @type {Text|Comment}\n\n      // lifecycle state\n      this._isCompiled = this._isDestroyed = this._isReady = this._isAttached = this._isBeingDestroyed = this._vForRemoving = false;\n      this._unlinkFn = null;\n\n      // context:\n      // if this is a transcluded component, context\n      // will be the common parent vm of this instance\n      // and its host.\n      this._context = options._context || this.$parent;\n\n      // scope:\n      // if this is inside an inline v-for, the scope\n      // will be the intermediate scope created for this\n      // repeat fragment. this is used for linking props\n      // and container directives.\n      this._scope = options._scope;\n\n      // fragment:\n      // if this instance is compiled inside a Fragment, it\n      // needs to reigster itself as a child of that fragment\n      // for attach/detach to work properly.\n      this._frag = options._frag;\n      if (this._frag) {\n        this._frag.children.push(this);\n      }\n\n      // push self into parent / transclusion host\n      if (this.$parent) {\n        this.$parent.$children.push(this);\n      }\n\n      // merge options.\n      options = this.$options = mergeOptions(this.constructor.options, options, this);\n\n      // set ref\n      this._updateRef();\n\n      // initialize data as empty object.\n      // it will be filled up in _initData().\n      this._data = {};\n\n      // call init hook\n      this._callHook('init');\n\n      // initialize data observation and scope inheritance.\n      this._initState();\n\n      // setup event system and option events.\n      this._initEvents();\n\n      // call created hook\n      this._callHook('created');\n\n      // if `el` option is passed, start compilation.\n      if (options.el) {\n        this.$mount(options.el);\n      }\n    };\n  }\n\n  var pathCache = new Cache(1000);\n\n  // actions\n  var APPEND = 0;\n  var PUSH = 1;\n  var INC_SUB_PATH_DEPTH = 2;\n  var PUSH_SUB_PATH = 3;\n\n  // states\n  var BEFORE_PATH = 0;\n  var IN_PATH = 1;\n  var BEFORE_IDENT = 2;\n  var IN_IDENT = 3;\n  var IN_SUB_PATH = 4;\n  var IN_SINGLE_QUOTE = 5;\n  var IN_DOUBLE_QUOTE = 6;\n  var AFTER_PATH = 7;\n  var ERROR = 8;\n\n  var pathStateMachine = [];\n\n  pathStateMachine[BEFORE_PATH] = {\n    'ws': [BEFORE_PATH],\n    'ident': [IN_IDENT, APPEND],\n    '[': [IN_SUB_PATH],\n    'eof': [AFTER_PATH]\n  };\n\n  pathStateMachine[IN_PATH] = {\n    'ws': [IN_PATH],\n    '.': [BEFORE_IDENT],\n    '[': [IN_SUB_PATH],\n    'eof': [AFTER_PATH]\n  };\n\n  pathStateMachine[BEFORE_IDENT] = {\n    'ws': [BEFORE_IDENT],\n    'ident': [IN_IDENT, APPEND]\n  };\n\n  pathStateMachine[IN_IDENT] = {\n    'ident': [IN_IDENT, APPEND],\n    '0': [IN_IDENT, APPEND],\n    'number': [IN_IDENT, APPEND],\n    'ws': [IN_PATH, PUSH],\n    '.': [BEFORE_IDENT, PUSH],\n    '[': [IN_SUB_PATH, PUSH],\n    'eof': [AFTER_PATH, PUSH]\n  };\n\n  pathStateMachine[IN_SUB_PATH] = {\n    \"'\": [IN_SINGLE_QUOTE, APPEND],\n    '\"': [IN_DOUBLE_QUOTE, APPEND],\n    '[': [IN_SUB_PATH, INC_SUB_PATH_DEPTH],\n    ']': [IN_PATH, PUSH_SUB_PATH],\n    'eof': ERROR,\n    'else': [IN_SUB_PATH, APPEND]\n  };\n\n  pathStateMachine[IN_SINGLE_QUOTE] = {\n    \"'\": [IN_SUB_PATH, APPEND],\n    'eof': ERROR,\n    'else': [IN_SINGLE_QUOTE, APPEND]\n  };\n\n  pathStateMachine[IN_DOUBLE_QUOTE] = {\n    '\"': [IN_SUB_PATH, APPEND],\n    'eof': ERROR,\n    'else': [IN_DOUBLE_QUOTE, APPEND]\n  };\n\n  /**\n   * Determine the type of a character in a keypath.\n   *\n   * @param {Char} ch\n   * @return {String} type\n   */\n\n  function getPathCharType(ch) {\n    if (ch === undefined) {\n      return 'eof';\n    }\n\n    var code = ch.charCodeAt(0);\n\n    switch (code) {\n      case 0x5B: // [\n      case 0x5D: // ]\n      case 0x2E: // .\n      case 0x22: // \"\n      case 0x27: // '\n      case 0x30:\n        // 0\n        return ch;\n\n      case 0x5F: // _\n      case 0x24:\n        // $\n        return 'ident';\n\n      case 0x20: // Space\n      case 0x09: // Tab\n      case 0x0A: // Newline\n      case 0x0D: // Return\n      case 0xA0: // No-break space\n      case 0xFEFF: // Byte Order Mark\n      case 0x2028: // Line Separator\n      case 0x2029:\n        // Paragraph Separator\n        return 'ws';\n    }\n\n    // a-z, A-Z\n    if (code >= 0x61 && code <= 0x7A || code >= 0x41 && code <= 0x5A) {\n      return 'ident';\n    }\n\n    // 1-9\n    if (code >= 0x31 && code <= 0x39) {\n      return 'number';\n    }\n\n    return 'else';\n  }\n\n  /**\n   * Format a subPath, return its plain form if it is\n   * a literal string or number. Otherwise prepend the\n   * dynamic indicator (*).\n   *\n   * @param {String} path\n   * @return {String}\n   */\n\n  function formatSubPath(path) {\n    var trimmed = path.trim();\n    // invalid leading 0\n    if (path.charAt(0) === '0' && isNaN(path)) {\n      return false;\n    }\n    return isLiteral(trimmed) ? stripQuotes(trimmed) : '*' + trimmed;\n  }\n\n  /**\n   * Parse a string path into an array of segments\n   *\n   * @param {String} path\n   * @return {Array|undefined}\n   */\n\n  function parse(path) {\n    var keys = [];\n    var index = -1;\n    var mode = BEFORE_PATH;\n    var subPathDepth = 0;\n    var c, newChar, key, type, transition, action, typeMap;\n\n    var actions = [];\n\n    actions[PUSH] = function () {\n      if (key !== undefined) {\n        keys.push(key);\n        key = undefined;\n      }\n    };\n\n    actions[APPEND] = function () {\n      if (key === undefined) {\n        key = newChar;\n      } else {\n        key += newChar;\n      }\n    };\n\n    actions[INC_SUB_PATH_DEPTH] = function () {\n      actions[APPEND]();\n      subPathDepth++;\n    };\n\n    actions[PUSH_SUB_PATH] = function () {\n      if (subPathDepth > 0) {\n        subPathDepth--;\n        mode = IN_SUB_PATH;\n        actions[APPEND]();\n      } else {\n        subPathDepth = 0;\n        key = formatSubPath(key);\n        if (key === false) {\n          return false;\n        } else {\n          actions[PUSH]();\n        }\n      }\n    };\n\n    function maybeUnescapeQuote() {\n      var nextChar = path[index + 1];\n      if (mode === IN_SINGLE_QUOTE && nextChar === \"'\" || mode === IN_DOUBLE_QUOTE && nextChar === '\"') {\n        index++;\n        newChar = '\\\\' + nextChar;\n        actions[APPEND]();\n        return true;\n      }\n    }\n\n    while (mode != null) {\n      index++;\n      c = path[index];\n\n      if (c === '\\\\' && maybeUnescapeQuote()) {\n        continue;\n      }\n\n      type = getPathCharType(c);\n      typeMap = pathStateMachine[mode];\n      transition = typeMap[type] || typeMap['else'] || ERROR;\n\n      if (transition === ERROR) {\n        return; // parse error\n      }\n\n      mode = transition[0];\n      action = actions[transition[1]];\n      if (action) {\n        newChar = transition[2];\n        newChar = newChar === undefined ? c : newChar;\n        if (action() === false) {\n          return;\n        }\n      }\n\n      if (mode === AFTER_PATH) {\n        keys.raw = path;\n        return keys;\n      }\n    }\n  }\n\n  /**\n   * External parse that check for a cache hit first\n   *\n   * @param {String} path\n   * @return {Array|undefined}\n   */\n\n  function parsePath(path) {\n    var hit = pathCache.get(path);\n    if (!hit) {\n      hit = parse(path);\n      if (hit) {\n        pathCache.put(path, hit);\n      }\n    }\n    return hit;\n  }\n\n  /**\n   * Get from an object from a path string\n   *\n   * @param {Object} obj\n   * @param {String} path\n   */\n\n  function getPath(obj, path) {\n    return parseExpression(path).get(obj);\n  }\n\n  /**\n   * Warn against setting non-existent root path on a vm.\n   */\n\n  var warnNonExistent;\n  if ('development' !== 'production') {\n    warnNonExistent = function (path, vm) {\n      warn('You are setting a non-existent path \"' + path.raw + '\" ' + 'on a vm instance. Consider pre-initializing the property ' + 'with the \"data\" option for more reliable reactivity ' + 'and better performance.', vm);\n    };\n  }\n\n  /**\n   * Set on an object from a path\n   *\n   * @param {Object} obj\n   * @param {String | Array} path\n   * @param {*} val\n   */\n\n  function setPath(obj, path, val) {\n    var original = obj;\n    if (typeof path === 'string') {\n      path = parse(path);\n    }\n    if (!path || !isObject(obj)) {\n      return false;\n    }\n    var last, key;\n    for (var i = 0, l = path.length; i < l; i++) {\n      last = obj;\n      key = path[i];\n      if (key.charAt(0) === '*') {\n        key = parseExpression(key.slice(1)).get.call(original, original);\n      }\n      if (i < l - 1) {\n        obj = obj[key];\n        if (!isObject(obj)) {\n          obj = {};\n          if ('development' !== 'production' && last._isVue) {\n            warnNonExistent(path, last);\n          }\n          set(last, key, obj);\n        }\n      } else {\n        if (isArray(obj)) {\n          obj.$set(key, val);\n        } else if (key in obj) {\n          obj[key] = val;\n        } else {\n          if ('development' !== 'production' && obj._isVue) {\n            warnNonExistent(path, obj);\n          }\n          set(obj, key, val);\n        }\n      }\n    }\n    return true;\n  }\n\nvar path = Object.freeze({\n    parsePath: parsePath,\n    getPath: getPath,\n    setPath: setPath\n  });\n\n  var expressionCache = new Cache(1000);\n\n  var allowedKeywords = 'Math,Date,this,true,false,null,undefined,Infinity,NaN,' + 'isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,' + 'encodeURIComponent,parseInt,parseFloat';\n  var allowedKeywordsRE = new RegExp('^(' + allowedKeywords.replace(/,/g, '\\\\b|') + '\\\\b)');\n\n  // keywords that don't make sense inside expressions\n  var improperKeywords = 'break,case,class,catch,const,continue,debugger,default,' + 'delete,do,else,export,extends,finally,for,function,if,' + 'import,in,instanceof,let,return,super,switch,throw,try,' + 'var,while,with,yield,enum,await,implements,package,' + 'protected,static,interface,private,public';\n  var improperKeywordsRE = new RegExp('^(' + improperKeywords.replace(/,/g, '\\\\b|') + '\\\\b)');\n\n  var wsRE = /\\s/g;\n  var newlineRE = /\\n/g;\n  var saveRE = /[\\{,]\\s*[\\w\\$_]+\\s*:|('(?:[^'\\\\]|\\\\.)*'|\"(?:[^\"\\\\]|\\\\.)*\"|`(?:[^`\\\\]|\\\\.)*\\$\\{|\\}(?:[^`\\\\]|\\\\.)*`|`(?:[^`\\\\]|\\\\.)*`)|new |typeof |void /g;\n  var restoreRE = /\"(\\d+)\"/g;\n  var pathTestRE = /^[A-Za-z_$][\\w$]*(?:\\.[A-Za-z_$][\\w$]*|\\['.*?'\\]|\\[\".*?\"\\]|\\[\\d+\\]|\\[[A-Za-z_$][\\w$]*\\])*$/;\n  var identRE = /[^\\w$\\.](?:[A-Za-z_$][\\w$]*)/g;\n  var literalValueRE$1 = /^(?:true|false|null|undefined|Infinity|NaN)$/;\n\n  function noop() {}\n\n  /**\n   * Save / Rewrite / Restore\n   *\n   * When rewriting paths found in an expression, it is\n   * possible for the same letter sequences to be found in\n   * strings and Object literal property keys. Therefore we\n   * remove and store these parts in a temporary array, and\n   * restore them after the path rewrite.\n   */\n\n  var saved = [];\n\n  /**\n   * Save replacer\n   *\n   * The save regex can match two possible cases:\n   * 1. An opening object literal\n   * 2. A string\n   * If matched as a plain string, we need to escape its\n   * newlines, since the string needs to be preserved when\n   * generating the function body.\n   *\n   * @param {String} str\n   * @param {String} isString - str if matched as a string\n   * @return {String} - placeholder with index\n   */\n\n  function save(str, isString) {\n    var i = saved.length;\n    saved[i] = isString ? str.replace(newlineRE, '\\\\n') : str;\n    return '\"' + i + '\"';\n  }\n\n  /**\n   * Path rewrite replacer\n   *\n   * @param {String} raw\n   * @return {String}\n   */\n\n  function rewrite(raw) {\n    var c = raw.charAt(0);\n    var path = raw.slice(1);\n    if (allowedKeywordsRE.test(path)) {\n      return raw;\n    } else {\n      path = path.indexOf('\"') > -1 ? path.replace(restoreRE, restore) : path;\n      return c + 'scope.' + path;\n    }\n  }\n\n  /**\n   * Restore replacer\n   *\n   * @param {String} str\n   * @param {String} i - matched save index\n   * @return {String}\n   */\n\n  function restore(str, i) {\n    return saved[i];\n  }\n\n  /**\n   * Rewrite an expression, prefixing all path accessors with\n   * `scope.` and generate getter/setter functions.\n   *\n   * @param {String} exp\n   * @return {Function}\n   */\n\n  function compileGetter(exp) {\n    if (improperKeywordsRE.test(exp)) {\n      'development' !== 'production' && warn('Avoid using reserved keywords in expression: ' + exp);\n    }\n    // reset state\n    saved.length = 0;\n    // save strings and object literal keys\n    var body = exp.replace(saveRE, save).replace(wsRE, '');\n    // rewrite all paths\n    // pad 1 space here because the regex matches 1 extra char\n    body = (' ' + body).replace(identRE, rewrite).replace(restoreRE, restore);\n    return makeGetterFn(body);\n  }\n\n  /**\n   * Build a getter function. Requires eval.\n   *\n   * We isolate the try/catch so it doesn't affect the\n   * optimization of the parse function when it is not called.\n   *\n   * @param {String} body\n   * @return {Function|undefined}\n   */\n\n  function makeGetterFn(body) {\n    try {\n      /* eslint-disable no-new-func */\n      return new Function('scope', 'return ' + body + ';');\n      /* eslint-enable no-new-func */\n    } catch (e) {\n      if ('development' !== 'production') {\n        /* istanbul ignore if */\n        if (e.toString().match(/unsafe-eval|CSP/)) {\n          warn('It seems you are using the default build of Vue.js in an environment ' + 'with Content Security Policy that prohibits unsafe-eval. ' + 'Use the CSP-compliant build instead: ' + 'http://vuejs.org/guide/installation.html#CSP-compliant-build');\n        } else {\n          warn('Invalid expression. ' + 'Generated function body: ' + body);\n        }\n      }\n      return noop;\n    }\n  }\n\n  /**\n   * Compile a setter function for the expression.\n   *\n   * @param {String} exp\n   * @return {Function|undefined}\n   */\n\n  function compileSetter(exp) {\n    var path = parsePath(exp);\n    if (path) {\n      return function (scope, val) {\n        setPath(scope, path, val);\n      };\n    } else {\n      'development' !== 'production' && warn('Invalid setter expression: ' + exp);\n    }\n  }\n\n  /**\n   * Parse an expression into re-written getter/setters.\n   *\n   * @param {String} exp\n   * @param {Boolean} needSet\n   * @return {Function}\n   */\n\n  function parseExpression(exp, needSet) {\n    exp = exp.trim();\n    // try cache\n    var hit = expressionCache.get(exp);\n    if (hit) {\n      if (needSet && !hit.set) {\n        hit.set = compileSetter(hit.exp);\n      }\n      return hit;\n    }\n    var res = { exp: exp };\n    res.get = isSimplePath(exp) && exp.indexOf('[') < 0\n    // optimized super simple getter\n    ? makeGetterFn('scope.' + exp)\n    // dynamic getter\n    : compileGetter(exp);\n    if (needSet) {\n      res.set = compileSetter(exp);\n    }\n    expressionCache.put(exp, res);\n    return res;\n  }\n\n  /**\n   * Check if an expression is a simple path.\n   *\n   * @param {String} exp\n   * @return {Boolean}\n   */\n\n  function isSimplePath(exp) {\n    return pathTestRE.test(exp) &&\n    // don't treat literal values as paths\n    !literalValueRE$1.test(exp) &&\n    // Math constants e.g. Math.PI, Math.E etc.\n    exp.slice(0, 5) !== 'Math.';\n  }\n\nvar expression = Object.freeze({\n    parseExpression: parseExpression,\n    isSimplePath: isSimplePath\n  });\n\n  // we have two separate queues: one for directive updates\n  // and one for user watcher registered via $watch().\n  // we want to guarantee directive updates to be called\n  // before user watchers so that when user watchers are\n  // triggered, the DOM would have already been in updated\n  // state.\n\n  var queue = [];\n  var userQueue = [];\n  var has = {};\n  var circular = {};\n  var waiting = false;\n\n  /**\n   * Reset the batcher's state.\n   */\n\n  function resetBatcherState() {\n    queue.length = 0;\n    userQueue.length = 0;\n    has = {};\n    circular = {};\n    waiting = false;\n  }\n\n  /**\n   * Flush both queues and run the watchers.\n   */\n\n  function flushBatcherQueue() {\n    var _again = true;\n\n    _function: while (_again) {\n      _again = false;\n\n      runBatcherQueue(queue);\n      runBatcherQueue(userQueue);\n      // user watchers triggered more watchers,\n      // keep flushing until it depletes\n      if (queue.length) {\n        _again = true;\n        continue _function;\n      }\n      // dev tool hook\n      /* istanbul ignore if */\n      if (devtools && config.devtools) {\n        devtools.emit('flush');\n      }\n      resetBatcherState();\n    }\n  }\n\n  /**\n   * Run the watchers in a single queue.\n   *\n   * @param {Array} queue\n   */\n\n  function runBatcherQueue(queue) {\n    // do not cache length because more watchers might be pushed\n    // as we run existing watchers\n    for (var i = 0; i < queue.length; i++) {\n      var watcher = queue[i];\n      var id = watcher.id;\n      has[id] = null;\n      watcher.run();\n      // in dev build, check and stop circular updates.\n      if ('development' !== 'production' && has[id] != null) {\n        circular[id] = (circular[id] || 0) + 1;\n        if (circular[id] > config._maxUpdateCount) {\n          warn('You may have an infinite update loop for watcher ' + 'with expression \"' + watcher.expression + '\"', watcher.vm);\n          break;\n        }\n      }\n    }\n    queue.length = 0;\n  }\n\n  /**\n   * Push a watcher into the watcher queue.\n   * Jobs with duplicate IDs will be skipped unless it's\n   * pushed when the queue is being flushed.\n   *\n   * @param {Watcher} watcher\n   *   properties:\n   *   - {Number} id\n   *   - {Function} run\n   */\n\n  function pushWatcher(watcher) {\n    var id = watcher.id;\n    if (has[id] == null) {\n      // push watcher into appropriate queue\n      var q = watcher.user ? userQueue : queue;\n      has[id] = q.length;\n      q.push(watcher);\n      // queue the flush\n      if (!waiting) {\n        waiting = true;\n        nextTick(flushBatcherQueue);\n      }\n    }\n  }\n\n  var uid$2 = 0;\n\n  /**\n   * A watcher parses an expression, collects dependencies,\n   * and fires callback when the expression value changes.\n   * This is used for both the $watch() api and directives.\n   *\n   * @param {Vue} vm\n   * @param {String|Function} expOrFn\n   * @param {Function} cb\n   * @param {Object} options\n   *                 - {Array} filters\n   *                 - {Boolean} twoWay\n   *                 - {Boolean} deep\n   *                 - {Boolean} user\n   *                 - {Boolean} sync\n   *                 - {Boolean} lazy\n   *                 - {Function} [preProcess]\n   *                 - {Function} [postProcess]\n   * @constructor\n   */\n  function Watcher(vm, expOrFn, cb, options) {\n    // mix in options\n    if (options) {\n      extend(this, options);\n    }\n    var isFn = typeof expOrFn === 'function';\n    this.vm = vm;\n    vm._watchers.push(this);\n    this.expression = expOrFn;\n    this.cb = cb;\n    this.id = ++uid$2; // uid for batching\n    this.active = true;\n    this.dirty = this.lazy; // for lazy watchers\n    this.deps = [];\n    this.newDeps = [];\n    this.depIds = new _Set();\n    this.newDepIds = new _Set();\n    this.prevError = null; // for async error stacks\n    // parse expression for getter/setter\n    if (isFn) {\n      this.getter = expOrFn;\n      this.setter = undefined;\n    } else {\n      var res = parseExpression(expOrFn, this.twoWay);\n      this.getter = res.get;\n      this.setter = res.set;\n    }\n    this.value = this.lazy ? undefined : this.get();\n    // state for avoiding false triggers for deep and Array\n    // watchers during vm._digest()\n    this.queued = this.shallow = false;\n  }\n\n  /**\n   * Evaluate the getter, and re-collect dependencies.\n   */\n\n  Watcher.prototype.get = function () {\n    this.beforeGet();\n    var scope = this.scope || this.vm;\n    var value;\n    try {\n      value = this.getter.call(scope, scope);\n    } catch (e) {\n      if ('development' !== 'production' && config.warnExpressionErrors) {\n        warn('Error when evaluating expression ' + '\"' + this.expression + '\": ' + e.toString(), this.vm);\n      }\n    }\n    // \"touch\" every property so they are all tracked as\n    // dependencies for deep watching\n    if (this.deep) {\n      traverse(value);\n    }\n    if (this.preProcess) {\n      value = this.preProcess(value);\n    }\n    if (this.filters) {\n      value = scope._applyFilters(value, null, this.filters, false);\n    }\n    if (this.postProcess) {\n      value = this.postProcess(value);\n    }\n    this.afterGet();\n    return value;\n  };\n\n  /**\n   * Set the corresponding value with the setter.\n   *\n   * @param {*} value\n   */\n\n  Watcher.prototype.set = function (value) {\n    var scope = this.scope || this.vm;\n    if (this.filters) {\n      value = scope._applyFilters(value, this.value, this.filters, true);\n    }\n    try {\n      this.setter.call(scope, scope, value);\n    } catch (e) {\n      if ('development' !== 'production' && config.warnExpressionErrors) {\n        warn('Error when evaluating setter ' + '\"' + this.expression + '\": ' + e.toString(), this.vm);\n      }\n    }\n    // two-way sync for v-for alias\n    var forContext = scope.$forContext;\n    if (forContext && forContext.alias === this.expression) {\n      if (forContext.filters) {\n        'development' !== 'production' && warn('It seems you are using two-way binding on ' + 'a v-for alias (' + this.expression + '), and the ' + 'v-for has filters. This will not work properly. ' + 'Either remove the filters or use an array of ' + 'objects and bind to object properties instead.', this.vm);\n        return;\n      }\n      forContext._withLock(function () {\n        if (scope.$key) {\n          // original is an object\n          forContext.rawValue[scope.$key] = value;\n        } else {\n          forContext.rawValue.$set(scope.$index, value);\n        }\n      });\n    }\n  };\n\n  /**\n   * Prepare for dependency collection.\n   */\n\n  Watcher.prototype.beforeGet = function () {\n    Dep.target = this;\n  };\n\n  /**\n   * Add a dependency to this directive.\n   *\n   * @param {Dep} dep\n   */\n\n  Watcher.prototype.addDep = function (dep) {\n    var id = dep.id;\n    if (!this.newDepIds.has(id)) {\n      this.newDepIds.add(id);\n      this.newDeps.push(dep);\n      if (!this.depIds.has(id)) {\n        dep.addSub(this);\n      }\n    }\n  };\n\n  /**\n   * Clean up for dependency collection.\n   */\n\n  Watcher.prototype.afterGet = function () {\n    Dep.target = null;\n    var i = this.deps.length;\n    while (i--) {\n      var dep = this.deps[i];\n      if (!this.newDepIds.has(dep.id)) {\n        dep.removeSub(this);\n      }\n    }\n    var tmp = this.depIds;\n    this.depIds = this.newDepIds;\n    this.newDepIds = tmp;\n    this.newDepIds.clear();\n    tmp = this.deps;\n    this.deps = this.newDeps;\n    this.newDeps = tmp;\n    this.newDeps.length = 0;\n  };\n\n  /**\n   * Subscriber interface.\n   * Will be called when a dependency changes.\n   *\n   * @param {Boolean} shallow\n   */\n\n  Watcher.prototype.update = function (shallow) {\n    if (this.lazy) {\n      this.dirty = true;\n    } else if (this.sync || !config.async) {\n      this.run();\n    } else {\n      // if queued, only overwrite shallow with non-shallow,\n      // but not the other way around.\n      this.shallow = this.queued ? shallow ? this.shallow : false : !!shallow;\n      this.queued = true;\n      // record before-push error stack in debug mode\n      /* istanbul ignore if */\n      if ('development' !== 'production' && config.debug) {\n        this.prevError = new Error('[vue] async stack trace');\n      }\n      pushWatcher(this);\n    }\n  };\n\n  /**\n   * Batcher job interface.\n   * Will be called by the batcher.\n   */\n\n  Watcher.prototype.run = function () {\n    if (this.active) {\n      var value = this.get();\n      if (value !== this.value ||\n      // Deep watchers and watchers on Object/Arrays should fire even\n      // when the value is the same, because the value may\n      // have mutated; but only do so if this is a\n      // non-shallow update (caused by a vm digest).\n      (isObject(value) || this.deep) && !this.shallow) {\n        // set new value\n        var oldValue = this.value;\n        this.value = value;\n        // in debug + async mode, when a watcher callbacks\n        // throws, we also throw the saved before-push error\n        // so the full cross-tick stack trace is available.\n        var prevError = this.prevError;\n        /* istanbul ignore if */\n        if ('development' !== 'production' && config.debug && prevError) {\n          this.prevError = null;\n          try {\n            this.cb.call(this.vm, value, oldValue);\n          } catch (e) {\n            nextTick(function () {\n              throw prevError;\n            }, 0);\n            throw e;\n          }\n        } else {\n          this.cb.call(this.vm, value, oldValue);\n        }\n      }\n      this.queued = this.shallow = false;\n    }\n  };\n\n  /**\n   * Evaluate the value of the watcher.\n   * This only gets called for lazy watchers.\n   */\n\n  Watcher.prototype.evaluate = function () {\n    // avoid overwriting another watcher that is being\n    // collected.\n    var current = Dep.target;\n    this.value = this.get();\n    this.dirty = false;\n    Dep.target = current;\n  };\n\n  /**\n   * Depend on all deps collected by this watcher.\n   */\n\n  Watcher.prototype.depend = function () {\n    var i = this.deps.length;\n    while (i--) {\n      this.deps[i].depend();\n    }\n  };\n\n  /**\n   * Remove self from all dependencies' subcriber list.\n   */\n\n  Watcher.prototype.teardown = function () {\n    if (this.active) {\n      // remove self from vm's watcher list\n      // this is a somewhat expensive operation so we skip it\n      // if the vm is being destroyed or is performing a v-for\n      // re-render (the watcher list is then filtered by v-for).\n      if (!this.vm._isBeingDestroyed && !this.vm._vForRemoving) {\n        this.vm._watchers.$remove(this);\n      }\n      var i = this.deps.length;\n      while (i--) {\n        this.deps[i].removeSub(this);\n      }\n      this.active = false;\n      this.vm = this.cb = this.value = null;\n    }\n  };\n\n  /**\n   * Recrusively traverse an object to evoke all converted\n   * getters, so that every nested property inside the object\n   * is collected as a \"deep\" dependency.\n   *\n   * @param {*} val\n   */\n\n  var seenObjects = new _Set();\n  function traverse(val, seen) {\n    var i = undefined,\n        keys = undefined;\n    if (!seen) {\n      seen = seenObjects;\n      seen.clear();\n    }\n    var isA = isArray(val);\n    var isO = isObject(val);\n    if ((isA || isO) && Object.isExtensible(val)) {\n      if (val.__ob__) {\n        var depId = val.__ob__.dep.id;\n        if (seen.has(depId)) {\n          return;\n        } else {\n          seen.add(depId);\n        }\n      }\n      if (isA) {\n        i = val.length;\n        while (i--) traverse(val[i], seen);\n      } else if (isO) {\n        keys = Object.keys(val);\n        i = keys.length;\n        while (i--) traverse(val[keys[i]], seen);\n      }\n    }\n  }\n\n  var text$1 = {\n\n    bind: function bind() {\n      this.attr = this.el.nodeType === 3 ? 'data' : 'textContent';\n    },\n\n    update: function update(value) {\n      this.el[this.attr] = _toString(value);\n    }\n  };\n\n  var templateCache = new Cache(1000);\n  var idSelectorCache = new Cache(1000);\n\n  var map = {\n    efault: [0, '', ''],\n    legend: [1, '<fieldset>', '</fieldset>'],\n    tr: [2, '<table><tbody>', '</tbody></table>'],\n    col: [2, '<table><tbody></tbody><colgroup>', '</colgroup></table>']\n  };\n\n  map.td = map.th = [3, '<table><tbody><tr>', '</tr></tbody></table>'];\n\n  map.option = map.optgroup = [1, '<select multiple=\"multiple\">', '</select>'];\n\n  map.thead = map.tbody = map.colgroup = map.caption = map.tfoot = [1, '<table>', '</table>'];\n\n  map.g = map.defs = map.symbol = map.use = map.image = map.text = map.circle = map.ellipse = map.line = map.path = map.polygon = map.polyline = map.rect = [1, '<svg ' + 'xmlns=\"http://www.w3.org/2000/svg\" ' + 'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' + 'xmlns:ev=\"http://www.w3.org/2001/xml-events\"' + 'version=\"1.1\">', '</svg>'];\n\n  /**\n   * Check if a node is a supported template node with a\n   * DocumentFragment content.\n   *\n   * @param {Node} node\n   * @return {Boolean}\n   */\n\n  function isRealTemplate(node) {\n    return isTemplate(node) && isFragment(node.content);\n  }\n\n  var tagRE$1 = /<([\\w:-]+)/;\n  var entityRE = /&#?\\w+?;/;\n  var commentRE = /<!--/;\n\n  /**\n   * Convert a string template to a DocumentFragment.\n   * Determines correct wrapping by tag types. Wrapping\n   * strategy found in jQuery & component/domify.\n   *\n   * @param {String} templateString\n   * @param {Boolean} raw\n   * @return {DocumentFragment}\n   */\n\n  function stringToFragment(templateString, raw) {\n    // try a cache hit first\n    var cacheKey = raw ? templateString : templateString.trim();\n    var hit = templateCache.get(cacheKey);\n    if (hit) {\n      return hit;\n    }\n\n    var frag = document.createDocumentFragment();\n    var tagMatch = templateString.match(tagRE$1);\n    var entityMatch = entityRE.test(templateString);\n    var commentMatch = commentRE.test(templateString);\n\n    if (!tagMatch && !entityMatch && !commentMatch) {\n      // text only, return a single text node.\n      frag.appendChild(document.createTextNode(templateString));\n    } else {\n      var tag = tagMatch && tagMatch[1];\n      var wrap = map[tag] || map.efault;\n      var depth = wrap[0];\n      var prefix = wrap[1];\n      var suffix = wrap[2];\n      var node = document.createElement('div');\n\n      node.innerHTML = prefix + templateString + suffix;\n      while (depth--) {\n        node = node.lastChild;\n      }\n\n      var child;\n      /* eslint-disable no-cond-assign */\n      while (child = node.firstChild) {\n        /* eslint-enable no-cond-assign */\n        frag.appendChild(child);\n      }\n    }\n    if (!raw) {\n      trimNode(frag);\n    }\n    templateCache.put(cacheKey, frag);\n    return frag;\n  }\n\n  /**\n   * Convert a template node to a DocumentFragment.\n   *\n   * @param {Node} node\n   * @return {DocumentFragment}\n   */\n\n  function nodeToFragment(node) {\n    // if its a template tag and the browser supports it,\n    // its content is already a document fragment. However, iOS Safari has\n    // bug when using directly cloned template content with touch\n    // events and can cause crashes when the nodes are removed from DOM, so we\n    // have to treat template elements as string templates. (#2805)\n    /* istanbul ignore if */\n    if (isRealTemplate(node)) {\n      return stringToFragment(node.innerHTML);\n    }\n    // script template\n    if (node.tagName === 'SCRIPT') {\n      return stringToFragment(node.textContent);\n    }\n    // normal node, clone it to avoid mutating the original\n    var clonedNode = cloneNode(node);\n    var frag = document.createDocumentFragment();\n    var child;\n    /* eslint-disable no-cond-assign */\n    while (child = clonedNode.firstChild) {\n      /* eslint-enable no-cond-assign */\n      frag.appendChild(child);\n    }\n    trimNode(frag);\n    return frag;\n  }\n\n  // Test for the presence of the Safari template cloning bug\n  // https://bugs.webkit.org/showug.cgi?id=137755\n  var hasBrokenTemplate = (function () {\n    /* istanbul ignore else */\n    if (inBrowser) {\n      var a = document.createElement('div');\n      a.innerHTML = '<template>1</template>';\n      return !a.cloneNode(true).firstChild.innerHTML;\n    } else {\n      return false;\n    }\n  })();\n\n  // Test for IE10/11 textarea placeholder clone bug\n  var hasTextareaCloneBug = (function () {\n    /* istanbul ignore else */\n    if (inBrowser) {\n      var t = document.createElement('textarea');\n      t.placeholder = 't';\n      return t.cloneNode(true).value === 't';\n    } else {\n      return false;\n    }\n  })();\n\n  /**\n   * 1. Deal with Safari cloning nested <template> bug by\n   *    manually cloning all template instances.\n   * 2. Deal with IE10/11 textarea placeholder bug by setting\n   *    the correct value after cloning.\n   *\n   * @param {Element|DocumentFragment} node\n   * @return {Element|DocumentFragment}\n   */\n\n  function cloneNode(node) {\n    /* istanbul ignore if */\n    if (!node.querySelectorAll) {\n      return node.cloneNode();\n    }\n    var res = node.cloneNode(true);\n    var i, original, cloned;\n    /* istanbul ignore if */\n    if (hasBrokenTemplate) {\n      var tempClone = res;\n      if (isRealTemplate(node)) {\n        node = node.content;\n        tempClone = res.content;\n      }\n      original = node.querySelectorAll('template');\n      if (original.length) {\n        cloned = tempClone.querySelectorAll('template');\n        i = cloned.length;\n        while (i--) {\n          cloned[i].parentNode.replaceChild(cloneNode(original[i]), cloned[i]);\n        }\n      }\n    }\n    /* istanbul ignore if */\n    if (hasTextareaCloneBug) {\n      if (node.tagName === 'TEXTAREA') {\n        res.value = node.value;\n      } else {\n        original = node.querySelectorAll('textarea');\n        if (original.length) {\n          cloned = res.querySelectorAll('textarea');\n          i = cloned.length;\n          while (i--) {\n            cloned[i].value = original[i].value;\n          }\n        }\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Process the template option and normalizes it into a\n   * a DocumentFragment that can be used as a partial or a\n   * instance template.\n   *\n   * @param {*} template\n   *        Possible values include:\n   *        - DocumentFragment object\n   *        - Node object of type Template\n   *        - id selector: '#some-template-id'\n   *        - template string: '<div><span>{{msg}}</span></div>'\n   * @param {Boolean} shouldClone\n   * @param {Boolean} raw\n   *        inline HTML interpolation. Do not check for id\n   *        selector and keep whitespace in the string.\n   * @return {DocumentFragment|undefined}\n   */\n\n  function parseTemplate(template, shouldClone, raw) {\n    var node, frag;\n\n    // if the template is already a document fragment,\n    // do nothing\n    if (isFragment(template)) {\n      trimNode(template);\n      return shouldClone ? cloneNode(template) : template;\n    }\n\n    if (typeof template === 'string') {\n      // id selector\n      if (!raw && template.charAt(0) === '#') {\n        // id selector can be cached too\n        frag = idSelectorCache.get(template);\n        if (!frag) {\n          node = document.getElementById(template.slice(1));\n          if (node) {\n            frag = nodeToFragment(node);\n            // save selector to cache\n            idSelectorCache.put(template, frag);\n          }\n        }\n      } else {\n        // normal string template\n        frag = stringToFragment(template, raw);\n      }\n    } else if (template.nodeType) {\n      // a direct node\n      frag = nodeToFragment(template);\n    }\n\n    return frag && shouldClone ? cloneNode(frag) : frag;\n  }\n\nvar template = Object.freeze({\n    cloneNode: cloneNode,\n    parseTemplate: parseTemplate\n  });\n\n  var html = {\n\n    bind: function bind() {\n      // a comment node means this is a binding for\n      // {{{ inline unescaped html }}}\n      if (this.el.nodeType === 8) {\n        // hold nodes\n        this.nodes = [];\n        // replace the placeholder with proper anchor\n        this.anchor = createAnchor('v-html');\n        replace(this.el, this.anchor);\n      }\n    },\n\n    update: function update(value) {\n      value = _toString(value);\n      if (this.nodes) {\n        this.swap(value);\n      } else {\n        this.el.innerHTML = value;\n      }\n    },\n\n    swap: function swap(value) {\n      // remove old nodes\n      var i = this.nodes.length;\n      while (i--) {\n        remove(this.nodes[i]);\n      }\n      // convert new value to a fragment\n      // do not attempt to retrieve from id selector\n      var frag = parseTemplate(value, true, true);\n      // save a reference to these nodes so we can remove later\n      this.nodes = toArray(frag.childNodes);\n      before(frag, this.anchor);\n    }\n  };\n\n  /**\n   * Abstraction for a partially-compiled fragment.\n   * Can optionally compile content with a child scope.\n   *\n   * @param {Function} linker\n   * @param {Vue} vm\n   * @param {DocumentFragment} frag\n   * @param {Vue} [host]\n   * @param {Object} [scope]\n   * @param {Fragment} [parentFrag]\n   */\n  function Fragment(linker, vm, frag, host, scope, parentFrag) {\n    this.children = [];\n    this.childFrags = [];\n    this.vm = vm;\n    this.scope = scope;\n    this.inserted = false;\n    this.parentFrag = parentFrag;\n    if (parentFrag) {\n      parentFrag.childFrags.push(this);\n    }\n    this.unlink = linker(vm, frag, host, scope, this);\n    var single = this.single = frag.childNodes.length === 1 &&\n    // do not go single mode if the only node is an anchor\n    !frag.childNodes[0].__v_anchor;\n    if (single) {\n      this.node = frag.childNodes[0];\n      this.before = singleBefore;\n      this.remove = singleRemove;\n    } else {\n      this.node = createAnchor('fragment-start');\n      this.end = createAnchor('fragment-end');\n      this.frag = frag;\n      prepend(this.node, frag);\n      frag.appendChild(this.end);\n      this.before = multiBefore;\n      this.remove = multiRemove;\n    }\n    this.node.__v_frag = this;\n  }\n\n  /**\n   * Call attach/detach for all components contained within\n   * this fragment. Also do so recursively for all child\n   * fragments.\n   *\n   * @param {Function} hook\n   */\n\n  Fragment.prototype.callHook = function (hook) {\n    var i, l;\n    for (i = 0, l = this.childFrags.length; i < l; i++) {\n      this.childFrags[i].callHook(hook);\n    }\n    for (i = 0, l = this.children.length; i < l; i++) {\n      hook(this.children[i]);\n    }\n  };\n\n  /**\n   * Insert fragment before target, single node version\n   *\n   * @param {Node} target\n   * @param {Boolean} withTransition\n   */\n\n  function singleBefore(target, withTransition) {\n    this.inserted = true;\n    var method = withTransition !== false ? beforeWithTransition : before;\n    method(this.node, target, this.vm);\n    if (inDoc(this.node)) {\n      this.callHook(attach);\n    }\n  }\n\n  /**\n   * Remove fragment, single node version\n   */\n\n  function singleRemove() {\n    this.inserted = false;\n    var shouldCallRemove = inDoc(this.node);\n    var self = this;\n    this.beforeRemove();\n    removeWithTransition(this.node, this.vm, function () {\n      if (shouldCallRemove) {\n        self.callHook(detach);\n      }\n      self.destroy();\n    });\n  }\n\n  /**\n   * Insert fragment before target, multi-nodes version\n   *\n   * @param {Node} target\n   * @param {Boolean} withTransition\n   */\n\n  function multiBefore(target, withTransition) {\n    this.inserted = true;\n    var vm = this.vm;\n    var method = withTransition !== false ? beforeWithTransition : before;\n    mapNodeRange(this.node, this.end, function (node) {\n      method(node, target, vm);\n    });\n    if (inDoc(this.node)) {\n      this.callHook(attach);\n    }\n  }\n\n  /**\n   * Remove fragment, multi-nodes version\n   */\n\n  function multiRemove() {\n    this.inserted = false;\n    var self = this;\n    var shouldCallRemove = inDoc(this.node);\n    this.beforeRemove();\n    removeNodeRange(this.node, this.end, this.vm, this.frag, function () {\n      if (shouldCallRemove) {\n        self.callHook(detach);\n      }\n      self.destroy();\n    });\n  }\n\n  /**\n   * Prepare the fragment for removal.\n   */\n\n  Fragment.prototype.beforeRemove = function () {\n    var i, l;\n    for (i = 0, l = this.childFrags.length; i < l; i++) {\n      // call the same method recursively on child\n      // fragments, depth-first\n      this.childFrags[i].beforeRemove(false);\n    }\n    for (i = 0, l = this.children.length; i < l; i++) {\n      // Call destroy for all contained instances,\n      // with remove:false and defer:true.\n      // Defer is necessary because we need to\n      // keep the children to call detach hooks\n      // on them.\n      this.children[i].$destroy(false, true);\n    }\n    var dirs = this.unlink.dirs;\n    for (i = 0, l = dirs.length; i < l; i++) {\n      // disable the watchers on all the directives\n      // so that the rendered content stays the same\n      // during removal.\n      dirs[i]._watcher && dirs[i]._watcher.teardown();\n    }\n  };\n\n  /**\n   * Destroy the fragment.\n   */\n\n  Fragment.prototype.destroy = function () {\n    if (this.parentFrag) {\n      this.parentFrag.childFrags.$remove(this);\n    }\n    this.node.__v_frag = null;\n    this.unlink();\n  };\n\n  /**\n   * Call attach hook for a Vue instance.\n   *\n   * @param {Vue} child\n   */\n\n  function attach(child) {\n    if (!child._isAttached && inDoc(child.$el)) {\n      child._callHook('attached');\n    }\n  }\n\n  /**\n   * Call detach hook for a Vue instance.\n   *\n   * @param {Vue} child\n   */\n\n  function detach(child) {\n    if (child._isAttached && !inDoc(child.$el)) {\n      child._callHook('detached');\n    }\n  }\n\n  var linkerCache = new Cache(5000);\n\n  /**\n   * A factory that can be used to create instances of a\n   * fragment. Caches the compiled linker if possible.\n   *\n   * @param {Vue} vm\n   * @param {Element|String} el\n   */\n  function FragmentFactory(vm, el) {\n    this.vm = vm;\n    var template;\n    var isString = typeof el === 'string';\n    if (isString || isTemplate(el) && !el.hasAttribute('v-if')) {\n      template = parseTemplate(el, true);\n    } else {\n      template = document.createDocumentFragment();\n      template.appendChild(el);\n    }\n    this.template = template;\n    // linker can be cached, but only for components\n    var linker;\n    var cid = vm.constructor.cid;\n    if (cid > 0) {\n      var cacheId = cid + (isString ? el : getOuterHTML(el));\n      linker = linkerCache.get(cacheId);\n      if (!linker) {\n        linker = compile(template, vm.$options, true);\n        linkerCache.put(cacheId, linker);\n      }\n    } else {\n      linker = compile(template, vm.$options, true);\n    }\n    this.linker = linker;\n  }\n\n  /**\n   * Create a fragment instance with given host and scope.\n   *\n   * @param {Vue} host\n   * @param {Object} scope\n   * @param {Fragment} parentFrag\n   */\n\n  FragmentFactory.prototype.create = function (host, scope, parentFrag) {\n    var frag = cloneNode(this.template);\n    return new Fragment(this.linker, this.vm, frag, host, scope, parentFrag);\n  };\n\n  var ON = 700;\n  var MODEL = 800;\n  var BIND = 850;\n  var TRANSITION = 1100;\n  var EL = 1500;\n  var COMPONENT = 1500;\n  var PARTIAL = 1750;\n  var IF = 2100;\n  var FOR = 2200;\n  var SLOT = 2300;\n\n  var uid$3 = 0;\n\n  var vFor = {\n\n    priority: FOR,\n    terminal: true,\n\n    params: ['track-by', 'stagger', 'enter-stagger', 'leave-stagger'],\n\n    bind: function bind() {\n      // support \"item in/of items\" syntax\n      var inMatch = this.expression.match(/(.*) (?:in|of) (.*)/);\n      if (inMatch) {\n        var itMatch = inMatch[1].match(/\\((.*),(.*)\\)/);\n        if (itMatch) {\n          this.iterator = itMatch[1].trim();\n          this.alias = itMatch[2].trim();\n        } else {\n          this.alias = inMatch[1].trim();\n        }\n        this.expression = inMatch[2];\n      }\n\n      if (!this.alias) {\n        'development' !== 'production' && warn('Invalid v-for expression \"' + this.descriptor.raw + '\": ' + 'alias is required.', this.vm);\n        return;\n      }\n\n      // uid as a cache identifier\n      this.id = '__v-for__' + ++uid$3;\n\n      // check if this is an option list,\n      // so that we know if we need to update the <select>'s\n      // v-model when the option list has changed.\n      // because v-model has a lower priority than v-for,\n      // the v-model is not bound here yet, so we have to\n      // retrive it in the actual updateModel() function.\n      var tag = this.el.tagName;\n      this.isOption = (tag === 'OPTION' || tag === 'OPTGROUP') && this.el.parentNode.tagName === 'SELECT';\n\n      // setup anchor nodes\n      this.start = createAnchor('v-for-start');\n      this.end = createAnchor('v-for-end');\n      replace(this.el, this.end);\n      before(this.start, this.end);\n\n      // cache\n      this.cache = Object.create(null);\n\n      // fragment factory\n      this.factory = new FragmentFactory(this.vm, this.el);\n    },\n\n    update: function update(data) {\n      this.diff(data);\n      this.updateRef();\n      this.updateModel();\n    },\n\n    /**\n     * Diff, based on new data and old data, determine the\n     * minimum amount of DOM manipulations needed to make the\n     * DOM reflect the new data Array.\n     *\n     * The algorithm diffs the new data Array by storing a\n     * hidden reference to an owner vm instance on previously\n     * seen data. This allows us to achieve O(n) which is\n     * better than a levenshtein distance based algorithm,\n     * which is O(m * n).\n     *\n     * @param {Array} data\n     */\n\n    diff: function diff(data) {\n      // check if the Array was converted from an Object\n      var item = data[0];\n      var convertedFromObject = this.fromObject = isObject(item) && hasOwn(item, '$key') && hasOwn(item, '$value');\n\n      var trackByKey = this.params.trackBy;\n      var oldFrags = this.frags;\n      var frags = this.frags = new Array(data.length);\n      var alias = this.alias;\n      var iterator = this.iterator;\n      var start = this.start;\n      var end = this.end;\n      var inDocument = inDoc(start);\n      var init = !oldFrags;\n      var i, l, frag, key, value, primitive;\n\n      // First pass, go through the new Array and fill up\n      // the new frags array. If a piece of data has a cached\n      // instance for it, we reuse it. Otherwise build a new\n      // instance.\n      for (i = 0, l = data.length; i < l; i++) {\n        item = data[i];\n        key = convertedFromObject ? item.$key : null;\n        value = convertedFromObject ? item.$value : item;\n        primitive = !isObject(value);\n        frag = !init && this.getCachedFrag(value, i, key);\n        if (frag) {\n          // reusable fragment\n          frag.reused = true;\n          // update $index\n          frag.scope.$index = i;\n          // update $key\n          if (key) {\n            frag.scope.$key = key;\n          }\n          // update iterator\n          if (iterator) {\n            frag.scope[iterator] = key !== null ? key : i;\n          }\n          // update data for track-by, object repeat &\n          // primitive values.\n          if (trackByKey || convertedFromObject || primitive) {\n            withoutConversion(function () {\n              frag.scope[alias] = value;\n            });\n          }\n        } else {\n          // new isntance\n          frag = this.create(value, alias, i, key);\n          frag.fresh = !init;\n        }\n        frags[i] = frag;\n        if (init) {\n          frag.before(end);\n        }\n      }\n\n      // we're done for the initial render.\n      if (init) {\n        return;\n      }\n\n      // Second pass, go through the old fragments and\n      // destroy those who are not reused (and remove them\n      // from cache)\n      var removalIndex = 0;\n      var totalRemoved = oldFrags.length - frags.length;\n      // when removing a large number of fragments, watcher removal\n      // turns out to be a perf bottleneck, so we batch the watcher\n      // removals into a single filter call!\n      this.vm._vForRemoving = true;\n      for (i = 0, l = oldFrags.length; i < l; i++) {\n        frag = oldFrags[i];\n        if (!frag.reused) {\n          this.deleteCachedFrag(frag);\n          this.remove(frag, removalIndex++, totalRemoved, inDocument);\n        }\n      }\n      this.vm._vForRemoving = false;\n      if (removalIndex) {\n        this.vm._watchers = this.vm._watchers.filter(function (w) {\n          return w.active;\n        });\n      }\n\n      // Final pass, move/insert new fragments into the\n      // right place.\n      var targetPrev, prevEl, currentPrev;\n      var insertionIndex = 0;\n      for (i = 0, l = frags.length; i < l; i++) {\n        frag = frags[i];\n        // this is the frag that we should be after\n        targetPrev = frags[i - 1];\n        prevEl = targetPrev ? targetPrev.staggerCb ? targetPrev.staggerAnchor : targetPrev.end || targetPrev.node : start;\n        if (frag.reused && !frag.staggerCb) {\n          currentPrev = findPrevFrag(frag, start, this.id);\n          if (currentPrev !== targetPrev && (!currentPrev ||\n          // optimization for moving a single item.\n          // thanks to suggestions by @livoras in #1807\n          findPrevFrag(currentPrev, start, this.id) !== targetPrev)) {\n            this.move(frag, prevEl);\n          }\n        } else {\n          // new instance, or still in stagger.\n          // insert with updated stagger index.\n          this.insert(frag, insertionIndex++, prevEl, inDocument);\n        }\n        frag.reused = frag.fresh = false;\n      }\n    },\n\n    /**\n     * Create a new fragment instance.\n     *\n     * @param {*} value\n     * @param {String} alias\n     * @param {Number} index\n     * @param {String} [key]\n     * @return {Fragment}\n     */\n\n    create: function create(value, alias, index, key) {\n      var host = this._host;\n      // create iteration scope\n      var parentScope = this._scope || this.vm;\n      var scope = Object.create(parentScope);\n      // ref holder for the scope\n      scope.$refs = Object.create(parentScope.$refs);\n      scope.$els = Object.create(parentScope.$els);\n      // make sure point $parent to parent scope\n      scope.$parent = parentScope;\n      // for two-way binding on alias\n      scope.$forContext = this;\n      // define scope properties\n      // important: define the scope alias without forced conversion\n      // so that frozen data structures remain non-reactive.\n      withoutConversion(function () {\n        defineReactive(scope, alias, value);\n      });\n      defineReactive(scope, '$index', index);\n      if (key) {\n        defineReactive(scope, '$key', key);\n      } else if (scope.$key) {\n        // avoid accidental fallback\n        def(scope, '$key', null);\n      }\n      if (this.iterator) {\n        defineReactive(scope, this.iterator, key !== null ? key : index);\n      }\n      var frag = this.factory.create(host, scope, this._frag);\n      frag.forId = this.id;\n      this.cacheFrag(value, frag, index, key);\n      return frag;\n    },\n\n    /**\n     * Update the v-ref on owner vm.\n     */\n\n    updateRef: function updateRef() {\n      var ref = this.descriptor.ref;\n      if (!ref) return;\n      var hash = (this._scope || this.vm).$refs;\n      var refs;\n      if (!this.fromObject) {\n        refs = this.frags.map(findVmFromFrag);\n      } else {\n        refs = {};\n        this.frags.forEach(function (frag) {\n          refs[frag.scope.$key] = findVmFromFrag(frag);\n        });\n      }\n      hash[ref] = refs;\n    },\n\n    /**\n     * For option lists, update the containing v-model on\n     * parent <select>.\n     */\n\n    updateModel: function updateModel() {\n      if (this.isOption) {\n        var parent = this.start.parentNode;\n        var model = parent && parent.__v_model;\n        if (model) {\n          model.forceUpdate();\n        }\n      }\n    },\n\n    /**\n     * Insert a fragment. Handles staggering.\n     *\n     * @param {Fragment} frag\n     * @param {Number} index\n     * @param {Node} prevEl\n     * @param {Boolean} inDocument\n     */\n\n    insert: function insert(frag, index, prevEl, inDocument) {\n      if (frag.staggerCb) {\n        frag.staggerCb.cancel();\n        frag.staggerCb = null;\n      }\n      var staggerAmount = this.getStagger(frag, index, null, 'enter');\n      if (inDocument && staggerAmount) {\n        // create an anchor and insert it synchronously,\n        // so that we can resolve the correct order without\n        // worrying about some elements not inserted yet\n        var anchor = frag.staggerAnchor;\n        if (!anchor) {\n          anchor = frag.staggerAnchor = createAnchor('stagger-anchor');\n          anchor.__v_frag = frag;\n        }\n        after(anchor, prevEl);\n        var op = frag.staggerCb = cancellable(function () {\n          frag.staggerCb = null;\n          frag.before(anchor);\n          remove(anchor);\n        });\n        setTimeout(op, staggerAmount);\n      } else {\n        var target = prevEl.nextSibling;\n        /* istanbul ignore if */\n        if (!target) {\n          // reset end anchor position in case the position was messed up\n          // by an external drag-n-drop library.\n          after(this.end, prevEl);\n          target = this.end;\n        }\n        frag.before(target);\n      }\n    },\n\n    /**\n     * Remove a fragment. Handles staggering.\n     *\n     * @param {Fragment} frag\n     * @param {Number} index\n     * @param {Number} total\n     * @param {Boolean} inDocument\n     */\n\n    remove: function remove(frag, index, total, inDocument) {\n      if (frag.staggerCb) {\n        frag.staggerCb.cancel();\n        frag.staggerCb = null;\n        // it's not possible for the same frag to be removed\n        // twice, so if we have a pending stagger callback,\n        // it means this frag is queued for enter but removed\n        // before its transition started. Since it is already\n        // destroyed, we can just leave it in detached state.\n        return;\n      }\n      var staggerAmount = this.getStagger(frag, index, total, 'leave');\n      if (inDocument && staggerAmount) {\n        var op = frag.staggerCb = cancellable(function () {\n          frag.staggerCb = null;\n          frag.remove();\n        });\n        setTimeout(op, staggerAmount);\n      } else {\n        frag.remove();\n      }\n    },\n\n    /**\n     * Move a fragment to a new position.\n     * Force no transition.\n     *\n     * @param {Fragment} frag\n     * @param {Node} prevEl\n     */\n\n    move: function move(frag, prevEl) {\n      // fix a common issue with Sortable:\n      // if prevEl doesn't have nextSibling, this means it's\n      // been dragged after the end anchor. Just re-position\n      // the end anchor to the end of the container.\n      /* istanbul ignore if */\n      if (!prevEl.nextSibling) {\n        this.end.parentNode.appendChild(this.end);\n      }\n      frag.before(prevEl.nextSibling, false);\n    },\n\n    /**\n     * Cache a fragment using track-by or the object key.\n     *\n     * @param {*} value\n     * @param {Fragment} frag\n     * @param {Number} index\n     * @param {String} [key]\n     */\n\n    cacheFrag: function cacheFrag(value, frag, index, key) {\n      var trackByKey = this.params.trackBy;\n      var cache = this.cache;\n      var primitive = !isObject(value);\n      var id;\n      if (key || trackByKey || primitive) {\n        id = getTrackByKey(index, key, value, trackByKey);\n        if (!cache[id]) {\n          cache[id] = frag;\n        } else if (trackByKey !== '$index') {\n          'development' !== 'production' && this.warnDuplicate(value);\n        }\n      } else {\n        id = this.id;\n        if (hasOwn(value, id)) {\n          if (value[id] === null) {\n            value[id] = frag;\n          } else {\n            'development' !== 'production' && this.warnDuplicate(value);\n          }\n        } else if (Object.isExtensible(value)) {\n          def(value, id, frag);\n        } else if ('development' !== 'production') {\n          warn('Frozen v-for objects cannot be automatically tracked, make sure to ' + 'provide a track-by key.');\n        }\n      }\n      frag.raw = value;\n    },\n\n    /**\n     * Get a cached fragment from the value/index/key\n     *\n     * @param {*} value\n     * @param {Number} index\n     * @param {String} key\n     * @return {Fragment}\n     */\n\n    getCachedFrag: function getCachedFrag(value, index, key) {\n      var trackByKey = this.params.trackBy;\n      var primitive = !isObject(value);\n      var frag;\n      if (key || trackByKey || primitive) {\n        var id = getTrackByKey(index, key, value, trackByKey);\n        frag = this.cache[id];\n      } else {\n        frag = value[this.id];\n      }\n      if (frag && (frag.reused || frag.fresh)) {\n        'development' !== 'production' && this.warnDuplicate(value);\n      }\n      return frag;\n    },\n\n    /**\n     * Delete a fragment from cache.\n     *\n     * @param {Fragment} frag\n     */\n\n    deleteCachedFrag: function deleteCachedFrag(frag) {\n      var value = frag.raw;\n      var trackByKey = this.params.trackBy;\n      var scope = frag.scope;\n      var index = scope.$index;\n      // fix #948: avoid accidentally fall through to\n      // a parent repeater which happens to have $key.\n      var key = hasOwn(scope, '$key') && scope.$key;\n      var primitive = !isObject(value);\n      if (trackByKey || key || primitive) {\n        var id = getTrackByKey(index, key, value, trackByKey);\n        this.cache[id] = null;\n      } else {\n        value[this.id] = null;\n        frag.raw = null;\n      }\n    },\n\n    /**\n     * Get the stagger amount for an insertion/removal.\n     *\n     * @param {Fragment} frag\n     * @param {Number} index\n     * @param {Number} total\n     * @param {String} type\n     */\n\n    getStagger: function getStagger(frag, index, total, type) {\n      type = type + 'Stagger';\n      var trans = frag.node.__v_trans;\n      var hooks = trans && trans.hooks;\n      var hook = hooks && (hooks[type] || hooks.stagger);\n      return hook ? hook.call(frag, index, total) : index * parseInt(this.params[type] || this.params.stagger, 10);\n    },\n\n    /**\n     * Pre-process the value before piping it through the\n     * filters. This is passed to and called by the watcher.\n     */\n\n    _preProcess: function _preProcess(value) {\n      // regardless of type, store the un-filtered raw value.\n      this.rawValue = value;\n      return value;\n    },\n\n    /**\n     * Post-process the value after it has been piped through\n     * the filters. This is passed to and called by the watcher.\n     *\n     * It is necessary for this to be called during the\n     * watcher's dependency collection phase because we want\n     * the v-for to update when the source Object is mutated.\n     */\n\n    _postProcess: function _postProcess(value) {\n      if (isArray(value)) {\n        return value;\n      } else if (isPlainObject(value)) {\n        // convert plain object to array.\n        var keys = Object.keys(value);\n        var i = keys.length;\n        var res = new Array(i);\n        var key;\n        while (i--) {\n          key = keys[i];\n          res[i] = {\n            $key: key,\n            $value: value[key]\n          };\n        }\n        return res;\n      } else {\n        if (typeof value === 'number' && !isNaN(value)) {\n          value = range(value);\n        }\n        return value || [];\n      }\n    },\n\n    unbind: function unbind() {\n      if (this.descriptor.ref) {\n        (this._scope || this.vm).$refs[this.descriptor.ref] = null;\n      }\n      if (this.frags) {\n        var i = this.frags.length;\n        var frag;\n        while (i--) {\n          frag = this.frags[i];\n          this.deleteCachedFrag(frag);\n          frag.destroy();\n        }\n      }\n    }\n  };\n\n  /**\n   * Helper to find the previous element that is a fragment\n   * anchor. This is necessary because a destroyed frag's\n   * element could still be lingering in the DOM before its\n   * leaving transition finishes, but its inserted flag\n   * should have been set to false so we can skip them.\n   *\n   * If this is a block repeat, we want to make sure we only\n   * return frag that is bound to this v-for. (see #929)\n   *\n   * @param {Fragment} frag\n   * @param {Comment|Text} anchor\n   * @param {String} id\n   * @return {Fragment}\n   */\n\n  function findPrevFrag(frag, anchor, id) {\n    var el = frag.node.previousSibling;\n    /* istanbul ignore if */\n    if (!el) return;\n    frag = el.__v_frag;\n    while ((!frag || frag.forId !== id || !frag.inserted) && el !== anchor) {\n      el = el.previousSibling;\n      /* istanbul ignore if */\n      if (!el) return;\n      frag = el.__v_frag;\n    }\n    return frag;\n  }\n\n  /**\n   * Find a vm from a fragment.\n   *\n   * @param {Fragment} frag\n   * @return {Vue|undefined}\n   */\n\n  function findVmFromFrag(frag) {\n    var node = frag.node;\n    // handle multi-node frag\n    if (frag.end) {\n      while (!node.__vue__ && node !== frag.end && node.nextSibling) {\n        node = node.nextSibling;\n      }\n    }\n    return node.__vue__;\n  }\n\n  /**\n   * Create a range array from given number.\n   *\n   * @param {Number} n\n   * @return {Array}\n   */\n\n  function range(n) {\n    var i = -1;\n    var ret = new Array(Math.floor(n));\n    while (++i < n) {\n      ret[i] = i;\n    }\n    return ret;\n  }\n\n  /**\n   * Get the track by key for an item.\n   *\n   * @param {Number} index\n   * @param {String} key\n   * @param {*} value\n   * @param {String} [trackByKey]\n   */\n\n  function getTrackByKey(index, key, value, trackByKey) {\n    return trackByKey ? trackByKey === '$index' ? index : trackByKey.charAt(0).match(/\\w/) ? getPath(value, trackByKey) : value[trackByKey] : key || value;\n  }\n\n  if ('development' !== 'production') {\n    vFor.warnDuplicate = function (value) {\n      warn('Duplicate value found in v-for=\"' + this.descriptor.raw + '\": ' + JSON.stringify(value) + '. Use track-by=\"$index\" if ' + 'you are expecting duplicate values.', this.vm);\n    };\n  }\n\n  var vIf = {\n\n    priority: IF,\n    terminal: true,\n\n    bind: function bind() {\n      var el = this.el;\n      if (!el.__vue__) {\n        // check else block\n        var next = el.nextElementSibling;\n        if (next && getAttr(next, 'v-else') !== null) {\n          remove(next);\n          this.elseEl = next;\n        }\n        // check main block\n        this.anchor = createAnchor('v-if');\n        replace(el, this.anchor);\n      } else {\n        'development' !== 'production' && warn('v-if=\"' + this.expression + '\" cannot be ' + 'used on an instance root element.', this.vm);\n        this.invalid = true;\n      }\n    },\n\n    update: function update(value) {\n      if (this.invalid) return;\n      if (value) {\n        if (!this.frag) {\n          this.insert();\n        }\n      } else {\n        this.remove();\n      }\n    },\n\n    insert: function insert() {\n      if (this.elseFrag) {\n        this.elseFrag.remove();\n        this.elseFrag = null;\n      }\n      // lazy init factory\n      if (!this.factory) {\n        this.factory = new FragmentFactory(this.vm, this.el);\n      }\n      this.frag = this.factory.create(this._host, this._scope, this._frag);\n      this.frag.before(this.anchor);\n    },\n\n    remove: function remove() {\n      if (this.frag) {\n        this.frag.remove();\n        this.frag = null;\n      }\n      if (this.elseEl && !this.elseFrag) {\n        if (!this.elseFactory) {\n          this.elseFactory = new FragmentFactory(this.elseEl._context || this.vm, this.elseEl);\n        }\n        this.elseFrag = this.elseFactory.create(this._host, this._scope, this._frag);\n        this.elseFrag.before(this.anchor);\n      }\n    },\n\n    unbind: function unbind() {\n      if (this.frag) {\n        this.frag.destroy();\n      }\n      if (this.elseFrag) {\n        this.elseFrag.destroy();\n      }\n    }\n  };\n\n  var show = {\n\n    bind: function bind() {\n      // check else block\n      var next = this.el.nextElementSibling;\n      if (next && getAttr(next, 'v-else') !== null) {\n        this.elseEl = next;\n      }\n    },\n\n    update: function update(value) {\n      this.apply(this.el, value);\n      if (this.elseEl) {\n        this.apply(this.elseEl, !value);\n      }\n    },\n\n    apply: function apply(el, value) {\n      if (inDoc(el)) {\n        applyTransition(el, value ? 1 : -1, toggle, this.vm);\n      } else {\n        toggle();\n      }\n      function toggle() {\n        el.style.display = value ? '' : 'none';\n      }\n    }\n  };\n\n  var text$2 = {\n\n    bind: function bind() {\n      var self = this;\n      var el = this.el;\n      var isRange = el.type === 'range';\n      var lazy = this.params.lazy;\n      var number = this.params.number;\n      var debounce = this.params.debounce;\n\n      // handle composition events.\n      //   http://blog.evanyou.me/2014/01/03/composition-event/\n      // skip this for Android because it handles composition\n      // events quite differently. Android doesn't trigger\n      // composition events for language input methods e.g.\n      // Chinese, but instead triggers them for spelling\n      // suggestions... (see Discussion/#162)\n      var composing = false;\n      if (!isAndroid && !isRange) {\n        this.on('compositionstart', function () {\n          composing = true;\n        });\n        this.on('compositionend', function () {\n          composing = false;\n          // in IE11 the \"compositionend\" event fires AFTER\n          // the \"input\" event, so the input handler is blocked\n          // at the end... have to call it here.\n          //\n          // #1327: in lazy mode this is unecessary.\n          if (!lazy) {\n            self.listener();\n          }\n        });\n      }\n\n      // prevent messing with the input when user is typing,\n      // and force update on blur.\n      this.focused = false;\n      if (!isRange && !lazy) {\n        this.on('focus', function () {\n          self.focused = true;\n        });\n        this.on('blur', function () {\n          self.focused = false;\n          // do not sync value after fragment removal (#2017)\n          if (!self._frag || self._frag.inserted) {\n            self.rawListener();\n          }\n        });\n      }\n\n      // Now attach the main listener\n      this.listener = this.rawListener = function () {\n        if (composing || !self._bound) {\n          return;\n        }\n        var val = number || isRange ? toNumber(el.value) : el.value;\n        self.set(val);\n        // force update on next tick to avoid lock & same value\n        // also only update when user is not typing\n        nextTick(function () {\n          if (self._bound && !self.focused) {\n            self.update(self._watcher.value);\n          }\n        });\n      };\n\n      // apply debounce\n      if (debounce) {\n        this.listener = _debounce(this.listener, debounce);\n      }\n\n      // Support jQuery events, since jQuery.trigger() doesn't\n      // trigger native events in some cases and some plugins\n      // rely on $.trigger()\n      //\n      // We want to make sure if a listener is attached using\n      // jQuery, it is also removed with jQuery, that's why\n      // we do the check for each directive instance and\n      // store that check result on itself. This also allows\n      // easier test coverage control by unsetting the global\n      // jQuery variable in tests.\n      this.hasjQuery = typeof jQuery === 'function';\n      if (this.hasjQuery) {\n        var method = jQuery.fn.on ? 'on' : 'bind';\n        jQuery(el)[method]('change', this.rawListener);\n        if (!lazy) {\n          jQuery(el)[method]('input', this.listener);\n        }\n      } else {\n        this.on('change', this.rawListener);\n        if (!lazy) {\n          this.on('input', this.listener);\n        }\n      }\n\n      // IE9 doesn't fire input event on backspace/del/cut\n      if (!lazy && isIE9) {\n        this.on('cut', function () {\n          nextTick(self.listener);\n        });\n        this.on('keyup', function (e) {\n          if (e.keyCode === 46 || e.keyCode === 8) {\n            self.listener();\n          }\n        });\n      }\n\n      // set initial value if present\n      if (el.hasAttribute('value') || el.tagName === 'TEXTAREA' && el.value.trim()) {\n        this.afterBind = this.listener;\n      }\n    },\n\n    update: function update(value) {\n      // #3029 only update when the value changes. This prevent\n      // browsers from overwriting values like selectionStart\n      value = _toString(value);\n      if (value !== this.el.value) this.el.value = value;\n    },\n\n    unbind: function unbind() {\n      var el = this.el;\n      if (this.hasjQuery) {\n        var method = jQuery.fn.off ? 'off' : 'unbind';\n        jQuery(el)[method]('change', this.listener);\n        jQuery(el)[method]('input', this.listener);\n      }\n    }\n  };\n\n  var radio = {\n\n    bind: function bind() {\n      var self = this;\n      var el = this.el;\n\n      this.getValue = function () {\n        // value overwrite via v-bind:value\n        if (el.hasOwnProperty('_value')) {\n          return el._value;\n        }\n        var val = el.value;\n        if (self.params.number) {\n          val = toNumber(val);\n        }\n        return val;\n      };\n\n      this.listener = function () {\n        self.set(self.getValue());\n      };\n      this.on('change', this.listener);\n\n      if (el.hasAttribute('checked')) {\n        this.afterBind = this.listener;\n      }\n    },\n\n    update: function update(value) {\n      this.el.checked = looseEqual(value, this.getValue());\n    }\n  };\n\n  var select = {\n\n    bind: function bind() {\n      var _this = this;\n\n      var self = this;\n      var el = this.el;\n\n      // method to force update DOM using latest value.\n      this.forceUpdate = function () {\n        if (self._watcher) {\n          self.update(self._watcher.get());\n        }\n      };\n\n      // check if this is a multiple select\n      var multiple = this.multiple = el.hasAttribute('multiple');\n\n      // attach listener\n      this.listener = function () {\n        var value = getValue(el, multiple);\n        value = self.params.number ? isArray(value) ? value.map(toNumber) : toNumber(value) : value;\n        self.set(value);\n      };\n      this.on('change', this.listener);\n\n      // if has initial value, set afterBind\n      var initValue = getValue(el, multiple, true);\n      if (multiple && initValue.length || !multiple && initValue !== null) {\n        this.afterBind = this.listener;\n      }\n\n      // All major browsers except Firefox resets\n      // selectedIndex with value -1 to 0 when the element\n      // is appended to a new parent, therefore we have to\n      // force a DOM update whenever that happens...\n      this.vm.$on('hook:attached', function () {\n        nextTick(_this.forceUpdate);\n      });\n      if (!inDoc(el)) {\n        nextTick(this.forceUpdate);\n      }\n    },\n\n    update: function update(value) {\n      var el = this.el;\n      el.selectedIndex = -1;\n      var multi = this.multiple && isArray(value);\n      var options = el.options;\n      var i = options.length;\n      var op, val;\n      while (i--) {\n        op = options[i];\n        val = op.hasOwnProperty('_value') ? op._value : op.value;\n        /* eslint-disable eqeqeq */\n        op.selected = multi ? indexOf$1(value, val) > -1 : looseEqual(value, val);\n        /* eslint-enable eqeqeq */\n      }\n    },\n\n    unbind: function unbind() {\n      /* istanbul ignore next */\n      this.vm.$off('hook:attached', this.forceUpdate);\n    }\n  };\n\n  /**\n   * Get select value\n   *\n   * @param {SelectElement} el\n   * @param {Boolean} multi\n   * @param {Boolean} init\n   * @return {Array|*}\n   */\n\n  function getValue(el, multi, init) {\n    var res = multi ? [] : null;\n    var op, val, selected;\n    for (var i = 0, l = el.options.length; i < l; i++) {\n      op = el.options[i];\n      selected = init ? op.hasAttribute('selected') : op.selected;\n      if (selected) {\n        val = op.hasOwnProperty('_value') ? op._value : op.value;\n        if (multi) {\n          res.push(val);\n        } else {\n          return val;\n        }\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Native Array.indexOf uses strict equal, but in this\n   * case we need to match string/numbers with custom equal.\n   *\n   * @param {Array} arr\n   * @param {*} val\n   */\n\n  function indexOf$1(arr, val) {\n    var i = arr.length;\n    while (i--) {\n      if (looseEqual(arr[i], val)) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  var checkbox = {\n\n    bind: function bind() {\n      var self = this;\n      var el = this.el;\n\n      this.getValue = function () {\n        return el.hasOwnProperty('_value') ? el._value : self.params.number ? toNumber(el.value) : el.value;\n      };\n\n      function getBooleanValue() {\n        var val = el.checked;\n        if (val && el.hasOwnProperty('_trueValue')) {\n          return el._trueValue;\n        }\n        if (!val && el.hasOwnProperty('_falseValue')) {\n          return el._falseValue;\n        }\n        return val;\n      }\n\n      this.listener = function () {\n        var model = self._watcher.value;\n        if (isArray(model)) {\n          var val = self.getValue();\n          if (el.checked) {\n            if (indexOf(model, val) < 0) {\n              model.push(val);\n            }\n          } else {\n            model.$remove(val);\n          }\n        } else {\n          self.set(getBooleanValue());\n        }\n      };\n\n      this.on('change', this.listener);\n      if (el.hasAttribute('checked')) {\n        this.afterBind = this.listener;\n      }\n    },\n\n    update: function update(value) {\n      var el = this.el;\n      if (isArray(value)) {\n        el.checked = indexOf(value, this.getValue()) > -1;\n      } else {\n        if (el.hasOwnProperty('_trueValue')) {\n          el.checked = looseEqual(value, el._trueValue);\n        } else {\n          el.checked = !!value;\n        }\n      }\n    }\n  };\n\n  var handlers = {\n    text: text$2,\n    radio: radio,\n    select: select,\n    checkbox: checkbox\n  };\n\n  var model = {\n\n    priority: MODEL,\n    twoWay: true,\n    handlers: handlers,\n    params: ['lazy', 'number', 'debounce'],\n\n    /**\n     * Possible elements:\n     *   <select>\n     *   <textarea>\n     *   <input type=\"*\">\n     *     - text\n     *     - checkbox\n     *     - radio\n     *     - number\n     */\n\n    bind: function bind() {\n      // friendly warning...\n      this.checkFilters();\n      if (this.hasRead && !this.hasWrite) {\n        'development' !== 'production' && warn('It seems you are using a read-only filter with ' + 'v-model=\"' + this.descriptor.raw + '\". ' + 'You might want to use a two-way filter to ensure correct behavior.', this.vm);\n      }\n      var el = this.el;\n      var tag = el.tagName;\n      var handler;\n      if (tag === 'INPUT') {\n        handler = handlers[el.type] || handlers.text;\n      } else if (tag === 'SELECT') {\n        handler = handlers.select;\n      } else if (tag === 'TEXTAREA') {\n        handler = handlers.text;\n      } else {\n        'development' !== 'production' && warn('v-model does not support element type: ' + tag, this.vm);\n        return;\n      }\n      el.__v_model = this;\n      handler.bind.call(this);\n      this.update = handler.update;\n      this._unbind = handler.unbind;\n    },\n\n    /**\n     * Check read/write filter stats.\n     */\n\n    checkFilters: function checkFilters() {\n      var filters = this.filters;\n      if (!filters) return;\n      var i = filters.length;\n      while (i--) {\n        var filter = resolveAsset(this.vm.$options, 'filters', filters[i].name);\n        if (typeof filter === 'function' || filter.read) {\n          this.hasRead = true;\n        }\n        if (filter.write) {\n          this.hasWrite = true;\n        }\n      }\n    },\n\n    unbind: function unbind() {\n      this.el.__v_model = null;\n      this._unbind && this._unbind();\n    }\n  };\n\n  // keyCode aliases\n  var keyCodes = {\n    esc: 27,\n    tab: 9,\n    enter: 13,\n    space: 32,\n    'delete': [8, 46],\n    up: 38,\n    left: 37,\n    right: 39,\n    down: 40\n  };\n\n  function keyFilter(handler, keys) {\n    var codes = keys.map(function (key) {\n      var charCode = key.charCodeAt(0);\n      if (charCode > 47 && charCode < 58) {\n        return parseInt(key, 10);\n      }\n      if (key.length === 1) {\n        charCode = key.toUpperCase().charCodeAt(0);\n        if (charCode > 64 && charCode < 91) {\n          return charCode;\n        }\n      }\n      return keyCodes[key];\n    });\n    codes = [].concat.apply([], codes);\n    return function keyHandler(e) {\n      if (codes.indexOf(e.keyCode) > -1) {\n        return handler.call(this, e);\n      }\n    };\n  }\n\n  function stopFilter(handler) {\n    return function stopHandler(e) {\n      e.stopPropagation();\n      return handler.call(this, e);\n    };\n  }\n\n  function preventFilter(handler) {\n    return function preventHandler(e) {\n      e.preventDefault();\n      return handler.call(this, e);\n    };\n  }\n\n  function selfFilter(handler) {\n    return function selfHandler(e) {\n      if (e.target === e.currentTarget) {\n        return handler.call(this, e);\n      }\n    };\n  }\n\n  var on$1 = {\n\n    priority: ON,\n    acceptStatement: true,\n    keyCodes: keyCodes,\n\n    bind: function bind() {\n      // deal with iframes\n      if (this.el.tagName === 'IFRAME' && this.arg !== 'load') {\n        var self = this;\n        this.iframeBind = function () {\n          on(self.el.contentWindow, self.arg, self.handler, self.modifiers.capture);\n        };\n        this.on('load', this.iframeBind);\n      }\n    },\n\n    update: function update(handler) {\n      // stub a noop for v-on with no value,\n      // e.g. @mousedown.prevent\n      if (!this.descriptor.raw) {\n        handler = function () {};\n      }\n\n      if (typeof handler !== 'function') {\n        'development' !== 'production' && warn('v-on:' + this.arg + '=\"' + this.expression + '\" expects a function value, ' + 'got ' + handler, this.vm);\n        return;\n      }\n\n      // apply modifiers\n      if (this.modifiers.stop) {\n        handler = stopFilter(handler);\n      }\n      if (this.modifiers.prevent) {\n        handler = preventFilter(handler);\n      }\n      if (this.modifiers.self) {\n        handler = selfFilter(handler);\n      }\n      // key filter\n      var keys = Object.keys(this.modifiers).filter(function (key) {\n        return key !== 'stop' && key !== 'prevent' && key !== 'self' && key !== 'capture';\n      });\n      if (keys.length) {\n        handler = keyFilter(handler, keys);\n      }\n\n      this.reset();\n      this.handler = handler;\n\n      if (this.iframeBind) {\n        this.iframeBind();\n      } else {\n        on(this.el, this.arg, this.handler, this.modifiers.capture);\n      }\n    },\n\n    reset: function reset() {\n      var el = this.iframeBind ? this.el.contentWindow : this.el;\n      if (this.handler) {\n        off(el, this.arg, this.handler);\n      }\n    },\n\n    unbind: function unbind() {\n      this.reset();\n    }\n  };\n\n  var prefixes = ['-webkit-', '-moz-', '-ms-'];\n  var camelPrefixes = ['Webkit', 'Moz', 'ms'];\n  var importantRE = /!important;?$/;\n  var propCache = Object.create(null);\n\n  var testEl = null;\n\n  var style = {\n\n    deep: true,\n\n    update: function update(value) {\n      if (typeof value === 'string') {\n        this.el.style.cssText = value;\n      } else if (isArray(value)) {\n        this.handleObject(value.reduce(extend, {}));\n      } else {\n        this.handleObject(value || {});\n      }\n    },\n\n    handleObject: function handleObject(value) {\n      // cache object styles so that only changed props\n      // are actually updated.\n      var cache = this.cache || (this.cache = {});\n      var name, val;\n      for (name in cache) {\n        if (!(name in value)) {\n          this.handleSingle(name, null);\n          delete cache[name];\n        }\n      }\n      for (name in value) {\n        val = value[name];\n        if (val !== cache[name]) {\n          cache[name] = val;\n          this.handleSingle(name, val);\n        }\n      }\n    },\n\n    handleSingle: function handleSingle(prop, value) {\n      prop = normalize(prop);\n      if (!prop) return; // unsupported prop\n      // cast possible numbers/booleans into strings\n      if (value != null) value += '';\n      if (value) {\n        var isImportant = importantRE.test(value) ? 'important' : '';\n        if (isImportant) {\n          /* istanbul ignore if */\n          if ('development' !== 'production') {\n            warn('It\\'s probably a bad idea to use !important with inline rules. ' + 'This feature will be deprecated in a future version of Vue.');\n          }\n          value = value.replace(importantRE, '').trim();\n          this.el.style.setProperty(prop.kebab, value, isImportant);\n        } else {\n          this.el.style[prop.camel] = value;\n        }\n      } else {\n        this.el.style[prop.camel] = '';\n      }\n    }\n\n  };\n\n  /**\n   * Normalize a CSS property name.\n   * - cache result\n   * - auto prefix\n   * - camelCase -> dash-case\n   *\n   * @param {String} prop\n   * @return {String}\n   */\n\n  function normalize(prop) {\n    if (propCache[prop]) {\n      return propCache[prop];\n    }\n    var res = prefix(prop);\n    propCache[prop] = propCache[res] = res;\n    return res;\n  }\n\n  /**\n   * Auto detect the appropriate prefix for a CSS property.\n   * https://gist.github.com/paulirish/523692\n   *\n   * @param {String} prop\n   * @return {String}\n   */\n\n  function prefix(prop) {\n    prop = hyphenate(prop);\n    var camel = camelize(prop);\n    var upper = camel.charAt(0).toUpperCase() + camel.slice(1);\n    if (!testEl) {\n      testEl = document.createElement('div');\n    }\n    var i = prefixes.length;\n    var prefixed;\n    if (camel !== 'filter' && camel in testEl.style) {\n      return {\n        kebab: prop,\n        camel: camel\n      };\n    }\n    while (i--) {\n      prefixed = camelPrefixes[i] + upper;\n      if (prefixed in testEl.style) {\n        return {\n          kebab: prefixes[i] + prop,\n          camel: prefixed\n        };\n      }\n    }\n  }\n\n  // xlink\n  var xlinkNS = 'http://www.w3.org/1999/xlink';\n  var xlinkRE = /^xlink:/;\n\n  // check for attributes that prohibit interpolations\n  var disallowedInterpAttrRE = /^v-|^:|^@|^(?:is|transition|transition-mode|debounce|track-by|stagger|enter-stagger|leave-stagger)$/;\n  // these attributes should also set their corresponding properties\n  // because they only affect the initial state of the element\n  var attrWithPropsRE = /^(?:value|checked|selected|muted)$/;\n  // these attributes expect enumrated values of \"true\" or \"false\"\n  // but are not boolean attributes\n  var enumeratedAttrRE = /^(?:draggable|contenteditable|spellcheck)$/;\n\n  // these attributes should set a hidden property for\n  // binding v-model to object values\n  var modelProps = {\n    value: '_value',\n    'true-value': '_trueValue',\n    'false-value': '_falseValue'\n  };\n\n  var bind$1 = {\n\n    priority: BIND,\n\n    bind: function bind() {\n      var attr = this.arg;\n      var tag = this.el.tagName;\n      // should be deep watch on object mode\n      if (!attr) {\n        this.deep = true;\n      }\n      // handle interpolation bindings\n      var descriptor = this.descriptor;\n      var tokens = descriptor.interp;\n      if (tokens) {\n        // handle interpolations with one-time tokens\n        if (descriptor.hasOneTime) {\n          this.expression = tokensToExp(tokens, this._scope || this.vm);\n        }\n\n        // only allow binding on native attributes\n        if (disallowedInterpAttrRE.test(attr) || attr === 'name' && (tag === 'PARTIAL' || tag === 'SLOT')) {\n          'development' !== 'production' && warn(attr + '=\"' + descriptor.raw + '\": ' + 'attribute interpolation is not allowed in Vue.js ' + 'directives and special attributes.', this.vm);\n          this.el.removeAttribute(attr);\n          this.invalid = true;\n        }\n\n        /* istanbul ignore if */\n        if ('development' !== 'production') {\n          var raw = attr + '=\"' + descriptor.raw + '\": ';\n          // warn src\n          if (attr === 'src') {\n            warn(raw + 'interpolation in \"src\" attribute will cause ' + 'a 404 request. Use v-bind:src instead.', this.vm);\n          }\n\n          // warn style\n          if (attr === 'style') {\n            warn(raw + 'interpolation in \"style\" attribute will cause ' + 'the attribute to be discarded in Internet Explorer. ' + 'Use v-bind:style instead.', this.vm);\n          }\n        }\n      }\n    },\n\n    update: function update(value) {\n      if (this.invalid) {\n        return;\n      }\n      var attr = this.arg;\n      if (this.arg) {\n        this.handleSingle(attr, value);\n      } else {\n        this.handleObject(value || {});\n      }\n    },\n\n    // share object handler with v-bind:class\n    handleObject: style.handleObject,\n\n    handleSingle: function handleSingle(attr, value) {\n      var el = this.el;\n      var interp = this.descriptor.interp;\n      if (this.modifiers.camel) {\n        attr = camelize(attr);\n      }\n      if (!interp && attrWithPropsRE.test(attr) && attr in el) {\n        var attrValue = attr === 'value' ? value == null // IE9 will set input.value to \"null\" for null...\n        ? '' : value : value;\n\n        if (el[attr] !== attrValue) {\n          el[attr] = attrValue;\n        }\n      }\n      // set model props\n      var modelProp = modelProps[attr];\n      if (!interp && modelProp) {\n        el[modelProp] = value;\n        // update v-model if present\n        var model = el.__v_model;\n        if (model) {\n          model.listener();\n        }\n      }\n      // do not set value attribute for textarea\n      if (attr === 'value' && el.tagName === 'TEXTAREA') {\n        el.removeAttribute(attr);\n        return;\n      }\n      // update attribute\n      if (enumeratedAttrRE.test(attr)) {\n        el.setAttribute(attr, value ? 'true' : 'false');\n      } else if (value != null && value !== false) {\n        if (attr === 'class') {\n          // handle edge case #1960:\n          // class interpolation should not overwrite Vue transition class\n          if (el.__v_trans) {\n            value += ' ' + el.__v_trans.id + '-transition';\n          }\n          setClass(el, value);\n        } else if (xlinkRE.test(attr)) {\n          el.setAttributeNS(xlinkNS, attr, value === true ? '' : value);\n        } else {\n          el.setAttribute(attr, value === true ? '' : value);\n        }\n      } else {\n        el.removeAttribute(attr);\n      }\n    }\n  };\n\n  var el = {\n\n    priority: EL,\n\n    bind: function bind() {\n      /* istanbul ignore if */\n      if (!this.arg) {\n        return;\n      }\n      var id = this.id = camelize(this.arg);\n      var refs = (this._scope || this.vm).$els;\n      if (hasOwn(refs, id)) {\n        refs[id] = this.el;\n      } else {\n        defineReactive(refs, id, this.el);\n      }\n    },\n\n    unbind: function unbind() {\n      var refs = (this._scope || this.vm).$els;\n      if (refs[this.id] === this.el) {\n        refs[this.id] = null;\n      }\n    }\n  };\n\n  var ref = {\n    bind: function bind() {\n      'development' !== 'production' && warn('v-ref:' + this.arg + ' must be used on a child ' + 'component. Found on <' + this.el.tagName.toLowerCase() + '>.', this.vm);\n    }\n  };\n\n  var cloak = {\n    bind: function bind() {\n      var el = this.el;\n      this.vm.$once('pre-hook:compiled', function () {\n        el.removeAttribute('v-cloak');\n      });\n    }\n  };\n\n  // must export plain object\n  var directives = {\n    text: text$1,\n    html: html,\n    'for': vFor,\n    'if': vIf,\n    show: show,\n    model: model,\n    on: on$1,\n    bind: bind$1,\n    el: el,\n    ref: ref,\n    cloak: cloak\n  };\n\n  var vClass = {\n\n    deep: true,\n\n    update: function update(value) {\n      if (!value) {\n        this.cleanup();\n      } else if (typeof value === 'string') {\n        this.setClass(value.trim().split(/\\s+/));\n      } else {\n        this.setClass(normalize$1(value));\n      }\n    },\n\n    setClass: function setClass(value) {\n      this.cleanup(value);\n      for (var i = 0, l = value.length; i < l; i++) {\n        var val = value[i];\n        if (val) {\n          apply(this.el, val, addClass);\n        }\n      }\n      this.prevKeys = value;\n    },\n\n    cleanup: function cleanup(value) {\n      var prevKeys = this.prevKeys;\n      if (!prevKeys) return;\n      var i = prevKeys.length;\n      while (i--) {\n        var key = prevKeys[i];\n        if (!value || value.indexOf(key) < 0) {\n          apply(this.el, key, removeClass);\n        }\n      }\n    }\n  };\n\n  /**\n   * Normalize objects and arrays (potentially containing objects)\n   * into array of strings.\n   *\n   * @param {Object|Array<String|Object>} value\n   * @return {Array<String>}\n   */\n\n  function normalize$1(value) {\n    var res = [];\n    if (isArray(value)) {\n      for (var i = 0, l = value.length; i < l; i++) {\n        var _key = value[i];\n        if (_key) {\n          if (typeof _key === 'string') {\n            res.push(_key);\n          } else {\n            for (var k in _key) {\n              if (_key[k]) res.push(k);\n            }\n          }\n        }\n      }\n    } else if (isObject(value)) {\n      for (var key in value) {\n        if (value[key]) res.push(key);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Add or remove a class/classes on an element\n   *\n   * @param {Element} el\n   * @param {String} key The class name. This may or may not\n   *                     contain a space character, in such a\n   *                     case we'll deal with multiple class\n   *                     names at once.\n   * @param {Function} fn\n   */\n\n  function apply(el, key, fn) {\n    key = key.trim();\n    if (key.indexOf(' ') === -1) {\n      fn(el, key);\n      return;\n    }\n    // The key contains one or more space characters.\n    // Since a class name doesn't accept such characters, we\n    // treat it as multiple classes.\n    var keys = key.split(/\\s+/);\n    for (var i = 0, l = keys.length; i < l; i++) {\n      fn(el, keys[i]);\n    }\n  }\n\n  var component = {\n\n    priority: COMPONENT,\n\n    params: ['keep-alive', 'transition-mode', 'inline-template'],\n\n    /**\n     * Setup. Two possible usages:\n     *\n     * - static:\n     *   <comp> or <div v-component=\"comp\">\n     *\n     * - dynamic:\n     *   <component :is=\"view\">\n     */\n\n    bind: function bind() {\n      if (!this.el.__vue__) {\n        // keep-alive cache\n        this.keepAlive = this.params.keepAlive;\n        if (this.keepAlive) {\n          this.cache = {};\n        }\n        // check inline-template\n        if (this.params.inlineTemplate) {\n          // extract inline template as a DocumentFragment\n          this.inlineTemplate = extractContent(this.el, true);\n        }\n        // component resolution related state\n        this.pendingComponentCb = this.Component = null;\n        // transition related state\n        this.pendingRemovals = 0;\n        this.pendingRemovalCb = null;\n        // create a ref anchor\n        this.anchor = createAnchor('v-component');\n        replace(this.el, this.anchor);\n        // remove is attribute.\n        // this is removed during compilation, but because compilation is\n        // cached, when the component is used elsewhere this attribute\n        // will remain at link time.\n        this.el.removeAttribute('is');\n        this.el.removeAttribute(':is');\n        // remove ref, same as above\n        if (this.descriptor.ref) {\n          this.el.removeAttribute('v-ref:' + hyphenate(this.descriptor.ref));\n        }\n        // if static, build right now.\n        if (this.literal) {\n          this.setComponent(this.expression);\n        }\n      } else {\n        'development' !== 'production' && warn('cannot mount component \"' + this.expression + '\" ' + 'on already mounted element: ' + this.el);\n      }\n    },\n\n    /**\n     * Public update, called by the watcher in the dynamic\n     * literal scenario, e.g. <component :is=\"view\">\n     */\n\n    update: function update(value) {\n      if (!this.literal) {\n        this.setComponent(value);\n      }\n    },\n\n    /**\n     * Switch dynamic components. May resolve the component\n     * asynchronously, and perform transition based on\n     * specified transition mode. Accepts a few additional\n     * arguments specifically for vue-router.\n     *\n     * The callback is called when the full transition is\n     * finished.\n     *\n     * @param {String} value\n     * @param {Function} [cb]\n     */\n\n    setComponent: function setComponent(value, cb) {\n      this.invalidatePending();\n      if (!value) {\n        // just remove current\n        this.unbuild(true);\n        this.remove(this.childVM, cb);\n        this.childVM = null;\n      } else {\n        var self = this;\n        this.resolveComponent(value, function () {\n          self.mountComponent(cb);\n        });\n      }\n    },\n\n    /**\n     * Resolve the component constructor to use when creating\n     * the child vm.\n     *\n     * @param {String|Function} value\n     * @param {Function} cb\n     */\n\n    resolveComponent: function resolveComponent(value, cb) {\n      var self = this;\n      this.pendingComponentCb = cancellable(function (Component) {\n        self.ComponentName = Component.options.name || (typeof value === 'string' ? value : null);\n        self.Component = Component;\n        cb();\n      });\n      this.vm._resolveComponent(value, this.pendingComponentCb);\n    },\n\n    /**\n     * Create a new instance using the current constructor and\n     * replace the existing instance. This method doesn't care\n     * whether the new component and the old one are actually\n     * the same.\n     *\n     * @param {Function} [cb]\n     */\n\n    mountComponent: function mountComponent(cb) {\n      // actual mount\n      this.unbuild(true);\n      var self = this;\n      var activateHooks = this.Component.options.activate;\n      var cached = this.getCached();\n      var newComponent = this.build();\n      if (activateHooks && !cached) {\n        this.waitingFor = newComponent;\n        callActivateHooks(activateHooks, newComponent, function () {\n          if (self.waitingFor !== newComponent) {\n            return;\n          }\n          self.waitingFor = null;\n          self.transition(newComponent, cb);\n        });\n      } else {\n        // update ref for kept-alive component\n        if (cached) {\n          newComponent._updateRef();\n        }\n        this.transition(newComponent, cb);\n      }\n    },\n\n    /**\n     * When the component changes or unbinds before an async\n     * constructor is resolved, we need to invalidate its\n     * pending callback.\n     */\n\n    invalidatePending: function invalidatePending() {\n      if (this.pendingComponentCb) {\n        this.pendingComponentCb.cancel();\n        this.pendingComponentCb = null;\n      }\n    },\n\n    /**\n     * Instantiate/insert a new child vm.\n     * If keep alive and has cached instance, insert that\n     * instance; otherwise build a new one and cache it.\n     *\n     * @param {Object} [extraOptions]\n     * @return {Vue} - the created instance\n     */\n\n    build: function build(extraOptions) {\n      var cached = this.getCached();\n      if (cached) {\n        return cached;\n      }\n      if (this.Component) {\n        // default options\n        var options = {\n          name: this.ComponentName,\n          el: cloneNode(this.el),\n          template: this.inlineTemplate,\n          // make sure to add the child with correct parent\n          // if this is a transcluded component, its parent\n          // should be the transclusion host.\n          parent: this._host || this.vm,\n          // if no inline-template, then the compiled\n          // linker can be cached for better performance.\n          _linkerCachable: !this.inlineTemplate,\n          _ref: this.descriptor.ref,\n          _asComponent: true,\n          _isRouterView: this._isRouterView,\n          // if this is a transcluded component, context\n          // will be the common parent vm of this instance\n          // and its host.\n          _context: this.vm,\n          // if this is inside an inline v-for, the scope\n          // will be the intermediate scope created for this\n          // repeat fragment. this is used for linking props\n          // and container directives.\n          _scope: this._scope,\n          // pass in the owner fragment of this component.\n          // this is necessary so that the fragment can keep\n          // track of its contained components in order to\n          // call attach/detach hooks for them.\n          _frag: this._frag\n        };\n        // extra options\n        // in 1.0.0 this is used by vue-router only\n        /* istanbul ignore if */\n        if (extraOptions) {\n          extend(options, extraOptions);\n        }\n        var child = new this.Component(options);\n        if (this.keepAlive) {\n          this.cache[this.Component.cid] = child;\n        }\n        /* istanbul ignore if */\n        if ('development' !== 'production' && this.el.hasAttribute('transition') && child._isFragment) {\n          warn('Transitions will not work on a fragment instance. ' + 'Template: ' + child.$options.template, child);\n        }\n        return child;\n      }\n    },\n\n    /**\n     * Try to get a cached instance of the current component.\n     *\n     * @return {Vue|undefined}\n     */\n\n    getCached: function getCached() {\n      return this.keepAlive && this.cache[this.Component.cid];\n    },\n\n    /**\n     * Teardown the current child, but defers cleanup so\n     * that we can separate the destroy and removal steps.\n     *\n     * @param {Boolean} defer\n     */\n\n    unbuild: function unbuild(defer) {\n      if (this.waitingFor) {\n        if (!this.keepAlive) {\n          this.waitingFor.$destroy();\n        }\n        this.waitingFor = null;\n      }\n      var child = this.childVM;\n      if (!child || this.keepAlive) {\n        if (child) {\n          // remove ref\n          child._inactive = true;\n          child._updateRef(true);\n        }\n        return;\n      }\n      // the sole purpose of `deferCleanup` is so that we can\n      // \"deactivate\" the vm right now and perform DOM removal\n      // later.\n      child.$destroy(false, defer);\n    },\n\n    /**\n     * Remove current destroyed child and manually do\n     * the cleanup after removal.\n     *\n     * @param {Function} cb\n     */\n\n    remove: function remove(child, cb) {\n      var keepAlive = this.keepAlive;\n      if (child) {\n        // we may have a component switch when a previous\n        // component is still being transitioned out.\n        // we want to trigger only one lastest insertion cb\n        // when the existing transition finishes. (#1119)\n        this.pendingRemovals++;\n        this.pendingRemovalCb = cb;\n        var self = this;\n        child.$remove(function () {\n          self.pendingRemovals--;\n          if (!keepAlive) child._cleanup();\n          if (!self.pendingRemovals && self.pendingRemovalCb) {\n            self.pendingRemovalCb();\n            self.pendingRemovalCb = null;\n          }\n        });\n      } else if (cb) {\n        cb();\n      }\n    },\n\n    /**\n     * Actually swap the components, depending on the\n     * transition mode. Defaults to simultaneous.\n     *\n     * @param {Vue} target\n     * @param {Function} [cb]\n     */\n\n    transition: function transition(target, cb) {\n      var self = this;\n      var current = this.childVM;\n      // for devtool inspection\n      if (current) current._inactive = true;\n      target._inactive = false;\n      this.childVM = target;\n      switch (self.params.transitionMode) {\n        case 'in-out':\n          target.$before(self.anchor, function () {\n            self.remove(current, cb);\n          });\n          break;\n        case 'out-in':\n          self.remove(current, function () {\n            target.$before(self.anchor, cb);\n          });\n          break;\n        default:\n          self.remove(current);\n          target.$before(self.anchor, cb);\n      }\n    },\n\n    /**\n     * Unbind.\n     */\n\n    unbind: function unbind() {\n      this.invalidatePending();\n      // Do not defer cleanup when unbinding\n      this.unbuild();\n      // destroy all keep-alive cached instances\n      if (this.cache) {\n        for (var key in this.cache) {\n          this.cache[key].$destroy();\n        }\n        this.cache = null;\n      }\n    }\n  };\n\n  /**\n   * Call activate hooks in order (asynchronous)\n   *\n   * @param {Array} hooks\n   * @param {Vue} vm\n   * @param {Function} cb\n   */\n\n  function callActivateHooks(hooks, vm, cb) {\n    var total = hooks.length;\n    var called = 0;\n    hooks[0].call(vm, next);\n    function next() {\n      if (++called >= total) {\n        cb();\n      } else {\n        hooks[called].call(vm, next);\n      }\n    }\n  }\n\n  var propBindingModes = config._propBindingModes;\n  var empty = {};\n\n  // regexes\n  var identRE$1 = /^[$_a-zA-Z]+[\\w$]*$/;\n  var settablePathRE = /^[A-Za-z_$][\\w$]*(\\.[A-Za-z_$][\\w$]*|\\[[^\\[\\]]+\\])*$/;\n\n  /**\n   * Compile props on a root element and return\n   * a props link function.\n   *\n   * @param {Element|DocumentFragment} el\n   * @param {Array} propOptions\n   * @param {Vue} vm\n   * @return {Function} propsLinkFn\n   */\n\n  function compileProps(el, propOptions, vm) {\n    var props = [];\n    var names = Object.keys(propOptions);\n    var i = names.length;\n    var options, name, attr, value, path, parsed, prop;\n    while (i--) {\n      name = names[i];\n      options = propOptions[name] || empty;\n\n      if ('development' !== 'production' && name === '$data') {\n        warn('Do not use $data as prop.', vm);\n        continue;\n      }\n\n      // props could contain dashes, which will be\n      // interpreted as minus calculations by the parser\n      // so we need to camelize the path here\n      path = camelize(name);\n      if (!identRE$1.test(path)) {\n        'development' !== 'production' && warn('Invalid prop key: \"' + name + '\". Prop keys ' + 'must be valid identifiers.', vm);\n        continue;\n      }\n\n      prop = {\n        name: name,\n        path: path,\n        options: options,\n        mode: propBindingModes.ONE_WAY,\n        raw: null\n      };\n\n      attr = hyphenate(name);\n      // first check dynamic version\n      if ((value = getBindAttr(el, attr)) === null) {\n        if ((value = getBindAttr(el, attr + '.sync')) !== null) {\n          prop.mode = propBindingModes.TWO_WAY;\n        } else if ((value = getBindAttr(el, attr + '.once')) !== null) {\n          prop.mode = propBindingModes.ONE_TIME;\n        }\n      }\n      if (value !== null) {\n        // has dynamic binding!\n        prop.raw = value;\n        parsed = parseDirective(value);\n        value = parsed.expression;\n        prop.filters = parsed.filters;\n        // check binding type\n        if (isLiteral(value) && !parsed.filters) {\n          // for expressions containing literal numbers and\n          // booleans, there's no need to setup a prop binding,\n          // so we can optimize them as a one-time set.\n          prop.optimizedLiteral = true;\n        } else {\n          prop.dynamic = true;\n          // check non-settable path for two-way bindings\n          if ('development' !== 'production' && prop.mode === propBindingModes.TWO_WAY && !settablePathRE.test(value)) {\n            prop.mode = propBindingModes.ONE_WAY;\n            warn('Cannot bind two-way prop with non-settable ' + 'parent path: ' + value, vm);\n          }\n        }\n        prop.parentPath = value;\n\n        // warn required two-way\n        if ('development' !== 'production' && options.twoWay && prop.mode !== propBindingModes.TWO_WAY) {\n          warn('Prop \"' + name + '\" expects a two-way binding type.', vm);\n        }\n      } else if ((value = getAttr(el, attr)) !== null) {\n        // has literal binding!\n        prop.raw = value;\n      } else if ('development' !== 'production') {\n        // check possible camelCase prop usage\n        var lowerCaseName = path.toLowerCase();\n        value = /[A-Z\\-]/.test(name) && (el.getAttribute(lowerCaseName) || el.getAttribute(':' + lowerCaseName) || el.getAttribute('v-bind:' + lowerCaseName) || el.getAttribute(':' + lowerCaseName + '.once') || el.getAttribute('v-bind:' + lowerCaseName + '.once') || el.getAttribute(':' + lowerCaseName + '.sync') || el.getAttribute('v-bind:' + lowerCaseName + '.sync'));\n        if (value) {\n          warn('Possible usage error for prop `' + lowerCaseName + '` - ' + 'did you mean `' + attr + '`? HTML is case-insensitive, remember to use ' + 'kebab-case for props in templates.', vm);\n        } else if (options.required) {\n          // warn missing required\n          warn('Missing required prop: ' + name, vm);\n        }\n      }\n      // push prop\n      props.push(prop);\n    }\n    return makePropsLinkFn(props);\n  }\n\n  /**\n   * Build a function that applies props to a vm.\n   *\n   * @param {Array} props\n   * @return {Function} propsLinkFn\n   */\n\n  function makePropsLinkFn(props) {\n    return function propsLinkFn(vm, scope) {\n      // store resolved props info\n      vm._props = {};\n      var inlineProps = vm.$options.propsData;\n      var i = props.length;\n      var prop, path, options, value, raw;\n      while (i--) {\n        prop = props[i];\n        raw = prop.raw;\n        path = prop.path;\n        options = prop.options;\n        vm._props[path] = prop;\n        if (inlineProps && hasOwn(inlineProps, path)) {\n          initProp(vm, prop, inlineProps[path]);\n        }if (raw === null) {\n          // initialize absent prop\n          initProp(vm, prop, undefined);\n        } else if (prop.dynamic) {\n          // dynamic prop\n          if (prop.mode === propBindingModes.ONE_TIME) {\n            // one time binding\n            value = (scope || vm._context || vm).$get(prop.parentPath);\n            initProp(vm, prop, value);\n          } else {\n            if (vm._context) {\n              // dynamic binding\n              vm._bindDir({\n                name: 'prop',\n                def: propDef,\n                prop: prop\n              }, null, null, scope); // el, host, scope\n            } else {\n                // root instance\n                initProp(vm, prop, vm.$get(prop.parentPath));\n              }\n          }\n        } else if (prop.optimizedLiteral) {\n          // optimized literal, cast it and just set once\n          var stripped = stripQuotes(raw);\n          value = stripped === raw ? toBoolean(toNumber(raw)) : stripped;\n          initProp(vm, prop, value);\n        } else {\n          // string literal, but we need to cater for\n          // Boolean props with no value, or with same\n          // literal value (e.g. disabled=\"disabled\")\n          // see https://github.com/vuejs/vue-loader/issues/182\n          value = options.type === Boolean && (raw === '' || raw === hyphenate(prop.name)) ? true : raw;\n          initProp(vm, prop, value);\n        }\n      }\n    };\n  }\n\n  /**\n   * Process a prop with a rawValue, applying necessary coersions,\n   * default values & assertions and call the given callback with\n   * processed value.\n   *\n   * @param {Vue} vm\n   * @param {Object} prop\n   * @param {*} rawValue\n   * @param {Function} fn\n   */\n\n  function processPropValue(vm, prop, rawValue, fn) {\n    var isSimple = prop.dynamic && isSimplePath(prop.parentPath);\n    var value = rawValue;\n    if (value === undefined) {\n      value = getPropDefaultValue(vm, prop);\n    }\n    value = coerceProp(prop, value, vm);\n    var coerced = value !== rawValue;\n    if (!assertProp(prop, value, vm)) {\n      value = undefined;\n    }\n    if (isSimple && !coerced) {\n      withoutConversion(function () {\n        fn(value);\n      });\n    } else {\n      fn(value);\n    }\n  }\n\n  /**\n   * Set a prop's initial value on a vm and its data object.\n   *\n   * @param {Vue} vm\n   * @param {Object} prop\n   * @param {*} value\n   */\n\n  function initProp(vm, prop, value) {\n    processPropValue(vm, prop, value, function (value) {\n      defineReactive(vm, prop.path, value);\n    });\n  }\n\n  /**\n   * Update a prop's value on a vm.\n   *\n   * @param {Vue} vm\n   * @param {Object} prop\n   * @param {*} value\n   */\n\n  function updateProp(vm, prop, value) {\n    processPropValue(vm, prop, value, function (value) {\n      vm[prop.path] = value;\n    });\n  }\n\n  /**\n   * Get the default value of a prop.\n   *\n   * @param {Vue} vm\n   * @param {Object} prop\n   * @return {*}\n   */\n\n  function getPropDefaultValue(vm, prop) {\n    // no default, return undefined\n    var options = prop.options;\n    if (!hasOwn(options, 'default')) {\n      // absent boolean value defaults to false\n      return options.type === Boolean ? false : undefined;\n    }\n    var def = options['default'];\n    // warn against non-factory defaults for Object & Array\n    if (isObject(def)) {\n      'development' !== 'production' && warn('Invalid default value for prop \"' + prop.name + '\": ' + 'Props with type Object/Array must use a factory function ' + 'to return the default value.', vm);\n    }\n    // call factory function for non-Function types\n    return typeof def === 'function' && options.type !== Function ? def.call(vm) : def;\n  }\n\n  /**\n   * Assert whether a prop is valid.\n   *\n   * @param {Object} prop\n   * @param {*} value\n   * @param {Vue} vm\n   */\n\n  function assertProp(prop, value, vm) {\n    if (!prop.options.required && ( // non-required\n    prop.raw === null || // abscent\n    value == null) // null or undefined\n    ) {\n        return true;\n      }\n    var options = prop.options;\n    var type = options.type;\n    var valid = !type;\n    var expectedTypes = [];\n    if (type) {\n      if (!isArray(type)) {\n        type = [type];\n      }\n      for (var i = 0; i < type.length && !valid; i++) {\n        var assertedType = assertType(value, type[i]);\n        expectedTypes.push(assertedType.expectedType);\n        valid = assertedType.valid;\n      }\n    }\n    if (!valid) {\n      if ('development' !== 'production') {\n        warn('Invalid prop: type check failed for prop \"' + prop.name + '\".' + ' Expected ' + expectedTypes.map(formatType).join(', ') + ', got ' + formatValue(value) + '.', vm);\n      }\n      return false;\n    }\n    var validator = options.validator;\n    if (validator) {\n      if (!validator(value)) {\n        'development' !== 'production' && warn('Invalid prop: custom validator check failed for prop \"' + prop.name + '\".', vm);\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Force parsing value with coerce option.\n   *\n   * @param {*} value\n   * @param {Object} options\n   * @return {*}\n   */\n\n  function coerceProp(prop, value, vm) {\n    var coerce = prop.options.coerce;\n    if (!coerce) {\n      return value;\n    }\n    if (typeof coerce === 'function') {\n      return coerce(value);\n    } else {\n      'development' !== 'production' && warn('Invalid coerce for prop \"' + prop.name + '\": expected function, got ' + typeof coerce + '.', vm);\n      return value;\n    }\n  }\n\n  /**\n   * Assert the type of a value\n   *\n   * @param {*} value\n   * @param {Function} type\n   * @return {Object}\n   */\n\n  function assertType(value, type) {\n    var valid;\n    var expectedType;\n    if (type === String) {\n      expectedType = 'string';\n      valid = typeof value === expectedType;\n    } else if (type === Number) {\n      expectedType = 'number';\n      valid = typeof value === expectedType;\n    } else if (type === Boolean) {\n      expectedType = 'boolean';\n      valid = typeof value === expectedType;\n    } else if (type === Function) {\n      expectedType = 'function';\n      valid = typeof value === expectedType;\n    } else if (type === Object) {\n      expectedType = 'object';\n      valid = isPlainObject(value);\n    } else if (type === Array) {\n      expectedType = 'array';\n      valid = isArray(value);\n    } else {\n      valid = value instanceof type;\n    }\n    return {\n      valid: valid,\n      expectedType: expectedType\n    };\n  }\n\n  /**\n   * Format type for output\n   *\n   * @param {String} type\n   * @return {String}\n   */\n\n  function formatType(type) {\n    return type ? type.charAt(0).toUpperCase() + type.slice(1) : 'custom type';\n  }\n\n  /**\n   * Format value\n   *\n   * @param {*} value\n   * @return {String}\n   */\n\n  function formatValue(val) {\n    return Object.prototype.toString.call(val).slice(8, -1);\n  }\n\n  var bindingModes = config._propBindingModes;\n\n  var propDef = {\n\n    bind: function bind() {\n      var child = this.vm;\n      var parent = child._context;\n      // passed in from compiler directly\n      var prop = this.descriptor.prop;\n      var childKey = prop.path;\n      var parentKey = prop.parentPath;\n      var twoWay = prop.mode === bindingModes.TWO_WAY;\n\n      var parentWatcher = this.parentWatcher = new Watcher(parent, parentKey, function (val) {\n        updateProp(child, prop, val);\n      }, {\n        twoWay: twoWay,\n        filters: prop.filters,\n        // important: props need to be observed on the\n        // v-for scope if present\n        scope: this._scope\n      });\n\n      // set the child initial value.\n      initProp(child, prop, parentWatcher.value);\n\n      // setup two-way binding\n      if (twoWay) {\n        // important: defer the child watcher creation until\n        // the created hook (after data observation)\n        var self = this;\n        child.$once('pre-hook:created', function () {\n          self.childWatcher = new Watcher(child, childKey, function (val) {\n            parentWatcher.set(val);\n          }, {\n            // ensure sync upward before parent sync down.\n            // this is necessary in cases e.g. the child\n            // mutates a prop array, then replaces it. (#1683)\n            sync: true\n          });\n        });\n      }\n    },\n\n    unbind: function unbind() {\n      this.parentWatcher.teardown();\n      if (this.childWatcher) {\n        this.childWatcher.teardown();\n      }\n    }\n  };\n\n  var queue$1 = [];\n  var queued = false;\n\n  /**\n   * Push a job into the queue.\n   *\n   * @param {Function} job\n   */\n\n  function pushJob(job) {\n    queue$1.push(job);\n    if (!queued) {\n      queued = true;\n      nextTick(flush);\n    }\n  }\n\n  /**\n   * Flush the queue, and do one forced reflow before\n   * triggering transitions.\n   */\n\n  function flush() {\n    // Force layout\n    var f = document.documentElement.offsetHeight;\n    for (var i = 0; i < queue$1.length; i++) {\n      queue$1[i]();\n    }\n    queue$1 = [];\n    queued = false;\n    // dummy return, so js linters don't complain about\n    // unused variable f\n    return f;\n  }\n\n  var TYPE_TRANSITION = 'transition';\n  var TYPE_ANIMATION = 'animation';\n  var transDurationProp = transitionProp + 'Duration';\n  var animDurationProp = animationProp + 'Duration';\n\n  /**\n   * If a just-entered element is applied the\n   * leave class while its enter transition hasn't started yet,\n   * and the transitioned property has the same value for both\n   * enter/leave, then the leave transition will be skipped and\n   * the transitionend event never fires. This function ensures\n   * its callback to be called after a transition has started\n   * by waiting for double raf.\n   *\n   * It falls back to setTimeout on devices that support CSS\n   * transitions but not raf (e.g. Android 4.2 browser) - since\n   * these environments are usually slow, we are giving it a\n   * relatively large timeout.\n   */\n\n  var raf = inBrowser && window.requestAnimationFrame;\n  var waitForTransitionStart = raf\n  /* istanbul ignore next */\n  ? function (fn) {\n    raf(function () {\n      raf(fn);\n    });\n  } : function (fn) {\n    setTimeout(fn, 50);\n  };\n\n  /**\n   * A Transition object that encapsulates the state and logic\n   * of the transition.\n   *\n   * @param {Element} el\n   * @param {String} id\n   * @param {Object} hooks\n   * @param {Vue} vm\n   */\n  function Transition(el, id, hooks, vm) {\n    this.id = id;\n    this.el = el;\n    this.enterClass = hooks && hooks.enterClass || id + '-enter';\n    this.leaveClass = hooks && hooks.leaveClass || id + '-leave';\n    this.hooks = hooks;\n    this.vm = vm;\n    // async state\n    this.pendingCssEvent = this.pendingCssCb = this.cancel = this.pendingJsCb = this.op = this.cb = null;\n    this.justEntered = false;\n    this.entered = this.left = false;\n    this.typeCache = {};\n    // check css transition type\n    this.type = hooks && hooks.type;\n    /* istanbul ignore if */\n    if ('development' !== 'production') {\n      if (this.type && this.type !== TYPE_TRANSITION && this.type !== TYPE_ANIMATION) {\n        warn('invalid CSS transition type for transition=\"' + this.id + '\": ' + this.type, vm);\n      }\n    }\n    // bind\n    var self = this;['enterNextTick', 'enterDone', 'leaveNextTick', 'leaveDone'].forEach(function (m) {\n      self[m] = bind(self[m], self);\n    });\n  }\n\n  var p$1 = Transition.prototype;\n\n  /**\n   * Start an entering transition.\n   *\n   * 1. enter transition triggered\n   * 2. call beforeEnter hook\n   * 3. add enter class\n   * 4. insert/show element\n   * 5. call enter hook (with possible explicit js callback)\n   * 6. reflow\n   * 7. based on transition type:\n   *    - transition:\n   *        remove class now, wait for transitionend,\n   *        then done if there's no explicit js callback.\n   *    - animation:\n   *        wait for animationend, remove class,\n   *        then done if there's no explicit js callback.\n   *    - no css transition:\n   *        done now if there's no explicit js callback.\n   * 8. wait for either done or js callback, then call\n   *    afterEnter hook.\n   *\n   * @param {Function} op - insert/show the element\n   * @param {Function} [cb]\n   */\n\n  p$1.enter = function (op, cb) {\n    this.cancelPending();\n    this.callHook('beforeEnter');\n    this.cb = cb;\n    addClass(this.el, this.enterClass);\n    op();\n    this.entered = false;\n    this.callHookWithCb('enter');\n    if (this.entered) {\n      return; // user called done synchronously.\n    }\n    this.cancel = this.hooks && this.hooks.enterCancelled;\n    pushJob(this.enterNextTick);\n  };\n\n  /**\n   * The \"nextTick\" phase of an entering transition, which is\n   * to be pushed into a queue and executed after a reflow so\n   * that removing the class can trigger a CSS transition.\n   */\n\n  p$1.enterNextTick = function () {\n    var _this = this;\n\n    // prevent transition skipping\n    this.justEntered = true;\n    waitForTransitionStart(function () {\n      _this.justEntered = false;\n    });\n    var enterDone = this.enterDone;\n    var type = this.getCssTransitionType(this.enterClass);\n    if (!this.pendingJsCb) {\n      if (type === TYPE_TRANSITION) {\n        // trigger transition by removing enter class now\n        removeClass(this.el, this.enterClass);\n        this.setupCssCb(transitionEndEvent, enterDone);\n      } else if (type === TYPE_ANIMATION) {\n        this.setupCssCb(animationEndEvent, enterDone);\n      } else {\n        enterDone();\n      }\n    } else if (type === TYPE_TRANSITION) {\n      removeClass(this.el, this.enterClass);\n    }\n  };\n\n  /**\n   * The \"cleanup\" phase of an entering transition.\n   */\n\n  p$1.enterDone = function () {\n    this.entered = true;\n    this.cancel = this.pendingJsCb = null;\n    removeClass(this.el, this.enterClass);\n    this.callHook('afterEnter');\n    if (this.cb) this.cb();\n  };\n\n  /**\n   * Start a leaving transition.\n   *\n   * 1. leave transition triggered.\n   * 2. call beforeLeave hook\n   * 3. add leave class (trigger css transition)\n   * 4. call leave hook (with possible explicit js callback)\n   * 5. reflow if no explicit js callback is provided\n   * 6. based on transition type:\n   *    - transition or animation:\n   *        wait for end event, remove class, then done if\n   *        there's no explicit js callback.\n   *    - no css transition:\n   *        done if there's no explicit js callback.\n   * 7. wait for either done or js callback, then call\n   *    afterLeave hook.\n   *\n   * @param {Function} op - remove/hide the element\n   * @param {Function} [cb]\n   */\n\n  p$1.leave = function (op, cb) {\n    this.cancelPending();\n    this.callHook('beforeLeave');\n    this.op = op;\n    this.cb = cb;\n    addClass(this.el, this.leaveClass);\n    this.left = false;\n    this.callHookWithCb('leave');\n    if (this.left) {\n      return; // user called done synchronously.\n    }\n    this.cancel = this.hooks && this.hooks.leaveCancelled;\n    // only need to handle leaveDone if\n    // 1. the transition is already done (synchronously called\n    //    by the user, which causes this.op set to null)\n    // 2. there's no explicit js callback\n    if (this.op && !this.pendingJsCb) {\n      // if a CSS transition leaves immediately after enter,\n      // the transitionend event never fires. therefore we\n      // detect such cases and end the leave immediately.\n      if (this.justEntered) {\n        this.leaveDone();\n      } else {\n        pushJob(this.leaveNextTick);\n      }\n    }\n  };\n\n  /**\n   * The \"nextTick\" phase of a leaving transition.\n   */\n\n  p$1.leaveNextTick = function () {\n    var type = this.getCssTransitionType(this.leaveClass);\n    if (type) {\n      var event = type === TYPE_TRANSITION ? transitionEndEvent : animationEndEvent;\n      this.setupCssCb(event, this.leaveDone);\n    } else {\n      this.leaveDone();\n    }\n  };\n\n  /**\n   * The \"cleanup\" phase of a leaving transition.\n   */\n\n  p$1.leaveDone = function () {\n    this.left = true;\n    this.cancel = this.pendingJsCb = null;\n    this.op();\n    removeClass(this.el, this.leaveClass);\n    this.callHook('afterLeave');\n    if (this.cb) this.cb();\n    this.op = null;\n  };\n\n  /**\n   * Cancel any pending callbacks from a previously running\n   * but not finished transition.\n   */\n\n  p$1.cancelPending = function () {\n    this.op = this.cb = null;\n    var hasPending = false;\n    if (this.pendingCssCb) {\n      hasPending = true;\n      off(this.el, this.pendingCssEvent, this.pendingCssCb);\n      this.pendingCssEvent = this.pendingCssCb = null;\n    }\n    if (this.pendingJsCb) {\n      hasPending = true;\n      this.pendingJsCb.cancel();\n      this.pendingJsCb = null;\n    }\n    if (hasPending) {\n      removeClass(this.el, this.enterClass);\n      removeClass(this.el, this.leaveClass);\n    }\n    if (this.cancel) {\n      this.cancel.call(this.vm, this.el);\n      this.cancel = null;\n    }\n  };\n\n  /**\n   * Call a user-provided synchronous hook function.\n   *\n   * @param {String} type\n   */\n\n  p$1.callHook = function (type) {\n    if (this.hooks && this.hooks[type]) {\n      this.hooks[type].call(this.vm, this.el);\n    }\n  };\n\n  /**\n   * Call a user-provided, potentially-async hook function.\n   * We check for the length of arguments to see if the hook\n   * expects a `done` callback. If true, the transition's end\n   * will be determined by when the user calls that callback;\n   * otherwise, the end is determined by the CSS transition or\n   * animation.\n   *\n   * @param {String} type\n   */\n\n  p$1.callHookWithCb = function (type) {\n    var hook = this.hooks && this.hooks[type];\n    if (hook) {\n      if (hook.length > 1) {\n        this.pendingJsCb = cancellable(this[type + 'Done']);\n      }\n      hook.call(this.vm, this.el, this.pendingJsCb);\n    }\n  };\n\n  /**\n   * Get an element's transition type based on the\n   * calculated styles.\n   *\n   * @param {String} className\n   * @return {Number}\n   */\n\n  p$1.getCssTransitionType = function (className) {\n    /* istanbul ignore if */\n    if (!transitionEndEvent ||\n    // skip CSS transitions if page is not visible -\n    // this solves the issue of transitionend events not\n    // firing until the page is visible again.\n    // pageVisibility API is supported in IE10+, same as\n    // CSS transitions.\n    document.hidden ||\n    // explicit js-only transition\n    this.hooks && this.hooks.css === false ||\n    // element is hidden\n    isHidden(this.el)) {\n      return;\n    }\n    var type = this.type || this.typeCache[className];\n    if (type) return type;\n    var inlineStyles = this.el.style;\n    var computedStyles = window.getComputedStyle(this.el);\n    var transDuration = inlineStyles[transDurationProp] || computedStyles[transDurationProp];\n    if (transDuration && transDuration !== '0s') {\n      type = TYPE_TRANSITION;\n    } else {\n      var animDuration = inlineStyles[animDurationProp] || computedStyles[animDurationProp];\n      if (animDuration && animDuration !== '0s') {\n        type = TYPE_ANIMATION;\n      }\n    }\n    if (type) {\n      this.typeCache[className] = type;\n    }\n    return type;\n  };\n\n  /**\n   * Setup a CSS transitionend/animationend callback.\n   *\n   * @param {String} event\n   * @param {Function} cb\n   */\n\n  p$1.setupCssCb = function (event, cb) {\n    this.pendingCssEvent = event;\n    var self = this;\n    var el = this.el;\n    var onEnd = this.pendingCssCb = function (e) {\n      if (e.target === el) {\n        off(el, event, onEnd);\n        self.pendingCssEvent = self.pendingCssCb = null;\n        if (!self.pendingJsCb && cb) {\n          cb();\n        }\n      }\n    };\n    on(el, event, onEnd);\n  };\n\n  /**\n   * Check if an element is hidden - in that case we can just\n   * skip the transition alltogether.\n   *\n   * @param {Element} el\n   * @return {Boolean}\n   */\n\n  function isHidden(el) {\n    if (/svg$/.test(el.namespaceURI)) {\n      // SVG elements do not have offset(Width|Height)\n      // so we need to check the client rect\n      var rect = el.getBoundingClientRect();\n      return !(rect.width || rect.height);\n    } else {\n      return !(el.offsetWidth || el.offsetHeight || el.getClientRects().length);\n    }\n  }\n\n  var transition$1 = {\n\n    priority: TRANSITION,\n\n    update: function update(id, oldId) {\n      var el = this.el;\n      // resolve on owner vm\n      var hooks = resolveAsset(this.vm.$options, 'transitions', id);\n      id = id || 'v';\n      oldId = oldId || 'v';\n      el.__v_trans = new Transition(el, id, hooks, this.vm);\n      removeClass(el, oldId + '-transition');\n      addClass(el, id + '-transition');\n    }\n  };\n\n  var internalDirectives = {\n    style: style,\n    'class': vClass,\n    component: component,\n    prop: propDef,\n    transition: transition$1\n  };\n\n  // special binding prefixes\n  var bindRE = /^v-bind:|^:/;\n  var onRE = /^v-on:|^@/;\n  var dirAttrRE = /^v-([^:]+)(?:$|:(.*)$)/;\n  var modifierRE = /\\.[^\\.]+/g;\n  var transitionRE = /^(v-bind:|:)?transition$/;\n\n  // default directive priority\n  var DEFAULT_PRIORITY = 1000;\n  var DEFAULT_TERMINAL_PRIORITY = 2000;\n\n  /**\n   * Compile a template and return a reusable composite link\n   * function, which recursively contains more link functions\n   * inside. This top level compile function would normally\n   * be called on instance root nodes, but can also be used\n   * for partial compilation if the partial argument is true.\n   *\n   * The returned composite link function, when called, will\n   * return an unlink function that tearsdown all directives\n   * created during the linking phase.\n   *\n   * @param {Element|DocumentFragment} el\n   * @param {Object} options\n   * @param {Boolean} partial\n   * @return {Function}\n   */\n\n  function compile(el, options, partial) {\n    // link function for the node itself.\n    var nodeLinkFn = partial || !options._asComponent ? compileNode(el, options) : null;\n    // link function for the childNodes\n    var childLinkFn = !(nodeLinkFn && nodeLinkFn.terminal) && !isScript(el) && el.hasChildNodes() ? compileNodeList(el.childNodes, options) : null;\n\n    /**\n     * A composite linker function to be called on a already\n     * compiled piece of DOM, which instantiates all directive\n     * instances.\n     *\n     * @param {Vue} vm\n     * @param {Element|DocumentFragment} el\n     * @param {Vue} [host] - host vm of transcluded content\n     * @param {Object} [scope] - v-for scope\n     * @param {Fragment} [frag] - link context fragment\n     * @return {Function|undefined}\n     */\n\n    return function compositeLinkFn(vm, el, host, scope, frag) {\n      // cache childNodes before linking parent, fix #657\n      var childNodes = toArray(el.childNodes);\n      // link\n      var dirs = linkAndCapture(function compositeLinkCapturer() {\n        if (nodeLinkFn) nodeLinkFn(vm, el, host, scope, frag);\n        if (childLinkFn) childLinkFn(vm, childNodes, host, scope, frag);\n      }, vm);\n      return makeUnlinkFn(vm, dirs);\n    };\n  }\n\n  /**\n   * Apply a linker to a vm/element pair and capture the\n   * directives created during the process.\n   *\n   * @param {Function} linker\n   * @param {Vue} vm\n   */\n\n  function linkAndCapture(linker, vm) {\n    /* istanbul ignore if */\n    if ('development' === 'production') {}\n    var originalDirCount = vm._directives.length;\n    linker();\n    var dirs = vm._directives.slice(originalDirCount);\n    dirs.sort(directiveComparator);\n    for (var i = 0, l = dirs.length; i < l; i++) {\n      dirs[i]._bind();\n    }\n    return dirs;\n  }\n\n  /**\n   * Directive priority sort comparator\n   *\n   * @param {Object} a\n   * @param {Object} b\n   */\n\n  function directiveComparator(a, b) {\n    a = a.descriptor.def.priority || DEFAULT_PRIORITY;\n    b = b.descriptor.def.priority || DEFAULT_PRIORITY;\n    return a > b ? -1 : a === b ? 0 : 1;\n  }\n\n  /**\n   * Linker functions return an unlink function that\n   * tearsdown all directives instances generated during\n   * the process.\n   *\n   * We create unlink functions with only the necessary\n   * information to avoid retaining additional closures.\n   *\n   * @param {Vue} vm\n   * @param {Array} dirs\n   * @param {Vue} [context]\n   * @param {Array} [contextDirs]\n   * @return {Function}\n   */\n\n  function makeUnlinkFn(vm, dirs, context, contextDirs) {\n    function unlink(destroying) {\n      teardownDirs(vm, dirs, destroying);\n      if (context && contextDirs) {\n        teardownDirs(context, contextDirs);\n      }\n    }\n    // expose linked directives\n    unlink.dirs = dirs;\n    return unlink;\n  }\n\n  /**\n   * Teardown partial linked directives.\n   *\n   * @param {Vue} vm\n   * @param {Array} dirs\n   * @param {Boolean} destroying\n   */\n\n  function teardownDirs(vm, dirs, destroying) {\n    var i = dirs.length;\n    while (i--) {\n      dirs[i]._teardown();\n      if ('development' !== 'production' && !destroying) {\n        vm._directives.$remove(dirs[i]);\n      }\n    }\n  }\n\n  /**\n   * Compile link props on an instance.\n   *\n   * @param {Vue} vm\n   * @param {Element} el\n   * @param {Object} props\n   * @param {Object} [scope]\n   * @return {Function}\n   */\n\n  function compileAndLinkProps(vm, el, props, scope) {\n    var propsLinkFn = compileProps(el, props, vm);\n    var propDirs = linkAndCapture(function () {\n      propsLinkFn(vm, scope);\n    }, vm);\n    return makeUnlinkFn(vm, propDirs);\n  }\n\n  /**\n   * Compile the root element of an instance.\n   *\n   * 1. attrs on context container (context scope)\n   * 2. attrs on the component template root node, if\n   *    replace:true (child scope)\n   *\n   * If this is a fragment instance, we only need to compile 1.\n   *\n   * @param {Element} el\n   * @param {Object} options\n   * @param {Object} contextOptions\n   * @return {Function}\n   */\n\n  function compileRoot(el, options, contextOptions) {\n    var containerAttrs = options._containerAttrs;\n    var replacerAttrs = options._replacerAttrs;\n    var contextLinkFn, replacerLinkFn;\n\n    // only need to compile other attributes for\n    // non-fragment instances\n    if (el.nodeType !== 11) {\n      // for components, container and replacer need to be\n      // compiled separately and linked in different scopes.\n      if (options._asComponent) {\n        // 2. container attributes\n        if (containerAttrs && contextOptions) {\n          contextLinkFn = compileDirectives(containerAttrs, contextOptions);\n        }\n        if (replacerAttrs) {\n          // 3. replacer attributes\n          replacerLinkFn = compileDirectives(replacerAttrs, options);\n        }\n      } else {\n        // non-component, just compile as a normal element.\n        replacerLinkFn = compileDirectives(el.attributes, options);\n      }\n    } else if ('development' !== 'production' && containerAttrs) {\n      // warn container directives for fragment instances\n      var names = containerAttrs.filter(function (attr) {\n        // allow vue-loader/vueify scoped css attributes\n        return attr.name.indexOf('_v-') < 0 &&\n        // allow event listeners\n        !onRE.test(attr.name) &&\n        // allow slots\n        attr.name !== 'slot';\n      }).map(function (attr) {\n        return '\"' + attr.name + '\"';\n      });\n      if (names.length) {\n        var plural = names.length > 1;\n        warn('Attribute' + (plural ? 's ' : ' ') + names.join(', ') + (plural ? ' are' : ' is') + ' ignored on component ' + '<' + options.el.tagName.toLowerCase() + '> because ' + 'the component is a fragment instance: ' + 'http://vuejs.org/guide/components.html#Fragment-Instance');\n      }\n    }\n\n    options._containerAttrs = options._replacerAttrs = null;\n    return function rootLinkFn(vm, el, scope) {\n      // link context scope dirs\n      var context = vm._context;\n      var contextDirs;\n      if (context && contextLinkFn) {\n        contextDirs = linkAndCapture(function () {\n          contextLinkFn(context, el, null, scope);\n        }, context);\n      }\n\n      // link self\n      var selfDirs = linkAndCapture(function () {\n        if (replacerLinkFn) replacerLinkFn(vm, el);\n      }, vm);\n\n      // return the unlink function that tearsdown context\n      // container directives.\n      return makeUnlinkFn(vm, selfDirs, context, contextDirs);\n    };\n  }\n\n  /**\n   * Compile a node and return a nodeLinkFn based on the\n   * node type.\n   *\n   * @param {Node} node\n   * @param {Object} options\n   * @return {Function|null}\n   */\n\n  function compileNode(node, options) {\n    var type = node.nodeType;\n    if (type === 1 && !isScript(node)) {\n      return compileElement(node, options);\n    } else if (type === 3 && node.data.trim()) {\n      return compileTextNode(node, options);\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Compile an element and return a nodeLinkFn.\n   *\n   * @param {Element} el\n   * @param {Object} options\n   * @return {Function|null}\n   */\n\n  function compileElement(el, options) {\n    // preprocess textareas.\n    // textarea treats its text content as the initial value.\n    // just bind it as an attr directive for value.\n    if (el.tagName === 'TEXTAREA') {\n      var tokens = parseText(el.value);\n      if (tokens) {\n        el.setAttribute(':value', tokensToExp(tokens));\n        el.value = '';\n      }\n    }\n    var linkFn;\n    var hasAttrs = el.hasAttributes();\n    var attrs = hasAttrs && toArray(el.attributes);\n    // check terminal directives (for & if)\n    if (hasAttrs) {\n      linkFn = checkTerminalDirectives(el, attrs, options);\n    }\n    // check element directives\n    if (!linkFn) {\n      linkFn = checkElementDirectives(el, options);\n    }\n    // check component\n    if (!linkFn) {\n      linkFn = checkComponent(el, options);\n    }\n    // normal directives\n    if (!linkFn && hasAttrs) {\n      linkFn = compileDirectives(attrs, options);\n    }\n    return linkFn;\n  }\n\n  /**\n   * Compile a textNode and return a nodeLinkFn.\n   *\n   * @param {TextNode} node\n   * @param {Object} options\n   * @return {Function|null} textNodeLinkFn\n   */\n\n  function compileTextNode(node, options) {\n    // skip marked text nodes\n    if (node._skip) {\n      return removeText;\n    }\n\n    var tokens = parseText(node.wholeText);\n    if (!tokens) {\n      return null;\n    }\n\n    // mark adjacent text nodes as skipped,\n    // because we are using node.wholeText to compile\n    // all adjacent text nodes together. This fixes\n    // issues in IE where sometimes it splits up a single\n    // text node into multiple ones.\n    var next = node.nextSibling;\n    while (next && next.nodeType === 3) {\n      next._skip = true;\n      next = next.nextSibling;\n    }\n\n    var frag = document.createDocumentFragment();\n    var el, token;\n    for (var i = 0, l = tokens.length; i < l; i++) {\n      token = tokens[i];\n      el = token.tag ? processTextToken(token, options) : document.createTextNode(token.value);\n      frag.appendChild(el);\n    }\n    return makeTextNodeLinkFn(tokens, frag, options);\n  }\n\n  /**\n   * Linker for an skipped text node.\n   *\n   * @param {Vue} vm\n   * @param {Text} node\n   */\n\n  function removeText(vm, node) {\n    remove(node);\n  }\n\n  /**\n   * Process a single text token.\n   *\n   * @param {Object} token\n   * @param {Object} options\n   * @return {Node}\n   */\n\n  function processTextToken(token, options) {\n    var el;\n    if (token.oneTime) {\n      el = document.createTextNode(token.value);\n    } else {\n      if (token.html) {\n        el = document.createComment('v-html');\n        setTokenType('html');\n      } else {\n        // IE will clean up empty textNodes during\n        // frag.cloneNode(true), so we have to give it\n        // something here...\n        el = document.createTextNode(' ');\n        setTokenType('text');\n      }\n    }\n    function setTokenType(type) {\n      if (token.descriptor) return;\n      var parsed = parseDirective(token.value);\n      token.descriptor = {\n        name: type,\n        def: directives[type],\n        expression: parsed.expression,\n        filters: parsed.filters\n      };\n    }\n    return el;\n  }\n\n  /**\n   * Build a function that processes a textNode.\n   *\n   * @param {Array<Object>} tokens\n   * @param {DocumentFragment} frag\n   */\n\n  function makeTextNodeLinkFn(tokens, frag) {\n    return function textNodeLinkFn(vm, el, host, scope) {\n      var fragClone = frag.cloneNode(true);\n      var childNodes = toArray(fragClone.childNodes);\n      var token, value, node;\n      for (var i = 0, l = tokens.length; i < l; i++) {\n        token = tokens[i];\n        value = token.value;\n        if (token.tag) {\n          node = childNodes[i];\n          if (token.oneTime) {\n            value = (scope || vm).$eval(value);\n            if (token.html) {\n              replace(node, parseTemplate(value, true));\n            } else {\n              node.data = _toString(value);\n            }\n          } else {\n            vm._bindDir(token.descriptor, node, host, scope);\n          }\n        }\n      }\n      replace(el, fragClone);\n    };\n  }\n\n  /**\n   * Compile a node list and return a childLinkFn.\n   *\n   * @param {NodeList} nodeList\n   * @param {Object} options\n   * @return {Function|undefined}\n   */\n\n  function compileNodeList(nodeList, options) {\n    var linkFns = [];\n    var nodeLinkFn, childLinkFn, node;\n    for (var i = 0, l = nodeList.length; i < l; i++) {\n      node = nodeList[i];\n      nodeLinkFn = compileNode(node, options);\n      childLinkFn = !(nodeLinkFn && nodeLinkFn.terminal) && node.tagName !== 'SCRIPT' && node.hasChildNodes() ? compileNodeList(node.childNodes, options) : null;\n      linkFns.push(nodeLinkFn, childLinkFn);\n    }\n    return linkFns.length ? makeChildLinkFn(linkFns) : null;\n  }\n\n  /**\n   * Make a child link function for a node's childNodes.\n   *\n   * @param {Array<Function>} linkFns\n   * @return {Function} childLinkFn\n   */\n\n  function makeChildLinkFn(linkFns) {\n    return function childLinkFn(vm, nodes, host, scope, frag) {\n      var node, nodeLinkFn, childrenLinkFn;\n      for (var i = 0, n = 0, l = linkFns.length; i < l; n++) {\n        node = nodes[n];\n        nodeLinkFn = linkFns[i++];\n        childrenLinkFn = linkFns[i++];\n        // cache childNodes before linking parent, fix #657\n        var childNodes = toArray(node.childNodes);\n        if (nodeLinkFn) {\n          nodeLinkFn(vm, node, host, scope, frag);\n        }\n        if (childrenLinkFn) {\n          childrenLinkFn(vm, childNodes, host, scope, frag);\n        }\n      }\n    };\n  }\n\n  /**\n   * Check for element directives (custom elements that should\n   * be resovled as terminal directives).\n   *\n   * @param {Element} el\n   * @param {Object} options\n   */\n\n  function checkElementDirectives(el, options) {\n    var tag = el.tagName.toLowerCase();\n    if (commonTagRE.test(tag)) {\n      return;\n    }\n    var def = resolveAsset(options, 'elementDirectives', tag);\n    if (def) {\n      return makeTerminalNodeLinkFn(el, tag, '', options, def);\n    }\n  }\n\n  /**\n   * Check if an element is a component. If yes, return\n   * a component link function.\n   *\n   * @param {Element} el\n   * @param {Object} options\n   * @return {Function|undefined}\n   */\n\n  function checkComponent(el, options) {\n    var component = checkComponentAttr(el, options);\n    if (component) {\n      var ref = findRef(el);\n      var descriptor = {\n        name: 'component',\n        ref: ref,\n        expression: component.id,\n        def: internalDirectives.component,\n        modifiers: {\n          literal: !component.dynamic\n        }\n      };\n      var componentLinkFn = function componentLinkFn(vm, el, host, scope, frag) {\n        if (ref) {\n          defineReactive((scope || vm).$refs, ref, null);\n        }\n        vm._bindDir(descriptor, el, host, scope, frag);\n      };\n      componentLinkFn.terminal = true;\n      return componentLinkFn;\n    }\n  }\n\n  /**\n   * Check an element for terminal directives in fixed order.\n   * If it finds one, return a terminal link function.\n   *\n   * @param {Element} el\n   * @param {Array} attrs\n   * @param {Object} options\n   * @return {Function} terminalLinkFn\n   */\n\n  function checkTerminalDirectives(el, attrs, options) {\n    // skip v-pre\n    if (getAttr(el, 'v-pre') !== null) {\n      return skip;\n    }\n    // skip v-else block, but only if following v-if\n    if (el.hasAttribute('v-else')) {\n      var prev = el.previousElementSibling;\n      if (prev && prev.hasAttribute('v-if')) {\n        return skip;\n      }\n    }\n\n    var attr, name, value, modifiers, matched, dirName, rawName, arg, def, termDef;\n    for (var i = 0, j = attrs.length; i < j; i++) {\n      attr = attrs[i];\n      name = attr.name.replace(modifierRE, '');\n      if (matched = name.match(dirAttrRE)) {\n        def = resolveAsset(options, 'directives', matched[1]);\n        if (def && def.terminal) {\n          if (!termDef || (def.priority || DEFAULT_TERMINAL_PRIORITY) > termDef.priority) {\n            termDef = def;\n            rawName = attr.name;\n            modifiers = parseModifiers(attr.name);\n            value = attr.value;\n            dirName = matched[1];\n            arg = matched[2];\n          }\n        }\n      }\n    }\n\n    if (termDef) {\n      return makeTerminalNodeLinkFn(el, dirName, value, options, termDef, rawName, arg, modifiers);\n    }\n  }\n\n  function skip() {}\n  skip.terminal = true;\n\n  /**\n   * Build a node link function for a terminal directive.\n   * A terminal link function terminates the current\n   * compilation recursion and handles compilation of the\n   * subtree in the directive.\n   *\n   * @param {Element} el\n   * @param {String} dirName\n   * @param {String} value\n   * @param {Object} options\n   * @param {Object} def\n   * @param {String} [rawName]\n   * @param {String} [arg]\n   * @param {Object} [modifiers]\n   * @return {Function} terminalLinkFn\n   */\n\n  function makeTerminalNodeLinkFn(el, dirName, value, options, def, rawName, arg, modifiers) {\n    var parsed = parseDirective(value);\n    var descriptor = {\n      name: dirName,\n      arg: arg,\n      expression: parsed.expression,\n      filters: parsed.filters,\n      raw: value,\n      attr: rawName,\n      modifiers: modifiers,\n      def: def\n    };\n    // check ref for v-for and router-view\n    if (dirName === 'for' || dirName === 'router-view') {\n      descriptor.ref = findRef(el);\n    }\n    var fn = function terminalNodeLinkFn(vm, el, host, scope, frag) {\n      if (descriptor.ref) {\n        defineReactive((scope || vm).$refs, descriptor.ref, null);\n      }\n      vm._bindDir(descriptor, el, host, scope, frag);\n    };\n    fn.terminal = true;\n    return fn;\n  }\n\n  /**\n   * Compile the directives on an element and return a linker.\n   *\n   * @param {Array|NamedNodeMap} attrs\n   * @param {Object} options\n   * @return {Function}\n   */\n\n  function compileDirectives(attrs, options) {\n    var i = attrs.length;\n    var dirs = [];\n    var attr, name, value, rawName, rawValue, dirName, arg, modifiers, dirDef, tokens, matched;\n    while (i--) {\n      attr = attrs[i];\n      name = rawName = attr.name;\n      value = rawValue = attr.value;\n      tokens = parseText(value);\n      // reset arg\n      arg = null;\n      // check modifiers\n      modifiers = parseModifiers(name);\n      name = name.replace(modifierRE, '');\n\n      // attribute interpolations\n      if (tokens) {\n        value = tokensToExp(tokens);\n        arg = name;\n        pushDir('bind', directives.bind, tokens);\n        // warn against mixing mustaches with v-bind\n        if ('development' !== 'production') {\n          if (name === 'class' && Array.prototype.some.call(attrs, function (attr) {\n            return attr.name === ':class' || attr.name === 'v-bind:class';\n          })) {\n            warn('class=\"' + rawValue + '\": Do not mix mustache interpolation ' + 'and v-bind for \"class\" on the same element. Use one or the other.', options);\n          }\n        }\n      } else\n\n        // special attribute: transition\n        if (transitionRE.test(name)) {\n          modifiers.literal = !bindRE.test(name);\n          pushDir('transition', internalDirectives.transition);\n        } else\n\n          // event handlers\n          if (onRE.test(name)) {\n            arg = name.replace(onRE, '');\n            pushDir('on', directives.on);\n          } else\n\n            // attribute bindings\n            if (bindRE.test(name)) {\n              dirName = name.replace(bindRE, '');\n              if (dirName === 'style' || dirName === 'class') {\n                pushDir(dirName, internalDirectives[dirName]);\n              } else {\n                arg = dirName;\n                pushDir('bind', directives.bind);\n              }\n            } else\n\n              // normal directives\n              if (matched = name.match(dirAttrRE)) {\n                dirName = matched[1];\n                arg = matched[2];\n\n                // skip v-else (when used with v-show)\n                if (dirName === 'else') {\n                  continue;\n                }\n\n                dirDef = resolveAsset(options, 'directives', dirName, true);\n                if (dirDef) {\n                  pushDir(dirName, dirDef);\n                }\n              }\n    }\n\n    /**\n     * Push a directive.\n     *\n     * @param {String} dirName\n     * @param {Object|Function} def\n     * @param {Array} [interpTokens]\n     */\n\n    function pushDir(dirName, def, interpTokens) {\n      var hasOneTimeToken = interpTokens && hasOneTime(interpTokens);\n      var parsed = !hasOneTimeToken && parseDirective(value);\n      dirs.push({\n        name: dirName,\n        attr: rawName,\n        raw: rawValue,\n        def: def,\n        arg: arg,\n        modifiers: modifiers,\n        // conversion from interpolation strings with one-time token\n        // to expression is differed until directive bind time so that we\n        // have access to the actual vm context for one-time bindings.\n        expression: parsed && parsed.expression,\n        filters: parsed && parsed.filters,\n        interp: interpTokens,\n        hasOneTime: hasOneTimeToken\n      });\n    }\n\n    if (dirs.length) {\n      return makeNodeLinkFn(dirs);\n    }\n  }\n\n  /**\n   * Parse modifiers from directive attribute name.\n   *\n   * @param {String} name\n   * @return {Object}\n   */\n\n  function parseModifiers(name) {\n    var res = Object.create(null);\n    var match = name.match(modifierRE);\n    if (match) {\n      var i = match.length;\n      while (i--) {\n        res[match[i].slice(1)] = true;\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Build a link function for all directives on a single node.\n   *\n   * @param {Array} directives\n   * @return {Function} directivesLinkFn\n   */\n\n  function makeNodeLinkFn(directives) {\n    return function nodeLinkFn(vm, el, host, scope, frag) {\n      // reverse apply because it's sorted low to high\n      var i = directives.length;\n      while (i--) {\n        vm._bindDir(directives[i], el, host, scope, frag);\n      }\n    };\n  }\n\n  /**\n   * Check if an interpolation string contains one-time tokens.\n   *\n   * @param {Array} tokens\n   * @return {Boolean}\n   */\n\n  function hasOneTime(tokens) {\n    var i = tokens.length;\n    while (i--) {\n      if (tokens[i].oneTime) return true;\n    }\n  }\n\n  function isScript(el) {\n    return el.tagName === 'SCRIPT' && (!el.hasAttribute('type') || el.getAttribute('type') === 'text/javascript');\n  }\n\n  var specialCharRE = /[^\\w\\-:\\.]/;\n\n  /**\n   * Process an element or a DocumentFragment based on a\n   * instance option object. This allows us to transclude\n   * a template node/fragment before the instance is created,\n   * so the processed fragment can then be cloned and reused\n   * in v-for.\n   *\n   * @param {Element} el\n   * @param {Object} options\n   * @return {Element|DocumentFragment}\n   */\n\n  function transclude(el, options) {\n    // extract container attributes to pass them down\n    // to compiler, because they need to be compiled in\n    // parent scope. we are mutating the options object here\n    // assuming the same object will be used for compile\n    // right after this.\n    if (options) {\n      options._containerAttrs = extractAttrs(el);\n    }\n    // for template tags, what we want is its content as\n    // a documentFragment (for fragment instances)\n    if (isTemplate(el)) {\n      el = parseTemplate(el);\n    }\n    if (options) {\n      if (options._asComponent && !options.template) {\n        options.template = '<slot></slot>';\n      }\n      if (options.template) {\n        options._content = extractContent(el);\n        el = transcludeTemplate(el, options);\n      }\n    }\n    if (isFragment(el)) {\n      // anchors for fragment instance\n      // passing in `persist: true` to avoid them being\n      // discarded by IE during template cloning\n      prepend(createAnchor('v-start', true), el);\n      el.appendChild(createAnchor('v-end', true));\n    }\n    return el;\n  }\n\n  /**\n   * Process the template option.\n   * If the replace option is true this will swap the $el.\n   *\n   * @param {Element} el\n   * @param {Object} options\n   * @return {Element|DocumentFragment}\n   */\n\n  function transcludeTemplate(el, options) {\n    var template = options.template;\n    var frag = parseTemplate(template, true);\n    if (frag) {\n      var replacer = frag.firstChild;\n      var tag = replacer.tagName && replacer.tagName.toLowerCase();\n      if (options.replace) {\n        /* istanbul ignore if */\n        if (el === document.body) {\n          'development' !== 'production' && warn('You are mounting an instance with a template to ' + '<body>. This will replace <body> entirely. You ' + 'should probably use `replace: false` here.');\n        }\n        // there are many cases where the instance must\n        // become a fragment instance: basically anything that\n        // can create more than 1 root nodes.\n        if (\n        // multi-children template\n        frag.childNodes.length > 1 ||\n        // non-element template\n        replacer.nodeType !== 1 ||\n        // single nested component\n        tag === 'component' || resolveAsset(options, 'components', tag) || hasBindAttr(replacer, 'is') ||\n        // element directive\n        resolveAsset(options, 'elementDirectives', tag) ||\n        // for block\n        replacer.hasAttribute('v-for') ||\n        // if block\n        replacer.hasAttribute('v-if')) {\n          return frag;\n        } else {\n          options._replacerAttrs = extractAttrs(replacer);\n          mergeAttrs(el, replacer);\n          return replacer;\n        }\n      } else {\n        el.appendChild(frag);\n        return el;\n      }\n    } else {\n      'development' !== 'production' && warn('Invalid template option: ' + template);\n    }\n  }\n\n  /**\n   * Helper to extract a component container's attributes\n   * into a plain object array.\n   *\n   * @param {Element} el\n   * @return {Array}\n   */\n\n  function extractAttrs(el) {\n    if (el.nodeType === 1 && el.hasAttributes()) {\n      return toArray(el.attributes);\n    }\n  }\n\n  /**\n   * Merge the attributes of two elements, and make sure\n   * the class names are merged properly.\n   *\n   * @param {Element} from\n   * @param {Element} to\n   */\n\n  function mergeAttrs(from, to) {\n    var attrs = from.attributes;\n    var i = attrs.length;\n    var name, value;\n    while (i--) {\n      name = attrs[i].name;\n      value = attrs[i].value;\n      if (!to.hasAttribute(name) && !specialCharRE.test(name)) {\n        to.setAttribute(name, value);\n      } else if (name === 'class' && !parseText(value) && (value = value.trim())) {\n        value.split(/\\s+/).forEach(function (cls) {\n          addClass(to, cls);\n        });\n      }\n    }\n  }\n\n  /**\n   * Scan and determine slot content distribution.\n   * We do this during transclusion instead at compile time so that\n   * the distribution is decoupled from the compilation order of\n   * the slots.\n   *\n   * @param {Element|DocumentFragment} template\n   * @param {Element} content\n   * @param {Vue} vm\n   */\n\n  function resolveSlots(vm, content) {\n    if (!content) {\n      return;\n    }\n    var contents = vm._slotContents = Object.create(null);\n    var el, name;\n    for (var i = 0, l = content.children.length; i < l; i++) {\n      el = content.children[i];\n      /* eslint-disable no-cond-assign */\n      if (name = el.getAttribute('slot')) {\n        (contents[name] || (contents[name] = [])).push(el);\n      }\n      /* eslint-enable no-cond-assign */\n      if ('development' !== 'production' && getBindAttr(el, 'slot')) {\n        warn('The \"slot\" attribute must be static.', vm.$parent);\n      }\n    }\n    for (name in contents) {\n      contents[name] = extractFragment(contents[name], content);\n    }\n    if (content.hasChildNodes()) {\n      var nodes = content.childNodes;\n      if (nodes.length === 1 && nodes[0].nodeType === 3 && !nodes[0].data.trim()) {\n        return;\n      }\n      contents['default'] = extractFragment(content.childNodes, content);\n    }\n  }\n\n  /**\n   * Extract qualified content nodes from a node list.\n   *\n   * @param {NodeList} nodes\n   * @return {DocumentFragment}\n   */\n\n  function extractFragment(nodes, parent) {\n    var frag = document.createDocumentFragment();\n    nodes = toArray(nodes);\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var node = nodes[i];\n      if (isTemplate(node) && !node.hasAttribute('v-if') && !node.hasAttribute('v-for')) {\n        parent.removeChild(node);\n        node = parseTemplate(node, true);\n      }\n      frag.appendChild(node);\n    }\n    return frag;\n  }\n\n\n\n  var compiler = Object.freeze({\n  \tcompile: compile,\n  \tcompileAndLinkProps: compileAndLinkProps,\n  \tcompileRoot: compileRoot,\n  \ttransclude: transclude,\n  \tresolveSlots: resolveSlots\n  });\n\n  function stateMixin (Vue) {\n    /**\n     * Accessor for `$data` property, since setting $data\n     * requires observing the new object and updating\n     * proxied properties.\n     */\n\n    Object.defineProperty(Vue.prototype, '$data', {\n      get: function get() {\n        return this._data;\n      },\n      set: function set(newData) {\n        if (newData !== this._data) {\n          this._setData(newData);\n        }\n      }\n    });\n\n    /**\n     * Setup the scope of an instance, which contains:\n     * - observed data\n     * - computed properties\n     * - user methods\n     * - meta properties\n     */\n\n    Vue.prototype._initState = function () {\n      this._initProps();\n      this._initMeta();\n      this._initMethods();\n      this._initData();\n      this._initComputed();\n    };\n\n    /**\n     * Initialize props.\n     */\n\n    Vue.prototype._initProps = function () {\n      var options = this.$options;\n      var el = options.el;\n      var props = options.props;\n      if (props && !el) {\n        'development' !== 'production' && warn('Props will not be compiled if no `el` option is ' + 'provided at instantiation.', this);\n      }\n      // make sure to convert string selectors into element now\n      el = options.el = query(el);\n      this._propsUnlinkFn = el && el.nodeType === 1 && props\n      // props must be linked in proper scope if inside v-for\n      ? compileAndLinkProps(this, el, props, this._scope) : null;\n    };\n\n    /**\n     * Initialize the data.\n     */\n\n    Vue.prototype._initData = function () {\n      var dataFn = this.$options.data;\n      var data = this._data = dataFn ? dataFn() : {};\n      if (!isPlainObject(data)) {\n        data = {};\n        'development' !== 'production' && warn('data functions should return an object.', this);\n      }\n      var props = this._props;\n      // proxy data on instance\n      var keys = Object.keys(data);\n      var i, key;\n      i = keys.length;\n      while (i--) {\n        key = keys[i];\n        // there are two scenarios where we can proxy a data key:\n        // 1. it's not already defined as a prop\n        // 2. it's provided via a instantiation option AND there are no\n        //    template prop present\n        if (!props || !hasOwn(props, key)) {\n          this._proxy(key);\n        } else if ('development' !== 'production') {\n          warn('Data field \"' + key + '\" is already defined ' + 'as a prop. To provide default value for a prop, use the \"default\" ' + 'prop option; if you want to pass prop values to an instantiation ' + 'call, use the \"propsData\" option.', this);\n        }\n      }\n      // observe data\n      observe(data, this);\n    };\n\n    /**\n     * Swap the instance's $data. Called in $data's setter.\n     *\n     * @param {Object} newData\n     */\n\n    Vue.prototype._setData = function (newData) {\n      newData = newData || {};\n      var oldData = this._data;\n      this._data = newData;\n      var keys, key, i;\n      // unproxy keys not present in new data\n      keys = Object.keys(oldData);\n      i = keys.length;\n      while (i--) {\n        key = keys[i];\n        if (!(key in newData)) {\n          this._unproxy(key);\n        }\n      }\n      // proxy keys not already proxied,\n      // and trigger change for changed values\n      keys = Object.keys(newData);\n      i = keys.length;\n      while (i--) {\n        key = keys[i];\n        if (!hasOwn(this, key)) {\n          // new property\n          this._proxy(key);\n        }\n      }\n      oldData.__ob__.removeVm(this);\n      observe(newData, this);\n      this._digest();\n    };\n\n    /**\n     * Proxy a property, so that\n     * vm.prop === vm._data.prop\n     *\n     * @param {String} key\n     */\n\n    Vue.prototype._proxy = function (key) {\n      if (!isReserved(key)) {\n        // need to store ref to self here\n        // because these getter/setters might\n        // be called by child scopes via\n        // prototype inheritance.\n        var self = this;\n        Object.defineProperty(self, key, {\n          configurable: true,\n          enumerable: true,\n          get: function proxyGetter() {\n            return self._data[key];\n          },\n          set: function proxySetter(val) {\n            self._data[key] = val;\n          }\n        });\n      }\n    };\n\n    /**\n     * Unproxy a property.\n     *\n     * @param {String} key\n     */\n\n    Vue.prototype._unproxy = function (key) {\n      if (!isReserved(key)) {\n        delete this[key];\n      }\n    };\n\n    /**\n     * Force update on every watcher in scope.\n     */\n\n    Vue.prototype._digest = function () {\n      for (var i = 0, l = this._watchers.length; i < l; i++) {\n        this._watchers[i].update(true); // shallow updates\n      }\n    };\n\n    /**\n     * Setup computed properties. They are essentially\n     * special getter/setters\n     */\n\n    function noop() {}\n    Vue.prototype._initComputed = function () {\n      var computed = this.$options.computed;\n      if (computed) {\n        for (var key in computed) {\n          var userDef = computed[key];\n          var def = {\n            enumerable: true,\n            configurable: true\n          };\n          if (typeof userDef === 'function') {\n            def.get = makeComputedGetter(userDef, this);\n            def.set = noop;\n          } else {\n            def.get = userDef.get ? userDef.cache !== false ? makeComputedGetter(userDef.get, this) : bind(userDef.get, this) : noop;\n            def.set = userDef.set ? bind(userDef.set, this) : noop;\n          }\n          Object.defineProperty(this, key, def);\n        }\n      }\n    };\n\n    function makeComputedGetter(getter, owner) {\n      var watcher = new Watcher(owner, getter, null, {\n        lazy: true\n      });\n      return function computedGetter() {\n        if (watcher.dirty) {\n          watcher.evaluate();\n        }\n        if (Dep.target) {\n          watcher.depend();\n        }\n        return watcher.value;\n      };\n    }\n\n    /**\n     * Setup instance methods. Methods must be bound to the\n     * instance since they might be passed down as a prop to\n     * child components.\n     */\n\n    Vue.prototype._initMethods = function () {\n      var methods = this.$options.methods;\n      if (methods) {\n        for (var key in methods) {\n          this[key] = bind(methods[key], this);\n        }\n      }\n    };\n\n    /**\n     * Initialize meta information like $index, $key & $value.\n     */\n\n    Vue.prototype._initMeta = function () {\n      var metas = this.$options._meta;\n      if (metas) {\n        for (var key in metas) {\n          defineReactive(this, key, metas[key]);\n        }\n      }\n    };\n  }\n\n  var eventRE = /^v-on:|^@/;\n\n  function eventsMixin (Vue) {\n    /**\n     * Setup the instance's option events & watchers.\n     * If the value is a string, we pull it from the\n     * instance's methods by name.\n     */\n\n    Vue.prototype._initEvents = function () {\n      var options = this.$options;\n      if (options._asComponent) {\n        registerComponentEvents(this, options.el);\n      }\n      registerCallbacks(this, '$on', options.events);\n      registerCallbacks(this, '$watch', options.watch);\n    };\n\n    /**\n     * Register v-on events on a child component\n     *\n     * @param {Vue} vm\n     * @param {Element} el\n     */\n\n    function registerComponentEvents(vm, el) {\n      var attrs = el.attributes;\n      var name, value, handler;\n      for (var i = 0, l = attrs.length; i < l; i++) {\n        name = attrs[i].name;\n        if (eventRE.test(name)) {\n          name = name.replace(eventRE, '');\n          // force the expression into a statement so that\n          // it always dynamically resolves the method to call (#2670)\n          // kinda ugly hack, but does the job.\n          value = attrs[i].value;\n          if (isSimplePath(value)) {\n            value += '.apply(this, $arguments)';\n          }\n          handler = (vm._scope || vm._context).$eval(value, true);\n          handler._fromParent = true;\n          vm.$on(name.replace(eventRE), handler);\n        }\n      }\n    }\n\n    /**\n     * Register callbacks for option events and watchers.\n     *\n     * @param {Vue} vm\n     * @param {String} action\n     * @param {Object} hash\n     */\n\n    function registerCallbacks(vm, action, hash) {\n      if (!hash) return;\n      var handlers, key, i, j;\n      for (key in hash) {\n        handlers = hash[key];\n        if (isArray(handlers)) {\n          for (i = 0, j = handlers.length; i < j; i++) {\n            register(vm, action, key, handlers[i]);\n          }\n        } else {\n          register(vm, action, key, handlers);\n        }\n      }\n    }\n\n    /**\n     * Helper to register an event/watch callback.\n     *\n     * @param {Vue} vm\n     * @param {String} action\n     * @param {String} key\n     * @param {Function|String|Object} handler\n     * @param {Object} [options]\n     */\n\n    function register(vm, action, key, handler, options) {\n      var type = typeof handler;\n      if (type === 'function') {\n        vm[action](key, handler, options);\n      } else if (type === 'string') {\n        var methods = vm.$options.methods;\n        var method = methods && methods[handler];\n        if (method) {\n          vm[action](key, method, options);\n        } else {\n          'development' !== 'production' && warn('Unknown method: \"' + handler + '\" when ' + 'registering callback for ' + action + ': \"' + key + '\".', vm);\n        }\n      } else if (handler && type === 'object') {\n        register(vm, action, key, handler.handler, handler);\n      }\n    }\n\n    /**\n     * Setup recursive attached/detached calls\n     */\n\n    Vue.prototype._initDOMHooks = function () {\n      this.$on('hook:attached', onAttached);\n      this.$on('hook:detached', onDetached);\n    };\n\n    /**\n     * Callback to recursively call attached hook on children\n     */\n\n    function onAttached() {\n      if (!this._isAttached) {\n        this._isAttached = true;\n        this.$children.forEach(callAttach);\n      }\n    }\n\n    /**\n     * Iterator to call attached hook\n     *\n     * @param {Vue} child\n     */\n\n    function callAttach(child) {\n      if (!child._isAttached && inDoc(child.$el)) {\n        child._callHook('attached');\n      }\n    }\n\n    /**\n     * Callback to recursively call detached hook on children\n     */\n\n    function onDetached() {\n      if (this._isAttached) {\n        this._isAttached = false;\n        this.$children.forEach(callDetach);\n      }\n    }\n\n    /**\n     * Iterator to call detached hook\n     *\n     * @param {Vue} child\n     */\n\n    function callDetach(child) {\n      if (child._isAttached && !inDoc(child.$el)) {\n        child._callHook('detached');\n      }\n    }\n\n    /**\n     * Trigger all handlers for a hook\n     *\n     * @param {String} hook\n     */\n\n    Vue.prototype._callHook = function (hook) {\n      this.$emit('pre-hook:' + hook);\n      var handlers = this.$options[hook];\n      if (handlers) {\n        for (var i = 0, j = handlers.length; i < j; i++) {\n          handlers[i].call(this);\n        }\n      }\n      this.$emit('hook:' + hook);\n    };\n  }\n\n  function noop$1() {}\n\n  /**\n   * A directive links a DOM element with a piece of data,\n   * which is the result of evaluating an expression.\n   * It registers a watcher with the expression and calls\n   * the DOM update function when a change is triggered.\n   *\n   * @param {Object} descriptor\n   *                 - {String} name\n   *                 - {Object} def\n   *                 - {String} expression\n   *                 - {Array<Object>} [filters]\n   *                 - {Object} [modifiers]\n   *                 - {Boolean} literal\n   *                 - {String} attr\n   *                 - {String} arg\n   *                 - {String} raw\n   *                 - {String} [ref]\n   *                 - {Array<Object>} [interp]\n   *                 - {Boolean} [hasOneTime]\n   * @param {Vue} vm\n   * @param {Node} el\n   * @param {Vue} [host] - transclusion host component\n   * @param {Object} [scope] - v-for scope\n   * @param {Fragment} [frag] - owner fragment\n   * @constructor\n   */\n  function Directive(descriptor, vm, el, host, scope, frag) {\n    this.vm = vm;\n    this.el = el;\n    // copy descriptor properties\n    this.descriptor = descriptor;\n    this.name = descriptor.name;\n    this.expression = descriptor.expression;\n    this.arg = descriptor.arg;\n    this.modifiers = descriptor.modifiers;\n    this.filters = descriptor.filters;\n    this.literal = this.modifiers && this.modifiers.literal;\n    // private\n    this._locked = false;\n    this._bound = false;\n    this._listeners = null;\n    // link context\n    this._host = host;\n    this._scope = scope;\n    this._frag = frag;\n    // store directives on node in dev mode\n    if ('development' !== 'production' && this.el) {\n      this.el._vue_directives = this.el._vue_directives || [];\n      this.el._vue_directives.push(this);\n    }\n  }\n\n  /**\n   * Initialize the directive, mixin definition properties,\n   * setup the watcher, call definition bind() and update()\n   * if present.\n   */\n\n  Directive.prototype._bind = function () {\n    var name = this.name;\n    var descriptor = this.descriptor;\n\n    // remove attribute\n    if ((name !== 'cloak' || this.vm._isCompiled) && this.el && this.el.removeAttribute) {\n      var attr = descriptor.attr || 'v-' + name;\n      this.el.removeAttribute(attr);\n    }\n\n    // copy def properties\n    var def = descriptor.def;\n    if (typeof def === 'function') {\n      this.update = def;\n    } else {\n      extend(this, def);\n    }\n\n    // setup directive params\n    this._setupParams();\n\n    // initial bind\n    if (this.bind) {\n      this.bind();\n    }\n    this._bound = true;\n\n    if (this.literal) {\n      this.update && this.update(descriptor.raw);\n    } else if ((this.expression || this.modifiers) && (this.update || this.twoWay) && !this._checkStatement()) {\n      // wrapped updater for context\n      var dir = this;\n      if (this.update) {\n        this._update = function (val, oldVal) {\n          if (!dir._locked) {\n            dir.update(val, oldVal);\n          }\n        };\n      } else {\n        this._update = noop$1;\n      }\n      var preProcess = this._preProcess ? bind(this._preProcess, this) : null;\n      var postProcess = this._postProcess ? bind(this._postProcess, this) : null;\n      var watcher = this._watcher = new Watcher(this.vm, this.expression, this._update, // callback\n      {\n        filters: this.filters,\n        twoWay: this.twoWay,\n        deep: this.deep,\n        preProcess: preProcess,\n        postProcess: postProcess,\n        scope: this._scope\n      });\n      // v-model with inital inline value need to sync back to\n      // model instead of update to DOM on init. They would\n      // set the afterBind hook to indicate that.\n      if (this.afterBind) {\n        this.afterBind();\n      } else if (this.update) {\n        this.update(watcher.value);\n      }\n    }\n  };\n\n  /**\n   * Setup all param attributes, e.g. track-by,\n   * transition-mode, etc...\n   */\n\n  Directive.prototype._setupParams = function () {\n    if (!this.params) {\n      return;\n    }\n    var params = this.params;\n    // swap the params array with a fresh object.\n    this.params = Object.create(null);\n    var i = params.length;\n    var key, val, mappedKey;\n    while (i--) {\n      key = hyphenate(params[i]);\n      mappedKey = camelize(key);\n      val = getBindAttr(this.el, key);\n      if (val != null) {\n        // dynamic\n        this._setupParamWatcher(mappedKey, val);\n      } else {\n        // static\n        val = getAttr(this.el, key);\n        if (val != null) {\n          this.params[mappedKey] = val === '' ? true : val;\n        }\n      }\n    }\n  };\n\n  /**\n   * Setup a watcher for a dynamic param.\n   *\n   * @param {String} key\n   * @param {String} expression\n   */\n\n  Directive.prototype._setupParamWatcher = function (key, expression) {\n    var self = this;\n    var called = false;\n    var unwatch = (this._scope || this.vm).$watch(expression, function (val, oldVal) {\n      self.params[key] = val;\n      // since we are in immediate mode,\n      // only call the param change callbacks if this is not the first update.\n      if (called) {\n        var cb = self.paramWatchers && self.paramWatchers[key];\n        if (cb) {\n          cb.call(self, val, oldVal);\n        }\n      } else {\n        called = true;\n      }\n    }, {\n      immediate: true,\n      user: false\n    });(this._paramUnwatchFns || (this._paramUnwatchFns = [])).push(unwatch);\n  };\n\n  /**\n   * Check if the directive is a function caller\n   * and if the expression is a callable one. If both true,\n   * we wrap up the expression and use it as the event\n   * handler.\n   *\n   * e.g. on-click=\"a++\"\n   *\n   * @return {Boolean}\n   */\n\n  Directive.prototype._checkStatement = function () {\n    var expression = this.expression;\n    if (expression && this.acceptStatement && !isSimplePath(expression)) {\n      var fn = parseExpression(expression).get;\n      var scope = this._scope || this.vm;\n      var handler = function handler(e) {\n        scope.$event = e;\n        fn.call(scope, scope);\n        scope.$event = null;\n      };\n      if (this.filters) {\n        handler = scope._applyFilters(handler, null, this.filters);\n      }\n      this.update(handler);\n      return true;\n    }\n  };\n\n  /**\n   * Set the corresponding value with the setter.\n   * This should only be used in two-way directives\n   * e.g. v-model.\n   *\n   * @param {*} value\n   * @public\n   */\n\n  Directive.prototype.set = function (value) {\n    /* istanbul ignore else */\n    if (this.twoWay) {\n      this._withLock(function () {\n        this._watcher.set(value);\n      });\n    } else if ('development' !== 'production') {\n      warn('Directive.set() can only be used inside twoWay' + 'directives.');\n    }\n  };\n\n  /**\n   * Execute a function while preventing that function from\n   * triggering updates on this directive instance.\n   *\n   * @param {Function} fn\n   */\n\n  Directive.prototype._withLock = function (fn) {\n    var self = this;\n    self._locked = true;\n    fn.call(self);\n    nextTick(function () {\n      self._locked = false;\n    });\n  };\n\n  /**\n   * Convenience method that attaches a DOM event listener\n   * to the directive element and autometically tears it down\n   * during unbind.\n   *\n   * @param {String} event\n   * @param {Function} handler\n   * @param {Boolean} [useCapture]\n   */\n\n  Directive.prototype.on = function (event, handler, useCapture) {\n    on(this.el, event, handler, useCapture);(this._listeners || (this._listeners = [])).push([event, handler]);\n  };\n\n  /**\n   * Teardown the watcher and call unbind.\n   */\n\n  Directive.prototype._teardown = function () {\n    if (this._bound) {\n      this._bound = false;\n      if (this.unbind) {\n        this.unbind();\n      }\n      if (this._watcher) {\n        this._watcher.teardown();\n      }\n      var listeners = this._listeners;\n      var i;\n      if (listeners) {\n        i = listeners.length;\n        while (i--) {\n          off(this.el, listeners[i][0], listeners[i][1]);\n        }\n      }\n      var unwatchFns = this._paramUnwatchFns;\n      if (unwatchFns) {\n        i = unwatchFns.length;\n        while (i--) {\n          unwatchFns[i]();\n        }\n      }\n      if ('development' !== 'production' && this.el) {\n        this.el._vue_directives.$remove(this);\n      }\n      this.vm = this.el = this._watcher = this._listeners = null;\n    }\n  };\n\n  function lifecycleMixin (Vue) {\n    /**\n     * Update v-ref for component.\n     *\n     * @param {Boolean} remove\n     */\n\n    Vue.prototype._updateRef = function (remove) {\n      var ref = this.$options._ref;\n      if (ref) {\n        var refs = (this._scope || this._context).$refs;\n        if (remove) {\n          if (refs[ref] === this) {\n            refs[ref] = null;\n          }\n        } else {\n          refs[ref] = this;\n        }\n      }\n    };\n\n    /**\n     * Transclude, compile and link element.\n     *\n     * If a pre-compiled linker is available, that means the\n     * passed in element will be pre-transcluded and compiled\n     * as well - all we need to do is to call the linker.\n     *\n     * Otherwise we need to call transclude/compile/link here.\n     *\n     * @param {Element} el\n     */\n\n    Vue.prototype._compile = function (el) {\n      var options = this.$options;\n\n      // transclude and init element\n      // transclude can potentially replace original\n      // so we need to keep reference; this step also injects\n      // the template and caches the original attributes\n      // on the container node and replacer node.\n      var original = el;\n      el = transclude(el, options);\n      this._initElement(el);\n\n      // handle v-pre on root node (#2026)\n      if (el.nodeType === 1 && getAttr(el, 'v-pre') !== null) {\n        return;\n      }\n\n      // root is always compiled per-instance, because\n      // container attrs and props can be different every time.\n      var contextOptions = this._context && this._context.$options;\n      var rootLinker = compileRoot(el, options, contextOptions);\n\n      // resolve slot distribution\n      resolveSlots(this, options._content);\n\n      // compile and link the rest\n      var contentLinkFn;\n      var ctor = this.constructor;\n      // component compilation can be cached\n      // as long as it's not using inline-template\n      if (options._linkerCachable) {\n        contentLinkFn = ctor.linker;\n        if (!contentLinkFn) {\n          contentLinkFn = ctor.linker = compile(el, options);\n        }\n      }\n\n      // link phase\n      // make sure to link root with prop scope!\n      var rootUnlinkFn = rootLinker(this, el, this._scope);\n      var contentUnlinkFn = contentLinkFn ? contentLinkFn(this, el) : compile(el, options)(this, el);\n\n      // register composite unlink function\n      // to be called during instance destruction\n      this._unlinkFn = function () {\n        rootUnlinkFn();\n        // passing destroying: true to avoid searching and\n        // splicing the directives\n        contentUnlinkFn(true);\n      };\n\n      // finally replace original\n      if (options.replace) {\n        replace(original, el);\n      }\n\n      this._isCompiled = true;\n      this._callHook('compiled');\n    };\n\n    /**\n     * Initialize instance element. Called in the public\n     * $mount() method.\n     *\n     * @param {Element} el\n     */\n\n    Vue.prototype._initElement = function (el) {\n      if (isFragment(el)) {\n        this._isFragment = true;\n        this.$el = this._fragmentStart = el.firstChild;\n        this._fragmentEnd = el.lastChild;\n        // set persisted text anchors to empty\n        if (this._fragmentStart.nodeType === 3) {\n          this._fragmentStart.data = this._fragmentEnd.data = '';\n        }\n        this._fragment = el;\n      } else {\n        this.$el = el;\n      }\n      this.$el.__vue__ = this;\n      this._callHook('beforeCompile');\n    };\n\n    /**\n     * Create and bind a directive to an element.\n     *\n     * @param {Object} descriptor - parsed directive descriptor\n     * @param {Node} node   - target node\n     * @param {Vue} [host] - transclusion host component\n     * @param {Object} [scope] - v-for scope\n     * @param {Fragment} [frag] - owner fragment\n     */\n\n    Vue.prototype._bindDir = function (descriptor, node, host, scope, frag) {\n      this._directives.push(new Directive(descriptor, this, node, host, scope, frag));\n    };\n\n    /**\n     * Teardown an instance, unobserves the data, unbind all the\n     * directives, turn off all the event listeners, etc.\n     *\n     * @param {Boolean} remove - whether to remove the DOM node.\n     * @param {Boolean} deferCleanup - if true, defer cleanup to\n     *                                 be called later\n     */\n\n    Vue.prototype._destroy = function (remove, deferCleanup) {\n      if (this._isBeingDestroyed) {\n        if (!deferCleanup) {\n          this._cleanup();\n        }\n        return;\n      }\n\n      var destroyReady;\n      var pendingRemoval;\n\n      var self = this;\n      // Cleanup should be called either synchronously or asynchronoysly as\n      // callback of this.$remove(), or if remove and deferCleanup are false.\n      // In any case it should be called after all other removing, unbinding and\n      // turning of is done\n      var cleanupIfPossible = function cleanupIfPossible() {\n        if (destroyReady && !pendingRemoval && !deferCleanup) {\n          self._cleanup();\n        }\n      };\n\n      // remove DOM element\n      if (remove && this.$el) {\n        pendingRemoval = true;\n        this.$remove(function () {\n          pendingRemoval = false;\n          cleanupIfPossible();\n        });\n      }\n\n      this._callHook('beforeDestroy');\n      this._isBeingDestroyed = true;\n      var i;\n      // remove self from parent. only necessary\n      // if parent is not being destroyed as well.\n      var parent = this.$parent;\n      if (parent && !parent._isBeingDestroyed) {\n        parent.$children.$remove(this);\n        // unregister ref (remove: true)\n        this._updateRef(true);\n      }\n      // destroy all children.\n      i = this.$children.length;\n      while (i--) {\n        this.$children[i].$destroy();\n      }\n      // teardown props\n      if (this._propsUnlinkFn) {\n        this._propsUnlinkFn();\n      }\n      // teardown all directives. this also tearsdown all\n      // directive-owned watchers.\n      if (this._unlinkFn) {\n        this._unlinkFn();\n      }\n      i = this._watchers.length;\n      while (i--) {\n        this._watchers[i].teardown();\n      }\n      // remove reference to self on $el\n      if (this.$el) {\n        this.$el.__vue__ = null;\n      }\n\n      destroyReady = true;\n      cleanupIfPossible();\n    };\n\n    /**\n     * Clean up to ensure garbage collection.\n     * This is called after the leave transition if there\n     * is any.\n     */\n\n    Vue.prototype._cleanup = function () {\n      if (this._isDestroyed) {\n        return;\n      }\n      // remove self from owner fragment\n      // do it in cleanup so that we can call $destroy with\n      // defer right when a fragment is about to be removed.\n      if (this._frag) {\n        this._frag.children.$remove(this);\n      }\n      // remove reference from data ob\n      // frozen object may not have observer.\n      if (this._data && this._data.__ob__) {\n        this._data.__ob__.removeVm(this);\n      }\n      // Clean up references to private properties and other\n      // instances. preserve reference to _data so that proxy\n      // accessors still work. The only potential side effect\n      // here is that mutating the instance after it's destroyed\n      // may affect the state of other components that are still\n      // observing the same object, but that seems to be a\n      // reasonable responsibility for the user rather than\n      // always throwing an error on them.\n      this.$el = this.$parent = this.$root = this.$children = this._watchers = this._context = this._scope = this._directives = null;\n      // call the last hook...\n      this._isDestroyed = true;\n      this._callHook('destroyed');\n      // turn off all instance listeners.\n      this.$off();\n    };\n  }\n\n  function miscMixin (Vue) {\n    /**\n     * Apply a list of filter (descriptors) to a value.\n     * Using plain for loops here because this will be called in\n     * the getter of any watcher with filters so it is very\n     * performance sensitive.\n     *\n     * @param {*} value\n     * @param {*} [oldValue]\n     * @param {Array} filters\n     * @param {Boolean} write\n     * @return {*}\n     */\n\n    Vue.prototype._applyFilters = function (value, oldValue, filters, write) {\n      var filter, fn, args, arg, offset, i, l, j, k;\n      for (i = 0, l = filters.length; i < l; i++) {\n        filter = filters[write ? l - i - 1 : i];\n        fn = resolveAsset(this.$options, 'filters', filter.name, true);\n        if (!fn) continue;\n        fn = write ? fn.write : fn.read || fn;\n        if (typeof fn !== 'function') continue;\n        args = write ? [value, oldValue] : [value];\n        offset = write ? 2 : 1;\n        if (filter.args) {\n          for (j = 0, k = filter.args.length; j < k; j++) {\n            arg = filter.args[j];\n            args[j + offset] = arg.dynamic ? this.$get(arg.value) : arg.value;\n          }\n        }\n        value = fn.apply(this, args);\n      }\n      return value;\n    };\n\n    /**\n     * Resolve a component, depending on whether the component\n     * is defined normally or using an async factory function.\n     * Resolves synchronously if already resolved, otherwise\n     * resolves asynchronously and caches the resolved\n     * constructor on the factory.\n     *\n     * @param {String|Function} value\n     * @param {Function} cb\n     */\n\n    Vue.prototype._resolveComponent = function (value, cb) {\n      var factory;\n      if (typeof value === 'function') {\n        factory = value;\n      } else {\n        factory = resolveAsset(this.$options, 'components', value, true);\n      }\n      /* istanbul ignore if */\n      if (!factory) {\n        return;\n      }\n      // async component factory\n      if (!factory.options) {\n        if (factory.resolved) {\n          // cached\n          cb(factory.resolved);\n        } else if (factory.requested) {\n          // pool callbacks\n          factory.pendingCallbacks.push(cb);\n        } else {\n          factory.requested = true;\n          var cbs = factory.pendingCallbacks = [cb];\n          factory.call(this, function resolve(res) {\n            if (isPlainObject(res)) {\n              res = Vue.extend(res);\n            }\n            // cache resolved\n            factory.resolved = res;\n            // invoke callbacks\n            for (var i = 0, l = cbs.length; i < l; i++) {\n              cbs[i](res);\n            }\n          }, function reject(reason) {\n            'development' !== 'production' && warn('Failed to resolve async component' + (typeof value === 'string' ? ': ' + value : '') + '. ' + (reason ? '\\nReason: ' + reason : ''));\n          });\n        }\n      } else {\n        // normal component\n        cb(factory);\n      }\n    };\n  }\n\n  var filterRE$1 = /[^|]\\|[^|]/;\n\n  function dataAPI (Vue) {\n    /**\n     * Get the value from an expression on this vm.\n     *\n     * @param {String} exp\n     * @param {Boolean} [asStatement]\n     * @return {*}\n     */\n\n    Vue.prototype.$get = function (exp, asStatement) {\n      var res = parseExpression(exp);\n      if (res) {\n        if (asStatement) {\n          var self = this;\n          return function statementHandler() {\n            self.$arguments = toArray(arguments);\n            var result = res.get.call(self, self);\n            self.$arguments = null;\n            return result;\n          };\n        } else {\n          try {\n            return res.get.call(this, this);\n          } catch (e) {}\n        }\n      }\n    };\n\n    /**\n     * Set the value from an expression on this vm.\n     * The expression must be a valid left-hand\n     * expression in an assignment.\n     *\n     * @param {String} exp\n     * @param {*} val\n     */\n\n    Vue.prototype.$set = function (exp, val) {\n      var res = parseExpression(exp, true);\n      if (res && res.set) {\n        res.set.call(this, this, val);\n      }\n    };\n\n    /**\n     * Delete a property on the VM\n     *\n     * @param {String} key\n     */\n\n    Vue.prototype.$delete = function (key) {\n      del(this._data, key);\n    };\n\n    /**\n     * Watch an expression, trigger callback when its\n     * value changes.\n     *\n     * @param {String|Function} expOrFn\n     * @param {Function} cb\n     * @param {Object} [options]\n     *                 - {Boolean} deep\n     *                 - {Boolean} immediate\n     * @return {Function} - unwatchFn\n     */\n\n    Vue.prototype.$watch = function (expOrFn, cb, options) {\n      var vm = this;\n      var parsed;\n      if (typeof expOrFn === 'string') {\n        parsed = parseDirective(expOrFn);\n        expOrFn = parsed.expression;\n      }\n      var watcher = new Watcher(vm, expOrFn, cb, {\n        deep: options && options.deep,\n        sync: options && options.sync,\n        filters: parsed && parsed.filters,\n        user: !options || options.user !== false\n      });\n      if (options && options.immediate) {\n        cb.call(vm, watcher.value);\n      }\n      return function unwatchFn() {\n        watcher.teardown();\n      };\n    };\n\n    /**\n     * Evaluate a text directive, including filters.\n     *\n     * @param {String} text\n     * @param {Boolean} [asStatement]\n     * @return {String}\n     */\n\n    Vue.prototype.$eval = function (text, asStatement) {\n      // check for filters.\n      if (filterRE$1.test(text)) {\n        var dir = parseDirective(text);\n        // the filter regex check might give false positive\n        // for pipes inside strings, so it's possible that\n        // we don't get any filters here\n        var val = this.$get(dir.expression, asStatement);\n        return dir.filters ? this._applyFilters(val, null, dir.filters) : val;\n      } else {\n        // no filter\n        return this.$get(text, asStatement);\n      }\n    };\n\n    /**\n     * Interpolate a piece of template text.\n     *\n     * @param {String} text\n     * @return {String}\n     */\n\n    Vue.prototype.$interpolate = function (text) {\n      var tokens = parseText(text);\n      var vm = this;\n      if (tokens) {\n        if (tokens.length === 1) {\n          return vm.$eval(tokens[0].value) + '';\n        } else {\n          return tokens.map(function (token) {\n            return token.tag ? vm.$eval(token.value) : token.value;\n          }).join('');\n        }\n      } else {\n        return text;\n      }\n    };\n\n    /**\n     * Log instance data as a plain JS object\n     * so that it is easier to inspect in console.\n     * This method assumes console is available.\n     *\n     * @param {String} [path]\n     */\n\n    Vue.prototype.$log = function (path) {\n      var data = path ? getPath(this._data, path) : this._data;\n      if (data) {\n        data = clean(data);\n      }\n      // include computed fields\n      if (!path) {\n        var key;\n        for (key in this.$options.computed) {\n          data[key] = clean(this[key]);\n        }\n        if (this._props) {\n          for (key in this._props) {\n            data[key] = clean(this[key]);\n          }\n        }\n      }\n      console.log(data);\n    };\n\n    /**\n     * \"clean\" a getter/setter converted object into a plain\n     * object copy.\n     *\n     * @param {Object} - obj\n     * @return {Object}\n     */\n\n    function clean(obj) {\n      return JSON.parse(JSON.stringify(obj));\n    }\n  }\n\n  function domAPI (Vue) {\n    /**\n     * Convenience on-instance nextTick. The callback is\n     * auto-bound to the instance, and this avoids component\n     * modules having to rely on the global Vue.\n     *\n     * @param {Function} fn\n     */\n\n    Vue.prototype.$nextTick = function (fn) {\n      nextTick(fn, this);\n    };\n\n    /**\n     * Append instance to target\n     *\n     * @param {Node} target\n     * @param {Function} [cb]\n     * @param {Boolean} [withTransition] - defaults to true\n     */\n\n    Vue.prototype.$appendTo = function (target, cb, withTransition) {\n      return insert(this, target, cb, withTransition, append, appendWithTransition);\n    };\n\n    /**\n     * Prepend instance to target\n     *\n     * @param {Node} target\n     * @param {Function} [cb]\n     * @param {Boolean} [withTransition] - defaults to true\n     */\n\n    Vue.prototype.$prependTo = function (target, cb, withTransition) {\n      target = query(target);\n      if (target.hasChildNodes()) {\n        this.$before(target.firstChild, cb, withTransition);\n      } else {\n        this.$appendTo(target, cb, withTransition);\n      }\n      return this;\n    };\n\n    /**\n     * Insert instance before target\n     *\n     * @param {Node} target\n     * @param {Function} [cb]\n     * @param {Boolean} [withTransition] - defaults to true\n     */\n\n    Vue.prototype.$before = function (target, cb, withTransition) {\n      return insert(this, target, cb, withTransition, beforeWithCb, beforeWithTransition);\n    };\n\n    /**\n     * Insert instance after target\n     *\n     * @param {Node} target\n     * @param {Function} [cb]\n     * @param {Boolean} [withTransition] - defaults to true\n     */\n\n    Vue.prototype.$after = function (target, cb, withTransition) {\n      target = query(target);\n      if (target.nextSibling) {\n        this.$before(target.nextSibling, cb, withTransition);\n      } else {\n        this.$appendTo(target.parentNode, cb, withTransition);\n      }\n      return this;\n    };\n\n    /**\n     * Remove instance from DOM\n     *\n     * @param {Function} [cb]\n     * @param {Boolean} [withTransition] - defaults to true\n     */\n\n    Vue.prototype.$remove = function (cb, withTransition) {\n      if (!this.$el.parentNode) {\n        return cb && cb();\n      }\n      var inDocument = this._isAttached && inDoc(this.$el);\n      // if we are not in document, no need to check\n      // for transitions\n      if (!inDocument) withTransition = false;\n      var self = this;\n      var realCb = function realCb() {\n        if (inDocument) self._callHook('detached');\n        if (cb) cb();\n      };\n      if (this._isFragment) {\n        removeNodeRange(this._fragmentStart, this._fragmentEnd, this, this._fragment, realCb);\n      } else {\n        var op = withTransition === false ? removeWithCb : removeWithTransition;\n        op(this.$el, this, realCb);\n      }\n      return this;\n    };\n\n    /**\n     * Shared DOM insertion function.\n     *\n     * @param {Vue} vm\n     * @param {Element} target\n     * @param {Function} [cb]\n     * @param {Boolean} [withTransition]\n     * @param {Function} op1 - op for non-transition insert\n     * @param {Function} op2 - op for transition insert\n     * @return vm\n     */\n\n    function insert(vm, target, cb, withTransition, op1, op2) {\n      target = query(target);\n      var targetIsDetached = !inDoc(target);\n      var op = withTransition === false || targetIsDetached ? op1 : op2;\n      var shouldCallHook = !targetIsDetached && !vm._isAttached && !inDoc(vm.$el);\n      if (vm._isFragment) {\n        mapNodeRange(vm._fragmentStart, vm._fragmentEnd, function (node) {\n          op(node, target, vm);\n        });\n        cb && cb();\n      } else {\n        op(vm.$el, target, vm, cb);\n      }\n      if (shouldCallHook) {\n        vm._callHook('attached');\n      }\n      return vm;\n    }\n\n    /**\n     * Check for selectors\n     *\n     * @param {String|Element} el\n     */\n\n    function query(el) {\n      return typeof el === 'string' ? document.querySelector(el) : el;\n    }\n\n    /**\n     * Append operation that takes a callback.\n     *\n     * @param {Node} el\n     * @param {Node} target\n     * @param {Vue} vm - unused\n     * @param {Function} [cb]\n     */\n\n    function append(el, target, vm, cb) {\n      target.appendChild(el);\n      if (cb) cb();\n    }\n\n    /**\n     * InsertBefore operation that takes a callback.\n     *\n     * @param {Node} el\n     * @param {Node} target\n     * @param {Vue} vm - unused\n     * @param {Function} [cb]\n     */\n\n    function beforeWithCb(el, target, vm, cb) {\n      before(el, target);\n      if (cb) cb();\n    }\n\n    /**\n     * Remove operation that takes a callback.\n     *\n     * @param {Node} el\n     * @param {Vue} vm - unused\n     * @param {Function} [cb]\n     */\n\n    function removeWithCb(el, vm, cb) {\n      remove(el);\n      if (cb) cb();\n    }\n  }\n\n  function eventsAPI (Vue) {\n    /**\n     * Listen on the given `event` with `fn`.\n     *\n     * @param {String} event\n     * @param {Function} fn\n     */\n\n    Vue.prototype.$on = function (event, fn) {\n      (this._events[event] || (this._events[event] = [])).push(fn);\n      modifyListenerCount(this, event, 1);\n      return this;\n    };\n\n    /**\n     * Adds an `event` listener that will be invoked a single\n     * time then automatically removed.\n     *\n     * @param {String} event\n     * @param {Function} fn\n     */\n\n    Vue.prototype.$once = function (event, fn) {\n      var self = this;\n      function on() {\n        self.$off(event, on);\n        fn.apply(this, arguments);\n      }\n      on.fn = fn;\n      this.$on(event, on);\n      return this;\n    };\n\n    /**\n     * Remove the given callback for `event` or all\n     * registered callbacks.\n     *\n     * @param {String} event\n     * @param {Function} fn\n     */\n\n    Vue.prototype.$off = function (event, fn) {\n      var cbs;\n      // all\n      if (!arguments.length) {\n        if (this.$parent) {\n          for (event in this._events) {\n            cbs = this._events[event];\n            if (cbs) {\n              modifyListenerCount(this, event, -cbs.length);\n            }\n          }\n        }\n        this._events = {};\n        return this;\n      }\n      // specific event\n      cbs = this._events[event];\n      if (!cbs) {\n        return this;\n      }\n      if (arguments.length === 1) {\n        modifyListenerCount(this, event, -cbs.length);\n        this._events[event] = null;\n        return this;\n      }\n      // specific handler\n      var cb;\n      var i = cbs.length;\n      while (i--) {\n        cb = cbs[i];\n        if (cb === fn || cb.fn === fn) {\n          modifyListenerCount(this, event, -1);\n          cbs.splice(i, 1);\n          break;\n        }\n      }\n      return this;\n    };\n\n    /**\n     * Trigger an event on self.\n     *\n     * @param {String|Object} event\n     * @return {Boolean} shouldPropagate\n     */\n\n    Vue.prototype.$emit = function (event) {\n      var isSource = typeof event === 'string';\n      event = isSource ? event : event.name;\n      var cbs = this._events[event];\n      var shouldPropagate = isSource || !cbs;\n      if (cbs) {\n        cbs = cbs.length > 1 ? toArray(cbs) : cbs;\n        // this is a somewhat hacky solution to the question raised\n        // in #2102: for an inline component listener like <comp @test=\"doThis\">,\n        // the propagation handling is somewhat broken. Therefore we\n        // need to treat these inline callbacks differently.\n        var hasParentCbs = isSource && cbs.some(function (cb) {\n          return cb._fromParent;\n        });\n        if (hasParentCbs) {\n          shouldPropagate = false;\n        }\n        var args = toArray(arguments, 1);\n        for (var i = 0, l = cbs.length; i < l; i++) {\n          var cb = cbs[i];\n          var res = cb.apply(this, args);\n          if (res === true && (!hasParentCbs || cb._fromParent)) {\n            shouldPropagate = true;\n          }\n        }\n      }\n      return shouldPropagate;\n    };\n\n    /**\n     * Recursively broadcast an event to all children instances.\n     *\n     * @param {String|Object} event\n     * @param {...*} additional arguments\n     */\n\n    Vue.prototype.$broadcast = function (event) {\n      var isSource = typeof event === 'string';\n      event = isSource ? event : event.name;\n      // if no child has registered for this event,\n      // then there's no need to broadcast.\n      if (!this._eventsCount[event]) return;\n      var children = this.$children;\n      var args = toArray(arguments);\n      if (isSource) {\n        // use object event to indicate non-source emit\n        // on children\n        args[0] = { name: event, source: this };\n      }\n      for (var i = 0, l = children.length; i < l; i++) {\n        var child = children[i];\n        var shouldPropagate = child.$emit.apply(child, args);\n        if (shouldPropagate) {\n          child.$broadcast.apply(child, args);\n        }\n      }\n      return this;\n    };\n\n    /**\n     * Recursively propagate an event up the parent chain.\n     *\n     * @param {String} event\n     * @param {...*} additional arguments\n     */\n\n    Vue.prototype.$dispatch = function (event) {\n      var shouldPropagate = this.$emit.apply(this, arguments);\n      if (!shouldPropagate) return;\n      var parent = this.$parent;\n      var args = toArray(arguments);\n      // use object event to indicate non-source emit\n      // on parents\n      args[0] = { name: event, source: this };\n      while (parent) {\n        shouldPropagate = parent.$emit.apply(parent, args);\n        parent = shouldPropagate ? parent.$parent : null;\n      }\n      return this;\n    };\n\n    /**\n     * Modify the listener counts on all parents.\n     * This bookkeeping allows $broadcast to return early when\n     * no child has listened to a certain event.\n     *\n     * @param {Vue} vm\n     * @param {String} event\n     * @param {Number} count\n     */\n\n    var hookRE = /^hook:/;\n    function modifyListenerCount(vm, event, count) {\n      var parent = vm.$parent;\n      // hooks do not get broadcasted so no need\n      // to do bookkeeping for them\n      if (!parent || !count || hookRE.test(event)) return;\n      while (parent) {\n        parent._eventsCount[event] = (parent._eventsCount[event] || 0) + count;\n        parent = parent.$parent;\n      }\n    }\n  }\n\n  function lifecycleAPI (Vue) {\n    /**\n     * Set instance target element and kick off the compilation\n     * process. The passed in `el` can be a selector string, an\n     * existing Element, or a DocumentFragment (for block\n     * instances).\n     *\n     * @param {Element|DocumentFragment|string} el\n     * @public\n     */\n\n    Vue.prototype.$mount = function (el) {\n      if (this._isCompiled) {\n        'development' !== 'production' && warn('$mount() should be called only once.', this);\n        return;\n      }\n      el = query(el);\n      if (!el) {\n        el = document.createElement('div');\n      }\n      this._compile(el);\n      this._initDOMHooks();\n      if (inDoc(this.$el)) {\n        this._callHook('attached');\n        ready.call(this);\n      } else {\n        this.$once('hook:attached', ready);\n      }\n      return this;\n    };\n\n    /**\n     * Mark an instance as ready.\n     */\n\n    function ready() {\n      this._isAttached = true;\n      this._isReady = true;\n      this._callHook('ready');\n    }\n\n    /**\n     * Teardown the instance, simply delegate to the internal\n     * _destroy.\n     *\n     * @param {Boolean} remove\n     * @param {Boolean} deferCleanup\n     */\n\n    Vue.prototype.$destroy = function (remove, deferCleanup) {\n      this._destroy(remove, deferCleanup);\n    };\n\n    /**\n     * Partially compile a piece of DOM and return a\n     * decompile function.\n     *\n     * @param {Element|DocumentFragment} el\n     * @param {Vue} [host]\n     * @param {Object} [scope]\n     * @param {Fragment} [frag]\n     * @return {Function}\n     */\n\n    Vue.prototype.$compile = function (el, host, scope, frag) {\n      return compile(el, this.$options, true)(this, el, host, scope, frag);\n    };\n  }\n\n  /**\n   * The exposed Vue constructor.\n   *\n   * API conventions:\n   * - public API methods/properties are prefixed with `$`\n   * - internal methods/properties are prefixed with `_`\n   * - non-prefixed properties are assumed to be proxied user\n   *   data.\n   *\n   * @constructor\n   * @param {Object} [options]\n   * @public\n   */\n\n  function Vue(options) {\n    this._init(options);\n  }\n\n  // install internals\n  initMixin(Vue);\n  stateMixin(Vue);\n  eventsMixin(Vue);\n  lifecycleMixin(Vue);\n  miscMixin(Vue);\n\n  // install instance APIs\n  dataAPI(Vue);\n  domAPI(Vue);\n  eventsAPI(Vue);\n  lifecycleAPI(Vue);\n\n  var slot = {\n\n    priority: SLOT,\n    params: ['name'],\n\n    bind: function bind() {\n      // this was resolved during component transclusion\n      var name = this.params.name || 'default';\n      var content = this.vm._slotContents && this.vm._slotContents[name];\n      if (!content || !content.hasChildNodes()) {\n        this.fallback();\n      } else {\n        this.compile(content.cloneNode(true), this.vm._context, this.vm);\n      }\n    },\n\n    compile: function compile(content, context, host) {\n      if (content && context) {\n        if (this.el.hasChildNodes() && content.childNodes.length === 1 && content.childNodes[0].nodeType === 1 && content.childNodes[0].hasAttribute('v-if')) {\n          // if the inserted slot has v-if\n          // inject fallback content as the v-else\n          var elseBlock = document.createElement('template');\n          elseBlock.setAttribute('v-else', '');\n          elseBlock.innerHTML = this.el.innerHTML;\n          // the else block should be compiled in child scope\n          elseBlock._context = this.vm;\n          content.appendChild(elseBlock);\n        }\n        var scope = host ? host._scope : this._scope;\n        this.unlink = context.$compile(content, host, scope, this._frag);\n      }\n      if (content) {\n        replace(this.el, content);\n      } else {\n        remove(this.el);\n      }\n    },\n\n    fallback: function fallback() {\n      this.compile(extractContent(this.el, true), this.vm);\n    },\n\n    unbind: function unbind() {\n      if (this.unlink) {\n        this.unlink();\n      }\n    }\n  };\n\n  var partial = {\n\n    priority: PARTIAL,\n\n    params: ['name'],\n\n    // watch changes to name for dynamic partials\n    paramWatchers: {\n      name: function name(value) {\n        vIf.remove.call(this);\n        if (value) {\n          this.insert(value);\n        }\n      }\n    },\n\n    bind: function bind() {\n      this.anchor = createAnchor('v-partial');\n      replace(this.el, this.anchor);\n      this.insert(this.params.name);\n    },\n\n    insert: function insert(id) {\n      var partial = resolveAsset(this.vm.$options, 'partials', id, true);\n      if (partial) {\n        this.factory = new FragmentFactory(this.vm, partial);\n        vIf.insert.call(this);\n      }\n    },\n\n    unbind: function unbind() {\n      if (this.frag) {\n        this.frag.destroy();\n      }\n    }\n  };\n\n  var elementDirectives = {\n    slot: slot,\n    partial: partial\n  };\n\n  var convertArray = vFor._postProcess;\n\n  /**\n   * Limit filter for arrays\n   *\n   * @param {Number} n\n   * @param {Number} offset (Decimal expected)\n   */\n\n  function limitBy(arr, n, offset) {\n    offset = offset ? parseInt(offset, 10) : 0;\n    n = toNumber(n);\n    return typeof n === 'number' ? arr.slice(offset, offset + n) : arr;\n  }\n\n  /**\n   * Filter filter for arrays\n   *\n   * @param {String} search\n   * @param {String} [delimiter]\n   * @param {String} ...dataKeys\n   */\n\n  function filterBy(arr, search, delimiter) {\n    arr = convertArray(arr);\n    if (search == null) {\n      return arr;\n    }\n    if (typeof search === 'function') {\n      return arr.filter(search);\n    }\n    // cast to lowercase string\n    search = ('' + search).toLowerCase();\n    // allow optional `in` delimiter\n    // because why not\n    var n = delimiter === 'in' ? 3 : 2;\n    // extract and flatten keys\n    var keys = Array.prototype.concat.apply([], toArray(arguments, n));\n    var res = [];\n    var item, key, val, j;\n    for (var i = 0, l = arr.length; i < l; i++) {\n      item = arr[i];\n      val = item && item.$value || item;\n      j = keys.length;\n      if (j) {\n        while (j--) {\n          key = keys[j];\n          if (key === '$key' && contains(item.$key, search) || contains(getPath(val, key), search)) {\n            res.push(item);\n            break;\n          }\n        }\n      } else if (contains(item, search)) {\n        res.push(item);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Filter filter for arrays\n   *\n   * @param {String|Array<String>|Function} ...sortKeys\n   * @param {Number} [order]\n   */\n\n  function orderBy(arr) {\n    var comparator = null;\n    var sortKeys = undefined;\n    arr = convertArray(arr);\n\n    // determine order (last argument)\n    var args = toArray(arguments, 1);\n    var order = args[args.length - 1];\n    if (typeof order === 'number') {\n      order = order < 0 ? -1 : 1;\n      args = args.length > 1 ? args.slice(0, -1) : args;\n    } else {\n      order = 1;\n    }\n\n    // determine sortKeys & comparator\n    var firstArg = args[0];\n    if (!firstArg) {\n      return arr;\n    } else if (typeof firstArg === 'function') {\n      // custom comparator\n      comparator = function (a, b) {\n        return firstArg(a, b) * order;\n      };\n    } else {\n      // string keys. flatten first\n      sortKeys = Array.prototype.concat.apply([], args);\n      comparator = function (a, b, i) {\n        i = i || 0;\n        return i >= sortKeys.length - 1 ? baseCompare(a, b, i) : baseCompare(a, b, i) || comparator(a, b, i + 1);\n      };\n    }\n\n    function baseCompare(a, b, sortKeyIndex) {\n      var sortKey = sortKeys[sortKeyIndex];\n      if (sortKey) {\n        if (sortKey !== '$key') {\n          if (isObject(a) && '$value' in a) a = a.$value;\n          if (isObject(b) && '$value' in b) b = b.$value;\n        }\n        a = isObject(a) ? getPath(a, sortKey) : a;\n        b = isObject(b) ? getPath(b, sortKey) : b;\n      }\n      return a === b ? 0 : a > b ? order : -order;\n    }\n\n    // sort on a copy to avoid mutating original array\n    return arr.slice().sort(comparator);\n  }\n\n  /**\n   * String contain helper\n   *\n   * @param {*} val\n   * @param {String} search\n   */\n\n  function contains(val, search) {\n    var i;\n    if (isPlainObject(val)) {\n      var keys = Object.keys(val);\n      i = keys.length;\n      while (i--) {\n        if (contains(val[keys[i]], search)) {\n          return true;\n        }\n      }\n    } else if (isArray(val)) {\n      i = val.length;\n      while (i--) {\n        if (contains(val[i], search)) {\n          return true;\n        }\n      }\n    } else if (val != null) {\n      return val.toString().toLowerCase().indexOf(search) > -1;\n    }\n  }\n\n  var digitsRE = /(\\d{3})(?=\\d)/g;\n\n  // asset collections must be a plain object.\n  var filters = {\n\n    orderBy: orderBy,\n    filterBy: filterBy,\n    limitBy: limitBy,\n\n    /**\n     * Stringify value.\n     *\n     * @param {Number} indent\n     */\n\n    json: {\n      read: function read(value, indent) {\n        return typeof value === 'string' ? value : JSON.stringify(value, null, arguments.length > 1 ? indent : 2);\n      },\n      write: function write(value) {\n        try {\n          return JSON.parse(value);\n        } catch (e) {\n          return value;\n        }\n      }\n    },\n\n    /**\n     * 'abc' => 'Abc'\n     */\n\n    capitalize: function capitalize(value) {\n      if (!value && value !== 0) return '';\n      value = value.toString();\n      return value.charAt(0).toUpperCase() + value.slice(1);\n    },\n\n    /**\n     * 'abc' => 'ABC'\n     */\n\n    uppercase: function uppercase(value) {\n      return value || value === 0 ? value.toString().toUpperCase() : '';\n    },\n\n    /**\n     * 'AbC' => 'abc'\n     */\n\n    lowercase: function lowercase(value) {\n      return value || value === 0 ? value.toString().toLowerCase() : '';\n    },\n\n    /**\n     * 12345 => $12,345.00\n     *\n     * @param {String} sign\n     * @param {Number} decimals Decimal places\n     */\n\n    currency: function currency(value, _currency, decimals) {\n      value = parseFloat(value);\n      if (!isFinite(value) || !value && value !== 0) return '';\n      _currency = _currency != null ? _currency : '$';\n      decimals = decimals != null ? decimals : 2;\n      var stringified = Math.abs(value).toFixed(decimals);\n      var _int = decimals ? stringified.slice(0, -1 - decimals) : stringified;\n      var i = _int.length % 3;\n      var head = i > 0 ? _int.slice(0, i) + (_int.length > 3 ? ',' : '') : '';\n      var _float = decimals ? stringified.slice(-1 - decimals) : '';\n      var sign = value < 0 ? '-' : '';\n      return sign + _currency + head + _int.slice(i).replace(digitsRE, '$1,') + _float;\n    },\n\n    /**\n     * 'item' => 'items'\n     *\n     * @params\n     *  an array of strings corresponding to\n     *  the single, double, triple ... forms of the word to\n     *  be pluralized. When the number to be pluralized\n     *  exceeds the length of the args, it will use the last\n     *  entry in the array.\n     *\n     *  e.g. ['single', 'double', 'triple', 'multiple']\n     */\n\n    pluralize: function pluralize(value) {\n      var args = toArray(arguments, 1);\n      var length = args.length;\n      if (length > 1) {\n        var index = value % 10 - 1;\n        return index in args ? args[index] : args[length - 1];\n      } else {\n        return args[0] + (value === 1 ? '' : 's');\n      }\n    },\n\n    /**\n     * Debounce a handler function.\n     *\n     * @param {Function} handler\n     * @param {Number} delay = 300\n     * @return {Function}\n     */\n\n    debounce: function debounce(handler, delay) {\n      if (!handler) return;\n      if (!delay) {\n        delay = 300;\n      }\n      return _debounce(handler, delay);\n    }\n  };\n\n  function installGlobalAPI (Vue) {\n    /**\n     * Vue and every constructor that extends Vue has an\n     * associated options object, which can be accessed during\n     * compilation steps as `this.constructor.options`.\n     *\n     * These can be seen as the default options of every\n     * Vue instance.\n     */\n\n    Vue.options = {\n      directives: directives,\n      elementDirectives: elementDirectives,\n      filters: filters,\n      transitions: {},\n      components: {},\n      partials: {},\n      replace: true\n    };\n\n    /**\n     * Expose useful internals\n     */\n\n    Vue.util = util;\n    Vue.config = config;\n    Vue.set = set;\n    Vue['delete'] = del;\n    Vue.nextTick = nextTick;\n\n    /**\n     * The following are exposed for advanced usage / plugins\n     */\n\n    Vue.compiler = compiler;\n    Vue.FragmentFactory = FragmentFactory;\n    Vue.internalDirectives = internalDirectives;\n    Vue.parsers = {\n      path: path,\n      text: text,\n      template: template,\n      directive: directive,\n      expression: expression\n    };\n\n    /**\n     * Each instance constructor, including Vue, has a unique\n     * cid. This enables us to create wrapped \"child\n     * constructors\" for prototypal inheritance and cache them.\n     */\n\n    Vue.cid = 0;\n    var cid = 1;\n\n    /**\n     * Class inheritance\n     *\n     * @param {Object} extendOptions\n     */\n\n    Vue.extend = function (extendOptions) {\n      extendOptions = extendOptions || {};\n      var Super = this;\n      var isFirstExtend = Super.cid === 0;\n      if (isFirstExtend && extendOptions._Ctor) {\n        return extendOptions._Ctor;\n      }\n      var name = extendOptions.name || Super.options.name;\n      if ('development' !== 'production') {\n        if (!/^[a-zA-Z][\\w-]*$/.test(name)) {\n          warn('Invalid component name: \"' + name + '\". Component names ' + 'can only contain alphanumeric characaters and the hyphen.');\n          name = null;\n        }\n      }\n      var Sub = createClass(name || 'VueComponent');\n      Sub.prototype = Object.create(Super.prototype);\n      Sub.prototype.constructor = Sub;\n      Sub.cid = cid++;\n      Sub.options = mergeOptions(Super.options, extendOptions);\n      Sub['super'] = Super;\n      // allow further extension\n      Sub.extend = Super.extend;\n      // create asset registers, so extended classes\n      // can have their private assets too.\n      config._assetTypes.forEach(function (type) {\n        Sub[type] = Super[type];\n      });\n      // enable recursive self-lookup\n      if (name) {\n        Sub.options.components[name] = Sub;\n      }\n      // cache constructor\n      if (isFirstExtend) {\n        extendOptions._Ctor = Sub;\n      }\n      return Sub;\n    };\n\n    /**\n     * A function that returns a sub-class constructor with the\n     * given name. This gives us much nicer output when\n     * logging instances in the console.\n     *\n     * @param {String} name\n     * @return {Function}\n     */\n\n    function createClass(name) {\n      /* eslint-disable no-new-func */\n      return new Function('return function ' + classify(name) + ' (options) { this._init(options) }')();\n      /* eslint-enable no-new-func */\n    }\n\n    /**\n     * Plugin system\n     *\n     * @param {Object} plugin\n     */\n\n    Vue.use = function (plugin) {\n      /* istanbul ignore if */\n      if (plugin.installed) {\n        return;\n      }\n      // additional parameters\n      var args = toArray(arguments, 1);\n      args.unshift(this);\n      if (typeof plugin.install === 'function') {\n        plugin.install.apply(plugin, args);\n      } else {\n        plugin.apply(null, args);\n      }\n      plugin.installed = true;\n      return this;\n    };\n\n    /**\n     * Apply a global mixin by merging it into the default\n     * options.\n     */\n\n    Vue.mixin = function (mixin) {\n      Vue.options = mergeOptions(Vue.options, mixin);\n    };\n\n    /**\n     * Create asset registration methods with the following\n     * signature:\n     *\n     * @param {String} id\n     * @param {*} definition\n     */\n\n    config._assetTypes.forEach(function (type) {\n      Vue[type] = function (id, definition) {\n        if (!definition) {\n          return this.options[type + 's'][id];\n        } else {\n          /* istanbul ignore if */\n          if ('development' !== 'production') {\n            if (type === 'component' && (commonTagRE.test(id) || reservedTagRE.test(id))) {\n              warn('Do not use built-in or reserved HTML elements as component ' + 'id: ' + id);\n            }\n          }\n          if (type === 'component' && isPlainObject(definition)) {\n            if (!definition.name) {\n              definition.name = id;\n            }\n            definition = Vue.extend(definition);\n          }\n          this.options[type + 's'][id] = definition;\n          return definition;\n        }\n      };\n    });\n\n    // expose internal transition API\n    extend(Vue.transition, transition);\n  }\n\n  installGlobalAPI(Vue);\n\n  Vue.version = '1.0.26';\n\n  // devtools global hook\n  /* istanbul ignore next */\n  setTimeout(function () {\n    if (config.devtools) {\n      if (devtools) {\n        devtools.emit('init', Vue);\n      } else if ('development' !== 'production' && inBrowser && /Chrome\\/\\d+/.test(window.navigator.userAgent)) {\n        console.log('Download the Vue Devtools for a better development experience:\\n' + 'https://github.com/vuejs/vue-devtools');\n      }\n    }\n  }, 0);\n\n  return Vue;\n\n}));"]}]}